

  <!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/Article">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Pinterest & Google verification -->
  <meta name="p:domain_verify" content="fb68a8459fe32b8b072bcd5cc620d125"/>
  <meta name="google-site-verification" content="WAkFPi5cvufClnQetgIl0STmvvwHhVf8jfyENFWhsxU" />
  <meta name="google-site-verification" content="g2pFZlv-92XQD67BPgiVHsvZ4TZH13Ucvmmvvv36kU4" />

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How to perform online video processing from the client’s… | PyShine</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="How to perform online video processing from the client’s…" />
<meta name="author" content="PyShine Team" />
<meta property="og:locale" content="en" />
<meta name="description" content="This tutorial is about obtaining live frames of a client’s camera, process it and provide result back to the client" />
<meta property="og:description" content="This tutorial is about obtaining live frames of a client’s camera, process it and provide result back to the client" />
<link rel="canonical" href="https://www.pyshine.com/Online-Video-Processing-From-Client-Camera/" />
<meta property="og:url" content="https://www.pyshine.com/Online-Video-Processing-From-Client-Camera/" />
<meta property="og:site_name" content="PyShine" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-06T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to perform online video processing from the client’s…" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"PyShine Team"},"dateModified":"2021-06-06T00:00:00+08:00","datePublished":"2021-06-06T00:00:00+08:00","description":"This tutorial is about obtaining live frames of a client’s camera, process it and provide result back to the client","headline":"How to perform online video processing from the client’s…","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.pyshine.com/Online-Video-Processing-From-Client-Camera/"},"name":"{{ page.title escape }}","url":"https://www.pyshine.com/Online-Video-Processing-From-Client-Camera/"}</script>
<!-- End Jekyll SEO tag -->
  <!-- This will generate the canonical link automatically -->

  <script src="https://analytics.ahrefs.com/analytics.js" data-key="Im0K82YsmEDy08+6wyUIZA" async></script>

  <!-- Favicon & App Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77">
  <link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77">
  <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77">
  <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]-->

  <!-- App & Theme Info -->
  <meta name="apple-mobile-web-app-title" content="Sleek">
  <meta name="application-name" content="Sleek">
  <meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77">
  <meta name="theme-color" content="#ffffff">

  
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-TCVFBKF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GTM-TCVFBKF');
</script>

  

  <!-- Critical CSS Inline -->
  <style class="inlineCSS">
    h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#19d319}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none;border-bottom:1px dashed #277cea}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px}@media (min-width:0){.container{max-width:auto;margin:0 auto}}@media (min-width:36em){.container{max-width:540px;margin:0 auto}}@media (min-width:48em){.container{max-width:720px;margin:0 auto}}@media (min-width:62em){.container{max-width:960px;margin:0 auto}}@media (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:0}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;border-bottom:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:none;position:absolute;top:3.75em;left:0;width:100%;height:auto;background:#fff}.header__link{color:#343851;padding:.938rem 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;padding:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;visibility:visible;width:auto;height:100%}.header__links-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;padding:0}.header__link{position:relative;padding:.938rem 1rem;border:0;height:100%}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;position:relative;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:2.25rem;border-bottom:0}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__label{position:absolute;top:1.5rem;left:1.5rem;z-index:2}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.post-card__inner{padding:1.875rem 1.25rem .625rem;color:#838c8d}.post-card__header{margin-bottom:.75rem}.post-card__header .post-card__meta{font-size:.875rem}.label{padding:0 10px;margin-bottom:1rem;display:inline-block;line-height:20px;font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.8);border:2px solid rgba(255,255,255,.5);border-radius:100px}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;margin:auto;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);width:100%;max-width:90%;z-index:1}.hero__wrap .hero__title{font-size:1.8em;color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media (min-width:48em){.hero__wrap{max-width:40em}.hero__wrap .hero__title{padding:1rem 0;font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}
  </style>

  <!-- Main CSS -->
  <link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript>

  <script type="text/javascript">
    /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
(function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}}
var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1}
return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia}
if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)}
setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return}
var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}}
if(typeof exports!=="undefined"){exports.loadCSS=loadCSS}
else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this))

  </script>

  <!-- MathJax -->
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>


  <body class="site" itemscope itemtype="https://schema.org/WebPage">

    
      <!-- Google Tag Manager (noscript) -->
      <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TCVFBKF"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
      </noscript>
      <!-- End Google Tag Manager -->
    

    <header class="header" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation">
  <div class="container">
    <div class="header__inner">
      <!-- Logo -->
      <a class="header__logo" href="/">
        <div class="header__logo--container">
          <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>

	
	
</g>
</svg>

        </div>
      </a>

      <!-- Navigation Links -->
      <nav class="header__links">
        <div class="container header__links-wrapper">
          
            <a class="header__link" href="/" itemprop="url">
              <span itemprop="name">Home</span>
            </a>
          
            <a class="header__link" href="/categories" itemprop="url">
              <span itemprop="name">Categories</span>
            </a>
          
            <a class="header__link" href="/converter.html" itemprop="url">
              <span itemprop="name">Free PNG Converter</span>
            </a>
          
            <a class="header__link" href="/about" itemprop="url">
              <span itemprop="name">About</span>
            </a>
          
            <a class="header__link" href="/contact" itemprop="url">
              <span itemprop="name">Contact</span>
            </a>
          
            <a class="header__link" href="/privacy" itemprop="url">
              <span itemprop="name">Privacy Policy</span>
            </a>
          
            <a class="header__link" href="/disclaimer" itemprop="url">
              <span itemprop="name">Disclaimer</span>
            </a>
          
        </div>
      </nav>

      <!-- Mobile Menu Toggle -->
      <div class="header__toggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
</header>


    
      <div class="hero dark-bg" role="img" aria-label="How to perform online video processing from the client's...">
    
        <div class="hero__wrap">
          
            <div class="hero__categories">
              
                <a class="label"
                   href="/categories/#Tutorial Series"
                   aria-label="Category: Tutorial Series">
                   Tutorial Series
                </a>
                
              
            </div>
          

          <h1 class="hero__title" itemprop="headline">How to perform online video processing from the client's...</h1>

          <p class="hero__meta">
            <time datetime="2021-06-06T00:00:00+08:00" itemprop="datePublished">
              06 Jun 2021
            </time>
            &nbsp;·&nbsp;
            
            <span itemprop="timeRequired">
              
                13 mins read
              
            </span>
          </p>
        </div>
      </div>

    <main class="site__content" role="main">
      <div class="container">

        <article class="post-content"
                 itemprop="articleBody"
                 itemscope itemtype="https://schema.org/Article">
          
          <p>Hi friends, hope you are doing great! Today’s tutorial is about using Flask, Socket.io and JavaScript, to obtain frames from a client’s camera, then process it
at the server side and then send the output to the client. This approach enables online services especially from the deployment point of view. Clients can use 
deep learning-based services from a webserver. Before proceeding to the tutorial please note that these days such approach is seldom used to avoid longer network
latencies. In most applications the camera of a client (smart phone) is used to obtain the frames. Thanks to the compact yet powerful computing resources at the client 
devices the frames are also processed at the client side to provide extremely low latency. A simple example is an app where a user face is replaced by a funny cartoon
on a smart phone.</p>

<p><a href="https://youtu.be/q6qHIsZ6V8s" title="GIF"><img src="https://github.com/py2ai/py2ai.github.io/blob/master/assets/img/posts/flasklipsonlinegif.gif?raw=true" alt="GIF" /></a></p>

<p>However, there are still some areas that require processing only at the server side, and where latency is not a major concern. One of such cases is where a server
side processing is cost consuming and the client have to pay for the services of the server. e.g., sending a client face to tryon glasses or facial recognition from
a huge data base, etc.</p>

<p>Alright, let’s proceed with the basic plan of this tutorial. At client side it will use the method named <code class="language-plaintext highlighter-rouge">MediaDevices.getUserMedia()</code>. It prompts the user for permission to use 
a media input which produces a MediaStream with tracks containing the requested types of media. That stream can include, for example, a video track (produced by either a hardware 
or virtual video source such as a camera, video recording device, screen sharing service, and so forth), an audio track (similarly, produced by a physical or virtual audio source 
like a microphone, A/D converter, or the like), and possibly other track types. It returns a Promise that resolves to a MediaStream object. If the user denies permission, or matching 
media is not available, then the promise is rejected with NotAllowedError or NotFoundError respectively. Next, we will use Socket.io, which enables real-time, bidirectional 
and event-based communication. It works on every platform, browser or device, focusing equally on reliability and speed. We will keep the frame rate at 6 FPS but you can
try various values and note the variations in latencies.</p>

<h1 id="important-installation-steps-to-aviod-any-issues">Important installation steps to aviod any issues</h1>

<p>We need to install the proper working version of Werkzeug i.e. (Werkzeug-0.10.2.dev0dev-20220510) . In addition install the following versions</p>

<p><code class="language-plaintext highlighter-rouge">pip3 install Flask-SocketIO==4.3.1</code></p>

<p><code class="language-plaintext highlighter-rouge">pip3 install python-engineio==3.13.2</code></p>

<p><code class="language-plaintext highlighter-rouge">pip3 install python-socketio==4.6.0</code></p>

<p><code class="language-plaintext highlighter-rouge">pip3 install git+https://github.com/untitaker/werkzeug.git@reloader-perf</code></p>

<p>Please note that the above installations will resolve following issues:</p>
<ul>
  <li>ImportError: cannot import name ‘run_with_reloader’ from ‘werkzeug.serving’</li>
  <li>The client is using an unsupported version of the Socket.IO or Engine.IO protocols (further occurrences of this error will be logged with level INFO)</li>
  <li>“GET /socket.io/?EIO=3&amp;transport=polling&amp;t=O2j_BJX HTTP/1.1” 400</li>
</ul>

<p>We will use <code class="language-plaintext highlighter-rouge">socket.emit('image', data);</code> to send the image frame as data to server, and then after processing this data at server we will get the response at the client
side using <code class="language-plaintext highlighter-rouge">socket.on('response_back', function(image){photo.setAttribute('src', image );});</code>.</p>

<p>At the server side we will run a Flask based App which will use Dlib library to obtain 68 feature points of a face and then replace the lips color as the output image.
It is highly recommend to follow these two links before proceeding:</p>
<ol>
  <li>https://pyshine.com/How-to-make-a-lipstick-tryon-app-in-PyQt5/</li>
  <li>https://pyshine.com/How-to-quickly-deploy-flask-application-for-video/</li>
</ol>

<p>In a project folder we require following files:</p>

<ol>
  <li>process.py</li>
  <li>shape_predictor_68_face_landmarks.dat: can be downloaded by following description in above link.</li>
  <li>templates/index.html</li>
  <li>ngrok: can be downloaded from https://ngrok.com/download for port forwarding, so that your localhost (or server address) is availble to the public on the internet.</li>
</ol>

<h2 id="indexhtml">index.html</h2>
<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Title<span class="nt">&lt;/title&gt;</span>

    <span class="nt">&lt;style&gt;</span>
    	<span class="nf">#video</span> <span class="p">{</span>
    		<span class="nl">transform</span><span class="p">:</span> <span class="n">rotateY</span><span class="p">(</span><span class="m">180deg</span><span class="p">);</span>
    		<span class="nl">-webkit-transform</span><span class="p">:</span><span class="n">rotateY</span><span class="p">(</span><span class="m">180deg</span><span class="p">);</span> <span class="c">/* Safari and Chrome */</span>
    		<span class="nl">-moz-transform</span><span class="p">:</span><span class="n">rotateY</span><span class="p">(</span><span class="m">180deg</span><span class="p">);</span> <span class="c">/* Firefox */</span>
    		
    	<span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
    
     <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
     <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">'https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.0/socket.io.js'</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;video</span> <span class="na">autoplay</span> <span class="na">playsinline</span> <span class="na">id=</span><span class="s">"videoElement"</span><span class="nt">&gt;&lt;/video&gt;</span>
    <span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">"canvas"</span>  <span class="na">width=</span><span class="s">"400"</span> <span class="na">height=</span><span class="s">"300"</span><span class="nt">&gt;&lt;/canvas&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class = </span><span class="s">'video'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"photo"</span>  <span class="na">width=</span><span class="s">"400"</span>  <span class="na">height=</span><span class="s">"300"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>video<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
      
        <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">//</span><span class="dl">'</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">domain</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">:</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">location</span><span class="p">.</span><span class="nx">port</span><span class="p">);</span>
        <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Connected...!</span><span class="dl">"</span><span class="p">,</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">connected</span><span class="p">)</span>
        <span class="p">});</span>


        <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">canvas</span><span class="dl">'</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">video</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#videoElement</span><span class="dl">"</span><span class="p">);</span>

        <span class="nx">video</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span> 
    

        <span class="k">if</span> <span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span> <span class="na">video</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">stream</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">video</span><span class="p">.</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">;</span>
                <span class="nx">video</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err0r</span><span class="p">)</span> <span class="p">{</span>

            <span class="p">});</span>
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">FPS</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
        <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">width</span><span class="o">=</span><span class="nx">video</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
            <span class="nx">height</span><span class="o">=</span><span class="nx">video</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
            <span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">video</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span> <span class="p">,</span> <span class="nx">height</span> <span class="p">);</span>
            <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="dl">'</span><span class="s1">image/jpeg</span><span class="dl">'</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
            <span class="nx">context</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span><span class="nx">height</span> <span class="p">);</span>
            <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">1000</span><span class="o">/</span><span class="nx">FPS</span><span class="p">);</span>

        <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">response_back</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">){</span>
                <span class="nx">photo</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">src</span><span class="dl">'</span><span class="p">,</span> <span class="nx">image</span> <span class="p">);</span>
                
        <span class="p">});</span>

    <span class="nt">&lt;/script&gt;</span>


 <span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>

</code></pre></div></div>

<h3 id="processpy">process.py</h3>
<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span>
<span class="kn">from</span> <span class="nn">flask_socketio</span> <span class="kn">import</span> <span class="n">SocketIO</span><span class="p">,</span> <span class="n">emit</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">base64</span><span class="p">,</span><span class="n">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pyshine</span> <span class="k">as</span> <span class="n">ps</span>
<span class="kn">from</span> <span class="nn">flask_cors</span> <span class="kn">import</span> <span class="n">CORS</span><span class="p">,</span><span class="n">cross_origin</span>
<span class="kn">import</span> <span class="nn">imutils</span>
<span class="kn">import</span> <span class="nn">dlib</span>
<span class="kn">from</span> <span class="nn">engineio.payload</span> <span class="kn">import</span> <span class="n">Payload</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">dlib</span><span class="p">.</span><span class="n">get_frontal_face_detector</span><span class="p">()</span>
<span class="n">predictor</span> <span class="o">=</span> <span class="n">dlib</span><span class="p">.</span><span class="n">shape_predictor</span><span class="p">(</span><span class="s">"shape_predictor_68_face_landmarks.dat"</span><span class="p">)</span>
<span class="n">Payload</span><span class="p">.</span><span class="n">max_decode_packets</span> <span class="o">=</span> <span class="mi">2048</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">socketio</span> <span class="o">=</span> <span class="n">SocketIO</span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="n">cors_allowed_origins</span><span class="o">=</span><span class="s">'*'</span> <span class="p">)</span>



<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">,</span> <span class="s">'GET'</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">readb64</span><span class="p">(</span><span class="n">base64_string</span><span class="p">):</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">base64_string</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'base64,'</span><span class="p">)</span>
    <span class="n">base64_string</span>  <span class="o">=</span> <span class="n">base64_string</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">7</span><span class="p">:]</span>

    <span class="n">sbuf</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">BytesIO</span><span class="p">()</span>

    <span class="n">sbuf</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">base64</span><span class="p">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">base64_string</span><span class="p">,</span> <span class="s">' /'</span><span class="p">))</span>
    <span class="n">pimg</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">sbuf</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">pimg</span><span class="p">),</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_RGB2BGR</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">moving_average</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="o">@</span><span class="n">socketio</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'catch-frame'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">catch_frame</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

    <span class="n">emit</span><span class="p">(</span><span class="s">'response_back'</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>  


<span class="k">global</span> <span class="n">fps</span><span class="p">,</span><span class="n">prev_recv_time</span><span class="p">,</span><span class="n">cnt</span><span class="p">,</span><span class="n">fps_array</span>
<span class="n">fps</span><span class="o">=</span><span class="mi">30</span>
<span class="n">prev_recv_time</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cnt</span><span class="o">=</span><span class="mi">0</span>
<span class="n">fps_array</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="o">@</span><span class="n">socketio</span><span class="p">.</span><span class="n">on</span><span class="p">(</span><span class="s">'image'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">image</span><span class="p">(</span><span class="n">data_image</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">fps</span><span class="p">,</span><span class="n">cnt</span><span class="p">,</span> <span class="n">prev_recv_time</span><span class="p">,</span><span class="n">fps_array</span>
    <span class="n">recv_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">text</span>  <span class="o">=</span>  <span class="s">'FPS: '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="p">(</span><span class="n">readb64</span><span class="p">(</span><span class="n">data_image</span><span class="p">))</span>

    <span class="n">frame</span> <span class="o">=</span> <span class="n">changeLipstick</span><span class="p">(</span><span class="n">frame</span><span class="p">,[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">ps</span><span class="p">.</span><span class="n">putBText</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">text_offset_x</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">text_offset_y</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">vspace</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">background_RGB</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">222</span><span class="p">),</span><span class="n">text_RGB</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">imgencode</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imencode</span><span class="p">(</span><span class="s">'.jpeg'</span><span class="p">,</span> <span class="n">frame</span><span class="p">,[</span><span class="n">cv2</span><span class="p">.</span><span class="n">IMWRITE_JPEG_QUALITY</span><span class="p">,</span><span class="mi">40</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">## base64 encode
</span>    <span class="n">stringData</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">imgencode</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
    <span class="n">b64_src</span> <span class="o">=</span> <span class="s">'data:image/jpeg;base64,'</span>
    <span class="n">stringData</span> <span class="o">=</span> <span class="n">b64_src</span> <span class="o">+</span> <span class="n">stringData</span>

    <span class="c1">## emit the frame back
</span>    <span class="n">emit</span><span class="p">(</span><span class="s">'response_back'</span><span class="p">,</span> <span class="n">stringData</span><span class="p">)</span>
    
    <span class="n">fps</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">recv_time</span> <span class="o">-</span> <span class="n">prev_recv_time</span><span class="p">)</span>
    <span class="n">fps_array</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">moving_average</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">fps_array</span><span class="p">)),</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">prev_recv_time</span> <span class="o">=</span> <span class="n">recv_time</span>
    <span class="c1">#print(fps_array)
</span>    <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">cnt</span><span class="o">==</span><span class="mi">30</span><span class="p">:</span>
        <span class="n">fps_array</span><span class="o">=</span><span class="p">[</span><span class="n">fps</span><span class="p">]</span>
        <span class="n">cnt</span><span class="o">=</span><span class="mi">0</span>
    



<span class="k">def</span> <span class="nf">getMaskOfLips</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">points</span><span class="p">):</span>
    <span class="s">""" This function will input the lips points and the image
        It will return the mask of lips region containing white pixels
    """</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">mask</span><span class="p">,[</span><span class="n">points</span><span class="p">],(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mask</span> 


<span class="k">def</span> <span class="nf">changeLipstick</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
    <span class="s">""" This funciton will take img image and lipstick color RGB
        Out the image with a changed lip color of the image
    """</span> 

    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">imgOriginal</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">imgColorLips</span><span class="o">=</span><span class="n">imgOriginal</span>
    <span class="n">imgGray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">faces</span> <span class="o">=</span> <span class="n">detector</span><span class="p">(</span><span class="n">imgGray</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">face</span><span class="p">.</span><span class="n">left</span><span class="p">(),</span><span class="n">face</span><span class="p">.</span><span class="n">top</span><span class="p">()</span>
        <span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">face</span><span class="p">.</span><span class="n">right</span><span class="p">(),</span><span class="n">face</span><span class="p">.</span><span class="n">bottom</span><span class="p">()</span>
       
        <span class="n">facial_landmarks</span> <span class="o">=</span> <span class="n">predictor</span><span class="p">(</span><span class="n">imgGray</span><span class="p">,</span><span class="n">face</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">68</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">facial_landmarks</span><span class="p">.</span><span class="n">part</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">facial_landmarks</span><span class="p">.</span><span class="n">part</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">y</span>
            <span class="n">points</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>


        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">imgLips</span> <span class="o">=</span> <span class="n">getMaskOfLips</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">points</span><span class="p">[</span><span class="mi">48</span><span class="p">:</span><span class="mi">61</span><span class="p">])</span>
        
        <span class="n">imgColorLips</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">imgLips</span><span class="p">)</span>
        
        <span class="n">imgColorLips</span><span class="p">[:]</span> <span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">imgColorLips</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">imgLips</span><span class="p">,</span><span class="n">imgColorLips</span><span class="p">)</span>
        
        <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="o">//</span><span class="mi">10</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">kernel_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="o">+</span><span class="n">value</span><span class="p">,</span><span class="mi">6</span><span class="o">+</span><span class="n">value</span><span class="p">)</span> <span class="c1"># +1 is to avoid 0
</span>        
        <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">+</span> <span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="o">/</span><span class="mi">400</span>
        <span class="n">imgColorLips</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">imgColorLips</span><span class="p">,</span><span class="n">kernel_size</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">imgColorLips</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">imgOriginal</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">imgColorLips</span><span class="p">,</span><span class="n">weight</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        
        
        
    <span class="k">return</span> <span class="n">imgColorLips</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">socketio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">9990</span> <span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
   

</code></pre></div></div>

<p>From the main project folder execute this command:</p>

<p><code class="language-plaintext highlighter-rouge">python3 process.py</code></p>

<p>Once the app gets running you will see this <code class="language-plaintext highlighter-rouge">wsgi starting up on http://127.0.0.1:9990</code></p>

<p>That’s the time when we need to open up another terminal window from the main project folder and run ngrok as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./ngrok http 9990
</code></pre></div></div>

<p>Here 9990 is the port we have given at the server app. Once ngrok is running, you will see the something like the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ngrok by @inconshreveable                                    (Ctrl+C to quit)
                                                                             
Session Status                online                                         
Session Expires               1 hour, 59 minutes                             
Update                        update available (version 2.3.40, Ctrl-U to upd
Version                       2.3.35                                         
Region                        United States (us)                             
Web Interface                 http://127.0.0.1:4040                          
Forwarding                    http://8706ac67c71b.ngrok.io -&gt; http://localhos
Forwarding                    https://8706ac67c71b.ngrok.io -&gt; http://localho
                                                                             
Connections                   ttl     opn     rt1     rt5     p50     p90    
                              1       2       0.01    0.00    9.15    9.15   
                                                                             
HTTP Requests                                                                
-------------                                                                
                                                                             
POST /socket.io/               200 OK                                        
GET  /socket.io/               200 OK                            

</code></pre></div></div>

<p>It has forwarded the localhost with a temporary public address, which means your localhost is now accessible anywhere on the internet. Now we need to copy the <code class="language-plaintext highlighter-rouge">https</code>
link as <code class="language-plaintext highlighter-rouge">https://8706ac67c71b.ngrok.io</code> and paste in the client browser for example Safari. You will observe lips colors are changed in the output that is shown near
the input live stream at the client side.</p>



          <!-- Inline code styling -->
          <link href="/assets/css/syntax.css" rel="stylesheet">
          <script src="/assets/scripts/copyCode.js" async></script>

          <!-- Google Ad (responsive rectangle after content) -->
          <section aria-label="Advertisements" class="ads mt-4">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2976211678184829"
                 data-ad-slot="7658460605"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </section>

        </article>

        <!-- Post Navigation -->
        <nav class="post-navigation controls__inner mt-5" aria-label="Post navigation">
          <div class="controls__item prev">
            
              <span>Previous</span>
              <a href="/Live-streaming-multiple-videos-on-a-webpage/" rel="prev">
                How to stream multiple videos on an H...
              </a>
            
          </div>

          <div class="controls__item next">
            
              <span>Next</span>
              <a href="/Video-and-text-chat-in-python/" rel="next">
                Video and Text chat in Python
              </a>
            
          </div>
        </nav>

        <!-- Comments Section -->
        
          <section class="comments mt-5" aria-label="Comments Section">
            
<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = 'https://www.pyshine.com/Online-Video-Processing-From-Client-Camera/';
this.page.identifier = 'https://www.pyshine.com/Online-Video-Processing-From-Client-Camera/';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://https-py2ai-github-io.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the comments.</noscript>


          </section>
        

      </div>
    </main>

    <footer class="footer">
  <div class="container">
    <nav class="social">
      
      
      
    </nav>
    <span>&copy; 2025 PyShine. All rights reserved.</span>
  </div>
</footer>
<script async src="/assets/js/bundle.js"></script>

<script async>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function( registration ) {
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    })
    .catch(function(error) {
      console.log('ServiceWorker registration failed: ', error);
    });
  }
</script>



    <!-- Scripts at bottom for performance -->
    
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script
  type="text/javascript"
  charset="utf-8"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
>
</script>
<script
  type="text/javascript"
  charset="utf-8"
  src="https://vincenttam.github.io/javascripts/MathJaxLocal.js"
>
</script>



    <!-- Async Ads script globally -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  </body>
</html>


