

  <!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/Article">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Canonical URL - redirect www to non-www -->
  <link rel="canonical" href="https://pyshine.com/Clipboard-App-for-Two-PCs/">

  <!-- Pinterest & Google verification -->
  <meta name="p:domain_verify" content="fb68a8459fe32b8b072bcd5cc620d125"/>
  <meta name="google-site-verification" content="WAkFPi5cvufClnQetgIl0STmvvwHhVf8jfyENFWhsxU" />
  <meta name="google-site-verification" content="g2pFZlv-92XQD67BPgiVHsvZ4TZH13Ucvmmvvv36kU4" />

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>PyShine clipboard App for two PCs | PyShine</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="PyShine clipboard App for two PCs" />
<meta name="author" content="PyShine Team" />
<meta property="og:locale" content="en" />
<meta name="description" content="A free App that lets you connect two computers and copy paste text and transfer files over the network" />
<meta property="og:description" content="A free App that lets you connect two computers and copy paste text and transfer files over the network" />
<link rel="canonical" href="http://localhost:4000/Clipboard-App-for-Two-PCs/" />
<meta property="og:url" content="http://localhost:4000/Clipboard-App-for-Two-PCs/" />
<meta property="og:site_name" content="PyShine" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-01-27T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="PyShine clipboard App for two PCs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"PyShine Team"},"dateModified":"2026-01-27T00:00:00+08:00","datePublished":"2026-01-27T00:00:00+08:00","description":"A free App that lets you connect two computers and copy paste text and transfer files over the network","headline":"PyShine clipboard App for two PCs","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Clipboard-App-for-Two-PCs/"},"name":"{{ page.title escape }}","url":"http://localhost:4000/Clipboard-App-for-Two-PCs/"}</script>
<!-- End Jekyll SEO tag -->
  <!-- This will generate the canonical link automatically -->

  <script src="https://analytics.ahrefs.com/analytics.js" data-key="Im0K82YsmEDy08+6wyUIZA" async></script>

  <!-- Favicon & App Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77">
  <link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77">
  <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77">
  <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]-->

  <!-- App & Theme Info -->
  <meta name="apple-mobile-web-app-title" content="Sleek">
  <meta name="application-name" content="Sleek">
  <meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77">
  <meta name="theme-color" content="#ffffff">

  
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-TCVFBKF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GTM-TCVFBKF');
</script>

  

  <!-- Critical CSS Inline -->
  <style class="inlineCSS">
    h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#19d319}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none;border-bottom:1px dashed #277cea}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px}@media (min-width:0){.container{max-width:auto;margin:0 auto}}@media (min-width:36em){.container{max-width:540px;margin:0 auto}}@media (min-width:48em){.container{max-width:720px;margin:0 auto}}@media (min-width:62em){.container{max-width:960px;margin:0 auto}}@media (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:0}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;border-bottom:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:none;position:absolute;top:3.75em;left:0;width:100%;height:auto;background:#fff}.header__link{color:#343851;padding:.938rem 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;padding:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;visibility:visible;width:auto;height:100%}.header__links-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;padding:0}.header__link{position:relative;padding:.938rem 1rem;border:0;height:100%}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;position:relative;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:2.25rem;border-bottom:0}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__label{position:absolute;top:1.5rem;left:1.5rem;z-index:2}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.post-card__inner{padding:1.875rem 1.25rem .625rem;color:#838c8d}.post-card__header{margin-bottom:.75rem}.post-card__header .post-card__meta{font-size:.875rem}.label{padding:0 10px;margin-bottom:1rem;display:inline-block;line-height:20px;font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.8);border:2px solid rgba(255,255,255,.5);border-radius:100px}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;margin:auto;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);width:100%;max-width:90%;z-index:1}.hero__wrap .hero__title{font-size:1.8em;color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media (min-width:48em){.hero__wrap{max-width:40em}.hero__wrap .hero__title{padding:1rem 0;font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}
  </style>

  <!-- Main CSS -->
  <link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript>

  <script type="text/javascript">
    /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
(function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}}
var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1}
return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia}
if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)}
setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return}
var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}}
if(typeof exports!=="undefined"){exports.loadCSS=loadCSS}
else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this))

  </script>

  <!-- MathJax -->
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>


  <body class="site" itemscope itemtype="https://schema.org/WebPage">

    
      <!-- Google Tag Manager (noscript) -->
      <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TCVFBKF"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
      </noscript>
      <!-- End Google Tag Manager -->
    

    <header class="header"
  itemscope
  itemtype="http://schema.org/SiteNavigationElement"
  aria-label="Main navigation">

  <div class="container">
    <div class="header__inner">

      <!-- Logo -->
      <a class="header__logo" href="/">
        <div class="header__logo--container">
          <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>

	
	
</g>
</svg>

        </div>
      </a>

      <!-- Navigation -->
      <nav class="header__links">
        <div class="header__links-wrapper">

          
            
              <a class="header__link" href="/">
                Home
              </a>
            
          
            
              <a class="header__link" href="/categories">
                Posts
              </a>
            
          
            

            <!-- Applications Dropdown -->
            <div class="header__dropdown">
              <span class="header__link header__dropdown-toggle">
                Applications
                <span class="dropdown-arrow">‚ñæ</span>
              </span>

              <div class="header__dropdown-menu">
                
                  <a class="header__dropdown-item"
                     href="/photo_correction">
                    Online Photo Correction
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/photo">
                    Online Passport Photo 20KB
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/finger.html">
                    Online Fingers Scanner
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/avatars">
                    Online Make Avatars
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/kanban/debounce.html">
                    Online Reminder App
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/converter.html">
                    Online Image Resize
                  </a>
                
              </div>
            </div>

            
          
            

            <!-- Applications Dropdown -->
            <div class="header__dropdown">
              <span class="header__link header__dropdown-toggle">
                Games
                <span class="dropdown-arrow">‚ñæ</span>
              </span>

              <div class="header__dropdown-menu">
                
                  <a class="header__dropdown-item"
                     href="/games/snake">
                    Snake Game
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/games/flappy-bird">
                    Flappy Bird
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/games/tetris">
                    Tetris
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/games/memory-match">
                    Memory Match
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/games/pong">
                    Pong
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/games/2048">
                    2048
                  </a>
                
              </div>
            </div>

            
          
            
              <a class="header__link" href="/about">
                About
              </a>
            
          
            
              <a class="header__link" href="/contact">
                Contact
              </a>
            
          
            
              <a class="header__link" href="/privacy">
                Privacy Policy
              </a>
            
          
            
              <a class="header__link" href="/disclaimer">
                Disclaimer
              </a>
            
          

        </div>
      </nav>

      <!-- Language Switcher -->
      

      <!-- Mobile Toggle -->
      <div class="header__toggle">
        <span></span><span></span><span></span>
      </div>

    </div>
  </div>

<style>
/* ==================================================
   üîí HEADER ‚Äî ALWAYS VISIBLE, FULL WIDTH COLOR
================================================== */
.header{
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;           /* full width */
  z-index: 10000;
  background: #FFFFFF;    /* uniform header background */
  box-shadow: 0 2px 12px rgba(0,0,0,.35);
  transform: none !important;
  transition: none !important;
}

/* Lock height to avoid reflow */
.header__inner{
  min-height: 72px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Prevent content hiding under fixed header */
body{
  padding-top: 72px;
}

/* ===============================
   NAV BASE
=============================== */
.header__links-wrapper{
  display:flex;
  align-items:center;
  gap:1.5rem;
}

.header__link,
.header__dropdown-toggle{
  display:inline-flex;
  align-items:center;
  gap:6px;
  cursor:pointer;
  font-size:16px;
  font-weight:500;
  color:#000000;
}

/* ===============================
   DROPDOWN
=============================== */
.header__dropdown{
  position:relative;
}

.dropdown-arrow{
  font-size:1.4em;
  transition:transform .2s ease;
}

.header__dropdown:hover .dropdown-arrow{
  transform:rotate(180deg);
}

.header__dropdown-menu{
  position:absolute;
  top:100%;
  left:0;
  min-width:220px;
  background:#121212;
  border:1px solid #333;
  border-radius:10px;
  padding:6px 0;
  display:none;
  z-index:9999;
}

.header__dropdown:hover .header__dropdown-menu{
  display:block;
}

.header__dropdown-item{
  display:block;
  padding:10px 16px;
  color:#eaeaea;
  text-decoration:none;
}

.header__dropdown-item:hover{
  background:#1f1f1f;
}

/* ===============================
   MOBILE
=============================== */
@media (max-width:768px){

  body{
    padding-top: 64px;
  }

  .header__inner{
    min-height: 64px;
  }

  .header__links-wrapper{
    flex-direction:column;
    align-items:stretch;
    gap:0;
  }

  .header__dropdown-toggle{
    justify-content:space-between;
    padding:14px 16px;
  }

  .header__dropdown-menu{
    position:static;
    display:none;
    background:#0f0f0f;
    border:none;
  }

  .header__dropdown:hover .header__dropdown-menu{
    display:block;
  }

  .header__dropdown-item{
    padding:14px 20px;
    background:#1a1a1a;
    border-top:1px solid #2a2a2a;
    font-size:15px;
  }
}

/* ===============================
   LANGUAGE SWITCHER
=============================== */
.header__lang-switcher{
  display:inline-flex;
  gap:.5rem;
  align-items:center;
  font-size:1.3rem;
  margin-left:1rem;
}
.lang-flag.active{ text-decoration:underline }
.lang-flag.disabled{ opacity:.5; filter:grayscale(100%) }

</style>
</header>


    
      <div class="hero lazyload"
           data-bg="http://localhost:4000/assets/img/posts/clipboard-20260227/clipboard-20260227.jpg"
           role="img"
           aria-label="PyShine clipboard App for two PCs">
    
        <div class="hero__wrap">

          
            <div class="hero__categories">
              
            </div>
          

          <h1 class="hero__title" itemprop="headline">PyShine clipboard App for two PCs</h1>

          <p class="hero__meta">
            <time datetime="2026-01-27T00:00:00+08:00" itemprop="datePublished">
              27 Jan 2026
            </time>
            &nbsp;¬∑&nbsp;
            
            <span itemprop="timeRequired">
              
                139 mins read
              
            </span>
          </p>
        </div>
      </div>

    <main class="site__content" role="main">
      <div class="container post-layout">

        <!-- SIDEBAR TOC -->
        <aside class="post-toc" id="post-toc">
          <h3 class="no-toc">Contents</h3>
          <nav id="toc-list"></nav>
        </aside>

        <!-- MAIN CONTENT -->
        <article class="post-content"
                 itemprop="articleBody"
                 itemscope itemtype="https://schema.org/Article">

          <!-- INLINE TOC -->
          <div id="inline-toc" class="inline-toc-box">
            <h3 class="no-toc">Contents</h3>
            <nav id="inline-toc-list"></nav>
          </div>

          <h1 id="pyshine-clipboard">PyShine Clipboard</h1>

<p>Seamlessly copy and paste <strong>text, files, and folders</strong> between devices on the same local network ‚Äî<br />
<strong>no cloud, no login, no tracking</strong>.</p>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/Dw-Y_B5mzRQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<p>Think <em>AirDrop</em>, but <strong>cross‚Äëplatform</strong>, <strong>private</strong>, and <strong>under your control</strong>.</p>

<hr />

<h2 id="features">Features</h2>

<ul>
  <li>Real-time clipboard sync</li>
  <li>File &amp; folder transfer with progress bar</li>
  <li>Works fully offline (Wifi or LAN)</li>
  <li>Cross-platform (Windows &amp; macOS)</li>
  <li>Fast, lightweight, and secure</li>
</ul>

<hr />

<h2 id="download-installers">Download Installers</h2>

<h3 id="windows-64-bit">Windows (64-bit)</h3>

<ul>
  <li><strong>Installer (.exe)</strong></li>
</ul>

<p><a href="/assets/downloads/pyshne_clipboard.exe">Download for Windows</a></p>

<blockquote>
  <p>Compatible with Windows 10 and above</p>
</blockquote>

<hr />

<h3 id="macos">macOS</h3>
<ul>
  <li><strong>Intel Macs</strong></li>
</ul>

<p><a href="/assets/downloads/pyshine_clipboard.zip">Download for macOS</a></p>

<p>Unzip pyshine_clipboard on macOS and then press option key and then click and select Open.</p>

<blockquote>
  <p>Compatible with macOS 11 (Big Sur) and above</p>
</blockquote>

<p>‚ö†Ô∏è On first launch, you may need to:</p>
<ul>
  <li>Right-click ‚Üí Open</li>
  <li>Allow network access when prompted</li>
</ul>

<p>Use ipconfig on windows pc to find your IP address and use ifconfig en0 on MacOs to find the IP. Open both apps on both PCs, and enter the target IP. For example in Windows PC app the target IP is of MacOs IP and vice-versa.</p>

<hr />

<h2 id="how-it-works-quick">How It Works (Quick)</h2>

<ol>
  <li>Install Clipboard Pro on both machines</li>
  <li>Make sure both are on the same Wi‚ÄëFi / LAN</li>
  <li>Launch the app on both devices</li>
  <li>Copy on one ‚Üí Paste on the other</li>
</ol>

<hr />

<h2 id="complete-code">Complete Code</h2>

<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="s">"""
PyShine Clipboard Pro - Complete Cross-Platform Solution
With Real-Time Progress Tracking for All Transfers
Fixed for macOS clipboard detection with circular progress indicators
DIRECT CONNECTION VERSION - Only communication between two PCs

FIXED: Proper termination on window close for PyInstaller builds
"""</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="n">tk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">ttk</span><span class="p">,</span> <span class="n">messagebox</span><span class="p">,</span> <span class="n">scrolledtext</span><span class="p">,</span> <span class="n">filedialog</span>
<span class="kn">import</span> <span class="nn">queue</span>
<span class="kn">import</span> <span class="nn">pyperclip</span>
<span class="kn">import</span> <span class="nn">pyclip</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">netifaces</span>
<span class="kn">import</span> <span class="nn">ipaddress</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">platform</span>


<span class="c1"># ------------------ Configuration ------------------
</span><span class="n">TCP_PORT</span> <span class="o">=</span> <span class="mi">6000</span>
<span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">8192</span>
<span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">65536</span>
<span class="n">DEVICE_ID</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">]</span>
<span class="n">HOST_OS</span> <span class="o">=</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span>

<span class="c1"># Clipboard check intervals - increased for macOS stability
</span><span class="n">TEXT_CHECK_INTERVAL</span> <span class="o">=</span> <span class="mf">1.5</span>  <span class="c1"># Increased from 1.0 for macOS
</span>
<span class="c1"># Set proper clipboard backend for macOS
</span><span class="n">CLIPBOARD_BACKEND</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">if</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">"Darwin"</span><span class="p">:</span>
    <span class="c1"># Try pyclip first (more reliable on macOS)
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">pyclip</span>
        <span class="n">CLIPBOARD_BACKEND</span> <span class="o">=</span> <span class="s">"pyclip"</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Using pyclip for macOS clipboard"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try to set pyperclip to use pbcopy/pbpaste
</span>            <span class="n">pyperclip</span><span class="p">.</span><span class="n">set_clipboard</span><span class="p">(</span><span class="s">"pbcopy"</span><span class="p">)</span>
            <span class="n">CLIPBOARD_BACKEND</span> <span class="o">=</span> <span class="s">"pyperclip"</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Using pyperclip with pbcopy for macOS clipboard"</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">CLIPBOARD_BACKEND</span> <span class="o">=</span> <span class="s">"subprocess"</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Using subprocess for macOS clipboard"</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">"Windows"</span><span class="p">:</span>
    <span class="n">CLIPBOARD_BACKEND</span> <span class="o">=</span> <span class="s">"pyperclip"</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">win32clipboard</span>
    <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>  <span class="c1"># Linux
</span>    <span class="n">CLIPBOARD_BACKEND</span> <span class="o">=</span> <span class="s">"pyperclip"</span>

<span class="k">def</span> <span class="nf">setup_application_icon</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="s">"""
    Setup application icon with reliable fallbacks.
    Creates .pyshine_clipboard folder in user directory and stores icon there.
    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create application folder in user directory
</span>        <span class="n">app_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">".pyshine_clipboard"</span>
        <span class="n">app_folder</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Define icon paths
</span>        <span class="n">icon_paths</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'png'</span><span class="p">:</span> <span class="n">app_folder</span> <span class="o">/</span> <span class="s">"icon.png"</span><span class="p">,</span>
            <span class="s">'ico'</span><span class="p">:</span> <span class="n">app_folder</span> <span class="o">/</span> <span class="s">"icon.ico"</span><span class="p">,</span>
        <span class="p">}</span>
        
        <span class="c1"># Check if we're running as PyInstaller executable
</span>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">'frozen'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">'_MEIPASS'</span><span class="p">):</span>
            <span class="c1"># We're running as a bundled executable
</span>            <span class="n">bundle_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">_MEIPASS</span><span class="p">)</span>
            
            <span class="c1"># Look for icon in bundle
</span>            <span class="n">possible_bundle_icons</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">bundle_dir</span> <span class="o">/</span> <span class="s">"icon_clean.png"</span><span class="p">,</span>
                <span class="n">bundle_dir</span> <span class="o">/</span> <span class="s">"icon.png"</span><span class="p">,</span>
                <span class="n">bundle_dir</span> <span class="o">/</span> <span class="s">"app.ico"</span><span class="p">,</span>
                <span class="n">bundle_dir</span> <span class="o">/</span> <span class="s">"icon.ico"</span><span class="p">,</span>
            <span class="p">]</span>
            
            <span class="n">bundle_icon_found</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">bundle_icon</span> <span class="ow">in</span> <span class="n">possible_bundle_icons</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bundle_icon</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">bundle_icon_found</span> <span class="o">=</span> <span class="n">bundle_icon</span>
                    <span class="k">break</span>
            
            <span class="k">if</span> <span class="n">bundle_icon_found</span><span class="p">:</span>
                <span class="c1"># Copy icon from bundle to user folder
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="p">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">bundle_icon_found</span><span class="p">,</span> <span class="n">icon_paths</span><span class="p">[</span><span class="s">'png'</span><span class="p">])</span>
                    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Icon copied from bundle to: </span><span class="si">{</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'png'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to copy icon from bundle: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Now try to load icon from user folder
</span>        <span class="n">icon_loaded</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="c1"># Try PNG first (works on all platforms)
</span>        <span class="k">if</span> <span class="n">icon_paths</span><span class="p">[</span><span class="s">'png'</span><span class="p">].</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">icon</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'png'</span><span class="p">]))</span>
                <span class="n">root</span><span class="p">.</span><span class="n">iconphoto</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>
                <span class="n">root</span><span class="p">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">icon</span>  <span class="c1"># Keep reference
</span>                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Icon loaded from: </span><span class="si">{</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'png'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="n">icon_loaded</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to load PNG icon: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Try ICO for Windows
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">icon_loaded</span> <span class="ow">and</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span> <span class="ow">and</span> <span class="n">icon_paths</span><span class="p">[</span><span class="s">'ico'</span><span class="p">].</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">root</span><span class="p">.</span><span class="n">iconbitmap</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'ico'</span><span class="p">]))</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Windows ICO icon loaded from: </span><span class="si">{</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'ico'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="n">icon_loaded</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to load ICO icon: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Try to convert PNG to ICO if needed (Windows only)
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">icon_loaded</span> <span class="ow">and</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span> <span class="ow">and</span> <span class="n">icon_paths</span><span class="p">[</span><span class="s">'png'</span><span class="p">].</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Convert PNG to ICO
</span>                <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'png'</span><span class="p">])</span>
                <span class="n">img</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'ico'</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s">'ICO'</span><span class="p">)</span>
                <span class="n">root</span><span class="p">.</span><span class="n">iconbitmap</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'ico'</span><span class="p">]))</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Converted PNG to ICO and loaded: </span><span class="si">{</span><span class="n">icon_paths</span><span class="p">[</span><span class="s">'ico'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="n">icon_loaded</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"PIL not available for PNG to ICO conversion"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to convert PNG to ICO: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Final fallback: try to load from any location
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">icon_loaded</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Trying fallback icon locations..."</span><span class="p">)</span>
            <span class="n">fallback_paths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Path</span><span class="p">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s">"icon_clean.png"</span><span class="p">,</span>
                <span class="n">Path</span><span class="p">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s">"icon.png"</span><span class="p">,</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">).</span><span class="n">parent</span> <span class="o">/</span> <span class="s">"icon_clean.png"</span><span class="p">,</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">).</span><span class="n">parent</span> <span class="o">/</span> <span class="s">"icon.png"</span><span class="p">,</span>
            <span class="p">]</span>
            
            <span class="k">for</span> <span class="n">fallback_path</span> <span class="ow">in</span> <span class="n">fallback_paths</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fallback_path</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">fallback_path</span><span class="p">.</span><span class="n">suffix</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">'.png'</span><span class="p">:</span>
                            <span class="n">icon</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">fallback_path</span><span class="p">))</span>
                            <span class="n">root</span><span class="p">.</span><span class="n">iconphoto</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>
                            <span class="n">root</span><span class="p">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">icon</span>
                            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Fallback icon loaded from: </span><span class="si">{</span><span class="n">fallback_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                            <span class="n">icon_loaded</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="c1"># Copy to user folder for future use
</span>                            <span class="n">shutil</span><span class="p">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">fallback_path</span><span class="p">,</span> <span class="n">icon_paths</span><span class="p">[</span><span class="s">'png'</span><span class="p">])</span>
                            <span class="k">break</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to load fallback icon </span><span class="si">{</span><span class="n">fallback_path</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">icon_loaded</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Could not load any icon, using Tkinter default"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="k">return</span> <span class="bp">True</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error in setup_application_icon: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
<span class="c1"># ------------------ Enhanced Network Utilities ------------------
</span><span class="k">class</span> <span class="nc">NetworkUtils</span><span class="p">:</span>
    <span class="s">"""Network utilities for cross-platform compatibility"""</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">get_all_network_interfaces</span><span class="p">():</span>
        <span class="s">"""Get all network interfaces with IP addresses"""</span>
        <span class="n">interfaces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">netifaces</span><span class="p">.</span><span class="n">interfaces</span><span class="p">():</span>
                <span class="n">addrs</span> <span class="o">=</span> <span class="n">netifaces</span><span class="p">.</span><span class="n">ifaddresses</span><span class="p">(</span><span class="n">iface</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">netifaces</span><span class="p">.</span><span class="n">AF_INET</span> <span class="ow">in</span> <span class="n">addrs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">addrs</span><span class="p">[</span><span class="n">netifaces</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s">'addr'</span> <span class="ow">in</span> <span class="n">addr</span> <span class="ow">and</span> <span class="n">addr</span><span class="p">[</span><span class="s">'addr'</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'127.0.0.1'</span><span class="p">:</span>
                            <span class="n">interfaces</span><span class="p">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s">'name'</span><span class="p">:</span> <span class="n">iface</span><span class="p">,</span>
                                <span class="s">'ip'</span><span class="p">:</span> <span class="n">addr</span><span class="p">[</span><span class="s">'addr'</span><span class="p">],</span>
                                <span class="s">'netmask'</span><span class="p">:</span> <span class="n">addr</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'netmask'</span><span class="p">,</span> <span class="s">'255.255.255.0'</span><span class="p">),</span>
                                <span class="s">'broadcast'</span><span class="p">:</span> <span class="n">addr</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'broadcast'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
                            <span class="p">})</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error getting network interfaces: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">interfaces</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">get_local_ip</span><span class="p">():</span>
        <span class="s">"""Get local IP address"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get local IP from socket
</span>            <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
            <span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Doesn't need to be reachable
</span>                <span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'10.255.255.255'</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">local_ip</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="n">local_ip</span> <span class="o">=</span> <span class="s">'127.0.0.1'</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">local_ip</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">'127.0.0.1'</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">validate_ip_address</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
        <span class="s">"""Validate IP address format"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">socket</span><span class="p">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="n">socket</span><span class="p">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">is_valid_port</span><span class="p">(</span><span class="n">port</span><span class="p">):</span>
        <span class="s">"""Validate port number"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">port</span> <span class="o">&lt;=</span> <span class="mi">65535</span>
        <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

<span class="c1"># ------------------ Circular Progress Widget ------------------
</span><span class="k">class</span> <span class="nc">CircularProgress</span><span class="p">(</span><span class="n">tk</span><span class="p">.</span><span class="n">Canvas</span><span class="p">):</span>
    <span class="s">"""Circular spinning progress indicator"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#2196F3"</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="s">"#f0f0f0"</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">thickness</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">bg_color</span> <span class="o">=</span> <span class="n">bg_color</span>
        
        <span class="n">tk</span><span class="p">.</span><span class="n">Canvas</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> 
                          <span class="n">width</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> 
                          <span class="n">height</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> 
                          <span class="n">bg</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
                          <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="n">thickness</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        
        <span class="c1"># Draw background circle
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">bg_circle</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_oval</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="n">outline</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        
        <span class="c1"># Create progress arc
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">progress_arc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">animation_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="c1"># Start position markers
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">start_markers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">30</span>
            <span class="n">rad</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">radius</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">radius</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
            
            <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> 
                                     <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">color</span><span class="p">,</span> 
                                     <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">=</span><span class="s">'hidden'</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">start_markers</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Start the spinning animation"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_animate</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Stop the spinning animation"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">is_running</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">animation_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">after_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">animation_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">animation_id</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c1"># Hide all markers
</span>        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">start_markers</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s">'hidden'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_animate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Animate the circular progress"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_running</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># Clear previous arc
</span>        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">progress_arc</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">progress_arc</span><span class="p">)</span>
        
        <span class="c1"># Calculate arc coordinates
</span>        <span class="n">start_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">angle</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="mi">80</span>  <span class="c1"># Length of the arc
</span>        
        <span class="c1"># Draw new arc
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">progress_arc</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_arc</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">-</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">center</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="n">start_angle</span><span class="p">,</span>
            <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
            <span class="n">outline</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">color</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">thickness</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">ARC</span>
        <span class="p">)</span>
        
        <span class="c1"># Update angle for next frame
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">angle</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
        
        <span class="c1"># Animate markers
</span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">start_markers</span><span class="p">):</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">angle</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">30</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'#</span><span class="si">{</span><span class="n">r</span><span class="si">:</span><span class="mi">02</span><span class="n">x</span><span class="si">}{</span><span class="n">g</span><span class="si">:</span><span class="mi">02</span><span class="n">x</span><span class="si">}{</span><span class="n">b</span><span class="si">:</span><span class="mi">02</span><span class="n">x</span><span class="si">}</span><span class="s">'</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s">'normal'</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mf">0.3</span> <span class="k">else</span> <span class="s">'hidden'</span><span class="p">)</span>
        
        <span class="c1"># Schedule next animation frame
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">animation_id</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_animate</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">set_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="s">"""Change the progress color"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">progress_arc</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">progress_arc</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">start_markers</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

<span class="c1"># ------------------ Enhanced Clipboard Manager for macOS ------------------
</span><span class="k">class</span> <span class="nc">ClipboardManager</span><span class="p">:</span>
    <span class="s">"""Enhanced clipboard manager with macOS-specific fixes"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span> <span class="o">=</span> <span class="n">log_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">last_hash</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">last_text</span> <span class="o">=</span> <span class="s">""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Lock</span><span class="p">()</span>
        
        <span class="c1"># Initialize clipboard for macOS
</span>        <span class="k">if</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">"Darwin"</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_init_macos_clipboard</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_init_macos_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Initialize macOS clipboard"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Test clipboard access
</span>            <span class="n">test_text</span> <span class="o">=</span> <span class="s">"test"</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_set_clipboard_text_macos</span><span class="p">(</span><span class="n">test_text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="n">retrieved</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_clipboard_text_macos</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">retrieved</span> <span class="o">==</span> <span class="n">test_text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="s">"[CLIPBOARD] macOS clipboard initialized successfully"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="s">"[CLIPBOARD] Warning: macOS clipboard verification failed"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="s">"[CLIPBOARD] Warning: Could not initialize macOS clipboard"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] Error initializing macOS clipboard: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_get_clipboard_text_macos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Get clipboard text specifically for macOS with multiple fallbacks"""</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_lock</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">""</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try pyclip first (most reliable on macOS)
</span>                <span class="k">if</span> <span class="n">CLIPBOARD_BACKEND</span> <span class="o">==</span> <span class="s">"pyclip"</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">pyclip</span><span class="p">.</span><span class="n">paste</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">text</span>
                    <span class="k">except</span> <span class="nb">UnicodeDecodeError</span><span class="p">:</span>
                        <span class="c1"># Silently skip if pyclip can't decode. Other methods might succeed.
</span>                        <span class="k">pass</span>  <span class="c1"># ‚¨ÖÔ∏è Changed from logging and returning
</span>                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pyclip failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Try pyperclip
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">pyperclip</span><span class="p">.</span><span class="n">paste</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="k">return</span> <span class="n">text</span>
                <span class="k">except</span> <span class="nb">UnicodeDecodeError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s">""</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pyperclip failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Try pbpaste command directly
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s">'pbpaste'</span><span class="p">],</span>
                        <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s">'LANG'</span><span class="p">:</span> <span class="s">'en_US.UTF-8'</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">:</span>
                        <span class="c1"># Try to decode, but ignore if it fails
</span>                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">text</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">'ignore'</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">():</span>
                                <span class="k">return</span> <span class="n">text</span>
                        <span class="k">except</span> <span class="nb">UnicodeDecodeError</span><span class="p">:</span>
                            <span class="k">return</span> <span class="s">""</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pbpaste failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Last resort: use AppleScript
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">script</span> <span class="o">=</span> <span class="s">'''
                    try
                        get the clipboard as text
                    on error
                        ""
                    end try
                    '''</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s">'osascript'</span><span class="p">,</span> <span class="s">'-e'</span><span class="p">,</span> <span class="n">script</span><span class="p">],</span>
                        <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">text</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] AppleScript failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] All macOS clipboard methods failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="s">""</span>
    <span class="k">def</span> <span class="nf">__get_clipboard_text_macos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Get clipboard text specifically for macOS with multiple fallbacks"""</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_lock</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">""</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try pyclip first (most reliable on macOS)
</span>                <span class="k">if</span> <span class="n">CLIPBOARD_BACKEND</span> <span class="o">==</span> <span class="s">"pyclip"</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">pyclip</span><span class="p">.</span><span class="n">paste</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">text</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pyclip failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Try pyperclip
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">pyperclip</span><span class="p">.</span><span class="n">paste</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="k">return</span> <span class="n">text</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pyperclip failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Try pbpaste command directly
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s">'pbpaste'</span><span class="p">],</span>
                        <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s">'LANG'</span><span class="p">:</span> <span class="s">'en_US.UTF-8'</span><span class="p">}</span>  <span class="c1"># Set locale for consistency
</span>                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span>
                        <span class="k">return</span> <span class="n">text</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pbpaste failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Last resort: use AppleScript
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">script</span> <span class="o">=</span> <span class="s">'''
                    try
                        get the clipboard as text
                    on error
                        ""
                    end try
                    '''</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s">'osascript'</span><span class="p">,</span> <span class="s">'-e'</span><span class="p">,</span> <span class="n">script</span><span class="p">],</span>
                        <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">text</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] AppleScript failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] All macOS clipboard methods failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="s">""</span>
    
    <span class="k">def</span> <span class="nf">_set_clipboard_text_macos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="s">"""Set clipboard text specifically for macOS with multiple fallbacks"""</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_lock</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try pyclip first
</span>                <span class="k">if</span> <span class="n">CLIPBOARD_BACKEND</span> <span class="o">==</span> <span class="s">"pyclip"</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pyclip</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                        <span class="c1"># Verify
</span>                        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                        <span class="n">verify</span> <span class="o">=</span> <span class="n">pyclip</span><span class="p">.</span><span class="n">paste</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">verify</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
                            <span class="k">return</span> <span class="bp">True</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pyclip copy failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Try pyperclip
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pyperclip</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="c1"># Verify
</span>                    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                    <span class="n">verify</span> <span class="o">=</span> <span class="n">pyperclip</span><span class="p">.</span><span class="n">paste</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">verify</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pyperclip copy failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Try pbcopy command directly
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s">'pbcopy'</span><span class="p">],</span>
                        <span class="nb">input</span><span class="o">=</span><span class="n">text</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s">'LANG'</span><span class="p">:</span> <span class="s">'en_US.UTF-8'</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># Verify with pbpaste
</span>                        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                        <span class="n">verify_result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
                            <span class="p">[</span><span class="s">'pbpaste'</span><span class="p">],</span>
                            <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">verify_result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">verify_result</span><span class="p">.</span><span class="n">stdout</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
                            <span class="k">return</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] pbcopy failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Last resort: use AppleScript
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Escape quotes in text
</span>                    <span class="n">escaped_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'"'</span><span class="p">,</span> <span class="s">'</span><span class="se">\\</span><span class="s">"'</span><span class="p">)</span>
                    <span class="n">script</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'set the clipboard to "</span><span class="si">{</span><span class="n">escaped_text</span><span class="si">}</span><span class="s">"'</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span><span class="s">'osascript'</span><span class="p">,</span> <span class="s">'-e'</span><span class="p">,</span> <span class="n">script</span><span class="p">],</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] AppleScript copy failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] All macOS clipboard set methods failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">get_clipboard_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Safely get clipboard text for all platforms"""</span>
        <span class="k">if</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">"Darwin"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_clipboard_text_macos</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_lock</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">pyperclip</span><span class="p">.</span><span class="n">paste</span><span class="p">()</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] Error getting text: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">""</span>
    
    <span class="k">def</span> <span class="nf">set_clipboard_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="s">"""Safely set clipboard text for all platforms"""</span>
        <span class="k">if</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">"Darwin"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_set_clipboard_text_macos</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_lock</span><span class="p">:</span>
                    <span class="n">pyperclip</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="c1"># Verify
</span>                    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                    <span class="n">verify</span> <span class="o">=</span> <span class="n">pyperclip</span><span class="p">.</span><span class="n">paste</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">verify</span> <span class="o">==</span> <span class="n">text</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] Error setting text: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">check_for_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Check if clipboard text has changed with improved macOS handling"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_text</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_clipboard_text</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">current_text</span> <span class="ow">or</span> <span class="n">current_text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            
            <span class="c1"># Normalize text - remove extra whitespace that macOS might add
</span>            <span class="n">current_text</span> <span class="o">=</span> <span class="n">current_text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">current_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="n">current_text</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">hexdigest</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">current_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">.</span><span class="n">last_hash</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">last_hash</span> <span class="o">=</span> <span class="n">current_hash</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">last_text</span> <span class="o">=</span> <span class="n">current_text</span>
                <span class="k">return</span> <span class="n">current_text</span>
            
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[CLIPBOARD] Error checking for changes: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>

<span class="c1"># ------------------ Progress Manager ------------------
</span><span class="k">class</span> <span class="nc">ProgressManager</span><span class="p">:</span>
    <span class="s">"""Manages progress tracking for file transfers"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gui_callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">gui_callback</span> <span class="o">=</span> <span class="n">gui_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Lock</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">start_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">total_size</span><span class="p">,</span> <span class="n">transfer_type</span><span class="o">=</span><span class="s">"send"</span><span class="p">):</span>
        <span class="s">"""Start tracking a new transfer"""</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">'filename'</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                <span class="s">'total_size'</span><span class="p">:</span> <span class="n">total_size</span><span class="p">,</span>
                <span class="s">'current_size'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">'start_time'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s">'transfer_type'</span><span class="p">:</span> <span class="n">transfer_type</span><span class="p">,</span>
                <span class="s">'last_update'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s">'completed'</span><span class="p">:</span> <span class="bp">False</span>
            <span class="p">}</span>
            
            <span class="c1"># Notify GUI
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">gui_callback</span><span class="p">(</span><span class="s">'transfer_started'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                <span class="s">'filename'</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                <span class="s">'total_size'</span><span class="p">:</span> <span class="n">total_size</span><span class="p">,</span>
                <span class="s">'transfer_type'</span><span class="p">:</span> <span class="n">transfer_type</span>
            <span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">update_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">bytes_transferred</span><span class="p">):</span>
        <span class="s">"""Update progress for a transfer"""</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transfer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">:</span>
                <span class="n">transfer</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span>
                <span class="n">transfer</span><span class="p">[</span><span class="s">'current_size'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">bytes_transferred</span>
                <span class="n">transfer</span><span class="p">[</span><span class="s">'last_update'</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
                
                <span class="c1"># Calculate progress percentage (for internal use only)
</span>                <span class="k">if</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'total_size'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">transfer</span><span class="p">[</span><span class="s">'current_size'</span><span class="p">]</span> <span class="o">/</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'total_size'</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">percentage</span> <span class="o">=</span> <span class="mi">0</span>
                
                <span class="c1"># Notify GUI - simplified for circular progress
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">gui_callback</span><span class="p">(</span><span class="s">'progress_updated'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'percentage'</span><span class="p">:</span> <span class="n">percentage</span><span class="p">,</span>
                    <span class="s">'current_size'</span><span class="p">:</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'current_size'</span><span class="p">],</span>
                    <span class="s">'total_size'</span><span class="p">:</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'total_size'</span><span class="p">],</span>
                    <span class="s">'transfer_type'</span><span class="p">:</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'transfer_type'</span><span class="p">]</span>
                <span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">complete_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Mark a transfer as completed"""</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transfer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">:</span>
                <span class="n">transfer</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span>
                <span class="n">transfer</span><span class="p">[</span><span class="s">'completed'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">transfer</span><span class="p">[</span><span class="s">'end_time'</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">transfer</span><span class="p">[</span><span class="s">'success'</span><span class="p">]</span> <span class="o">=</span> <span class="n">success</span>
                <span class="n">transfer</span><span class="p">[</span><span class="s">'error'</span><span class="p">]</span> <span class="o">=</span> <span class="n">error_msg</span>
                
                <span class="c1"># Calculate total time
</span>                <span class="n">total_time</span> <span class="o">=</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'end_time'</span><span class="p">]</span> <span class="o">-</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'start_time'</span><span class="p">]</span>
                
                <span class="c1"># Notify GUI
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">gui_callback</span><span class="p">(</span><span class="s">'transfer_completed'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'filename'</span><span class="p">:</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'filename'</span><span class="p">],</span>
                    <span class="s">'success'</span><span class="p">:</span> <span class="n">success</span><span class="p">,</span>
                    <span class="s">'error_msg'</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">,</span>
                    <span class="s">'total_time'</span><span class="p">:</span> <span class="n">total_time</span><span class="p">,</span>
                    <span class="s">'total_size'</span><span class="p">:</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'total_size'</span><span class="p">]</span>
                <span class="p">})</span>
                
                <span class="c1"># Keep for a while then remove
</span>                <span class="n">threading</span><span class="p">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_remove_transfer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]).</span><span class="n">start</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_remove_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">):</span>
        <span class="s">"""Remove a completed transfer"""</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">transfer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">format_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_bytes</span><span class="p">):</span>
        <span class="s">"""Format file size in human-readable format"""</span>
        <span class="k">if</span> <span class="n">size_bytes</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">size_bytes</span><span class="si">}</span><span class="s"> B"</span>
        <span class="k">elif</span> <span class="n">size_bytes</span> <span class="o">&lt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">size_bytes</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> KB"</span>
        <span class="k">elif</span> <span class="n">size_bytes</span> <span class="o">&lt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">size_bytes</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> MB"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">size_bytes</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> GB"</span>
    
    <span class="k">def</span> <span class="nf">get_active_transfers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Get list of active transfers"""</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">.</span><span class="n">items</span><span class="p">())</span>

<span class="c1"># ------------------ File Transfer Manager ------------------
</span><span class="k">class</span> <span class="nc">FileTransferManager</span><span class="p">:</span>
    <span class="s">"""Handles all file and folder transfers"""</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">zip_folder</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">progress_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Zip a folder for transfer with progress tracking"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_path</span><span class="p">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">folder_path</span><span class="p">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"Not a valid folder"</span>
            
            <span class="c1"># Count total files for progress
</span>            <span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">folder_path</span><span class="p">.</span><span class="n">rglob</span><span class="p">(</span><span class="s">'*'</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">file_path</span><span class="p">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="n">file_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="n">total_size</span> <span class="o">+=</span> <span class="n">file_path</span><span class="p">.</span><span class="n">stat</span><span class="p">().</span><span class="n">st_size</span>
            
            <span class="k">if</span> <span class="n">progress_callback</span><span class="p">:</span>
                <span class="n">progress_callback</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Preparing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span><span class="si">}</span><span class="s"> files..."</span><span class="p">)</span>
            
            <span class="c1"># Create temp zip file
</span>            <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="p">.</span><span class="n">gettempdir</span><span class="p">())</span>
            <span class="n">zip_path</span> <span class="o">=</span> <span class="n">temp_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">folder_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">.zip"</span>
            
            <span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_list</span><span class="p">):</span>
                    <span class="n">arcname</span> <span class="o">=</span> <span class="n">file_path</span><span class="p">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
                    <span class="n">zipf</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">arcname</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">progress_callback</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                        <span class="n">progress_callback</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Compressing: </span><span class="si">{</span><span class="n">file_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">progress_callback</span><span class="p">:</span>
                <span class="n">progress_callback</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s">"Compression complete"</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">zip_path</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">get_file_info</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="s">"""Get file information for transfer"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"File does not exist"</span>
            
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">'name'</span><span class="p">:</span> <span class="n">filepath</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s">'size'</span><span class="p">:</span> <span class="n">filepath</span><span class="p">.</span><span class="n">stat</span><span class="p">().</span><span class="n">st_size</span><span class="p">,</span>
                <span class="s">'modified'</span><span class="p">:</span> <span class="n">filepath</span><span class="p">.</span><span class="n">stat</span><span class="p">().</span><span class="n">st_mtime</span><span class="p">,</span>
                <span class="s">'is_dir'</span><span class="p">:</span> <span class="n">filepath</span><span class="p">.</span><span class="n">is_dir</span><span class="p">(),</span>
                <span class="s">'is_file'</span><span class="p">:</span> <span class="n">filepath</span><span class="p">.</span><span class="n">is_file</span><span class="p">(),</span>
                <span class="s">'path'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="c1"># Get MIME type
</span>            <span class="n">mime_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="p">.</span><span class="n">guess_type</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mime_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filepath</span><span class="p">.</span><span class="n">is_dir</span><span class="p">():</span>
                    <span class="n">mime_type</span> <span class="o">=</span> <span class="s">'application/x-directory'</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mime_type</span> <span class="o">=</span> <span class="s">'application/octet-stream'</span>
            
            <span class="n">info</span><span class="p">[</span><span class="s">'mime_type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mime_type</span>
            
            <span class="c1"># Get folder info if it's a directory
</span>            <span class="k">if</span> <span class="n">filepath</span><span class="p">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">file_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">.</span><span class="n">rglob</span><span class="p">(</span><span class="s">'*'</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">.</span><span class="n">is_file</span><span class="p">():</span>
                        <span class="n">file_count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">total_size</span> <span class="o">+=</span> <span class="n">item</span><span class="p">.</span><span class="n">stat</span><span class="p">().</span><span class="n">st_size</span>
                
                <span class="n">info</span><span class="p">[</span><span class="s">'file_count'</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_count</span>
                <span class="n">info</span><span class="p">[</span><span class="s">'total_size'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_size</span>
            
            <span class="k">return</span> <span class="n">info</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">format_size</span><span class="p">(</span><span class="n">size_bytes</span><span class="p">):</span>
        <span class="s">"""Format file size in human-readable format"""</span>
        <span class="k">if</span> <span class="n">size_bytes</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">size_bytes</span><span class="si">}</span><span class="s"> B"</span>
        <span class="k">elif</span> <span class="n">size_bytes</span> <span class="o">&lt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">size_bytes</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> KB"</span>
        <span class="k">elif</span> <span class="n">size_bytes</span> <span class="o">&lt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">size_bytes</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> MB"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">size_bytes</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> GB"</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="s">"""Open file with default application"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">'Windows'</span><span class="p">:</span>
                <span class="n">os</span><span class="p">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">'Darwin'</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'open'</span><span class="p">,</span> <span class="n">filepath</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'xdg-open'</span><span class="p">,</span> <span class="n">filepath</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">open_folder</span><span class="p">(</span><span class="n">folderpath</span><span class="p">):</span>
        <span class="s">"""Open folder in file browser"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">folderpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folderpath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">'Windows'</span><span class="p">:</span>
                <span class="n">os</span><span class="p">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">folderpath</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">HOST_OS</span> <span class="o">==</span> <span class="s">'Darwin'</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'open'</span><span class="p">,</span> <span class="n">folderpath</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'xdg-open'</span><span class="p">,</span> <span class="n">folderpath</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="c1"># ------------------ Clipboard Monitor ------------------
</span><span class="k">class</span> <span class="nc">ClipboardMonitor</span><span class="p">:</span>
    <span class="s">"""Monitor clipboard for changes with improved macOS handling"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clipboard_callback</span><span class="p">,</span> <span class="n">log_callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_callback</span> <span class="o">=</span> <span class="n">clipboard_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span> <span class="o">=</span> <span class="n">log_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span> <span class="o">=</span> <span class="n">ClipboardManager</span><span class="p">(</span><span class="n">log_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">last_sent_hash</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">monitor_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Lock</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Start monitoring"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">monitor_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_monitor_loop</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">monitor_thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="s">"[MONITOR] Clipboard monitoring started"</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_monitor_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Main monitoring loop with improved error handling"""</span>
        <span class="n">consecutive_errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_consecutive_errors</span> <span class="o">=</span> <span class="mi">5</span>
        
        <span class="k">while</span> <span class="bp">self</span><span class="p">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">monitor_lock</span><span class="p">:</span>
                    <span class="n">new_text</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span><span class="p">.</span><span class="n">check_for_changes</span><span class="p">()</span>
                    
                    <span class="k">if</span> <span class="n">new_text</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">last_sent_hash</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span><span class="p">.</span><span class="n">last_hash</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">last_sent_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span><span class="p">.</span><span class="n">last_hash</span>
                        
                        <span class="n">clipboard_item</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">'type'</span><span class="p">:</span> <span class="s">'text'</span><span class="p">,</span>
                            <span class="s">'data'</span><span class="p">:</span> <span class="n">new_text</span><span class="p">,</span>
                            <span class="s">'mime_type'</span><span class="p">:</span> <span class="s">'text/plain'</span><span class="p">,</span>
                            <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">(),</span>
                            <span class="s">'hash'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span><span class="p">.</span><span class="n">last_hash</span>
                        <span class="p">}</span>
                        
                        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_callback</span><span class="p">(</span><span class="n">clipboard_item</span><span class="p">)</span>
                        
                        <span class="c1"># Reset error counter on success
</span>                        <span class="n">consecutive_errors</span> <span class="o">=</span> <span class="mi">0</span>
                
                <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">TEXT_CHECK_INTERVAL</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">consecutive_errors</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[MONITOR] Error in loop: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">consecutive_errors</span> <span class="o">&gt;=</span> <span class="n">max_consecutive_errors</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="s">"[MONITOR] Too many errors, restarting clipboard manager..."</span><span class="p">)</span>
                    <span class="c1"># Reinitialize clipboard manager
</span>                    <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span> <span class="o">=</span> <span class="n">ClipboardManager</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">)</span>
                    <span class="n">consecutive_errors</span> <span class="o">=</span> <span class="mi">0</span>
                
                <span class="c1"># Exponential backoff on errors
</span>                <span class="n">sleep_time</span> <span class="o">=</span> <span class="n">TEXT_CHECK_INTERVAL</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="nb">min</span><span class="p">(</span><span class="n">consecutive_errors</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>
                
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Stop monitoring"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="s">"[MONITOR] Clipboard monitoring stopped"</span><span class="p">)</span>

<span class="c1"># ------------------ TCP Server (Receiver with Progress) ------------------
</span><span class="k">class</span> <span class="nc">ClipboardReceiver</span><span class="p">:</span>
    <span class="s">"""Receive clipboard data with progress tracking"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">data_callback</span><span class="p">,</span> <span class="n">log_callback</span><span class="p">,</span> <span class="n">progress_callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">data_callback</span> <span class="o">=</span> <span class="n">data_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span> <span class="o">=</span> <span class="n">log_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span> <span class="o">=</span> <span class="n">progress_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Start TCP server"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">server_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_server_loop</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">server_thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[RECEIVER] Listening on TCP port </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_server_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Main server loop"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span><span class="p">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'0.0.0.0'</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">port</span><span class="p">))</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="k">while</span> <span class="bp">self</span><span class="p">.</span><span class="n">running</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">client_socket</span><span class="p">,</span> <span class="n">client_address</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
                    <span class="n">client_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span>
                        <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_handle_client</span><span class="p">,</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,</span> <span class="n">client_address</span><span class="p">),</span>
                        <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span>
                    <span class="p">)</span>
                    <span class="n">client_thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
                    
                <span class="k">except</span> <span class="n">socket</span><span class="p">.</span><span class="n">timeout</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">running</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[RECEIVER] Accept error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                        
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[RECEIVER] Server error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">_handle_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_socket</span><span class="p">,</span> <span class="n">client_address</span><span class="p">):</span>
        <span class="s">"""Handle incoming connection with progress tracking"""</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">transfer_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"recv_</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">"</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client_socket</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
            
            <span class="c1"># Receive header
</span>            <span class="n">header_data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_receive_with_progress</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">header_data</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">return</span>
                
            <span class="n">header_len</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">'!I'</span><span class="p">,</span> <span class="n">header_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># Receive header JSON
</span>            <span class="n">header_json</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_receive_with_progress</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,</span> <span class="n">header_len</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">header_json</span><span class="p">:</span>
                <span class="k">return</span>
                
            <span class="n">header</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">header_json</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">header</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'type'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">)</span>
            <span class="n">total_size</span> <span class="o">=</span> <span class="n">header</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'size'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">transfer_type</span> <span class="o">=</span> <span class="n">header</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'transfer_type'</span><span class="p">,</span> <span class="s">'single'</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">header</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'filename'</span><span class="p">,</span> <span class="sa">f</span><span class="s">'file_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">is_folder</span> <span class="o">=</span> <span class="n">header</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'is_folder'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            
            <span class="c1"># Start progress tracking for large files
</span>            <span class="k">if</span> <span class="n">total_size</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># &gt; 1MB
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'start_transfer'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'filename'</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                    <span class="s">'total_size'</span><span class="p">:</span> <span class="n">total_size</span><span class="p">,</span>
                    <span class="s">'transfer_type'</span><span class="p">:</span> <span class="s">'receive'</span><span class="p">,</span>
                    <span class="s">'source_ip'</span><span class="p">:</span> <span class="n">ip</span>
                <span class="p">})</span>
                
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[RECEIVER] Receiving </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">FileTransferManager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span><span class="si">}</span><span class="s">) from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Receive data with progress tracking
</span>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_receive_with_progress</span><span class="p">(</span><span class="n">client_socket</span><span class="p">,</span> <span class="n">total_size</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">total_size</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s">'text'</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">'ignore'</span><span class="p">)</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">data_callback</span><span class="p">({</span>
                        <span class="s">'type'</span><span class="p">:</span> <span class="s">'text'</span><span class="p">,</span>
                        <span class="s">'data'</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
                        <span class="s">'source_ip'</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
                        <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="p">})</span>
                    
                <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s">'file'</span><span class="p">:</span>
                    <span class="n">mime_type</span> <span class="o">=</span> <span class="n">header</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'mime_type'</span><span class="p">,</span> <span class="s">'application/octet-stream'</span><span class="p">)</span>
                    
                    <span class="n">file_data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s">'type'</span><span class="p">:</span> <span class="s">'file'</span><span class="p">,</span>
                        <span class="s">'data'</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
                        <span class="s">'filename'</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                        <span class="s">'mime_type'</span><span class="p">:</span> <span class="n">mime_type</span><span class="p">,</span>
                        <span class="s">'is_folder'</span><span class="p">:</span> <span class="n">is_folder</span><span class="p">,</span>
                        <span class="s">'transfer_type'</span><span class="p">:</span> <span class="n">transfer_type</span><span class="p">,</span>
                        <span class="s">'source_ip'</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
                        <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="p">}</span>
                    
                    <span class="c1"># Add original folder name if it's a folder
</span>                    <span class="k">if</span> <span class="n">is_folder</span><span class="p">:</span>
                        <span class="n">file_data</span><span class="p">[</span><span class="s">'original_folder_name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'original_folder_name'</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    
                    <span class="bp">self</span><span class="p">.</span><span class="n">data_callback</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
            
            <span class="c1"># Complete progress tracking
</span>            <span class="k">if</span> <span class="n">total_size</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'complete_transfer'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'success'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">'error_msg'</span><span class="p">:</span> <span class="bp">None</span>
                <span class="p">})</span>
                    
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[RECEIVER] Client error from </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">total_size</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'complete_transfer'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">'error_msg'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">})</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">client_socket</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
                
    <span class="k">def</span> <span class="nf">_receive_with_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">total_size</span><span class="p">,</span> <span class="n">progress_start</span><span class="p">):</span>
        <span class="s">"""Receive data with progress tracking"""</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s">''</span>
        <span class="n">bytes_received</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">last_progress_update</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunk_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">CHUNK_SIZE</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="n">chunk</span>
                <span class="n">bytes_received</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                
                <span class="c1"># Update progress periodically
</span>                <span class="k">if</span> <span class="n">total_size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_progress_update</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span><span class="n">bytes_received</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                    <span class="k">if</span> <span class="n">progress</span> <span class="o">-</span> <span class="n">last_progress_update</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">bytes_received</span> <span class="o">%</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'update_progress'</span><span class="p">,</span> <span class="p">{</span>
                            <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                            <span class="s">'bytes_transferred'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="p">})</span>
                        <span class="n">last_progress_update</span> <span class="o">=</span> <span class="n">progress</span>
                
            <span class="k">except</span> <span class="n">socket</span><span class="p">.</span><span class="n">timeout</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">data</span>
        
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Stop server"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">server_socket</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="s">"[RECEIVER] Server stopped"</span><span class="p">)</span>

<span class="c1"># ------------------ TCP Client (Sender with Progress) ------------------
</span><span class="k">class</span> <span class="nc">ClipboardSender</span><span class="p">:</span>
    <span class="s">"""Send clipboard data and files with progress tracking"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_callback</span><span class="p">,</span> <span class="n">progress_callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span> <span class="o">=</span> <span class="n">log_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span> <span class="o">=</span> <span class="n">progress_callback</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span> <span class="o">=</span> <span class="n">FileTransferManager</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">send_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="s">"""Send text to device"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sock</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">sock</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Prepare header
</span>                <span class="n">data</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
                <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">'type'</span><span class="p">:</span> <span class="s">'text'</span><span class="p">,</span>
                    <span class="s">'size'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                    <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
                <span class="p">}</span>
                
                <span class="n">header_json</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">header</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
                <span class="n">header_len</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="s">'!I'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_json</span><span class="p">))</span>
                
                <span class="c1"># Send header length
</span>                <span class="n">sock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">header_len</span><span class="p">)</span>
                <span class="c1"># Send header
</span>                <span class="n">sock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">header_json</span><span class="p">)</span>
                <span class="c1"># Send data
</span>                <span class="n">sock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                
                <span class="k">return</span> <span class="bp">True</span>
                
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">sock</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SENDER] Error sending to </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
            
    <span class="k">def</span> <span class="nf">send_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">is_folder</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">transfer_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Send any file to device with progress tracking"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"File does not exist"</span>
            
            <span class="c1"># Get file info
</span>            <span class="n">file_info</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">get_file_info</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="n">error</span>
            
            <span class="c1"># Create transfer ID if not provided
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">transfer_id</span><span class="p">:</span>
                <span class="n">transfer_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"send_</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">"</span>
            
            <span class="c1"># Start progress tracking
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'start_transfer'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                <span class="s">'filename'</span><span class="p">:</span> <span class="n">filepath</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s">'total_size'</span><span class="p">:</span> <span class="n">file_info</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span>
                <span class="s">'transfer_type'</span><span class="p">:</span> <span class="s">'send'</span><span class="p">,</span>
                <span class="s">'destination_ip'</span><span class="p">:</span> <span class="n">ip</span>
            <span class="p">})</span>
            
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SENDER] Starting transfer: </span><span class="si">{</span><span class="n">filepath</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">file_info</span><span class="p">[</span><span class="s">'size'</span><span class="p">])</span><span class="si">}</span><span class="s">) to </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Read file in chunks for progress tracking
</span>            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sock</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">sock</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Prepare header
</span>                <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">'type'</span><span class="p">:</span> <span class="s">'file'</span><span class="p">,</span>
                    <span class="s">'size'</span><span class="p">:</span> <span class="n">file_info</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span>
                    <span class="s">'filename'</span><span class="p">:</span> <span class="n">filepath</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s">'mime_type'</span><span class="p">:</span> <span class="n">file_info</span><span class="p">[</span><span class="s">'mime_type'</span><span class="p">],</span>
                    <span class="s">'is_folder'</span><span class="p">:</span> <span class="n">is_folder</span><span class="p">,</span>
                    <span class="s">'transfer_type'</span><span class="p">:</span> <span class="s">'single'</span><span class="p">,</span>
                    <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
                <span class="p">}</span>
                
                <span class="c1"># Add original folder name for folders
</span>                <span class="k">if</span> <span class="n">is_folder</span><span class="p">:</span>
                    <span class="n">header</span><span class="p">[</span><span class="s">'original_folder_name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">filepath</span><span class="p">.</span><span class="n">name</span>
                
                <span class="n">header_json</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">header</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
                <span class="n">header_len</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="s">'!I'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_json</span><span class="p">))</span>
                
                <span class="c1"># Send header length
</span>                <span class="n">sock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">header_len</span><span class="p">)</span>
                <span class="c1"># Send header
</span>                <span class="n">sock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">header_json</span><span class="p">)</span>
                
                <span class="c1"># Send file data in chunks with progress tracking
</span>                <span class="n">bytes_sent</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">last_progress_update</span> <span class="o">=</span> <span class="mi">0</span>
                
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                        <span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">CHUNK_SIZE</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                            <span class="k">break</span>
                        
                        <span class="n">sock</span><span class="p">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        <span class="n">bytes_sent</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                        
                        <span class="c1"># Update progress periodically
</span>                        <span class="k">if</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_progress_update</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
                            <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span><span class="n">bytes_sent</span> <span class="o">/</span> <span class="n">file_info</span><span class="p">[</span><span class="s">'size'</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
                            <span class="k">if</span> <span class="n">progress</span> <span class="o">-</span> <span class="n">last_progress_update</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'update_progress'</span><span class="p">,</span> <span class="p">{</span>
                                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                                    <span class="s">'bytes_transferred'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                                <span class="p">})</span>
                                <span class="n">last_progress_update</span> <span class="o">=</span> <span class="n">progress</span>
                
                <span class="c1"># Complete progress tracking
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'complete_transfer'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'success'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">'error_msg'</span><span class="p">:</span> <span class="bp">None</span>
                <span class="p">})</span>
                
                <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SENDER] Transfer completed: </span><span class="si">{</span><span class="n">filepath</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">None</span>
                
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">sock</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SENDER] Error sending file to </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Mark transfer as failed
</span>            <span class="k">if</span> <span class="n">transfer_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'complete_transfer'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">'error_msg'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="p">})</span>
            
            <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">send_folder_as_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">transfer_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Send folder as ZIP archive with progress tracking"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_path</span><span class="p">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">folder_path</span><span class="p">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"Not a valid folder"</span>
            
            <span class="c1"># Create transfer ID if not provided
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">transfer_id</span><span class="p">:</span>
                <span class="n">transfer_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"send_folder_</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">"</span>
            
            <span class="c1"># Get folder info
</span>            <span class="n">folder_info</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">get_file_info</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="n">error</span>
            
            <span class="c1"># Start progress tracking for preparation
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'start_transfer'</span><span class="p">,</span> <span class="p">{</span>
                <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                <span class="s">'filename'</span><span class="p">:</span> <span class="n">folder_path</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s">'total_size'</span><span class="p">:</span> <span class="n">folder_info</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'total_size'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s">'transfer_type'</span><span class="p">:</span> <span class="s">'send'</span><span class="p">,</span>
                <span class="s">'destination_ip'</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
                <span class="s">'is_folder'</span><span class="p">:</span> <span class="bp">True</span>
            <span class="p">})</span>
            
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SENDER] Preparing folder: </span><span class="si">{</span><span class="n">folder_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">folder_info</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'file_count'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s"> files, </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">folder_info</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'total_size'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
            
            <span class="c1"># Create ZIP with progress callback
</span>            <span class="k">def</span> <span class="nf">zip_progress_callback</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'update_progress'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'bytes_transferred'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s">'message'</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                    <span class="s">'preparation_progress'</span><span class="p">:</span> <span class="n">progress</span>
                <span class="p">})</span>
            
            <span class="n">zip_path</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">zip_folder</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">zip_progress_callback</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'complete_transfer'</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                    <span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">'error_msg'</span><span class="p">:</span> <span class="sa">f</span><span class="s">"Failed to create ZIP: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span>
                <span class="p">})</span>
                <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Failed to create ZIP: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Send ZIP file
</span>                <span class="n">success</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">send_file</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">zip_path</span><span class="p">,</span> <span class="n">is_folder</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">transfer_id</span><span class="o">=</span><span class="n">transfer_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SENDER] Folder sent successfully: </span><span class="si">{</span><span class="n">folder_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">progress_callback</span><span class="p">(</span><span class="s">'complete_transfer'</span><span class="p">,</span> <span class="p">{</span>
                        <span class="s">'transfer_id'</span><span class="p">:</span> <span class="n">transfer_id</span><span class="p">,</span>
                        <span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                        <span class="s">'error_msg'</span><span class="p">:</span> <span class="n">error</span>
                    <span class="p">})</span>
                
                <span class="k">return</span> <span class="n">success</span><span class="p">,</span> <span class="n">error</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Clean up temp ZIP
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">log_callback</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SENDER] Error sending folder to </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># ------------------ Circular Progress Dialog ------------------
</span><span class="k">class</span> <span class="nc">CircularProgressDialog</span><span class="p">:</span>
    <span class="s">"""Modal dialog showing circular progress indicator"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">total_size</span><span class="p">,</span> <span class="n">transfer_type</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">total_size</span> <span class="o">=</span> <span class="n">total_size</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transfer_type</span> <span class="o">=</span> <span class="n">transfer_type</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
        
        <span class="c1"># Create dialog
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="s">'Sending'</span> <span class="k">if</span> <span class="n">transfer_type</span> <span class="o">==</span> <span class="s">'send'</span> <span class="k">else</span> <span class="s">'Receiving'</span><span class="si">}</span><span class="s"> File"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">geometry</span><span class="p">(</span><span class="s">"400x250"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">resizable</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">transient</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">grab_set</span><span class="p">()</span>
        
        <span class="c1"># Center dialog
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">update_idletasks</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">parent</span><span class="p">.</span><span class="n">winfo_x</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">parent</span><span class="p">.</span><span class="n">winfo_width</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">200</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">parent</span><span class="p">.</span><span class="n">winfo_y</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">parent</span><span class="p">.</span><span class="n">winfo_height</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">125</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">geometry</span><span class="p">(</span><span class="sa">f</span><span class="s">"+</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s">+</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="c1"># Create widgets
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_create_widgets</span><span class="p">()</span>
        
        <span class="c1"># Start time
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_create_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Create dialog widgets"""</span>
        <span class="c1"># Main frame
</span>        <span class="n">main_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">main_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Title
</span>        <span class="n">title_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="s">'Sending'</span> <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_type</span> <span class="o">==</span> <span class="s">'send'</span> <span class="k">else</span> <span class="s">'Receiving'</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span>
        <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">main_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">title_text</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">'TkDefaultFont'</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s">'bold'</span><span class="p">)).</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Destination
</span>        <span class="n">dest_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="s">'To'</span> <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_type</span> <span class="o">==</span> <span class="s">'send'</span> <span class="k">else</span> <span class="s">'From'</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">destination</span><span class="si">}</span><span class="s">"</span>
        <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">main_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">dest_text</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Size info
</span>        <span class="n">size_str</span> <span class="o">=</span> <span class="n">FileTransferManager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">total_size</span><span class="p">)</span>
        <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">main_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s">"Size: </span><span class="si">{</span><span class="n">size_str</span><span class="si">}</span><span class="s">"</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Progress frame
</span>        <span class="n">progress_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">main_frame</span><span class="p">)</span>
        <span class="n">progress_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Circular progress indicator
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">progress_circle</span> <span class="o">=</span> <span class="n">CircularProgress</span><span class="p">(</span><span class="n">progress_frame</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">progress_circle</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">progress_circle</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        
        <span class="c1"># Status label
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">status_label</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">progress_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Transfer in progress..."</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">status_label</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        
        <span class="c1"># Cancel button
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">cancel_button</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">main_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Cancel"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">cancel</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cancel_button</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">update_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">current_size</span><span class="p">,</span> <span class="n">total_size</span><span class="p">):</span>
        <span class="s">"""Update progress display - simplified for circular progress"""</span>
        <span class="c1"># Update status text occasionally
</span>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">percentage</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_str</span> <span class="o">=</span> <span class="n">FileTransferManager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">current_size</span><span class="p">)</span>
            <span class="n">total_str</span> <span class="o">=</span> <span class="n">FileTransferManager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">status_label</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">current_str</span><span class="si">}</span><span class="s"> of </span><span class="si">{</span><span class="n">total_str</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
        <span class="c1"># Update dialog
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Mark transfer as complete"""</span>
        <span class="c1"># Stop the circular animation
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">progress_circle</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="c1"># Change to success color (green)
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">progress_circle</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">"#4CAF50"</span><span class="p">)</span>
            
            <span class="c1"># Draw a checkmark
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">status_label</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">"Transfer complete!"</span><span class="p">)</span>
            
            <span class="c1"># Change cancel button to close
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">cancel_button</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">"Close"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">destroy</span><span class="p">)</span>
            
            <span class="c1"># Auto-close after 2 seconds
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">destroy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Change to error color (red)
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">progress_circle</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">"#F44336"</span><span class="p">)</span>
            
            <span class="c1"># Show error message
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">status_label</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">error_msg</span><span class="p">[</span><span class="si">:</span><span class="mi">50</span><span class="p">]</span><span class="si">}</span><span class="s">..."</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">cancel_button</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">"Close"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">destroy</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Cancel the transfer"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">destroy</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">is_cancelled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Check if dialog was closed"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">dialog</span><span class="p">.</span><span class="n">winfo_exists</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

<span class="c1"># ------------------ Main Application GUI ------------------
</span><span class="k">class</span> <span class="nc">PyShineClipboardApp</span><span class="p">:</span>
    <span class="s">"""Main application with progress tracking - Direct Connection Version"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s">"PyShine Clipboard Pro - v1.0"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">geometry</span><span class="p">(</span><span class="s">"1000x850"</span><span class="p">)</span>
        
        <span class="c1"># Configure styles
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Style</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">theme_use</span><span class="p">(</span><span class="s">'clam'</span><span class="p">)</span>
        <span class="c1"># Initialize primary_received_dir
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">primary_received_dir</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c1"># Variables
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">auto_sync_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">BooleanVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">notify_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">BooleanVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">"192.168.1.100"</span><span class="p">)</span>  <span class="c1"># Default target IP
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">"6000"</span><span class="p">)</span>  <span class="c1"># Default port
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">local_ip_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
        
        <span class="c1"># Data storage
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">received_files</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Progress tracking
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">progress_dialogs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">progress_manager</span> <span class="o">=</span> <span class="n">ProgressManager</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_progress_callback</span><span class="p">)</span>
        
        <span class="c1"># Clipboard state
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">last_received_hash</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">is_processing</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="c1"># Create queues
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">log_queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">progress_queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">Queue</span><span class="p">()</span>
        
        <span class="c1"># Load cached IP if available
</span>        <span class="n">cached_ip</span><span class="p">,</span> <span class="n">cached_port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_load_cached_ip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cached_ip</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cached_ip</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached_port</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cached_port</span><span class="p">)</span>
        
        <span class="c1"># Initialize components
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_init_components</span><span class="p">()</span>
        
        <span class="c1"># Start services
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_start_services</span><span class="p">()</span>
        
        <span class="c1"># Start GUI update loop
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_update_gui_loop</span><span class="p">()</span>
        
        <span class="c1"># Setup window close handler - CRITICAL FIX
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">protocol</span><span class="p">(</span><span class="s">"WM_DELETE_WINDOW"</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">on_closing</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"="</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"PyShine Clipboard Pro - v1.0"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"Device ID: </span><span class="si">{</span><span class="n">DEVICE_ID</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"Platform: </span><span class="si">{</span><span class="n">HOST_OS</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"Clipboard Backend: </span><span class="si">{</span><span class="n">CLIPBOARD_BACKEND</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"Mode: DIRECT CONNECTION BETWEEN TWO PCs"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"Enter target IP and port to connect"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"="</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        
        <span class="c1"># Get and display local IP
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_update_local_ip</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_get_cache_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Get path to cache file"""</span>
        <span class="n">cache_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">".pyshine_clipboard"</span>
        <span class="n">cache_dir</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="s">"last_connection.cache"</span>

    <span class="k">def</span> <span class="nf">_load_cached_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Load cached IP and port from file"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cache_file</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_cache_path</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cache_file</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                        <span class="c1"># Format: "IP:PORT"
</span>                        <span class="n">parts</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">ip</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">port</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">return</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">"6000"</span>  <span class="c1"># Default port
</span>        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to load cached IP: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_save_cached_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Save current IP and port to cache file"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ip</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
            
            <span class="c1"># Validate
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ip</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">port</span><span class="p">:</span>
                <span class="k">return</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">validate_ip_address</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
                <span class="k">return</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">is_valid_port</span><span class="p">(</span><span class="n">port</span><span class="p">):</span>
                <span class="k">return</span>
            
            <span class="c1"># Save to cache
</span>            <span class="n">cache_file</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_cache_path</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"Cached connection: </span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to cache IP: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_local_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Update local IP display"""</span>
        <span class="n">local_ip</span> <span class="o">=</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">get_local_ip</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">local_ip_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="sa">f</span><span class="s">"Enter the IP address of Target"</span><span class="p">)</span>
        <span class="c1"># self._log(f"Local IP: {local_ip}")
</span>
    <span class="k">def</span> <span class="nf">_init_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Initialize GUI components"""</span>
        <span class="c1"># Main container
</span>        <span class="n">main_container</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">PanedWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">main_container</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="c1"># Left panel - Connection and controls
</span>        <span class="n">left_panel</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">main_container</span><span class="p">)</span>
        <span class="n">main_container</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">left_panel</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Connection frame
</span>        <span class="n">connection_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">LabelFrame</span><span class="p">(</span><span class="n">left_panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Direct Connection"</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">connection_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Local IP display
</span>        <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">connection_frame</span><span class="p">,</span> <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">local_ip_var</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">'TkDefaultFont'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">'bold'</span><span class="p">)).</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Target IP entry
</span>        <span class="n">ip_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">connection_frame</span><span class="p">)</span>
        <span class="n">ip_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">ip_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Target IP:"</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_entry</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">ip_frame</span><span class="p">,</span> <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_entry</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="c1"># Port entry
</span>        <span class="n">port_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">connection_frame</span><span class="p">)</span>
        <span class="n">port_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">port_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Port:"</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">target_port_entry</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">port_frame</span><span class="p">,</span> <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">target_port_entry</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">port_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"(Default: 6000)"</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        
        <span class="c1"># Connection buttons frame
</span>        <span class="n">btn_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">connection_frame</span><span class="p">)</span>
        <span class="n">btn_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">btn_frame</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"Connection"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_test_connection</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">15</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">btn_frame</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"Refresh Local IP"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_update_local_ip</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">15</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        
        <span class="c1"># Connection status
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">"Not connected"</span><span class="p">)</span>
        <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">connection_frame</span><span class="p">,</span> <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">connection_status_var</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">'TkDefaultFont'</span><span class="p">,</span> <span class="mi">9</span><span class="p">)).</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        
        <span class="c1"># Transfer controls
</span>        <span class="n">transfer_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">LabelFrame</span><span class="p">(</span><span class="n">left_panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Transfer Controls"</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">transfer_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Buttons grid
</span>        <span class="n">btn_grid</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">transfer_frame</span><span class="p">)</span>
        <span class="n">btn_grid</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">)</span>
        
        <span class="c1"># Row 1
</span>        <span class="n">row1</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">btn_grid</span><span class="p">)</span>
        <span class="n">row1</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">row1</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"üìÑ Send File..."</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_send_file_dialog</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">18</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">row1</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"üìÅ Send Folder..."</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_send_folder_dialog</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">18</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        
        <span class="c1"># Row 2
</span>        <span class="n">row2</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">btn_grid</span><span class="p">)</span>
        <span class="n">row2</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">row2</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"üé¨ Send Video..."</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_send_video_dialog</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">18</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">row2</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"üìã Sync Clipboard"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_sync_clipboard</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">18</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        
        <span class="c1"># Row 3 - Clipboard sync controls
</span>        <span class="n">row3</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">btn_grid</span><span class="p">)</span>
        <span class="n">row3</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">row3</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"üîÑ Start Sync"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_start_clipboard_sync</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">18</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">row3</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"‚è∏Ô∏è Stop Sync"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_stop_clipboard_sync</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">18</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        
        <span class="c1"># Settings frame
</span>        <span class="n">settings_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">LabelFrame</span><span class="p">(</span><span class="n">left_panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Settings"</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">settings_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">)</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Checkbutton</span><span class="p">(</span>
            <span class="n">settings_frame</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"Auto-sync clipboard text"</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">auto_sync_var</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_toggle_auto_sync</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Checkbutton</span><span class="p">(</span>
            <span class="n">settings_frame</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"Show notifications"</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">notify_var</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Right panel - Clipboard and logs
</span>        <span class="n">right_panel</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">main_container</span><span class="p">)</span>
        <span class="n">main_container</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">right_panel</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Clipboard display
</span>        <span class="n">clipboard_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">LabelFrame</span><span class="p">(</span><span class="n">right_panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Current Clipboard"</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">clipboard_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_text</span> <span class="o">=</span> <span class="n">scrolledtext</span><span class="p">.</span><span class="n">ScrolledText</span><span class="p">(</span>
            <span class="n">clipboard_frame</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">wrap</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">WORD</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">'TkDefaultFont'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_text</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'disabled'</span><span class="p">)</span>
        
        <span class="c1"># Active transfers frame
</span>        <span class="n">transfers_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">LabelFrame</span><span class="p">(</span><span class="n">right_panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Active Transfers"</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">transfers_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># Transfers list
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">transfers_text</span> <span class="o">=</span> <span class="n">scrolledtext</span><span class="p">.</span><span class="n">ScrolledText</span><span class="p">(</span>
            <span class="n">transfers_frame</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">wrap</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">WORD</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">'Courier'</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transfers_text</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transfers_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'disabled'</span><span class="p">)</span>
        
        <span class="c1"># Log display
</span>        <span class="n">log_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">LabelFrame</span><span class="p">(</span><span class="n">right_panel</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Activity Log"</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">log_frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span> <span class="o">=</span> <span class="n">scrolledtext</span><span class="p">.</span><span class="n">ScrolledText</span><span class="p">(</span>
            <span class="n">log_frame</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">wrap</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">WORD</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">'Courier'</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'disabled'</span><span class="p">)</span>
        
        <span class="c1"># Log controls
</span>        <span class="n">log_controls</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">log_frame</span><span class="p">)</span>
        <span class="n">log_controls</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">log_controls</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"Clear Log"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_clear_log</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">log_controls</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"Copy Log"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_copy_log</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="n">ttk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">log_controls</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">"Open Received"</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_open_received_folder</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">12</span>
        <span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">RIGHT</span><span class="p">)</span>
        
        <span class="c1"># Status bar
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">status_bar</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">SUNKEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">status_bar</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">X</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">StringVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">"Ready | Enter target IP and port"</span><span class="p">)</span>
        <span class="n">status_label</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">status_bar</span><span class="p">,</span>
            <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">W</span>
        <span class="p">)</span>
        <span class="n">status_label</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="c1"># Circular progress indicator in status bar
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">status_progress</span> <span class="o">=</span> <span class="n">CircularProgress</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">status_bar</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#2196F3"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">status_progress</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">status_progress</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_icon</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">status_bar</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"üî¥"</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">'TkDefaultFont'</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_icon</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_start_services</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Start all background services"""</span>
        <span class="c1"># Get port from entry or use default
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">TCP_PORT</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">receiver</span> <span class="o">=</span> <span class="n">ClipboardReceiver</span><span class="p">(</span>
            <span class="n">port</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_clipboard_received</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log_callback</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_progress_callback</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_monitor</span> <span class="o">=</span> <span class="n">ClipboardMonitor</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_clipboard_changed</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log_callback</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">ClipboardSender</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_log_callback</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_progress_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span> <span class="o">=</span> <span class="n">ClipboardManager</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">_log_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span> <span class="o">=</span> <span class="n">FileTransferManager</span><span class="p">()</span>
        
        <span class="c1"># Start services
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">receiver</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_monitor</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">_test_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Test connection to target"""</span>
        <span class="n">target_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">target_port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_ip</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">"No IP"</span><span class="p">,</span> <span class="s">"Please enter target IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_port</span><span class="p">:</span>
            <span class="n">target_port</span> <span class="o">=</span> <span class="s">"6000"</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="c1"># Validate IP address
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">validate_ip_address</span><span class="p">(</span><span class="n">target_ip</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid IP"</span><span class="p">,</span> <span class="s">"Please enter a valid IP address (e.g., 192.168.1.100)"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Validate port
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">is_valid_port</span><span class="p">(</span><span class="n">target_port</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid Port"</span><span class="p">,</span> <span class="s">"Please enter a valid port number (1-65535)"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">target_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üîß Testing connection to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="sa">f</span><span class="s">"Testing connection to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">"Testing connection..."</span><span class="p">)</span>
            
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sock</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">))</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
            
            <span class="n">sock</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úÖ Connection successful to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s">ms)"</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="sa">f</span><span class="s">"Connected to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="sa">f</span><span class="s">"Connected to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_icon</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">"üü¢"</span><span class="p">)</span>
                <span class="c1"># Save to cache
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">_save_cached_ip</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">)</span>
                
                <span class="c1"># Test clipboard sync
</span>                <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_test_clipboard_sync</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Connection failed to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="sa">f</span><span class="s">"Connection failed to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="sa">f</span><span class="s">"Connection failed"</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_icon</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">"üî¥"</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Connection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="sa">f</span><span class="s">"Connection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">"Connection error"</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">connection_status_icon</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">"üî¥"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_test_clipboard_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">):</span>
        <span class="s">"""Test clipboard synchronization"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Send a test message
</span>            <span class="n">test_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"Clipboard sync test from </span><span class="si">{</span><span class="n">DEVICE_ID</span><span class="si">}</span><span class="s"> at </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="si">:</span><span class="o">%</span><span class="n">S</span><span class="s">')</span><span class="si">}</span><span class="s">"</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">send_text</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">test_message</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úÖ Clipboard sync test successful"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ö†Ô∏è Clipboard sync test failed"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ö†Ô∏è Clipboard test error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_sync_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Manually sync clipboard to target"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">auto_sync_var</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">return</span>
        
        <span class="n">target_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">target_port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_ip</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">"No IP"</span><span class="p">,</span> <span class="s">"Please enter target IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_port</span><span class="p">:</span>
            <span class="n">target_port</span> <span class="o">=</span> <span class="s">"6000"</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="c1"># Validate IP address
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">validate_ip_address</span><span class="p">(</span><span class="n">target_ip</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid IP"</span><span class="p">,</span> <span class="s">"Please enter a valid IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Validate port
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">is_valid_port</span><span class="p">(</span><span class="n">target_port</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid Port"</span><span class="p">,</span> <span class="s">"Please enter a valid port number"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">target_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get current clipboard text
</span>            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span><span class="p">.</span><span class="n">get_clipboard_text</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">send_text</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üì§ Sent clipboard to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_update_clipboard_display</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to send clipboard"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"üìã Clipboard is empty"</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Clipboard sync error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_start_clipboard_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Start automatic clipboard synchronization"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">auto_sync_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"üîÑ Auto-sync enabled"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">"Auto-sync enabled"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_stop_clipboard_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Stop automatic clipboard synchronization"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">auto_sync_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"‚è∏Ô∏è Auto-sync disabled"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">"Auto-sync disabled"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_clipboard_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clipboard_item</span><span class="p">):</span>
        <span class="s">"""Handle local clipboard changes"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">auto_sync_var</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_processing</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="n">target_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">target_port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_ip</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">target_port</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># Validate IP and port
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">validate_ip_address</span><span class="p">(</span><span class="n">target_ip</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">target_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">clipboard_item</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">last_received_hash</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìã Clipboard changed (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">clipboard_item</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span><span class="si">}</span><span class="s"> chars)"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_update_clipboard_display</span><span class="p">(</span><span class="n">clipboard_item</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
        
        <span class="c1"># Send to target
</span>        <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_send_to_target</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">clipboard_item</span><span class="p">),</span>
            <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">).</span><span class="n">start</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_send_to_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">clipboard_item</span><span class="p">):</span>
        <span class="s">"""Send clipboard item to target"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">send_text</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">clipboard_item</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üì§ Sent to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to send to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Send error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_clipboard_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="s">"""Handle received clipboard data"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">is_processing</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'text'</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">]</span>
                <span class="n">source_ip</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'source_ip'</span><span class="p">,</span> <span class="s">'Unknown'</span><span class="p">)</span>
                <span class="n">source_port</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'source_port'</span><span class="p">,</span> <span class="s">'Unknown'</span><span class="p">)</span>
                
                <span class="n">text_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">hexdigest</span><span class="p">()</span>
                
                <span class="k">if</span> <span class="n">text_hash</span> <span class="o">==</span> <span class="bp">self</span><span class="p">.</span><span class="n">last_received_hash</span><span class="p">:</span>
                    <span class="k">return</span>
                    
                <span class="bp">self</span><span class="p">.</span><span class="n">last_received_hash</span> <span class="o">=</span> <span class="n">text_hash</span>
                
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_manager</span><span class="p">.</span><span class="n">set_clipboard_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_update_clipboard_display</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üì• Received text from </span><span class="si">{</span><span class="n">source_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">source_port</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">notify_var</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">_show_notification</span><span class="p">(</span><span class="sa">f</span><span class="s">"Clipboard updated from </span><span class="si">{</span><span class="n">source_ip</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"‚ùå Failed to set clipboard"</span><span class="p">)</span>
                    
            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'file'</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_save_received_file</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">is_processing</span> <span class="o">=</span> <span class="bp">False</span>
    
    
    <span class="k">def</span> <span class="nf">_save_received_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="s">"""Save received file or folder with robust permission handling and fallbacks"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get file information from data
</span>            <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'filename'</span><span class="p">,</span> <span class="sa">f</span><span class="s">'received_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">is_folder</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'is_folder'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">transfer_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'transfer_type'</span><span class="p">,</span> <span class="s">'single'</span><span class="p">)</span>
            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'source_ip'</span><span class="p">,</span> <span class="s">'Unknown'</span><span class="p">)</span>
            
            <span class="c1"># ===== STEP 1: DETERMINE SAVE LOCATION WITH FALLBACKS =====
</span>            <span class="n">received_dir</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">save_location_type</span> <span class="o">=</span> <span class="s">"Unknown"</span>
            
            <span class="c1"># Try multiple locations in order of preference
</span>            <span class="n">possible_locations</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1"># 1. Primary location in user's home directory
</span>                <span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"ClipboardReceived"</span><span class="p">,</span> <span class="s">"Home Directory"</span><span class="p">),</span>
                <span class="c1"># 2. Downloads folder (usually has write access)
</span>                <span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"Downloads"</span> <span class="o">/</span> <span class="s">"ClipboardReceived"</span><span class="p">,</span> <span class="s">"Downloads"</span><span class="p">),</span>
                <span class="c1"># 3. Desktop (user-visible location)
</span>                <span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"Desktop"</span> <span class="o">/</span> <span class="s">"ClipboardReceived"</span><span class="p">,</span> <span class="s">"Desktop"</span><span class="p">),</span>
                <span class="c1"># 4. Documents folder
</span>                <span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"Documents"</span> <span class="o">/</span> <span class="s">"ClipboardReceived"</span><span class="p">,</span> <span class="s">"Documents"</span><span class="p">),</span>
                <span class="c1"># 5. Application Support (macOS convention)
</span>                <span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"Library"</span> <span class="o">/</span> <span class="s">"Application Support"</span> <span class="o">/</span> <span class="s">"PyShineClipboard"</span> <span class="o">/</span> <span class="s">"Received"</span><span class="p">,</span> <span class="s">"Application Support"</span><span class="p">),</span>
                <span class="c1"># 6. Last resort: Temporary directory
</span>                <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="p">.</span><span class="n">gettempdir</span><span class="p">())</span> <span class="o">/</span> <span class="s">"PyShineClipboard_Received"</span><span class="p">,</span> <span class="s">"Temporary"</span><span class="p">)</span>
            <span class="p">]</span>
            
            <span class="c1"># Try each location until we find one we can write to
</span>            <span class="k">for</span> <span class="n">location</span><span class="p">,</span> <span class="n">location_name</span> <span class="ow">in</span> <span class="n">possible_locations</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Create directory if it doesn't exist
</span>                    <span class="n">location</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    
                    <span class="c1"># Test if we can write to this directory
</span>                    <span class="n">test_file</span> <span class="o">=</span> <span class="n">location</span> <span class="o">/</span> <span class="s">".write_test"</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">test_file</span><span class="p">.</span><span class="n">touch</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="c1"># Write something to the file
</span>                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">test_file</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"test"</span><span class="p">)</span>
                        <span class="n">test_file</span><span class="p">.</span><span class="n">unlink</span><span class="p">()</span>  <span class="c1"># Clean up
</span>                        
                        <span class="c1"># If we get here, we can write to this location
</span>                        <span class="n">received_dir</span> <span class="o">=</span> <span class="n">location</span>
                        
                        
                        <span class="n">save_location_type</span> <span class="o">=</span> <span class="n">location_name</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úì Using </span><span class="si">{</span><span class="n">location_name</span><span class="si">}</span><span class="s"> for saving: </span><span class="si">{</span><span class="n">received_dir</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                        <span class="k">break</span>
                        
                    <span class="k">except</span> <span class="p">(</span><span class="n">PermissionError</span><span class="p">,</span> <span class="nb">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úó Cannot write to </span><span class="si">{</span><span class="n">location_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                        <span class="k">continue</span>
                        
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úó Failed to access </span><span class="si">{</span><span class="n">location_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    <span class="k">continue</span>
            
            <span class="c1"># If all automatic locations failed, ask the user
</span>            <span class="k">if</span> <span class="n">received_dir</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"‚ö†Ô∏è All automatic save locations failed. Asking user..."</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_ask_for_save_location</span><span class="p">)</span>
                <span class="c1"># Wait a bit for user response (non-blocking in real app)
</span>                <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1"># Check if user provided a location (you'll need to implement _get_user_save_location)
</span>                <span class="n">user_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_user_save_location</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">user_dir</span><span class="p">:</span>
                    <span class="n">received_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">user_dir</span><span class="p">)</span>
                    <span class="n">save_location_type</span> <span class="o">=</span> <span class="s">"User Selected"</span>
                    <span class="n">received_dir</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"‚ùå No save location available. File not saved."</span><span class="p">)</span>
                    <span class="k">return</span>
            
            <span class="c1"># ===== STEP 2: SAVE THE ACTUAL FILE/FOLDER =====
</span>            <span class="k">if</span> <span class="n">is_folder</span><span class="p">:</span>
                <span class="c1"># It's a folder (ZIP file)
</span>                <span class="n">original_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'original_folder_name'</span><span class="p">,</span> <span class="n">filename</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.zip'</span><span class="p">,</span> <span class="s">''</span><span class="p">))</span>
                
                <span class="c1"># Save ZIP file
</span>                <span class="n">zip_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">.zip"</span>
                <span class="n">zip_path</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="n">zip_filename</span>
                
                <span class="c1"># Write ZIP data
</span>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
                
                <span class="c1"># Create extract path
</span>                <span class="n">extract_path</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="n">original_name</span>
                
                <span class="c1"># Avoid overwriting - add number if folder exists
</span>                <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">extract_path</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">extract_path</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s">"</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="n">extract_path</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                
                <span class="c1"># Extract ZIP
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
                        <span class="c1"># Get list of files for progress reporting
</span>                        <span class="n">file_list</span> <span class="o">=</span> <span class="n">zipf</span><span class="p">.</span><span class="n">namelist</span><span class="p">()</span>
                        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span>
                        
                        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üì¶ Extracting </span><span class="si">{</span><span class="n">total_files</span><span class="si">}</span><span class="s"> files from </span><span class="si">{</span><span class="n">zip_filename</span><span class="si">}</span><span class="s">..."</span><span class="p">)</span>
                        
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">zipf</span><span class="p">.</span><span class="n">extract</span><span class="p">(</span><span class="n">file_info</span><span class="p">,</span> <span class="n">extract_path</span><span class="p">)</span>
                            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ö†Ô∏è Failed to extract </span><span class="si">{</span><span class="n">file_info</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                                <span class="k">continue</span>
                            
                            <span class="c1"># Log progress for large archives
</span>                            <span class="k">if</span> <span class="n">total_files</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_files</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">total_files</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"   Extracting... </span><span class="si">{</span><span class="n">progress</span><span class="si">:</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s">% (</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">total_files</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
                    
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úÖ Extraction complete: </span><span class="si">{</span><span class="n">extract_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    
                <span class="k">except</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">BadZipFile</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Error: </span><span class="si">{</span><span class="n">zip_filename</span><span class="si">}</span><span class="s"> is not a valid ZIP file"</span><span class="p">)</span>
                    <span class="c1"># Try to save the raw file anyway
</span>                    <span class="n">raw_path</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s">.zip"</span>
                    <span class="n">shutil</span><span class="p">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="n">raw_path</span><span class="p">)</span>
                    <span class="n">extract_path</span> <span class="o">=</span> <span class="n">raw_path</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üíæ Saved as raw file instead: </span><span class="si">{</span><span class="n">raw_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Clean up ZIP file after successful extraction
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">zip_path</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                        <span class="n">zip_path</span><span class="p">.</span><span class="n">unlink</span><span class="p">()</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üßπ Cleaned up ZIP file: </span><span class="si">{</span><span class="n">zip_filename</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># Don't worry if we can't delete the zip
</span>                
                <span class="n">final_path</span> <span class="o">=</span> <span class="n">extract_path</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÅ Folder saved: </span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s"> ‚Üí </span><span class="si">{</span><span class="n">save_location_type</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Regular file
</span>                <span class="c1"># Handle duplicate filenames
</span>                <span class="n">filepath</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="n">filename</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">name_parts</span> <span class="o">=</span> <span class="n">filename</span><span class="p">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                
                <span class="k">while</span> <span class="n">filepath</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">name_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s">"</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s">"</span>
                    <span class="n">filepath</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="n">new_filename</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># Safety limit
</span>                        <span class="n">filepath</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span>
                        <span class="k">break</span>
                
                <span class="c1"># Save the file
</span>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
                
                <span class="n">final_path</span> <span class="o">=</span> <span class="n">filepath</span>
                <span class="n">file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
                <span class="n">size_str</span> <span class="o">=</span> <span class="n">FileTransferManager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">file_size</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÑ File saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">size_str</span><span class="si">}</span><span class="s">) ‚Üí </span><span class="si">{</span><span class="n">save_location_type</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># ===== STEP 3: POST-SAVE ACTIONS =====
</span>            <span class="c1"># Add to recent transfers list
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">received_files</span><span class="p">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">'path'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">),</span>
                <span class="s">'name'</span><span class="p">:</span> <span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s">'is_folder'</span><span class="p">:</span> <span class="n">is_folder</span><span class="p">,</span>
                <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s">'size'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">]),</span>
                <span class="s">'location'</span><span class="p">:</span> <span class="n">save_location_type</span><span class="p">,</span>
                <span class="s">'source'</span><span class="p">:</span> <span class="n">source_ip</span>
            <span class="p">})</span>
            
            <span class="c1"># Update transfers list display
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">_update_transfers_list</span><span class="p">()</span>
            
            <span class="c1"># Show notification if enabled
</span>            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">notify_var</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">is_folder</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_show_notification</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÅ Folder received from </span><span class="si">{</span><span class="n">source_ip</span><span class="si">}</span><span class="s"> "</span> <span class="o">+</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s">Saved to: </span><span class="si">{</span><span class="n">save_location_type</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_show_notification</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÑ File received from </span><span class="si">{</span><span class="n">source_ip</span><span class="si">}</span><span class="s"> "</span> <span class="o">+</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s">Saved to: </span><span class="si">{</span><span class="n">save_location_type</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># ===== STEP 4: ASK USER WHAT TO DO =====
</span>            <span class="k">def</span> <span class="nf">ask_user_action</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">is_folder</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">messagebox</span><span class="p">.</span><span class="n">askyesnocancel</span><span class="p">(</span>
                        <span class="s">"Folder Received"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s">"Received folder: </span><span class="si">{</span><span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n\n</span><span class="s">"</span>
                        <span class="sa">f</span><span class="s">"Location: </span><span class="si">{</span><span class="n">save_location_type</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
                        <span class="sa">f</span><span class="s">"From: </span><span class="si">{</span><span class="n">source_ip</span><span class="si">}</span><span class="se">\n\n</span><span class="s">"</span>
                        <span class="s">"What would you like to do?"</span><span class="p">,</span>
                        <span class="n">detail</span><span class="o">=</span><span class="s">"Yes: Open folder</span><span class="se">\n</span><span class="s">No: Show in Finder</span><span class="se">\n</span><span class="s">Cancel: Do nothing"</span>
                    <span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>  <span class="c1"># Yes - Open folder
</span>                        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">open_folder</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to open folder: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">response</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>  <span class="c1"># No - Show in Finder
</span>                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Darwin"</span><span class="p">:</span>
                                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'open'</span><span class="p">,</span> <span class="s">'-R'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">)])</span>
                            <span class="k">elif</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span><span class="p">:</span>
                                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'explorer'</span><span class="p">,</span> <span class="s">'/select,'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">)])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'xdg-open'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">.</span><span class="n">parent</span><span class="p">)])</span>
                        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to show in file manager: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Regular file
</span>                    <span class="n">response</span> <span class="o">=</span> <span class="n">messagebox</span><span class="p">.</span><span class="n">askyesnocancel</span><span class="p">(</span>
                        <span class="s">"File Received"</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s">"Received file: </span><span class="si">{</span><span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n\n</span><span class="s">"</span>
                        <span class="sa">f</span><span class="s">"Location: </span><span class="si">{</span><span class="n">save_location_type</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
                        <span class="sa">f</span><span class="s">"From: </span><span class="si">{</span><span class="n">source_ip</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
                        <span class="sa">f</span><span class="s">"Size: </span><span class="si">{</span><span class="n">FileTransferManager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">]))</span><span class="si">}</span><span class="se">\n\n</span><span class="s">"</span>
                        <span class="s">"Open the file?"</span><span class="p">,</span>
                        <span class="n">detail</span><span class="o">=</span><span class="s">"Yes: Open file</span><span class="se">\n</span><span class="s">No: Show in Finder</span><span class="se">\n</span><span class="s">Cancel: Do nothing"</span>
                    <span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>  <span class="c1"># Yes - Open file
</span>                        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to open file: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">response</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>  <span class="c1"># No - Show in Finder
</span>                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Darwin"</span><span class="p">:</span>
                                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'open'</span><span class="p">,</span> <span class="s">'-R'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">)])</span>
                            <span class="k">elif</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span><span class="p">:</span>
                                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'explorer'</span><span class="p">,</span> <span class="s">'/select,'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">)])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'xdg-open'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">.</span><span class="n">parent</span><span class="p">)])</span>
                        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to show in file manager: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Ask user in main thread
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ask_user_action</span><span class="p">)</span>
            
            <span class="c1"># Log success
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úÖ Successfully saved to: </span><span class="si">{</span><span class="n">final_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="c1"># Store the parent directory for future "Open Received" clicks
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">primary_received_dir</span> <span class="o">=</span> <span class="n">final_path</span><span class="p">.</span><span class="n">parent</span>  <span class="c1"># &lt;-- ADD THIS LINE
</span>            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Critical error saving file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">traceback</span><span class="p">.</span><span class="n">print_exc</span><span class="p">()</span>
            
            <span class="c1"># Last resort: save to desktop with timestamp
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">emergency_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"Desktop"</span> <span class="o">/</span> <span class="sa">f</span><span class="s">"CLIPBOARD_EMERGENCY_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">.dat"</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">emergency_path</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üö® Emergency save to Desktop: </span><span class="si">{</span><span class="n">emergency_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">final_e</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üí• All save attempts failed: </span><span class="si">{</span><span class="n">final_e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ask_for_save_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Ask user for save location (called from main thread)"""</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="p">.</span><span class="n">askdirectory</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s">"Select folder to save received files"</span><span class="p">,</span>
            <span class="n">initialdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_user_save_location</span> <span class="o">=</span> <span class="n">save_path</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÅ User selected save location: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_user_save_location</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_get_user_save_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Get the user-selected save location"""</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">'_user_save_location'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">__save_received_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="s">"""Save received file or folder"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create received directory
</span>            <span class="n">received_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"ClipboardReceived"</span>
            <span class="n">received_dir</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            
            <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'filename'</span><span class="p">,</span> <span class="sa">f</span><span class="s">'received_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="n">is_folder</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'is_folder'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">transfer_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'transfer_type'</span><span class="p">,</span> <span class="s">'single'</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">is_folder</span><span class="p">:</span>
                <span class="c1"># It's a folder (ZIP file)
</span>                <span class="n">original_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'original_folder_name'</span><span class="p">,</span> <span class="n">filename</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'.zip'</span><span class="p">,</span> <span class="s">''</span><span class="p">))</span>
                
                <span class="c1"># Save ZIP file
</span>                <span class="n">zip_path</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="n">filename</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
                
                <span class="c1"># Extract ZIP
</span>                <span class="n">extract_path</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="n">original_name</span>
                <span class="n">extract_path</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                
                <span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
                    <span class="n">zipf</span><span class="p">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span>
                
                <span class="c1"># Clean up ZIP
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="n">final_path</span> <span class="o">=</span> <span class="n">extract_path</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÅ Folder received: </span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Regular file
</span>                <span class="n">filepath</span> <span class="o">=</span> <span class="n">received_dir</span> <span class="o">/</span> <span class="n">filename</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
                
                <span class="n">final_path</span> <span class="o">=</span> <span class="n">filepath</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÑ File received: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Add to recent transfers list
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">received_files</span><span class="p">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">'path'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">),</span>
                <span class="s">'name'</span><span class="p">:</span> <span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s">'is_folder'</span><span class="p">:</span> <span class="n">is_folder</span><span class="p">,</span>
                <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s">'size'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
            <span class="p">})</span>
            
            <span class="c1"># Update files list
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">_update_transfers_list</span><span class="p">()</span>
            
            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'source_ip'</span><span class="p">,</span> <span class="s">'Unknown'</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">notify_var</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">is_folder</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_show_notification</span><span class="p">(</span><span class="sa">f</span><span class="s">"Folder received from </span><span class="si">{</span><span class="n">source_ip</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_show_notification</span><span class="p">(</span><span class="sa">f</span><span class="s">"File received from </span><span class="si">{</span><span class="n">source_ip</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Ask to open
</span>            <span class="k">if</span> <span class="n">is_folder</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">messagebox</span><span class="p">.</span><span class="n">askyesno</span><span class="p">(</span><span class="s">"Folder Received"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Received folder: </span><span class="si">{</span><span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n\n</span><span class="s">Open folder?"</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">open_folder</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">messagebox</span><span class="p">.</span><span class="n">askyesno</span><span class="p">(</span><span class="s">"File Received"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Received file: </span><span class="si">{</span><span class="n">final_path</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n\n</span><span class="s">Open file?"</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Error saving file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_send_file_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Send any file to target"""</span>
        <span class="n">target_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">target_port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_ip</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">"No Target"</span><span class="p">,</span> <span class="s">"Please enter target IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_port</span><span class="p">:</span>
            <span class="n">target_port</span> <span class="o">=</span> <span class="s">"6000"</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="c1"># Validate IP and port
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">validate_ip_address</span><span class="p">(</span><span class="n">target_ip</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid IP"</span><span class="p">,</span> <span class="s">"Please enter a valid IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">is_valid_port</span><span class="p">(</span><span class="n">target_port</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid Port"</span><span class="p">,</span> <span class="s">"Please enter a valid port number"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">target_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="n">filepaths</span> <span class="o">=</span> <span class="n">filedialog</span><span class="p">.</span><span class="n">askopenfilenames</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s">"Select files to send"</span><span class="p">,</span>
            <span class="n">filetypes</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s">"All files"</span><span class="p">,</span> <span class="s">"*.*"</span><span class="p">),</span>
                <span class="p">(</span><span class="s">"Videos"</span><span class="p">,</span> <span class="s">"*.mp4 *.avi *.mov *.mkv *.wmv *.flv *.webm"</span><span class="p">),</span>
                <span class="p">(</span><span class="s">"Images"</span><span class="p">,</span> <span class="s">"*.png *.jpg *.jpeg *.gif *.bmp *.tiff *.webp"</span><span class="p">),</span>
                <span class="p">(</span><span class="s">"Documents"</span><span class="p">,</span> <span class="s">"*.pdf *.doc *.docx *.txt *.rtf *.odt"</span><span class="p">),</span>
                <span class="p">(</span><span class="s">"Audio"</span><span class="p">,</span> <span class="s">"*.mp3 *.wav *.flac *.aac *.ogg *.m4a"</span><span class="p">),</span>
                <span class="p">(</span><span class="s">"Archives"</span><span class="p">,</span> <span class="s">"*.zip *.rar *.7z *.tar *.gz"</span><span class="p">),</span>
                <span class="p">(</span><span class="s">"Code"</span><span class="p">,</span> <span class="s">"*.py *.js *.html *.css *.java *.cpp *.c *.php"</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filepaths</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">_send_files</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">filepaths</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_send_folder_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Send folder to target"""</span>
        <span class="n">target_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">target_port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_ip</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">"No Target"</span><span class="p">,</span> <span class="s">"Please enter target IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_port</span><span class="p">:</span>
            <span class="n">target_port</span> <span class="o">=</span> <span class="s">"6000"</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="c1"># Validate IP and port
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">validate_ip_address</span><span class="p">(</span><span class="n">target_ip</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid IP"</span><span class="p">,</span> <span class="s">"Please enter a valid IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">is_valid_port</span><span class="p">(</span><span class="n">target_port</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid Port"</span><span class="p">,</span> <span class="s">"Please enter a valid port number"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">target_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="p">.</span><span class="n">askdirectory</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Select folder to send"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_path</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># Get folder info
</span>        <span class="n">folder_info</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">get_file_info</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Error"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Invalid folder: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Confirm transfer
</span>        <span class="n">file_count</span> <span class="o">=</span> <span class="n">folder_info</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'file_count'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">total_size</span> <span class="o">=</span> <span class="n">folder_info</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'total_size'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="n">confirm</span> <span class="o">=</span> <span class="n">messagebox</span><span class="p">.</span><span class="n">askyesno</span><span class="p">(</span>
            <span class="s">"Confirm Folder Transfer"</span><span class="p">,</span>
            <span class="sa">f</span><span class="s">"Folder: </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
            <span class="sa">f</span><span class="s">"Files: </span><span class="si">{</span><span class="n">file_count</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
            <span class="sa">f</span><span class="s">"Total size: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s">"</span>
            <span class="sa">f</span><span class="s">"Send to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">?"</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">confirm</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_send_folder</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_send_video_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Send video files"""</span>
        <span class="n">target_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_ip_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">target_port</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_ip</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">"No Target"</span><span class="p">,</span> <span class="s">"Please enter target IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_port</span><span class="p">:</span>
            <span class="n">target_port</span> <span class="o">=</span> <span class="s">"6000"</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">target_port_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        
        <span class="c1"># Validate IP and port
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">validate_ip_address</span><span class="p">(</span><span class="n">target_ip</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid IP"</span><span class="p">,</span> <span class="s">"Please enter a valid IP address"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="n">is_valid_port</span><span class="p">(</span><span class="n">target_port</span><span class="p">):</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Invalid Port"</span><span class="p">,</span> <span class="s">"Please enter a valid port number"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">target_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_port</span><span class="p">)</span>
        <span class="c1"># Save to cache
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">_save_cached_ip</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">)</span>
        
        <span class="n">filepaths</span> <span class="o">=</span> <span class="n">filedialog</span><span class="p">.</span><span class="n">askopenfilenames</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s">"Select video files to send"</span><span class="p">,</span>
            <span class="n">filetypes</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s">"Video files"</span><span class="p">,</span> <span class="s">"*.mp4 *.avi *.mov *.mkv *.wmv *.flv *.webm *.m4v *.mpg *.mpeg"</span><span class="p">),</span>
                <span class="p">(</span><span class="s">"All files"</span><span class="p">,</span> <span class="s">"*.*"</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filepaths</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">_send_files</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">filepaths</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_send_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">filepaths</span><span class="p">):</span>
        <span class="s">"""Send multiple files"""</span>
        <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">filepaths</span><span class="p">:</span>
            <span class="n">file_info</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">get_file_info</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Error with </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">continue</span>
            
            <span class="c1"># Show progress dialog for large files
</span>            <span class="k">if</span> <span class="n">file_info</span><span class="p">[</span><span class="s">'size'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># &gt; 10MB
</span>                <span class="n">transfer_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"send_</span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">"</span>
                
                <span class="c1"># Create circular progress dialog
</span>                <span class="n">dialog</span> <span class="o">=</span> <span class="n">CircularProgressDialog</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">,</span>
                    <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">file_info</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span>
                    <span class="s">'send'</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span>
                <span class="p">)</span>
                
                <span class="c1"># Store dialog reference
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">progress_dialogs</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">dialog</span>
                
                <span class="c1"># Start transfer in background thread
</span>                <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span>
                    <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_send_file_with_progress</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">dialog</span><span class="p">),</span>
                    <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span>
                <span class="p">).</span><span class="n">start</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Small file, send without progress dialog
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üì§ Sending </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">file_info</span><span class="p">[</span><span class="s">'size'</span><span class="p">])</span><span class="si">}</span><span class="s">) to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">..."</span><span class="p">)</span>
                
                <span class="n">success</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">send_file</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úÖ Sent: </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to send </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_send_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">):</span>
        <span class="s">"""Send folder as ZIP"""</span>
        <span class="c1"># Get folder info
</span>        <span class="n">folder_info</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">get_file_info</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Error"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Invalid folder: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Create progress dialog
</span>        <span class="n">transfer_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"send_folder_</span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s">"</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">CircularProgressDialog</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">,</span>
            <span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">).</span><span class="n">name</span><span class="p">,</span>
            <span class="n">folder_info</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'total_size'</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s">'send'</span><span class="p">,</span>
            <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">"</span>
        <span class="p">)</span>
        
        <span class="c1"># Store dialog reference
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">progress_dialogs</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">dialog</span>
        
        <span class="c1"># Start transfer in background thread
</span>        <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_send_folder_with_progress</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">dialog</span><span class="p">),</span>
            <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">).</span><span class="n">start</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_send_file_with_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">is_folder</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">dialog</span><span class="p">):</span>
        <span class="s">"""Send file with circular progress dialog"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">send_file</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">is_folder</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">)</span>
            
            <span class="c1"># Update dialog on completion
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">dialog</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úÖ Sent: </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to send </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">dialog</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Error sending </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Remove dialog reference after a delay
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">_remove_dialog</span><span class="p">(</span><span class="n">transfer_id</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">_send_folder_with_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">dialog</span><span class="p">):</span>
        <span class="s">"""Send folder with circular progress dialog"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">send_folder_as_zip</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">)</span>
            
            <span class="c1"># Update dialog on completion
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">dialog</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úÖ Folder sent: </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">).</span><span class="n">name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to send folder: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">dialog</span><span class="p">.</span><span class="n">complete</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Error sending folder: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Remove dialog reference after a delay
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">_remove_dialog</span><span class="p">(</span><span class="n">transfer_id</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">_remove_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transfer_id</span><span class="p">):</span>
        <span class="s">"""Remove progress dialog reference"""</span>
        <span class="k">if</span> <span class="n">transfer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">progress_dialogs</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">.</span><span class="n">progress_dialogs</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">_toggle_auto_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Toggle auto-sync"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">auto_sync_var</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"Auto-sync enabled"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"Auto-sync disabled"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_show_notification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="s">"""Show notification"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">notify_var</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üì¢ </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__open_received_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Open received files folder"""</span>
        <span class="n">received_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"ClipboardReceived"</span>
        <span class="n">received_dir</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">open_folder</span><span class="p">(</span><span class="n">received_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to open folder: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_open_received_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Open the folder where files are actually being saved"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 1. Try to use the directory from the most recent save
</span>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">'primary_received_dir'</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">primary_received_dir</span><span class="p">:</span>
                <span class="n">received_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">primary_received_dir</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÇ Opening from recent save location: </span><span class="si">{</span><span class="n">received_dir</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># 2. Fallback: check received_files list for last saved file
</span>            <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">received_files</span><span class="p">:</span>
                <span class="n">last_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">received_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">'path'</span><span class="p">])</span>
                <span class="n">received_dir</span> <span class="o">=</span> <span class="n">last_file_path</span><span class="p">.</span><span class="n">parent</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÇ Opening from last received file: </span><span class="si">{</span><span class="n">received_dir</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="c1"># Update primary for next time
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">primary_received_dir</span> <span class="o">=</span> <span class="n">received_dir</span>
            
            <span class="c1"># 3. Ultimate fallback: default location
</span>            <span class="k">else</span><span class="p">:</span>
                <span class="n">received_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"ClipboardReceived"</span>
                <span class="n">received_dir</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÇ Opening default folder (no files received yet): </span><span class="si">{</span><span class="n">received_dir</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">primary_received_dir</span> <span class="o">=</span> <span class="n">received_dir</span>
            
            <span class="c1"># Ensure the directory exists
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">received_dir</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">received_dir</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"üìÅ Created missing directory: </span><span class="si">{</span><span class="n">received_dir</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            
            <span class="c1"># Open it
</span>            <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">open_folder</span><span class="p">(</span><span class="n">received_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Failed to open folder </span><span class="si">{</span><span class="n">received_dir</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Error in _open_received_folder: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="c1"># Emergency fallback
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="n">fallback</span> <span class="o">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"ClipboardReceived"</span>
                <span class="n">fallback</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">open_folder</span><span class="p">(</span><span class="n">fallback</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># Nothing more we can do
</span>    
    <span class="k">def</span> <span class="nf">_update_clipboard_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="s">"""Update clipboard display"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">_update_clipboard_display_threadsafe</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">_update_clipboard_display_threadsafe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="s">"""Thread-safe UI update"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'normal'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_text</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="p">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_text</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>  <span class="c1"># No truncation
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'disabled'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_update_transfers_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Update active transfers list"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_update_transfers_list_threadsafe</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_update_transfers_list_threadsafe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Thread-safe transfers list update"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transfers_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'normal'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">transfers_text</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="p">.</span><span class="n">END</span><span class="p">)</span>
        
        <span class="c1"># Get active transfers from progress manager
</span>        <span class="n">active_transfers</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">progress_manager</span><span class="p">.</span><span class="n">get_active_transfers</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">active_transfers</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">transfers_text</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">"No active transfers"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">transfer_id</span><span class="p">,</span> <span class="n">transfer</span> <span class="ow">in</span> <span class="n">active_transfers</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'filename'</span><span class="p">]</span>
                <span class="n">current_size</span> <span class="o">=</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'current_size'</span><span class="p">]</span>
                <span class="n">total_size</span> <span class="o">=</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'total_size'</span><span class="p">]</span>
                <span class="n">transfer_type</span> <span class="o">=</span> <span class="s">"Sending"</span> <span class="k">if</span> <span class="n">transfer</span><span class="p">[</span><span class="s">'transfer_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'send'</span> <span class="k">else</span> <span class="s">"Receiving"</span>
                
                <span class="c1"># Show size instead of percentage
</span>                <span class="n">current_str</span> <span class="o">=</span> <span class="n">FileTransferManager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">current_size</span><span class="p">)</span>
                <span class="n">total_str</span> <span class="o">=</span> <span class="n">FileTransferManager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">total_size</span><span class="p">)</span>
                
                <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">transfer_type</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">current_str</span><span class="si">}</span><span class="s"> / </span><span class="si">{</span><span class="n">total_str</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">transfers_text</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="p">.</span><span class="n">END</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="p">.</span><span class="n">transfers_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'disabled'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="s">"""Add message to log"""</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%H:%M:%S"</span><span class="p">)</span>
        <span class="n">log_entry</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_queue</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">log_entry</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_log_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="s">"""Callback for logging from threads"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_progress_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="s">"""Handle progress updates from transfers"""</span>
        <span class="c1"># Put in queue for thread-safe GUI update
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">progress_queue</span><span class="p">.</span><span class="n">put</span><span class="p">((</span><span class="n">event_type</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">_update_gui_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Update GUI periodically"""</span>
        <span class="c1"># Process log queue
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">log_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">log_queue</span><span class="p">.</span><span class="n">get_nowait</span><span class="p">()</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'normal'</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="p">.</span><span class="n">END</span><span class="p">,</span> <span class="n">log_entry</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">see</span><span class="p">(</span><span class="n">tk</span><span class="p">.</span><span class="n">END</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'disabled'</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="s">'end-1c'</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s">'500'</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">'2.0'</span><span class="p">)</span>
                    
        <span class="k">except</span> <span class="n">queue</span><span class="p">.</span><span class="n">Empty</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="c1"># Process progress queue
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">event_type</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">progress_queue</span><span class="p">.</span><span class="n">get_nowait</span><span class="p">()</span>
                
                <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s">'transfer_started'</span><span class="p">:</span>
                    <span class="n">transfer_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'transfer_id'</span><span class="p">]</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                    
                    <span class="c1"># Update status bar
</span>                    <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="s">'Sending'</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'transfer_type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'send'</span> <span class="k">else</span> <span class="s">'Receiving'</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'filename'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s">'progress_updated'</span><span class="p">:</span>
                    <span class="n">transfer_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'transfer_id'</span><span class="p">]</span>
                    
                    <span class="c1"># Update active transfer
</span>                    <span class="k">if</span> <span class="n">transfer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">].</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    
                    <span class="c1"># Update progress dialog if exists
</span>                    <span class="k">if</span> <span class="n">transfer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">progress_dialogs</span><span class="p">:</span>
                        <span class="n">dialog</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">progress_dialogs</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">dialog</span><span class="p">.</span><span class="n">is_cancelled</span><span class="p">():</span>
                            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">dialog</span><span class="p">.</span><span class="n">update_progress</span><span class="p">(</span>
                                <span class="n">data</span><span class="p">[</span><span class="s">'percentage'</span><span class="p">],</span>
                                <span class="n">data</span><span class="p">[</span><span class="s">'current_size'</span><span class="p">],</span>
                                <span class="n">data</span><span class="p">[</span><span class="s">'total_size'</span><span class="p">]</span>
                            <span class="p">))</span>
                    
                <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s">'transfer_completed'</span><span class="p">:</span>
                    <span class="n">transfer_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'transfer_id'</span><span class="p">]</span>
                    
                    <span class="c1"># Remove from active transfers
</span>                    <span class="k">if</span> <span class="n">transfer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">:</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="p">.</span><span class="n">active_transfers</span><span class="p">[</span><span class="n">transfer_id</span><span class="p">]</span>
                    
                    <span class="c1"># Update status bar
</span>                    <span class="bp">self</span><span class="p">.</span><span class="n">status_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">"Ready"</span><span class="p">)</span>
                    
                    <span class="c1"># Log completion
</span>                    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'success'</span><span class="p">]:</span>
                        <span class="n">time_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'total_time'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">s"</span>
                        <span class="n">size_str</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">transfer_manager</span><span class="p">.</span><span class="n">format_size</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'total_size'</span><span class="p">])</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚úÖ Transfer completed: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'filename'</span><span class="p">]</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">size_str</span><span class="si">}</span><span class="s">) in </span><span class="si">{</span><span class="n">time_str</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"‚ùå Transfer failed: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'filename'</span><span class="p">]</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'error_msg'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                
                <span class="c1"># Update transfers list
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">_update_transfers_list</span><span class="p">()</span>
                    
        <span class="k">except</span> <span class="n">queue</span><span class="p">.</span><span class="n">Empty</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="c1"># Schedule next update
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_update_gui_loop</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_clear_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Clear log"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'normal'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="p">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">'disabled'</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_copy_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Copy log to clipboard"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log_content</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">log_text</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="p">.</span><span class="n">END</span><span class="p">)</span>
            <span class="n">pyperclip</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">log_content</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"Log copied to clipboard"</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    
    <span class="c1"># ====== CRITICAL FIX: Enhanced on_closing method ======
</span>    <span class="k">def</span> <span class="nf">on_closing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Handle application closing - FIXED for proper termination"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"[SHUTDOWN] Application shutdown initiated..."</span><span class="p">)</span>
            
            <span class="c1"># Ask for confirmation
</span>            <span class="k">if</span> <span class="n">messagebox</span><span class="p">.</span><span class="n">askokcancel</span><span class="p">(</span><span class="s">"Quit"</span><span class="p">,</span> <span class="s">"Do you want to quit?"</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"[SHUTDOWN] Shutting down services..."</span><span class="p">)</span>
                
                <span class="c1"># Stop all services
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">receiver</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_monitor</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
                
                <span class="c1"># Call stop methods
</span>                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">receiver</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                    
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">clipboard_monitor</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c1"># Wait a moment for threads to stop
</span>                <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">after</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">_force_shutdown</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="sa">f</span><span class="s">"[SHUTDOWN] Error during shutdown: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="c1"># Force shutdown anyway
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">_force_shutdown</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_force_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Force shutdown of the application"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Destroy all windows
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">root</span><span class="p">.</span><span class="n">destroy</span><span class="p">()</span>
            
            <span class="c1"># Force exit - this is CRITICAL for PyInstaller
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">_log</span><span class="p">(</span><span class="s">"[SHUTDOWN] Forcing application exit..."</span><span class="p">)</span>
            
            <span class="c1"># Kill the process
</span>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">'_exit'</span><span class="p">):</span>
                <span class="n">os</span><span class="p">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Immediate termination, bypassing Python cleanup
</span>            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Fallback
</span>                
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># Ultimate fallback
</span>            <span class="kn">import</span> <span class="nn">ctypes</span>
            <span class="n">ctypes</span><span class="p">.</span><span class="n">windll</span><span class="p">.</span><span class="n">user32</span><span class="p">.</span><span class="n">PostQuitMessage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="n">os</span><span class="p">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># ------------------ Resource Path Helper ------------------
</span><span class="k">def</span> <span class="nf">get_resource_path</span><span class="p">(</span><span class="n">relative_path</span><span class="p">):</span>
    <span class="s">"""Get the correct path for resources whether running as script or PyInstaller executable"""</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># PyInstaller creates a temp folder and stores path in _MEIPASS
</span>        <span class="n">base_path</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">_MEIPASS</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="c1"># Running as normal Python script
</span>        <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="s">"."</span><span class="p">)</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">)</span>
    
    <span class="c1"># Check if file exists, if not try other common locations
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="c1"># Try parent directory
</span>        <span class="n">alt_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="n">relative_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alt_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">alt_path</span>
        
        <span class="c1"># Try current working directory
</span>        <span class="n">alt_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">relative_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alt_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">alt_path</span>
        
        <span class="c1"># Try the actual executable directory (for PyInstaller)
</span>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">'frozen'</span><span class="p">):</span>
            <span class="n">exe_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">)</span>
            <span class="n">alt_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">exe_dir</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">alt_path</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">alt_path</span>
    
    <span class="k">return</span> <span class="n">path</span>

<span class="k">def</span> <span class="nf">load_application_icon</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="s">"""Simple wrapper for backward compatibility"""</span>
    <span class="k">return</span> <span class="n">setup_application_icon</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_load_application_icon</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="s">"""Load application icon with multiple fallbacks, including PyInstaller bundle"""</span>
    <span class="c1"># First, try the icon that PyInstaller might have embedded
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">'_MEIPASS'</span><span class="p">):</span>
            <span class="c1"># Running as PyInstaller bundle
</span>            <span class="n">bundle_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">_MEIPASS</span><span class="p">)</span>
            <span class="n">icon_path</span> <span class="o">=</span> <span class="n">bundle_dir</span> <span class="o">/</span> <span class="s">"icon_clean.png"</span>
            <span class="k">if</span> <span class="n">icon_path</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">icon</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">icon_path</span><span class="p">))</span>
                <span class="n">root</span><span class="p">.</span><span class="n">iconphoto</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>
                <span class="n">root</span><span class="p">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">icon</span>  <span class="c1"># Keep reference
</span>                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Icon loaded from bundle: </span><span class="si">{</span><span class="n">icon_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to load icon from bundle: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="c1"># Try multiple icon formats and locations
</span>    <span class="n">icon_formats</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"icon_clean.png"</span><span class="p">,</span>
        <span class="s">"icon.png"</span><span class="p">,</span>
        <span class="s">"logo.png"</span><span class="p">,</span>
        <span class="s">"app.ico"</span><span class="p">,</span>
        <span class="s">"logo.ico"</span><span class="p">,</span>
        <span class="s">"icon.ico"</span><span class="p">,</span>
    <span class="p">]</span>
    
    <span class="c1"># Check multiple possible locations
</span>    <span class="n">search_paths</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Path</span><span class="p">.</span><span class="n">cwd</span><span class="p">(),</span>  <span class="c1"># Current working directory
</span>        <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">).</span><span class="n">parent</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s">'frozen'</span><span class="p">)</span> <span class="k">else</span> <span class="n">Path</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="n">parent</span><span class="p">,</span>  <span class="c1"># Executable directory
</span>        <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"Downloads"</span><span class="p">,</span>
        <span class="n">Path</span><span class="p">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s">"Desktop"</span><span class="p">,</span>
    <span class="p">]</span>
    
    <span class="k">for</span> <span class="n">icon_file</span> <span class="ow">in</span> <span class="n">icon_formats</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">search_path</span> <span class="ow">in</span> <span class="n">search_paths</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">icon_path</span> <span class="o">=</span> <span class="n">search_path</span> <span class="o">/</span> <span class="n">icon_file</span>
                <span class="k">if</span> <span class="n">icon_path</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Trying icon: </span><span class="si">{</span><span class="n">icon_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">icon_file</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.ico'</span><span class="p">):</span>
                        <span class="c1"># For Windows .ico files
</span>                        <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span><span class="p">:</span>
                            <span class="n">root</span><span class="p">.</span><span class="n">iconbitmap</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">icon_path</span><span class="p">))</span>
                            <span class="k">return</span> <span class="bp">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># On non-Windows, try to load as image
</span>                            <span class="k">try</span><span class="p">:</span>
                                <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageTk</span><span class="p">,</span> <span class="n">Image</span>
                                <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">icon_path</span><span class="p">)</span>
                                <span class="n">photo</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                                <span class="n">root</span><span class="p">.</span><span class="n">iconphoto</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">photo</span><span class="p">)</span>
                                <span class="n">root</span><span class="p">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">photo</span>
                                <span class="k">return</span> <span class="bp">True</span>
                            <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># For PNG/GIF files
</span>                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">icon</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">icon_path</span><span class="p">))</span>
                            <span class="n">root</span><span class="p">.</span><span class="n">iconphoto</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>
                            <span class="n">root</span><span class="p">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">icon</span>
                            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Icon loaded successfully: </span><span class="si">{</span><span class="n">icon_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                            <span class="k">return</span> <span class="bp">True</span>
                        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed to load </span><span class="si">{</span><span class="n">icon_path</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                            <span class="k">continue</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error checking </span><span class="si">{</span><span class="n">icon_file</span><span class="si">}</span><span class="s"> in </span><span class="si">{</span><span class="n">search_path</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
                <span class="k">continue</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"No icon found, using default Tkinter icon"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">_load_application_icon</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="s">"""Load application icon with multiple fallbacks"""</span>
    <span class="n">icon_formats</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"icon_clean.png"</span><span class="p">,</span>
        <span class="s">"icon.png"</span><span class="p">,</span>
        <span class="s">"logo.png"</span><span class="p">,</span>
        <span class="s">"app.ico"</span><span class="p">,</span>
        <span class="s">"logo.ico"</span><span class="p">,</span>
        <span class="s">"icon.ico"</span><span class="p">,</span>
    <span class="p">]</span>
    
    <span class="k">for</span> <span class="n">icon_file</span> <span class="ow">in</span> <span class="n">icon_formats</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">icon_path</span> <span class="o">=</span> <span class="n">get_resource_path</span><span class="p">(</span><span class="n">icon_file</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">icon_path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">icon_file</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.ico'</span><span class="p">):</span>
                    <span class="c1"># For Windows .ico files
</span>                    <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span><span class="p">:</span>
                        <span class="n">root</span><span class="p">.</span><span class="n">iconbitmap</span><span class="p">(</span><span class="n">icon_path</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># On non-Windows, try to load as image
</span>                        <span class="k">try</span><span class="p">:</span>
                            <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageTk</span><span class="p">,</span> <span class="n">Image</span>
                            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">icon_path</span><span class="p">)</span>
                            <span class="n">photo</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                            <span class="n">root</span><span class="p">.</span><span class="n">iconphoto</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">photo</span><span class="p">)</span>
                            <span class="c1"># Keep reference to prevent garbage collection
</span>                            <span class="n">root</span><span class="p">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">photo</span>
                            <span class="k">return</span> <span class="bp">True</span>
                        <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For PNG/GIF files
</span>                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">icon</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">icon_path</span><span class="p">)</span>
                        <span class="n">root</span><span class="p">.</span><span class="n">iconphoto</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">icon</span><span class="p">)</span>
                        <span class="c1"># Keep reference to prevent garbage collection
</span>                        <span class="n">root</span><span class="p">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">icon</span>
                        <span class="k">return</span> <span class="bp">True</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">continue</span>
    
    <span class="k">return</span> <span class="bp">False</span>

<span class="c1"># ------------------ Installation ------------------
</span><span class="k">def</span> <span class="nf">install_dependencies</span><span class="p">():</span>
    <span class="s">"""Install required dependencies"""</span>
    <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="s">'pyperclip'</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Darwin"</span><span class="p">:</span>
        <span class="n">required</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'pyclip'</span><span class="p">)</span>  <span class="c1"># Better for macOS
</span>        <span class="n">required</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'netifaces'</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span><span class="p">:</span>
        <span class="c1"># required.append('pywin32')
</span>        <span class="n">required</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'netifaces'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Linux
</span>        <span class="n">required</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'xclip'</span><span class="p">)</span>  <span class="c1"># For Linux clipboard
</span>        <span class="n">required</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'netifaces'</span><span class="p">)</span>
    
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">required</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s">'xclip'</span><span class="p">:</span>
                <span class="c1"># Check if xclip command exists on Linux
</span>                <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Linux"</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">'which'</span><span class="p">,</span> <span class="s">'xclip'</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">missing</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'xclip (system package)'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">__import__</span><span class="p">(</span><span class="n">module</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'-'</span><span class="p">,</span> <span class="s">'_'</span><span class="p">))</span>
        <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
            <span class="n">missing</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Installing missing dependencies..."</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">subprocess</span>
            <span class="n">pip_install</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">missing</span> <span class="k">if</span> <span class="s">'(system package)'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pip_install</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="p">.</span><span class="n">check_call</span><span class="p">([</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">,</span> <span class="s">'-m'</span><span class="p">,</span> <span class="s">'pip'</span><span class="p">,</span> <span class="s">'install'</span><span class="p">]</span> <span class="o">+</span> <span class="n">pip_install</span><span class="p">)</span>
            
            <span class="c1"># Print system package instructions
</span>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">'(system package)'</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n</span><span class="s">For </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s">, install system package:"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Linux"</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"  sudo apt-get install </span><span class="si">{</span><span class="n">m</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error installing dependencies: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Please install manually:"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"  pip install"</span><span class="p">,</span> <span class="s">" "</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">missing</span> <span class="k">if</span> <span class="s">'(system package)'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">m</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">check_firewall</span><span class="p">():</span>
    <span class="s">"""Check firewall settings"""</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="s">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"FIREWALL CONFIGURATION"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Windows"</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"1. Allow Python through Windows Defender Firewall"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"2. Allow port 6000 (TCP)"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"3. Run as Administrator if needed"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">"Darwin"</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"1. System Settings &gt; Privacy &amp; Security &gt; Firewall"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"2. Click 'Firewall Options'"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"3. Allow Python/terminal"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Clipboard Access:"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"4. System Settings &gt; Privacy &amp; Security &gt; Privacy"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"5. Select 'Automation' or 'Accessibility'"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"6. Add Terminal/iTerm and grant clipboard access"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"If using ufw:"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"  sudo ufw allow 6000/tcp"</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

<span class="c1"># ------------------ Main ------------------
</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="s">"""Main entry point"""</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"PyShine Clipboard Pro - v1.0"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Features:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"‚Ä¢ DIRECT CONNECTION BETWEEN TWO PCs"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"‚Ä¢ Enter target IP and port (default: 6000)"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"‚Ä¢ Auto-sync clipboard text"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"‚Ä¢ Send ANY file type (videos, images, documents, etc.)"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"‚Ä¢ Send complete folders with structure"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"‚Ä¢ Circular progress indicators"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"‚Ä¢ Cross-platform (Windows, macOS, Linux)"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">HOW TO USE:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"1. Enter target IP address"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"2. Enter target port (default: 6000)"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"3. Click 'Connection' to verify"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"4. Use 'Send File/Folder' to transfer files"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"5. Enable 'Auto-sync' for automatic clipboard sharing"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"="</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    
    <span class="c1"># Install dependencies
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">install_dependencies</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Warning: Could not install all dependencies: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    
    <span class="c1"># Check firewall
</span>    <span class="n">check_firewall</span><span class="p">()</span>
    
    <span class="c1"># Initialize mimetypes
</span>    <span class="n">mimetypes</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
    
    <span class="c1"># Create and run application
</span>    <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Tk</span><span class="p">()</span>
    
    <span class="c1"># Load icon dynamically
</span>    <span class="n">load_application_icon</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">PyShineClipboardApp</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    
    <span class="c1"># Center window
</span>    <span class="n">root</span><span class="p">.</span><span class="n">update_idletasks</span><span class="p">()</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">winfo_width</span><span class="p">()</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">winfo_height</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="n">winfo_screenwidth</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="n">winfo_screenheight</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">root</span><span class="p">.</span><span class="n">geometry</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s">+</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s">+</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    
    <span class="c1"># Start main loop
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">root</span><span class="p">.</span><span class="n">mainloop</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Shutting down..."</span><span class="p">)</span>
        <span class="c1"># Force exit on Ctrl+C
</span>        <span class="n">os</span><span class="p">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="privacy-first">Privacy First</h2>

<ul>
  <li>No cloud servers</li>
  <li>No accounts</li>
  <li>No telemetry</li>
  <li>Your data stays on your network</li>
</ul>

<hr />

<h2 id="support--updates">Support &amp; Updates</h2>

<ul>
  <li>Website: https://www.pyshine.com</li>
</ul>

<hr />

<p>Made with ‚ù§Ô∏è by <strong>PyShine</strong></p>


          <!-- Syntax Highlighting -->
          <link href="/assets/css/syntax.css" rel="stylesheet">
          <script src="/assets/scripts/copyCode.js" async></script>

          <!-- Ads -->
          <section aria-label="Advertisements" class="ads mt-4">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2976211678184829"
                 data-ad-slot="7658460605"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </section>

        </article>

      </div>

      <!-- Post Navigation -->
      <nav class="post-navigation controls__inner mt-5" aria-label="Post navigation">
        <div class="controls__item prev">
          
            <span>Previous</span>
            <a href="/Pascals-Law-Simulation-in-Python/" rel="prev">
              Visualizing Pascal's Law with Python ...
            </a>
          
        </div>

        <div class="controls__item next">
          
            <span>Next</span>
            <a href="/Tkinter-Snake-Game-Easy/" rel="next">
              Building a Snake Game in Python with ...
            </a>
          
        </div>
      </nav>

      <!-- Related Posts -->
      
      
      
      
      
      
      
      
      
      

      <!-- Disqus -->
      
        <section class="comments mt-5" aria-label="Comments Section">
          
<section class="comments mt-5" aria-label="Comments Section" style="text-align: center; padding: 50px 0; background-color: #fafafa;">
  <div id="disqus_thread" style="max-width: 800px; margin: 0 auto;"></div>
  <script>

var disqus_config = function () {
this.page.url = 'http://localhost:4000/Clipboard-App-for-Two-PCs/';
this.page.identifier = 'http://localhost:4000/Clipboard-App-for-Two-PCs/';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://https-py2ai-github-io.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the comments.</noscript>
</section>


        </section>
      

    </main>

    <footer class="footer">
  <div class="container">
    <nav class="social">
      
      
      
    </nav>
    <span>&copy; 2026 PyShine. All rights reserved.</span>
  </div>
</footer>
<script async src="/assets/js/bundle.js"></script>

<script async>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function( registration ) {
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    })
    .catch(function(error) {
      console.log('ServiceWorker registration failed: ', error);
    });
  }
</script>



    <!-- Back to Top Button -->
    <button id="back-to-top" class="back-to-top" aria-label="Back to top">
      <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="18 15 12 9 6 15"></polyline>
      </svg>
    </button>

    <!-- MathJax -->
    


    <!-- Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <!-- SIDEBAR TOC SCRIPT -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      const toc = document.getElementById("toc-list");
      const headings = document.querySelectorAll(
        ".post-content h2:not(.no-toc), .post-content h3:not(.no-toc)"
      );
      if (!toc || headings.length === 0) return;

      const ul = document.createElement("ul");
      headings.forEach(h => {
        const id = h.id || h.textContent.trim().toLowerCase().replace(/\s+/g, "-");
        h.id = id;

        const li = document.createElement("li");
        if (h.tagName === "H3") li.style.marginLeft = "1rem";

        li.innerHTML = `<a href="#${id}">${h.textContent}</a>`;
        ul.appendChild(li);
      });
      toc.appendChild(ul);
    });
    </script>

    <!-- INLINE TOC SCRIPT -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      const tocTarget = document.getElementById("inline-toc-list");
      const headings = document.querySelectorAll(
        ".post-content h2:not(.no-toc), .post-content h3:not(.no-toc)"
      );
      if (!tocTarget || headings.length === 0) return;

      const ul = document.createElement("ul");
      headings.forEach(h => {
        const id = h.id || h.textContent.trim().toLowerCase().replace(/\s+/g, "-");
        h.id = id;

        const li = document.createElement("li");
        if (h.tagName === "H3") li.style.marginLeft = "1rem";

        li.innerHTML = `<a href="#${id}">${h.textContent}</a>`;
        ul.appendChild(li);
      });
      tocTarget.appendChild(ul);
    });
    </script>

    <!-- Back to Top Button Script -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      const backToTopButton = document.getElementById("back-to-top");
      if (!backToTopButton) return;

      // Show button when scrolled down 300px
      window.addEventListener("scroll", function() {
        if (window.pageYOffset > 300) {
          backToTopButton.classList.add("visible");
        } else {
          backToTopButton.classList.remove("visible");
        }
      });

      // Smooth scroll to top when clicked
      backToTopButton.addEventListener("click", function() {
        window.scrollTo({
          top: 0,
          behavior: "smooth"
        });
      });
    });
    </script>

    <!-- INLINE TOC STYLES -->
    <style>
      .inline-toc-box {
        background: #D4EDFD;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 25px;
        border: 1px solid #e0e0e0;
      }
      .inline-toc-box ul {
        margin: 0;
        padding-left: 18px;
      }
      .inline-toc-box li {
        margin-bottom: 6px;
      }
      /* Center post navigation */
      .post-navigation.controls__inner {
        justify-content: center !important;
        gap: 4rem;
      }
      /* Related Posts Styles */
      .related-posts {
        margin-top: 3rem;
        padding: 2rem 0;
        border-top: 1px solid #e0e0e0;
      }
      .related-posts .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
      }
      .related-posts__title {
        font-size: 1.75rem;
        margin-bottom: 1.5rem;
        color: #000000;
        text-align: center;
      }
      .related-posts__grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        max-width: 1200px;
        margin: 0 auto;
      }
      .related-post-card {
        display: block;
        text-decoration: none;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        transition: box-shadow 0.3s ease, transform 0.3s ease;
      }
      .related-post-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateY(-4px);
      }
      .related-post-card__image {
        width: 100%;
        height: 100px;
        background: #f5f5f5;
      }
      .related-post-card__image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .related-post-card__content {
        padding: 0.75rem;
      }
      .related-post-card__title {
        font-size: 0.95rem;
        margin: 0 0 0.4rem 0;
        color: #000000;
        line-height: 1.3;
        font-weight: 600;
      }
      .related-post-card__excerpt {
        font-size: 0.8rem;
        color: #666;
        margin: 0 0 0.5rem 0;
        line-height: 1.4;
      }
      .related-post-card__date {
        font-size: 0.75rem;
        color: #999;
      }
      @media (max-width: 992px) {
        .related-posts__grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 600px) {
        .related-posts__grid {
          grid-template-columns: 1fr;
        }
      }
      /* Back to Top Button Styles */
      .back-to-top {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        background: #000000;
        color: #ffffff;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
        z-index: 9999;
      }
      .back-to-top.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }
      .back-to-top:hover {
        background: #333333;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        transform: translateY(-2px);
      }
      .back-to-top:active {
        transform: translateY(0);
      }
      @media (max-width: 768px) {
        .back-to-top {
          bottom: 20px;
          right: 20px;
          width: 45px;
          height: 45px;
        }
      }
    </style>

  </body>
</html>


