

  <!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/Article">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Pinterest & Google verification -->
  <meta name="p:domain_verify" content="fb68a8459fe32b8b072bcd5cc620d125"/>
  <meta name="google-site-verification" content="WAkFPi5cvufClnQetgIl0STmvvwHhVf8jfyENFWhsxU" />
  <meta name="google-site-verification" content="g2pFZlv-92XQD67BPgiVHsvZ4TZH13Ucvmmvvv36kU4" />

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Video streaming and Car Control in Python | PyShine</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Video streaming and Car Control in Python" />
<meta name="author" content="PyShine Team" />
<meta property="og:locale" content="en" />
<meta name="description" content="This tutorial is about running Flask Application and Controlling car from Clientsâ€™ webpage" />
<meta property="og:description" content="This tutorial is about running Flask Application and Controlling car from Clientsâ€™ webpage" />
<link rel="canonical" href="http://localhost:4000/Video-streaming-and-car-control-with-Python/" />
<meta property="og:url" content="http://localhost:4000/Video-streaming-and-car-control-with-Python/" />
<meta property="og:site_name" content="PyShine" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-03T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Video streaming and Car Control in Python" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"PyShine Team"},"dateModified":"2022-05-03T00:00:00+08:00","datePublished":"2022-05-03T00:00:00+08:00","description":"This tutorial is about running Flask Application and Controlling car from Clientsâ€™ webpage","headline":"Video streaming and Car Control in Python","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Video-streaming-and-car-control-with-Python/"},"name":"{{ page.title escape }}","url":"http://localhost:4000/Video-streaming-and-car-control-with-Python/"}</script>
<!-- End Jekyll SEO tag -->
  <!-- This will generate the canonical link automatically -->

  <script src="https://analytics.ahrefs.com/analytics.js" data-key="Im0K82YsmEDy08+6wyUIZA" async></script>

  <!-- Favicon & App Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77">
  <link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77">
  <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77">
  <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]-->

  <!-- App & Theme Info -->
  <meta name="apple-mobile-web-app-title" content="Sleek">
  <meta name="application-name" content="Sleek">
  <meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77">
  <meta name="theme-color" content="#ffffff">

  
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-TCVFBKF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GTM-TCVFBKF');
</script>

  

  <!-- Critical CSS Inline -->
  <style class="inlineCSS">
    h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#19d319}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none;border-bottom:1px dashed #277cea}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px}@media (min-width:0){.container{max-width:auto;margin:0 auto}}@media (min-width:36em){.container{max-width:540px;margin:0 auto}}@media (min-width:48em){.container{max-width:720px;margin:0 auto}}@media (min-width:62em){.container{max-width:960px;margin:0 auto}}@media (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:0}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;border-bottom:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:none;position:absolute;top:3.75em;left:0;width:100%;height:auto;background:#fff}.header__link{color:#343851;padding:.938rem 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;padding:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;visibility:visible;width:auto;height:100%}.header__links-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;padding:0}.header__link{position:relative;padding:.938rem 1rem;border:0;height:100%}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;position:relative;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:2.25rem;border-bottom:0}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__label{position:absolute;top:1.5rem;left:1.5rem;z-index:2}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.post-card__inner{padding:1.875rem 1.25rem .625rem;color:#838c8d}.post-card__header{margin-bottom:.75rem}.post-card__header .post-card__meta{font-size:.875rem}.label{padding:0 10px;margin-bottom:1rem;display:inline-block;line-height:20px;font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.8);border:2px solid rgba(255,255,255,.5);border-radius:100px}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;margin:auto;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);width:100%;max-width:90%;z-index:1}.hero__wrap .hero__title{font-size:1.8em;color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media (min-width:48em){.hero__wrap{max-width:40em}.hero__wrap .hero__title{padding:1rem 0;font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}
  </style>

  <!-- Main CSS -->
  <link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript>

  <script type="text/javascript">
    /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
(function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}}
var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1}
return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia}
if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)}
setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return}
var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}}
if(typeof exports!=="undefined"){exports.loadCSS=loadCSS}
else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this))

  </script>

  <!-- MathJax -->
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>


  <body class="site" itemscope itemtype="https://schema.org/WebPage">

    
      <!-- Google Tag Manager (noscript) -->
      <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TCVFBKF"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
      </noscript>
      <!-- End Google Tag Manager -->
    

    <header class="header"
  itemscope
  itemtype="http://schema.org/SiteNavigationElement"
  aria-label="Main navigation">

  <div class="container">
    <div class="header__inner">

      <!-- Logo -->
      <a class="header__logo" href="/">
        <div class="header__logo--container">
          <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>

	
	
</g>
</svg>

        </div>
      </a>

      <!-- Navigation -->
      <nav class="header__links">
        <div class="header__links-wrapper">

          
            
              <a class="header__link" href="/">
                Home
              </a>
            
          
            
              <a class="header__link" href="/categories">
                Posts
              </a>
            
          
            

            <!-- Applications Dropdown -->
            <div class="header__dropdown">
              <span class="header__link header__dropdown-toggle">
                Applications
                <span class="dropdown-arrow">â–¾</span>
              </span>

              <div class="header__dropdown-menu">
                
                  <a class="header__dropdown-item"
                     href="/photo_correction">
                    Online Photo Correction
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/photo">
                    Online Passport Photo 20KB
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/finger.html">
                    Online Fingers Scanner
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/avatars">
                    Online Make Avatars
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/kanban/debounce.html">
                    Online Reminder App
                  </a>
                
                  <a class="header__dropdown-item"
                     href="/converter.html">
                    Online Image Resize
                  </a>
                
              </div>
            </div>

            
          
            
              <a class="header__link" href="/about">
                About
              </a>
            
          
            
              <a class="header__link" href="/contact">
                Contact
              </a>
            
          
            
              <a class="header__link" href="/privacy">
                Privacy Policy
              </a>
            
          
            
              <a class="header__link" href="/disclaimer">
                Disclaimer
              </a>
            
          

        </div>
      </nav>

      <!-- Language Switcher -->
      

      <!-- Mobile Toggle -->
      <div class="header__toggle">
        <span></span><span></span><span></span>
      </div>

    </div>
  </div>

<style>
/* ==================================================
   ðŸ”’ HEADER â€” ALWAYS VISIBLE, FULL WIDTH COLOR
================================================== */
.header{
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;           /* full width */
  z-index: 10000;
  background: #FFFFFF;    /* uniform header background */
  box-shadow: 0 2px 12px rgba(0,0,0,.35);
  transform: none !important;
  transition: none !important;
}

/* Lock height to avoid reflow */
.header__inner{
  min-height: 72px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Prevent content hiding under fixed header */
body{
  padding-top: 72px;
}

/* ===============================
   NAV BASE
=============================== */
.header__links-wrapper{
  display:flex;
  align-items:center;
  gap:1.5rem;
}

.header__link,
.header__dropdown-toggle{
  display:inline-flex;
  align-items:center;
  gap:6px;
  cursor:pointer;
  font-size:20px;
  font-weight:500;
}

/* ===============================
   DROPDOWN
=============================== */
.header__dropdown{
  position:relative;
}

.dropdown-arrow{
  font-size:1.4em;
  transition:transform .2s ease;
}

.header__dropdown:hover .dropdown-arrow{
  transform:rotate(180deg);
}

.header__dropdown-menu{
  position:absolute;
  top:100%;
  left:0;
  min-width:220px;
  background:#121212;
  border:1px solid #333;
  border-radius:10px;
  padding:6px 0;
  display:none;
  z-index:9999;
}

.header__dropdown:hover .header__dropdown-menu{
  display:block;
}

.header__dropdown-item{
  display:block;
  padding:10px 16px;
  color:#eaeaea;
  text-decoration:none;
}

.header__dropdown-item:hover{
  background:#1f1f1f;
}

/* ===============================
   MOBILE
=============================== */
@media (max-width:768px){

  body{
    padding-top: 64px;
  }

  .header__inner{
    min-height: 64px;
  }

  .header__links-wrapper{
    flex-direction:column;
    align-items:stretch;
    gap:0;
  }

  .header__dropdown-toggle{
    justify-content:space-between;
    padding:14px 16px;
  }

  .header__dropdown-menu{
    position:static;
    display:none;
    background:#0f0f0f;
    border:none;
  }

  .header__dropdown:hover .header__dropdown-menu{
    display:block;
  }

  .header__dropdown-item{
    padding:14px 20px;
    background:#1a1a1a;
    border-top:1px solid #2a2a2a;
    font-size:15px;
  }
}

/* ===============================
   LANGUAGE SWITCHER
=============================== */
.header__lang-switcher{
  display:inline-flex;
  gap:.5rem;
  align-items:center;
  font-size:1.3rem;
  margin-left:1rem;
}
.lang-flag.active{ text-decoration:underline }
.lang-flag.disabled{ opacity:.5; filter:grayscale(100%) }

</style>
</header>


    
      <div class="hero lazyload"
           data-bg="http://localhost:4000/assets/img/posts/raspberrypicarcontrol.jpg"
           role="img"
           aria-label="Video streaming and Car Control in Python">
    
        <div class="hero__wrap">

          
            <div class="hero__categories">
              
                <a class="label"
                   href="/categories/#Raspberry Pi Programming Series"
                   aria-label="Category: Raspberry Pi Programming Series">
                   Raspberry Pi Programming Series
                </a>
                
              
            </div>
          

          <h1 class="hero__title" itemprop="headline">Video streaming and Car Control in Python</h1>

          <p class="hero__meta">
            <time datetime="2022-05-03T00:00:00+08:00" itemprop="datePublished">
              03 May 2022
            </time>
            &nbsp;Â·&nbsp;
            
            <span itemprop="timeRequired">
              
                16 mins read
              
            </span>
          </p>
        </div>
      </div>

    <main class="site__content" role="main">
      <div class="container post-layout">

        <!-- SIDEBAR TOC -->
        <aside class="post-toc" id="post-toc">
          <h3 class="no-toc">Contents</h3>
          <nav id="toc-list"></nav>
        </aside>

        <!-- MAIN CONTENT -->
        <article class="post-content"
                 itemprop="articleBody"
                 itemscope itemtype="https://schema.org/Article">

          <!-- INLINE TOC -->
          <div id="inline-toc" class="inline-toc-box">
            <h3 class="no-toc">Contents</h3>
            <nav id="inline-toc-list"></nav>
          </div>

          <p>Hi friends! Todayâ€™s tutorial is Part 04 of the Raspberry Pi (RPi) learning series. Raspberry Pi zero W has limited resources in terms of compute power as compare 
to higher versions such as Raspberry Pi 3 and 4. The aim of this tutorial is to do optimized video transfer and client control all inside the tiny little 
Raspberry Pi zero W (RPi), which weighs only 9 grams. The following code also applies and works well in higher version of Raspberry Pi. The lighter weight of 
RPi makes it perfect candidate for the control of toy cars or small drones. Please watch the video below to understand the code</p>

<p><br /></p>
<div align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/uJagCes4bzA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
<p><br /></p>

<h1 id="running-video-streamer-and-flask-app-in-pc">Running Video Streamer and Flask App in PC</h1>

<p>Project view:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Project_Directory/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ index.html
â””â”€â”€ main.py
</code></pre></div></div>
<p>Here is the Python code for the Flask application running at local machine and no control pins are activated:</p>

<h2 id="mainpy">main.py</h2>
<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Welcome to PyShine, this code is for demonstration on PC
## Client can send control commands to server, and also can view live
## video stream on the same webpage.
## We can easily extend this code for Raspberry Pi Zero W and other versions of Pi 
</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span>  <span class="nn">pyshine</span> <span class="k">as</span> <span class="n">ps</span> <span class="c1">#  pip3 install pyshine==0.0.9
</span><span class="kn">import</span> <span class="nn">threading</span>
<span class="c1">## import RPi.GPIO as io
</span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>



<span class="n">FORWARD</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">BACK</span> <span class="o">=</span> <span class="mi">26</span>
<span class="n">LEFT</span> <span class="o">=</span> <span class="mi">27</span>
<span class="n">RIGHT</span> <span class="o">=</span> <span class="mi">22</span>

<span class="n">map_motion</span> <span class="o">=</span>  <span class="p">{</span>
        <span class="n">FORWARD</span><span class="p">:</span> <span class="s">"FORWARD"</span><span class="p">,</span>
        <span class="n">BACK</span> <span class="p">:</span> <span class="s">"BACK"</span><span class="p">,</span>
        <span class="n">LEFT</span> <span class="p">:</span> <span class="s">"LEFT"</span><span class="p">,</span>
        <span class="n">RIGHT</span> <span class="p">:</span> <span class="s">"RIGHT"</span><span class="p">}</span>

<span class="n">server_ip</span> <span class="o">=</span> <span class="s">'192.168.10.115'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9000</span>
<span class="n">HTML</span><span class="o">=</span><span class="s">"""
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;PyShine Live Streaming&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;center&gt;&lt;h1&gt; PyShine Live Streaming using OpenCV &lt;/h1&gt;&lt;/center&gt;
&lt;center&gt;&lt;img src="stream.mjpg" width='640' height='480' autoplay playsinline&gt;&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
"""</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">StreamProps</span> <span class="o">=</span> <span class="n">ps</span><span class="p">.</span><span class="n">StreamProps</span>
    <span class="n">StreamProps</span><span class="p">.</span><span class="n">set_Page</span><span class="p">(</span><span class="n">StreamProps</span><span class="p">,</span><span class="n">HTML</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="n">server_ip</span><span class="p">,</span><span class="n">port</span><span class="p">)</span> <span class="c1"># Enter your IP address 
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">StreamProps</span><span class="p">.</span><span class="n">set_Mode</span><span class="p">(</span><span class="n">StreamProps</span><span class="p">,</span><span class="s">'cv2'</span><span class="p">)</span>
        <span class="n">capture</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="s">'test.mp4'</span><span class="p">)</span> <span class="c1"># replace 'outside.mp4' with 0 depending on webcam id
</span>        <span class="n">capture</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">CAP_PROP_BUFFERSIZE</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">capture</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">,</span><span class="mi">320</span><span class="p">)</span>
        <span class="n">capture</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">,</span><span class="mi">240</span><span class="p">)</span>
        <span class="n">capture</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">CAP_PROP_FPS</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">StreamProps</span><span class="p">.</span><span class="n">set_Capture</span><span class="p">(</span><span class="n">StreamProps</span><span class="p">,</span><span class="n">capture</span><span class="p">)</span>
        <span class="n">StreamProps</span><span class="p">.</span><span class="n">set_Quality</span><span class="p">(</span><span class="n">StreamProps</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">ps</span><span class="p">.</span><span class="n">Streamer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span><span class="n">StreamProps</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Server started at'</span><span class="p">,</span><span class="s">'http://'</span><span class="o">+</span><span class="n">address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">':'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">()</span>
        
    <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">capture</span><span class="p">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">server</span><span class="p">.</span><span class="n">socket</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">my_list</span> <span class="o">=</span><span class="p">[</span><span class="n">FORWARD</span><span class="p">,</span><span class="n">BACK</span><span class="p">,</span><span class="n">LEFT</span><span class="p">,</span><span class="n">RIGHT</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">run_for</span> <span class="p">(</span><span class="n">pin</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"action-- </span><span class="si">{</span><span class="n">map_motion</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="k">pass</span>
             
<span class="k">global</span> <span class="n">pin</span> 
<span class="n">pin</span> <span class="o">=</span> <span class="n">FORWARD</span>
<span class="n">init</span><span class="p">()</span>
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">pin</span>
    <span class="n">data</span><span class="o">=</span> <span class="s">'stop'</span> <span class="c1">#default
</span>    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"data"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">'forward'</span><span class="p">:</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">FORWARD</span>
            <span class="n">run_for</span> <span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="k">elif</span>  <span class="n">data</span> <span class="o">==</span> <span class="s">'back'</span><span class="p">:</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">BACK</span>
            <span class="n">run_for</span> <span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s">'left'</span><span class="p">:</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">LEFT</span>
            <span class="n">run_for</span> <span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s">'right'</span><span class="p">:</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">RIGHT</span>
            <span class="n">run_for</span> <span class="p">(</span><span class="n">pin</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'right'</span><span class="p">)</span>          
        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s">'stop'</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'STOP'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"NO POST ..."</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    
    <span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">main</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">server_ip</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">threaded</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
</code></pre></div></div>

<p>Following is the index.html containing javascript</p>

<h3 id="indexhtml">index.html</h3>
<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;center&gt;&lt;h1&gt;</span>PyShine Live Streaming and Control Car with Sockets<span class="nt">&lt;/h1&gt;&lt;/center&gt;</span>
		<span class="nt">&lt;center&gt;&lt;img</span> <span class="na">src=</span><span class="s">"http://192.168.10.115:9000/stream.mjpg"</span> <span class="na">width=</span><span class="s">"640"</span> <span class="na">height=</span><span class="s">"480"</span> <span class="na">autoplay</span> <span class="na">playsinline</span> <span class="na">class=</span><span class="s">"rotateimg0"</span><span class="nt">&gt;&lt;/center&gt;</span>
	
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://code.jquery.com/jquery-3.5.1.js"</span>
        <span class="na">integrity=</span><span class="s">"sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="</span>
        <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        <span class="c1">// forward function </span>
        <span class="kd">function</span> <span class="nx">forward_func</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">color</span><span class="p">,</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">color</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">normalColor</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span><span class="na">data</span><span class="p">:{</span><span class="na">data</span><span class="p">:</span><span class="dl">'</span><span class="s1">stop</span><span class="dl">'</span><span class="p">},</span>
                <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">good</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">},</span>
                <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">normalColor</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="na">data</span><span class="p">:{</span><span class="na">data</span><span class="p">:</span><span class="nx">action</span><span class="p">},</span>
                <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">good</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">},</span>
                <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="p">}</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="ni">&amp;nbsp;</span> 
        <span class="nt">&lt;center&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">onpointerdown=</span><span class="s">"forward_func(this,'blue','forward')"</span> <span class="na">onpointerup=</span><span class="s">"forward_func(this)"</span> <span class="na">style=</span><span class="s">"height:120px;width:120px"</span><span class="nt">&gt;</span>Forward<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">onpointerdown=</span><span class="s">"forward_func(this,'blue','back')"</span> <span class="na">onpointerup=</span><span class="s">"forward_func(this)"</span> <span class="na">style=</span><span class="s">"height:120px;width:120px"</span><span class="nt">&gt;</span>Back<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">onpointerdown=</span><span class="s">"forward_func(this,'blue','left')"</span> <span class="na">onpointerup=</span><span class="s">"forward_func(this)"</span> <span class="na">style=</span><span class="s">"height:120px;width:120px"</span><span class="nt">&gt;</span>Left<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">onpointerdown=</span><span class="s">"forward_func(this,'blue','right')"</span> <span class="na">onpointerup=</span><span class="s">"forward_func(this)"</span> <span class="na">style=</span><span class="s">"height:120px;width:120px"</span><span class="nt">&gt;</span>Right<span class="nt">&lt;/button&gt;</span>
        
        <span class="nt">&lt;/center&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

</code></pre></div></div>

<h2 id="running-video-streamer-and-flask-app-in-raspberry-pi-zero-w">Running Video Streamer and Flask App in Raspberry Pi Zero W</h2>

<p>You can skip the above code and use the following code only for the Raspberry Pi.</p>

<p>!<img src="http://localhost:4000/assets/img/posts/car_pi_2022_05_09.jpg" alt="car pi 2022 05 09" /></p>

<p>Project view:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Project_Directory/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ index.html
â”œâ”€â”€ staic/
â”‚   â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”‚   â”œâ”€â”€ jquery-3.5.1.js
â””â”€â”€ main.py
</code></pre></div></div>

<h3 id="mainpy-1">main.py</h3>
<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span>  <span class="nn">pyshine</span> <span class="k">as</span> <span class="n">ps</span> <span class="c1">#  pip3 install pyshine==0.0.9
</span><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">picamera</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="n">FORWARD</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">BACK</span> <span class="o">=</span> <span class="mi">26</span>
<span class="n">LEFT</span> <span class="o">=</span> <span class="mi">27</span>
<span class="n">RIGHT</span> <span class="o">=</span> <span class="mi">22</span>

<span class="n">server_ip</span> <span class="o">=</span> <span class="s">'192.168.10.1'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9000</span>

<span class="n">map_motion</span> <span class="o">=</span>  <span class="p">{</span><span class="n">FORWARD</span><span class="p">:</span> <span class="s">"FORWARD"</span><span class="p">,</span>
        <span class="n">BACK</span> <span class="p">:</span> <span class="s">"BACK"</span><span class="p">,</span>
        <span class="n">LEFT</span> <span class="p">:</span> <span class="s">"LEFT"</span><span class="p">,</span>
        <span class="n">RIGHT</span> <span class="p">:</span> <span class="s">"RIGHT"</span><span class="p">}</span>

<span class="n">HTML</span><span class="o">=</span><span class="s">"""
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;PyShine Live Streaming&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;center&gt;&lt;h1&gt; PyShine Live Streaming using OpenCV &lt;/h1&gt;&lt;/center&gt;
&lt;center&gt;&lt;img src="stream.mjpg" width='640' height='480' autoplay playsinline&gt;&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
"""</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    
    <span class="n">StreamProps</span> <span class="o">=</span> <span class="n">ps</span><span class="p">.</span><span class="n">StreamProps</span>
    <span class="n">StreamProps</span><span class="p">.</span><span class="n">set_Page</span><span class="p">(</span><span class="n">StreamProps</span><span class="p">,</span><span class="n">HTML</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="p">(</span><span class="n">server_ip</span><span class="p">,</span><span class="n">port</span><span class="p">)</span> <span class="c1"># Enter your IP address 
</span>    <span class="n">StreamProps</span><span class="p">.</span><span class="n">set_Mode</span><span class="p">(</span><span class="n">StreamProps</span><span class="p">,</span><span class="s">'picamera'</span><span class="p">)</span>    
    <span class="k">with</span> <span class="n">picamera</span><span class="p">.</span><span class="n">PiCamera</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s">'320x240'</span><span class="p">,</span> <span class="n">framerate</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">camera</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">ps</span><span class="p">.</span><span class="n">StreamOut</span><span class="p">()</span>
        <span class="n">StreamProps</span><span class="p">.</span><span class="n">set_Output</span><span class="p">(</span><span class="n">StreamProps</span><span class="p">,</span><span class="n">output</span><span class="p">)</span>
        <span class="n">camera</span><span class="p">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">camera</span><span class="p">.</span><span class="n">start_recording</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">'mjpeg'</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">ps</span><span class="p">.</span><span class="n">Streamer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">StreamProps</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'Server started at'</span><span class="p">,</span><span class="s">'http://'</span><span class="o">+</span><span class="n">address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">':'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">camera</span><span class="p">.</span><span class="n">stop_recording</span><span class="p">()</span>


<span class="n">my_list</span> <span class="o">=</span><span class="p">[</span><span class="n">FORWARD</span><span class="p">,</span><span class="n">BACK</span><span class="p">,</span><span class="n">LEFT</span><span class="p">,</span><span class="n">RIGHT</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">run_for</span> <span class="p">(</span><span class="n">pin</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"action-- </span><span class="si">{</span><span class="n">map_motion</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="n">io</span><span class="p">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">BCM</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">io</span><span class="p">.</span><span class="n">OUT</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">pin</span><span class="p">:</span>
            <span class="n">io</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="n">io</span><span class="p">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">BCM</span><span class="p">)</span>              
    <span class="n">io</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">FORWARD</span><span class="p">,</span><span class="n">io</span><span class="p">.</span><span class="n">OUT</span><span class="p">)</span>  
    <span class="n">io</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">BACK</span><span class="p">,</span><span class="n">io</span><span class="p">.</span><span class="n">OUT</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">LEFT</span><span class="p">,</span><span class="n">io</span><span class="p">.</span><span class="n">OUT</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">RIGHT</span><span class="p">,</span><span class="n">io</span><span class="p">.</span><span class="n">OUT</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
        <span class="n">io</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">io</span><span class="p">.</span><span class="n">cleanup</span><span class="p">()</span>

<span class="k">global</span> <span class="n">pin</span> 
<span class="n">pin</span> <span class="o">=</span> <span class="n">FORWARD</span>
<span class="n">init</span><span class="p">()</span>
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    
    <span class="k">global</span> <span class="n">pin</span>
    <span class="n">data</span><span class="o">=</span> <span class="s">'stop'</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"data"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">'forward'</span><span class="p">:</span>
            <span class="c1">## print('forward')
</span>            <span class="n">run_for</span><span class="p">(</span><span class="n">FORWARD</span><span class="p">)</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">FORWARD</span>
        <span class="k">elif</span>  <span class="n">data</span> <span class="o">==</span> <span class="s">'back'</span><span class="p">:</span>
            <span class="c1">## print("back")
</span>            <span class="n">run_for</span><span class="p">(</span><span class="n">BACK</span><span class="p">)</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">BACK</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s">'left'</span><span class="p">:</span>
            <span class="c1">## print('left')
</span>            <span class="n">run_for</span><span class="p">(</span><span class="n">LEFT</span><span class="p">)</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">LEFT</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s">'right'</span><span class="p">:</span>
            <span class="c1">## print('right')          
</span>            <span class="n">run_for</span><span class="p">(</span><span class="n">RIGHT</span><span class="p">)</span>
            <span class="n">pin</span> <span class="o">=</span> <span class="n">RIGHT</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s">'stop'</span><span class="p">:</span>
            <span class="c1">## print('STOP')
</span>            <span class="n">io</span><span class="p">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">BCM</span><span class="p">)</span>
            <span class="n">io</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">io</span><span class="p">.</span><span class="n">OUT</span><span class="p">)</span>
            <span class="n">io</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">io</span><span class="p">.</span><span class="n">cleanup</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"NO POST ..."</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    
    <span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">main</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">server_ip</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">threaded</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
</code></pre></div></div>

<h3 id="indexhtml-1">index.html</h3>

<p>Please note that, in the following script we are accessing <code class="language-plaintext highlighter-rouge">jquery-3.5.1.js</code> from the <code class="language-plaintext highlighter-rouge">/static/scripts/</code> location instead of <code class="language-plaintext highlighter-rouge">https://code.jquery.com/jquery-3.5.1.js</code>, because if you want to run in Ad hoc mode, then you would not have the choice to access this js file from
the internet. In that case you can download and save it in the <code class="language-plaintext highlighter-rouge">/static/scripts/</code> location</p>
<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;body&gt;</span>
		<span class="nt">&lt;center&gt;&lt;h1&gt;</span>PyShine Live Streaming and Control Car with Sockets<span class="nt">&lt;/h1&gt;&lt;/center&gt;</span>
		<span class="nt">&lt;center&gt;&lt;img</span> <span class="na">src=</span><span class="s">"http://192.168.10.1:9000/stream.mjpg"</span> <span class="na">width=</span><span class="s">"640"</span> <span class="na">height=</span><span class="s">"480"</span> <span class="na">autoplay</span> <span class="na">playsinline</span> <span class="na">class=</span><span class="s">"rotateimg0"</span><span class="nt">&gt;&lt;/center&gt;</span>
	
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/static/scripts/jquery-3.5.1.js"</span>
                <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
        <span class="c1">// forward function </span>
        <span class="kd">function</span> <span class="nx">forward_func</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">color</span><span class="p">,</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">color</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">normalColor</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span><span class="na">data</span><span class="p">:{</span><span class="na">data</span><span class="p">:</span><span class="dl">'</span><span class="s1">stop</span><span class="dl">'</span><span class="p">},</span>
                <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">stop</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">},</span>
                <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">normalColor</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="na">data</span><span class="p">:{</span><span class="na">data</span><span class="p">:</span><span class="nx">action</span><span class="p">},</span>
                <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
                <span class="p">},</span>
                <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="p">}</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nt">&lt;/script&gt;</span>
        <span class="ni">&amp;nbsp;</span> 
        <span class="nt">&lt;center&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">onpointerdown=</span><span class="s">"forward_func(this,'blue','forward')"</span> <span class="na">onpointerup=</span><span class="s">"forward_func(this)"</span> <span class="na">style=</span><span class="s">"height:120px;width:120px"</span><span class="nt">&gt;</span>Forward<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">onpointerdown=</span><span class="s">"forward_func(this,'blue','back')"</span> <span class="na">onpointerup=</span><span class="s">"forward_func(this)"</span> <span class="na">style=</span><span class="s">"height:120px;width:120px"</span><span class="nt">&gt;</span>Back<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">onpointerdown=</span><span class="s">"forward_func(this,'blue','left')"</span> <span class="na">onpointerup=</span><span class="s">"forward_func(this)"</span> <span class="na">style=</span><span class="s">"height:120px;width:120px"</span><span class="nt">&gt;</span>Left<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">onpointerdown=</span><span class="s">"forward_func(this,'blue','right')"</span> <span class="na">onpointerup=</span><span class="s">"forward_func(this)"</span> <span class="na">style=</span><span class="s">"height:120px;width:120px"</span><span class="nt">&gt;</span>Right<span class="nt">&lt;/button&gt;</span>
        
        <span class="nt">&lt;/center&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="setting-up-raspberry-pi-in-ad-hoc-mode">Setting up Raspberry Pi in Ad hoc mode</h3>
<p>If you want to run this code at a place with no wifi router, than you can configure RPi in Adhoc mode. However, this is optional. Previously, we have discussed how to configure your RPi device in Ad hoc mode or infrastructure-less mode. Yes, that means without any requirement of a wifi router.  That is a significant advantage of Ad hoc mode because it gives us the wifi-router freedom, and a dedicated point-to-point link provides lower latency, which is the best choice for the FPV systems. You can visit https://pyshine.com/How-to-configure-Raspberry-Pi-in-Ad-hoc-wifi-mode/</p>

<p><br /></p>
<div align="center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/L0PaW55ZLmw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
<p><br /></p>

<h2 id="tip">TIP</h2>
<p>We can run any Python code automatically e.g., <code class="language-plaintext highlighter-rouge">/home/pi/Documents/main.py</code> by giving the path to profile, once the RPi is booted.
Open up profile</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nano /etc/profile
</code></pre></div></div>
<p>Now put the path to <code class="language-plaintext highlighter-rouge">/home/pi/Documents/main.py</code> the profile page as the last line with python version.</p>

<p><code class="language-plaintext highlighter-rouge">python3 /home/pi/Documents/main.py &amp;</code></p>

<p>Save it and reboot, the code main.py will run automatically once booted.</p>



          <!-- Syntax Highlighting -->
          <link href="/assets/css/syntax.css" rel="stylesheet">
          <script src="/assets/scripts/copyCode.js" async></script>

          <!-- Ads -->
          <section aria-label="Advertisements" class="ads mt-4">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2976211678184829"
                 data-ad-slot="7658460605"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </section>

        </article>

      </div>

      <!-- Post Navigation -->
      <nav class="post-navigation controls__inner mt-5" aria-label="Post navigation">
        <div class="controls__item prev">
          
            <span>Previous</span>
            <a href="/Server-sends-UDP-video-and-client-saves/" rel="prev">
              How to send video over UDP socket and...
            </a>
          
        </div>

        <div class="controls__item next">
          
            <span>Next</span>
            <a href="/UDP-Send-Video-Single-Sever-Multiple-Clients/" rel="next">
              UDP Single server to multiple clients
            </a>
          
        </div>
      </nav>

      <!-- Disqus -->
      
        <section class="comments mt-5" aria-label="Comments Section">
          
<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = 'http://localhost:4000/Video-streaming-and-car-control-with-Python/';
this.page.identifier = 'http://localhost:4000/Video-streaming-and-car-control-with-Python/';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://https-py2ai-github-io.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the comments.</noscript>


        </section>
      

    </main>

    <footer class="footer">
  <div class="container">
    <nav class="social">
      
      
      
    </nav>
    <span>&copy; 2026 PyShine. All rights reserved.</span>
  </div>
</footer>
<script async src="/assets/js/bundle.js"></script>

<script async>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function( registration ) {
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    })
    .catch(function(error) {
      console.log('ServiceWorker registration failed: ', error);
    });
  }
</script>



    <!-- MathJax -->
    
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script
  type="text/javascript"
  charset="utf-8"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
>
</script>
<script
  type="text/javascript"
  charset="utf-8"
  src="https://vincenttam.github.io/javascripts/MathJaxLocal.js"
>
</script>



    <!-- Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <!-- SIDEBAR TOC SCRIPT -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      const toc = document.getElementById("toc-list");
      const headings = document.querySelectorAll(
        ".post-content h2:not(.no-toc), .post-content h3:not(.no-toc)"
      );
      if (!toc || headings.length === 0) return;

      const ul = document.createElement("ul");
      headings.forEach(h => {
        const id = h.id || h.textContent.trim().toLowerCase().replace(/\s+/g, "-");
        h.id = id;

        const li = document.createElement("li");
        if (h.tagName === "H3") li.style.marginLeft = "1rem";

        li.innerHTML = `<a href="#${id}">${h.textContent}</a>`;
        ul.appendChild(li);
      });
      toc.appendChild(ul);
    });
    </script>

    <!-- INLINE TOC SCRIPT -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      const tocTarget = document.getElementById("inline-toc-list");
      const headings = document.querySelectorAll(
        ".post-content h2:not(.no-toc), .post-content h3:not(.no-toc)"
      );
      if (!tocTarget || headings.length === 0) return;

      const ul = document.createElement("ul");
      headings.forEach(h => {
        const id = h.id || h.textContent.trim().toLowerCase().replace(/\s+/g, "-");
        h.id = id;

        const li = document.createElement("li");
        if (h.tagName === "H3") li.style.marginLeft = "1rem";

        li.innerHTML = `<a href="#${id}">${h.textContent}</a>`;
        ul.appendChild(li);
      });
      tocTarget.appendChild(ul);
    });
    </script>

    <!-- INLINE TOC STYLES -->
    <style>
      .inline-toc-box {
        background: #D4EDFD;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 25px;
        border: 1px solid #e0e0e0;
      }
      .inline-toc-box ul {
        margin: 0;
        padding-left: 18px;
      }
      .inline-toc-box li {
        margin-bottom: 6px;
      }
    </style>

  </body>
</html>


