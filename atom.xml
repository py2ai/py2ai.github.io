<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://www.pyshine.com/atom.xml" rel="self" type="application/atom+xml" /><link href="https://www.pyshine.com/" rel="alternate" type="text/html" hreflang="en" /><updated>2026-01-14T01:09:56+00:00</updated><id>https://www.pyshine.com/atom.xml</id><title type="html">PyShine</title><subtitle>Simple and practical Python tutorials for everyone. Learn, build, and explore AI and coding step by step — no jargon, just clear explanations.</subtitle><author><name>PyShine Team</name></author><entry><title type="html">Visualizing Pascal’s Law with Python and Pygame</title><link href="https://www.pyshine.com/Pascals-Law-Simulation-in-Python/" rel="alternate" type="text/html" title="Visualizing Pascal’s Law with Python and Pygame" /><published>2026-01-10T00:00:00+00:00</published><updated>2026-01-10T00:00:00+00:00</updated><id>https://www.pyshine.com/Pascals-Law-Simulation-in-Python</id><content type="html" xml:base="https://www.pyshine.com/Pascals-Law-Simulation-in-Python/"><![CDATA[<h1 id="visualizing-pascals-law-with-python-and-pygame">Visualizing Pascal’s Law with Python and Pygame</h1>

<p>This project demonstrates <strong>Pascal’s Law</strong>, a fundamental principle of fluid mechanics, using an interactive <strong>Pygame simulation</strong>. By dragging pistons and adjusting areas, users can visually and numerically understand how pressure and force behave in a confined fluid.</p>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/1LPkqUvLulU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<hr />

<h2 id="what-is-pascals-law">What Is Pascal’s Law?</h2>

<p><strong>Pascal’s Law</strong> states:</p>

<blockquote>
  <p><em>Pressure applied to a confined fluid is transmitted equally in all directions throughout the fluid.</em></p>
</blockquote>

<p>Mathematically:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>P = F / A
</code></pre></div></div>

<p>Where:</p>
<ul>
  <li><strong>P</strong> = Pressure (Pascals, Pa)</li>
  <li><strong>F</strong> = Force (Newtons, N)</li>
  <li><strong>A</strong> = Area (square meters, m²)</li>
</ul>

<p>This principle is the reason <strong>hydraulic presses, car brakes, lifts, and excavators</strong> can multiply force.</p>

<hr />

<h2 id="what-this-simulation-shows">What This Simulation Shows</h2>

<p>This program visually simulates a <strong>hydraulic system</strong> with:</p>

<ul>
  <li>A <strong>small input piston</strong> (left)</li>
  <li>A <strong>large output piston</strong> (right)</li>
  <li>A <strong>U-shaped fluid pipe</strong> connecting them</li>
</ul>

<h3 id="key-features">Key Features</h3>

<ul>
  <li>Real-time fluid visualization</li>
  <li>Mouse-controlled piston movement</li>
  <li>Adjustable output piston area</li>
  <li>Automatic force multiplication</li>
  <li>Live display of SI units (N, m², Pa)</li>
</ul>

<hr />

<h2 id="technologies-used">Technologies Used</h2>

<ul>
  <li><strong>Python 3</strong></li>
  <li><strong>Pygame</strong> (graphics + interaction)</li>
  <li><strong>Physics equations</strong> (real SI units)</li>
</ul>

<hr />

<h2 id="physics-model-used">Physics Model Used</h2>

<h3 id="pressure-calculation">Pressure Calculation</h3>

<p>Pressure is calculated using fluid depth:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>P = ρ g h
</code></pre></div></div>

<p>Where:</p>
<ul>
  <li><strong>ρ</strong> = fluid density (1000 kg/m³ for water)</li>
  <li><strong>g</strong> = gravity (9.81 m/s²)</li>
  <li><strong>h</strong> = depth of piston (meters)</li>
</ul>

<hr />

<h3 id="force-transmission">Force Transmission</h3>

<p>Because pressure is equal everywhere:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>F_in / A_small = F_out / A_big
</code></pre></div></div>

<p>So:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>F_out = F_in × (A_big / A_small)
</code></pre></div></div>

<p>This is why <strong>small force on a small piston creates large force on a large piston</strong>.</p>

<hr />

<h2 id="understanding-the-code-structure">Understanding the Code Structure</h2>

<h3 id="1-window-setup-portrait-mode">1. Window Setup (Portrait Mode)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">650</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
</code></pre></div></div>

<p>A tall window helps visualize vertical piston motion.</p>

<hr />

<h3 id="2-si-units-configuration">2. SI Units Configuration</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">A_small</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># m²
</span><span class="n">A_big</span> <span class="o">=</span> <span class="mf">0.08</span>    <span class="c1"># m²
</span><span class="n">fluid_density</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>
</code></pre></div></div>

<p>All calculations are done using <strong>real physics units</strong>.</p>

<hr />

<h3 id="3-area-to-width-scaling">3. Area-to-Width Scaling</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">big_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_width</span> <span class="o">*</span> <span class="p">(</span><span class="n">A_big</span> <span class="o">/</span> <span class="n">A_small</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
</code></pre></div></div>

<p>Why square root?</p>

<p>Because:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Area ∝ width²
</code></pre></div></div>

<p>So width must scale with √area to remain visually correct.</p>

<hr />

<h3 id="4-constant-fluid-volume-constraint">4. Constant Fluid Volume Constraint</h3>

<p>To simulate incompressible fluid:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">initial_fluid_area</span> <span class="o">=</span> <span class="n">calculate_fluid_area</span><span class="p">(...)</span>
</code></pre></div></div>

<p>When one piston moves down, the other <strong>must rise</strong> to conserve volume.</p>

<hr />

<h3 id="5-mouse-interaction">5. Mouse Interaction</h3>

<ul>
  <li>Drag <strong>left piston</strong> → increases pressure</li>
  <li>Drag <strong>right handle</strong> → changes piston area</li>
</ul>

<p>This lets users <strong>experiment freely</strong>.</p>

<hr />

<h3 id="complete-code">Complete code</h3>
<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""This demonstrates Pascal's Law:
that pressure applied to a confined fluid is transmitted 
equally throughout the fluid.

Key Features:
Real-time piston movement and corresponding pressure/force change.
Adjustable output piston area via mouse drag tovisualize force multiplication.
Realistic SI units (Force in N, Area in meter-square., Pressure in Pa).
Dynamic info panel displaying Pascal's law and live values.
visit www.pyshine.com for more details
"""</span>

<span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="nn">pygame.draw</span> <span class="kn">import</span> <span class="n">rect</span><span class="p">,</span> <span class="n">lines</span>
<span class="kn">from</span> <span class="nn">pygame</span> <span class="kn">import</span> <span class="n">Rect</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1">#Portrait window setup
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">650</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Hydraulic Pressure"</span><span class="p">)</span>

<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">"Arial"</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">BLUE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">GRAY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">DARK</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">WHITE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">OUTLINE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">HANDLE_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">ORANGE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># New color for dragging
</span>
<span class="c1">#SI Units Setup
# Areas in m^2, 
# Pressure in Pa (Pascals), 
# Force in N (Newtons)
</span><span class="n">A_small</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="c1"># 0.01 m^2 = 100 cm^2(small piston)
</span><span class="n">A_big</span> <span class="o">=</span> <span class="mf">0.08</span>          <span class="c1"># 0.08 m^2 = 800 cm^2 (big piston)
</span><span class="n">fluid_density</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># kg/m³ (water density)
</span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>              <span class="c1"># m/s² (gravity)
</span>
<span class="c1">#Geometry
</span><span class="n">left_x</span><span class="p">,</span> <span class="n">right_x</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">350</span>
<span class="n">pipe_top</span><span class="p">,</span> <span class="n">pipe_bottom</span> <span class="o">=</span> <span class="mi">440</span><span class="p">,</span> <span class="mi">450</span>
<span class="n">shaft_len</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">piston_height</span> <span class="o">=</span> <span class="mi">25</span>

<span class="c1"># Calculate widths based on areas to 
# maintain visual equality
</span><span class="n">base_width</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># base width for A_small 
</span><span class="n">piston_width</span> <span class="o">=</span> <span class="n">base_width</span>
<span class="c1"># cylinder is 10px wider than piston
</span><span class="n">cylinder_w</span> <span class="o">=</span> <span class="n">base_width</span> <span class="o">+</span> <span class="mi">10</span>  

<span class="c1"># Calculate big piston width to be 
# visually proportional to area
</span><span class="n">big_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">base_width</span> <span class="o">*</span> <span class="p">(</span><span class="n">A_big</span> <span class="o">/</span> <span class="n">A_small</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>  
<span class="n">big_h</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">piston_y</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">dragging</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">area_drag</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">offset_y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">410</span>

<span class="c1"># Calculate initial total blue fluid area 
# (all three regions)
</span><span class="k">def</span> <span class="nf">calculate_fluid_area</span><span class="p">(</span><span class="n">left_y</span><span class="p">,</span> <span class="n">right_y</span><span class="p">,</span> <span class="n">big_width</span><span class="p">):</span>
    <span class="s">"""Calculate total blue fluid area including
    all three regions"""</span>
    <span class="c1"># 1. Left cylinder blue area 
</span>    <span class="c1"># (from piston to pipe bottom)
</span>    <span class="n">left_area</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">*</span> <span class="p">(</span><span class="n">pipe_bottom</span> <span class="o">-</span> <span class="n">left_y</span><span class="p">)</span>
    
    <span class="c1"># 2. Pipe region blue area 
</span>    <span class="c1"># (horizontal U-shaped part)
</span>    <span class="n">pipe_area</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">*</span> <span class="p">(</span><span class="n">pipe_bottom</span> <span class="o">-</span> <span class="n">pipe_top</span><span class="p">)</span>
    
    <span class="c1"># 3. Right cylinder blue area 
</span>    <span class="c1"># (from piston to pipe bottom)
</span>    <span class="n">right_area</span> <span class="o">=</span> <span class="n">big_width</span> <span class="o">*</span> \
        <span class="p">(</span><span class="n">pipe_bottom</span> <span class="o">-</span> <span class="p">(</span><span class="n">right_y</span> <span class="o">+</span> <span class="n">big_h</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">left_area</span> <span class="o">+</span> <span class="n">pipe_area</span> <span class="o">+</span> <span class="n">right_area</span>
<span class="k">def</span> <span class="nf">input_pressure</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="s">"""Pressure applied by left piston in Pascals"""</span>
    <span class="c1"># Convert pixels to meters (100px = 1m)
</span>    <span class="n">depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">depth</span> <span class="o">*</span> <span class="n">fluid_density</span> <span class="o">*</span> <span class="n">g</span>  <span class="c1"># Pressure
</span><span class="k">def</span> <span class="nf">calculate_right_piston_position</span><span class="p">(</span><span class="n">left_y</span><span class="p">,</span> <span class="n">big_width</span><span class="p">):</span>
    <span class="s">"""Calculate right piston position to maintain 
    constant total fluid area"""</span>
    <span class="c1"># Current left and pipe areas 
</span>    <span class="c1"># (these change with left piston movement)
</span>    <span class="n">current_left_area</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">*</span> <span class="p">(</span><span class="n">pipe_bottom</span> <span class="o">-</span> <span class="n">left_y</span><span class="p">)</span>
    <span class="n">current_pipe_area</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">*</span> <span class="p">(</span><span class="n">pipe_bottom</span> <span class="o">-</span> <span class="n">pipe_top</span><span class="p">)</span>  
    
    <span class="c1"># Calculate required right area to maintain 
</span>    <span class="c1"># constant total
</span>    <span class="n">required_right_area</span> <span class="o">=</span> <span class="n">initial_fluid_area</span> <span class="o">-</span> \
                          <span class="n">current_left_area</span> <span class="o">-</span> \
                          <span class="n">current_pipe_area</span>
    
    <span class="c1"># Calculate right piston position from required 
</span>    <span class="c1"># right area
</span>    <span class="k">if</span> <span class="n">big_width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">right_fluid_height</span> <span class="o">=</span> <span class="n">required_right_area</span> <span class="o">/</span> \
                            <span class="n">big_width</span>
        <span class="n">right_y</span> <span class="o">=</span> <span class="n">pipe_bottom</span> <span class="o">-</span> <span class="n">right_fluid_height</span> <span class="o">-</span>\
                            <span class="n">big_h</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">right_y</span> <span class="o">=</span> <span class="n">initial_right_y</span>
    
    <span class="c1"># Ensure the piston stays within bounds
</span>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">right_y</span><span class="p">))</span>

<span class="c1"># Initial fluid area calculation
</span><span class="n">initial_right_y</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">initial_fluid_area</span> <span class="o">=</span> <span class="n">calculate_fluid_area</span><span class="p">(</span>
                    <span class="n">piston_y</span><span class="p">,</span><span class="n">initial_right_y</span><span class="p">,</span> <span class="n">big_w</span><span class="p">)</span>
<span class="c1"># Main Loop
# visit www.pyshine.com for more details
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span> 
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="c1"># Left piston drag
</span>            <span class="k">if</span> <span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="n">piston_width</span><span class="o">//</span><span class="mi">2</span> <span class="o">&lt;</span> \
                <span class="n">e</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">left_x</span> <span class="o">+</span> <span class="n">piston_width</span><span class="o">//</span><span class="mi">2</span>
                <span class="ow">and</span> <span class="n">piston_y</span> <span class="o">-</span> <span class="n">piston_height</span><span class="o">//</span><span class="mi">2</span> <span class="o">&lt;</span> \
                <span class="n">e</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">piston_y</span> <span class="o">+</span> <span class="n">piston_height</span><span class="p">):</span>
                
                <span class="n">dragging</span><span class="p">,</span> <span class="n">offset_y</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> \
                <span class="n">e</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">piston_y</span>
            <span class="c1"># Right piston area handle drag
</span>            <span class="n">handle_rect</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">right_x</span> <span class="o">+</span> 
                          <span class="n">big_w</span><span class="o">//</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">handle_rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">pos</span><span class="p">):</span>
                <span class="n">area_drag</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
            <span class="n">dragging</span> <span class="o">=</span> <span class="n">area_drag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEMOTION</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dragging</span><span class="p">:</span>
                <span class="n">piston_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> 
                        <span class="nb">min</span><span class="p">(</span><span class="n">y_max</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">offset_y</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">area_drag</span><span class="p">:</span>
                <span class="c1"># Change big piston area and 
</span>                <span class="c1"># update width accordingly
</span>                <span class="n">new_big_w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> 
                    <span class="nb">min</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">right_x</span><span class="o">+</span><span class="n">big_w</span><span class="o">//</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">A_big</span> <span class="o">=</span> <span class="n">A_small</span> <span class="o">*</span> \
                    <span class="p">(</span><span class="n">new_big_w</span> <span class="o">/</span> <span class="n">base_width</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  
                <span class="n">big_w</span> <span class="o">=</span> <span class="n">new_big_w</span>

    <span class="c1">#Physics
</span>    <span class="n">P_in</span> <span class="o">=</span> <span class="n">input_pressure</span><span class="p">(</span><span class="n">piston_y</span><span class="p">)</span>  <span class="c1"># Pressure Pascals
</span>    <span class="n">P_out</span> <span class="o">=</span> <span class="n">P_in</span>  <span class="c1"># Same pressure (Pascal's principle)
</span>    <span class="n">F_in</span> <span class="o">=</span> <span class="n">P_in</span> <span class="o">*</span> <span class="n">A_small</span>  <span class="c1"># Force in Newtons
</span>    <span class="n">F_out</span> <span class="o">=</span> <span class="n">P_out</span> <span class="o">*</span> <span class="n">A_big</span>  <span class="c1"># Force in Newtons
</span>    
    <span class="c1"># Calculate mechanical advantage safely
</span>    <span class="n">mechanical_advantage</span> <span class="o">=</span> <span class="n">F_out</span> <span class="o">/</span> <span class="n">F_in</span> <span class="k">if</span> \
                            <span class="n">F_in</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    
    <span class="c1"># Calculate right piston position to maintain 
</span>    <span class="c1"># constant total fluid area
</span>    <span class="n">right_y</span> <span class="o">=</span> <span class="n">calculate_right_piston_position</span><span class="p">(</span>
                            <span class="n">piston_y</span><span class="p">,</span> <span class="n">big_w</span><span class="p">)</span>
    
    <span class="c1"># Calculate current total fluid area for display
</span>    <span class="n">current_fluid_area</span> <span class="o">=</span> <span class="n">calculate_fluid_area</span><span class="p">(</span>
                            <span class="n">piston_y</span><span class="p">,</span> <span class="n">right_y</span><span class="p">,</span> <span class="n">big_w</span><span class="p">)</span>

    <span class="c1">#Drawing
</span>    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">DARK</span><span class="p">)</span>

    <span class="c1"># U-shaped pipe - ALL THREE BLUE REGIONS:
</span>    <span class="c1"># 1. Horizontal pipe region (constant)
</span>    <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">BLUE</span><span class="p">,</span> <span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> 
                   <span class="n">pipe_top</span><span class="p">,</span> 
                   <span class="n">right_x</span> <span class="o">-</span> <span class="n">left_x</span> <span class="o">+</span> <span class="mi">40</span><span class="p">,</span> 
                   <span class="n">pipe_bottom</span> <span class="o">-</span> <span class="n">pipe_top</span><span class="p">))</span>
    <span class="c1"># 2. Left cylinder blue region (changes with piston)
</span>    <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">BLUE</span><span class="p">,</span> <span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> 
                   <span class="n">piston_y</span><span class="p">,</span> 
                   <span class="mi">40</span><span class="p">,</span> 
                   <span class="n">pipe_bottom</span> <span class="o">-</span> <span class="n">piston_y</span><span class="p">))</span>
    <span class="c1"># 3. Right cylinder blue region (changes with piston)
</span>    <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">BLUE</span><span class="p">,</span> <span class="p">(</span><span class="n">right_x</span> <span class="o">-</span> <span class="n">big_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> 
                   <span class="n">right_y</span> <span class="o">+</span> <span class="n">big_h</span><span class="p">,</span> 
                   <span class="n">big_w</span><span class="p">,</span> 
                   <span class="n">pipe_bottom</span> <span class="o">-</span> <span class="p">(</span><span class="n">right_y</span> <span class="o">+</span> <span class="n">big_h</span><span class="p">)))</span>

    <span class="c1"># Left cylinder outline
</span>    <span class="n">cyl_rect</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="n">cylinder_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> 
                           <span class="n">y_min</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> 
                           <span class="n">cylinder_w</span><span class="p">,</span> 
                           <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span> <span class="o">+</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">OUTLINE</span><span class="p">,</span> <span class="n">cyl_rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Left piston shaft + T-head - CHANGE COLOR 
</span>    <span class="k">if</span> <span class="n">dragging</span><span class="p">:</span>
        <span class="c1"># Use ORANGE when dragging
</span>        <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">ORANGE</span><span class="p">,</span> 
             <span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> 
              <span class="n">piston_y</span> <span class="o">-</span> <span class="n">shaft_len</span><span class="p">,</span> 
              <span class="mi">10</span><span class="p">,</span> 
              <span class="n">shaft_len</span><span class="p">))</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="n">piston_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> 
                    <span class="n">piston_y</span><span class="p">,</span> 
                    <span class="n">piston_width</span><span class="p">,</span> 
                    <span class="n">piston_height</span><span class="p">)</span>
        <span class="n">top_bar</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="n">piston_width</span><span class="p">,</span> 
                       <span class="n">piston_y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> 
                       <span class="n">piston_width</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> 
                       <span class="mi">10</span><span class="p">)</span>
        <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">ORANGE</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>
        <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">ORANGE</span><span class="p">,</span> <span class="n">top_bar</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use GRAY when not dragging
</span>        <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">GRAY</span><span class="p">,</span> 
                <span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span>
                <span class="n">piston_y</span> <span class="o">-</span> <span class="n">shaft_len</span><span class="p">,</span> 
                <span class="mi">10</span><span class="p">,</span> 
                <span class="n">shaft_len</span><span class="p">))</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="n">piston_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> 
                           <span class="n">piston_y</span><span class="p">,</span> 
                           <span class="n">piston_width</span><span class="p">,</span> 
                           <span class="n">piston_height</span><span class="p">)</span>
        <span class="n">top_bar</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="n">piston_width</span><span class="p">,</span> 
                              <span class="n">piston_y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> 
                              <span class="n">piston_width</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> 
                              <span class="mi">10</span><span class="p">)</span>
        <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">GRAY</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>
        <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">GRAY</span><span class="p">,</span> <span class="n">top_bar</span><span class="p">)</span>

    <span class="c1"># Right piston
</span>    <span class="n">right_rect</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">right_x</span> <span class="o">-</span> <span class="n">big_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> 
                      <span class="n">right_y</span><span class="p">,</span> 
                      <span class="n">big_w</span><span class="p">,</span> 
                      <span class="n">big_h</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">GRAY</span><span class="p">,</span> <span class="n">right_rect</span><span class="p">)</span>
    <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">OUTLINE</span><span class="p">,</span> <span class="n">right_rect</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Handle to drag width/area - 
</span>    <span class="c1"># CHANGE COLOR WHEN DRAGGING
</span>    <span class="n">handle_rect</span> <span class="o">=</span> <span class="n">Rect</span><span class="p">(</span><span class="n">right_x</span> <span class="o">+</span> <span class="n">big_w</span><span class="o">//</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> 
                       <span class="mi">350</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">area_drag</span><span class="p">:</span>
        <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">ORANGE</span><span class="p">,</span> <span class="n">handle_rect</span><span class="p">)</span>  <span class="c1"># Orange dragging
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">HANDLE_COLOR</span><span class="p">,</span> <span class="n">handle_rect</span><span class="p">)</span>  <span class="c1"># Normal color
</span>
    <span class="c1"># Pipe outline
</span>    <span class="n">lines</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="n">pipe_top</span><span class="p">),</span>
        <span class="p">(</span><span class="n">left_x</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="n">pipe_bottom</span><span class="p">),</span>
        <span class="p">(</span><span class="n">right_x</span> <span class="o">+</span> <span class="n">big_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">pipe_bottom</span><span class="p">),</span>
        <span class="p">(</span><span class="n">right_x</span> <span class="o">+</span> <span class="n">big_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">pipe_top</span><span class="p">)</span>
    <span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Pascal's Law formula and explanation added to the info panel
</span>    <span class="n">info_lines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"Pascal's Law:"</span><span class="p">,</span>
        <span class="s">"Pressure applied to confined fluid is transmitted equally"</span><span class="p">,</span>
        <span class="s">"Formula: P = F / A (Pressure = Force divided by Area)"</span><span class="p">,</span>
        <span class="s">""</span><span class="p">,</span>
        <span class="sa">f</span><span class="s">"Input Force: </span><span class="si">{</span><span class="n">F_in</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> N | Output Force: </span><span class="si">{</span><span class="n">F_out</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> N"</span><span class="p">,</span>
        <span class="sa">f</span><span class="s">"Input Area: </span><span class="si">{</span><span class="n">A_small</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> m² | Output Area: </span><span class="si">{</span><span class="n">A_big</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> m²"</span><span class="p">,</span>
        <span class="s">"From Pascal's law: F_in / A_small = F_out/A_big"</span><span class="p">,</span>
        <span class="sa">f</span><span class="s">"Input Pressure: </span><span class="si">{</span><span class="n">F_in</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> N / </span><span class="si">{</span><span class="n">A_small</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> m² = </span><span class="si">{</span><span class="n">P_in</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> Pa"</span><span class="p">,</span>
        <span class="sa">f</span><span class="s">"Output Pressure: </span><span class="si">{</span><span class="n">F_out</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> N / </span><span class="si">{</span><span class="n">A_big</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> m² = </span><span class="si">{</span><span class="n">P_out</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s"> Pa"</span>
            <span class="p">]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">info_lines</span><span class="p">):</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">),</span> 
               <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">22</span><span class="p">))</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="live-information-panel">Live Information Panel</h2>

<p>The top panel displays:</p>

<ul>
  <li>Pascal’s Law explanation</li>
  <li>Input &amp; output forces</li>
  <li>Input &amp; output areas</li>
  <li>Pressure equality proof</li>
</ul>

<p>Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input Pressure: 981 Pa
Output Pressure: 981 Pa
</code></pre></div></div>

<hr />

<h2 id="educational-use-cases">Educational Use Cases</h2>

<p>This simulation is excellent for:</p>

<ul>
  <li>Physics classrooms</li>
  <li>STEM demonstrations</li>
  <li>Engineering intuition</li>
  <li>Interactive learning projects</li>
  <li>Educational games</li>
</ul>

<hr />

<h2 id="real-world-applications-of-pascals-law">Real-World Applications of Pascal’s Law</h2>

<ul>
  <li>Hydraulic car jacks</li>
  <li>Excavators</li>
  <li>Aircraft brakes</li>
  <li>Industrial presses</li>
  <li>Power steering systems</li>
</ul>

<hr />

<h2 id="common-questions-faq">Common Questions (FAQ)</h2>

<h3 id="why-doesnt-force-stay-the-same">Why doesn’t force stay the same?</h3>
<p>Because <strong>area changes</strong>. Pressure stays constant, not force.</p>

<hr />

<h3 id="why-is-the-output-piston-larger">Why is the output piston larger?</h3>
<p>To demonstrate <strong>force multiplication</strong>.</p>

<hr />

<h3 id="why-is-gravity-included">Why is gravity included?</h3>
<p>It converts piston depth into <strong>real pressure values</strong>.</p>

<hr />

<h3 id="is-this-physically-accurate">Is this physically accurate?</h3>
<p>Yes for <strong>ideal fluids</strong> (incompressible, no losses).</p>

<hr />

<h2 id="possible-extensions">Possible Extensions</h2>

<ul>
  <li>Add pressure gauges</li>
  <li>Animate fluid particles</li>
  <li>Add oil vs water density</li>
  <li>Add real hydraulic ratios</li>
  <li>Export data graphs</li>
</ul>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>This Pygame project transforms Pascal’s Law from a formula into a <strong>hands-on visual experience</strong>. By interacting with pistons and areas, users gain an intuitive understanding of pressure, force, and mechanical advantage.</p>

<p>If you can <em>see</em> physics, you can <em>understand</em> it.</p>

<hr />

<p>Happy learning!</p>]]></content><author><name>PyShine Team</name></author><summary type="html"><![CDATA[A detailed beginner-to-intermediate tutorial explaining Pascal’s Law using an interactive Pygame hydraulic press simulation.]]></summary></entry><entry><title type="html">Interactive 3D PSO with a Draggable Target in Python</title><link href="https://www.pyshine.com/How-to-make-3D-PSO-simulation/" rel="alternate" type="text/html" title="Interactive 3D PSO with a Draggable Target in Python" /><published>2025-12-23T00:00:00+00:00</published><updated>2025-12-23T00:00:00+00:00</updated><id>https://www.pyshine.com/How-to-make-3D-PSO-simulation</id><content type="html" xml:base="https://www.pyshine.com/How-to-make-3D-PSO-simulation/"><![CDATA[<h1 id="interactive-3d-pso-with-a-draggable-target-in-python">Interactive 3D PSO with a Draggable Target in Python</h1>

<p>This tutorial explains <strong>two Python scripts working together</strong>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Draggable.py</code> → an interactive 2D window where you drag a target and adjust its <strong>Z value</strong></li>
  <li><code class="language-plaintext highlighter-rouge">main.py</code> → a <strong>3D Particle Swarm Optimization (PSO)</strong> simulation that continuously chases that target</li>
</ul>

<p>This is a powerful example of <strong>interactive optimization</strong>, <strong>real-time visualization</strong>, and <strong>process communication</strong> in Python.</p>

<hr />

<h2 id="big-picture-how-everything-works">Big Picture: How Everything Works</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mouse / Keyboard
      ↓
Draggable.py  ──► target.csv  ──► main.py (PSO)
      ↑                                   ↓
   Visual UI                    3D Particles Follow Target
</code></pre></div></div>

<ul>
  <li>You drag a point in 2D (X, Y)</li>
  <li>Press <strong>U / D</strong> to move Z up or down</li>
  <li>The target position is written to <code class="language-plaintext highlighter-rouge">target.csv</code></li>
  <li>The PSO loop continuously reads that file</li>
  <li>Particles move toward the live target</li>
</ul>

<p>This pattern is extremely useful for <strong>human-in-the-loop optimization</strong>.</p>

<hr />

<h2 id="file-1-draggablepy-interactive-target-controller">File 1: Draggable.py (Interactive Target Controller)</h2>

<h3 id="purpose">Purpose</h3>
<ul>
  <li>Lets the user <strong>drag a target with the mouse</strong></li>
  <li>Shows live <strong>X, Y, Z values</strong> on screen</li>
  <li>Writes the target position to a CSV file</li>
</ul>

<h3 id="key-concepts-used">Key Concepts Used</h3>
<ul>
  <li>Matplotlib mouse events</li>
  <li>Keyboard events</li>
  <li>Text overlays</li>
  <li>Safe exit handling</li>
</ul>

<h3 id="important-sections-explained">Important Sections Explained</h3>

<h4 id="1-clean-exit-handling">1. Clean Exit Handling</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="o">*</span><span class="n">_</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="s">"all"</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>
<p>This ensures the window closes cleanly when you press <strong>Ctrl+C</strong> or close the app.</p>

<hr />

<h4 id="2-interactive-target">2. Interactive Target</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</code></pre></div></div>
<p>This represents <strong>X, Y, Z</strong>. Only X &amp; Y are draggable; Z is controlled by keys.</p>

<hr />

<h4 id="3-mouse-drag-logic">3. Mouse Drag Logic</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">on_motion</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pressed</span> <span class="ow">or</span> <span class="n">event</span><span class="p">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="n">ax</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">ydata</span>
    <span class="n">update</span><span class="p">()</span>
</code></pre></div></div>
<p>This allows smooth dragging inside the plot area.</p>

<hr />

<h4 id="4-keyboard-control-for-z-axis">4. Keyboard Control for Z Axis</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">on_key</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="s">'u'</span><span class="p">:</span>
        <span class="n">target</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10</span>
    <span class="k">elif</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="s">'d'</span><span class="p">:</span>
        <span class="n">target</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">10</span>
    <span class="n">update</span><span class="p">()</span>
</code></pre></div></div>
<p>This adds <strong>3D control using a 2D UI</strong>.</p>

<hr />

<h4 id="5-live-text-overlay">5. Live Text Overlay</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">txt</span><span class="p">.</span><span class="n">set_text</span><span class="p">(</span>
    <span class="sa">f</span><span class="s">"x: </span><span class="si">{</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
    <span class="sa">f</span><span class="s">"y: </span><span class="si">{</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
    <span class="sa">f</span><span class="s">"z: </span><span class="si">{</span><span class="n">target</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">"</span>
<span class="p">)</span>
</code></pre></div></div>
<p>Users always see exact coordinates — extremely helpful for debugging and demos.</p>

<hr />

<h2 id="file-2-mainpy-interactive-pso-engine">File 2: main.py (Interactive PSO Engine)</h2>

<h3 id="purpose-1">Purpose</h3>
<ul>
  <li>Runs a <strong>3D Particle Swarm Optimization</strong> loop</li>
  <li>Continuously reads the target from <code class="language-plaintext highlighter-rouge">target.csv</code></li>
  <li>Visualizes particles chasing a moving target</li>
</ul>

<hr />

<h2 id="what-is-pso-quick-theory">What is PSO (Quick Theory)</h2>

<p>Particle Swarm Optimization is inspired by <strong>bird flocks and fish schools</strong>.</p>

<p>Each particle:</p>
<ul>
  <li>Has a position</li>
  <li>Has a velocity</li>
  <li>Moves toward a target using momentum + attraction</li>
</ul>

<p>Formula intuition:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>new_velocity = inertia + attraction_to_target
new_position = old_position + new_velocity
</code></pre></div></div>

<hr />

<h2 id="particle-class-explained">Particle Class Explained</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Particle</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span>
</code></pre></div></div>
<p>Each particle computes <strong>distance to the target</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">self</span><span class="p">.</span><span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="bp">self</span><span class="p">.</span><span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">random</span><span class="p">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">w</code> → inertia (smooth motion)</li>
  <li><code class="language-plaintext highlighter-rouge">c</code> → attraction strength</li>
</ul>

<hr />

<h2 id="why-csv-is-used-and-why-its-smart">Why CSV Is Used (And Why It’s Smart)</h2>

<p>Using <code class="language-plaintext highlighter-rouge">target.csv</code> is:</p>

<p>✔ Simple
✔ Debuggable
✔ Language-agnostic
✔ Easy to visualize</p>

<p>This technique is common in:</p>
<ul>
  <li>Robotics</li>
  <li>Simulation systems</li>
  <li>Multi-process AI experiments</li>
</ul>

<hr />

<h2 id="why-this-project-is-important">Why This Project Is Important</h2>

<p>This is <strong>not just a demo</strong> — it teaches:</p>

<ul>
  <li>Event-driven programming</li>
  <li>Real-time visualization</li>
  <li>Optimization algorithms</li>
  <li>Inter-process communication</li>
  <li>Human-in-the-loop control</li>
</ul>

<p>Many beginners never see these ideas combined.</p>

<hr />

<h2 id="practical-use-cases">Practical Use Cases</h2>

<ol>
  <li><strong>AI parameter tuning with human guidance</strong></li>
  <li><strong>Robotics target following simulations</strong></li>
  <li><strong>Game AI movement systems</strong></li>
  <li><strong>Research demos &amp; visual explanations</strong></li>
  <li><strong>Teaching optimization interactively</strong></li>
</ol>

<hr />

<h2 id="complete-code">Complete Code</h2>

<h3 id="draggablepy">Draggable.py</h3>

<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Welcome to PyShine
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">signal</span><span class="p">,</span> <span class="n">sys</span>

<span class="n">TARGET_FILE</span> <span class="o">=</span> <span class="s">"target.csv"</span>

<span class="c1">#  CLEAN EXIT 
</span><span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="o">*</span><span class="n">_</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="s">"all"</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">cleanup</span><span class="p">)</span>
<span class="n">signal</span><span class="p">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">cleanup</span><span class="p">)</span>

<span class="c1">#  FIGURE 
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="p">.</span><span class="n">patch</span><span class="p">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">"white"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">"white"</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"Drag Target | U / D = Z"</span><span class="p">)</span>

<span class="c1">#  TARGET 
</span><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

<span class="n">pt</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="p">[</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
    <span class="s">'ko'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="c1"># TEXT OVERLAY (TOP-LEFT, AXES COORDS)
</span><span class="n">txt</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span>
    <span class="s">""</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s">"top"</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s">"white"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">"none"</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">#  FILE WRITE 
</span><span class="k">def</span> <span class="nf">write_target</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TARGET_FILE</span><span class="p">,</span> <span class="s">"w"</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">""</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">csv</span><span class="p">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">).</span><span class="n">writerow</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

<span class="c1">#  UPDATE 
</span><span class="k">def</span> <span class="nf">update</span><span class="p">():</span>
    <span class="n">pt</span><span class="p">.</span><span class="n">set_data</span><span class="p">([</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>   <span class="c1"># sequence-safe
</span>    <span class="n">txt</span><span class="p">.</span><span class="n">set_text</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"x: </span><span class="si">{</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
        <span class="sa">f</span><span class="s">"y: </span><span class="si">{</span><span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span>
        <span class="sa">f</span><span class="s">"z: </span><span class="si">{</span><span class="n">target</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">"</span>
    <span class="p">)</span>
    <span class="n">write_target</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">draw_idle</span><span class="p">()</span>

<span class="c1"># initial write + text
</span><span class="n">update</span><span class="p">()</span>

<span class="c1">#  EVENTS 
</span><span class="n">pressed</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">on_press</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">pressed</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="n">ax</span><span class="p">:</span>
        <span class="n">pressed</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">on_release</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">pressed</span>
    <span class="n">pressed</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">on_motion</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pressed</span> <span class="ow">or</span> <span class="n">event</span><span class="p">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="n">ax</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">xdata</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">event</span><span class="p">.</span><span class="n">ydata</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">ydata</span>
    <span class="n">update</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">on_key</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="s">'u'</span><span class="p">:</span>
        <span class="n">target</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10</span>
    <span class="k">elif</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="s">'d'</span><span class="p">:</span>
        <span class="n">target</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">10</span>
    <span class="n">update</span><span class="p">()</span>

<span class="c1">#  CONNECT 
</span><span class="n">fig</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">"button_press_event"</span><span class="p">,</span> <span class="n">on_press</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">"button_release_event"</span><span class="p">,</span> <span class="n">on_release</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">"motion_notify_event"</span><span class="p">,</span> <span class="n">on_motion</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">"key_press_event"</span><span class="p">,</span> <span class="n">on_key</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

</code></pre></div></div>

<h3 id="mainpy">main.py</h3>

<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Welcome to PyShine
</span><span class="kn">import</span> <span class="nn">random</span><span class="p">,</span> <span class="n">csv</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">_thread</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1">#  SAFETY 
</span><span class="n">running</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">running</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Figure closed — breaking loop"</span><span class="p">)</span>
    <span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"target.csv"</span><span class="p">,</span><span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"0,0,0"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">start_drag</span><span class="p">():</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">"python Draggable.py"</span><span class="p">)</span>

<span class="n">_thread</span><span class="p">.</span><span class="n">start_new_thread</span><span class="p">(</span><span class="n">start_drag</span><span class="p">,</span> <span class="p">())</span>

<span class="c1">#  UTILS 
</span><span class="k">def</span> <span class="nf">getXYZ</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv</span><span class="p">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

<span class="k">def</span> <span class="nf">fitness</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
    <span class="n">tx</span><span class="p">,</span><span class="n">ty</span><span class="p">,</span><span class="n">tz</span> <span class="o">=</span> <span class="n">getXYZ</span><span class="p">(</span><span class="s">"target.csv"</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tx</span><span class="o">-</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">ty</span><span class="o">-</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">tz</span><span class="o">-</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

<span class="c1">#  PARTICLE 
</span><span class="k">class</span> <span class="nc">Particle</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">pid</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">initial</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">vel</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">initial</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">id</span> <span class="o">=</span> <span class="n">pid</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">'inf'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Particle </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="nb">id</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s"> ERROR -----&gt; </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">error</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">error</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">bounds</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mf">0.7</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">1.8</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">)):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="bp">self</span><span class="p">.</span><span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">random</span><span class="p">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">.</span><span class="n">vel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="nb">min</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

<span class="c1">#  PSO 
</span><span class="k">class</span> <span class="nc">Interactive_PSO</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s">"hsv"</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">running</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">num_particles</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_particles</span><span class="p">)]</span>

        <span class="n">swarm</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Particle</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_particles</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">plt</span><span class="p">.</span><span class="n">ion</span><span class="p">()</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s">'3d'</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">"close_event"</span><span class="p">,</span> <span class="n">on_close</span><span class="p">)</span>

        <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">running</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>

            <span class="n">target</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">getXYZ</span><span class="p">(</span><span class="s">"target.csv"</span><span class="p">))</span>

            <span class="n">global_best_error</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">'inf'</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n</span><span class="s">=== ITERATION </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s"> ==="</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"TARGET ---&gt; </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">swarm</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">evaluate</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="n">global_best_error</span><span class="p">:</span>
                    <span class="n">global_best_error</span> <span class="o">=</span> <span class="n">err</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">swarm</span><span class="p">:</span>
                <span class="n">p</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="n">color</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">target</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'k'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="s">"PyShine Interactive PSO (3D) | Particles:{} | Error:{:.2f}"</span>
                <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">num_particles</span><span class="p">,</span> <span class="n">global_best_error</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">plt</span><span class="p">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Results"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Final Target:"</span><span class="p">,</span> <span class="n">getXYZ</span><span class="p">(</span><span class="s">"target.csv"</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Final Best Error:"</span><span class="p">,</span> <span class="n">global_best_error</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="s">'all'</span><span class="p">)</span>

<span class="c1">#  RUN 
</span><span class="n">Interactive_PSO</span><span class="p">(</span>
    <span class="n">initial</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="o">-</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">)]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">num_particles</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>     <span class="c1"># any number
</span>    <span class="n">colormap</span><span class="o">=</span><span class="s">"hsv"</span>
<span class="p">)</span>

</code></pre></div></div>

<h2 id="common-questions-faq">Common Questions (FAQ)</h2>

<h3 id="q-why-not-use-sockets-or-shared-memory">Q: Why not use sockets or shared memory?</h3>
<p>CSV is simpler, safer, and perfect for teaching concepts first.</p>

<hr />

<h3 id="q-can-this-be-extended-to-real-ai-models">Q: Can this be extended to real AI models?</h3>
<p>Yes. Replace <code class="language-plaintext highlighter-rouge">fitness()</code> with a real evaluation function.</p>

<hr />

<h3 id="q-can-i-control-velocity-or-pso-parameters-live">Q: Can I control velocity or PSO parameters live?</h3>
<p>Absolutely — add keyboard bindings just like Z control.</p>

<hr />

<h3 id="q-why-is-this-powerful">Q: Why is this powerful?</h3>
<p>Because <strong>you are steering an optimizer in real time</strong>.</p>

<hr />

<h2 id="final-thoughts">Final Thoughts</h2>

<p>This project beautifully combines:</p>

<ul>
  <li>Visualization</li>
  <li>Optimization</li>
  <li>Interaction</li>
  <li>Clean Python design</li>
</ul>

<p>It’s an excellent <strong>advanced-beginner to intermediate</strong> Python project and a great foundation for AI demos.</p>

<hr />

<p>Happy coding!</p>

<p>Built with ❤️ by PyShine</p>]]></content><author><name>PyShine Team</name></author><summary type="html"><![CDATA[A beginner-friendly tutorial explaining how to build an interactive 3D Particle Swarm Optimization (PSO) demo using Matplotlib, keyboard & mouse events, and inter-process communication via CSV.]]></summary></entry><entry><title type="html">Automatically Free a Busy Port in Python Using psutil</title><link href="https://www.pyshine.com/How-to-fix-Address-already-in-use-problem/" rel="alternate" type="text/html" title="Automatically Free a Busy Port in Python Using psutil" /><published>2025-12-13T00:00:00+00:00</published><updated>2025-12-13T00:00:00+00:00</updated><id>https://www.pyshine.com/How-to-fix-Address-already-in-use-problem</id><content type="html" xml:base="https://www.pyshine.com/How-to-fix-Address-already-in-use-problem/"><![CDATA[<h1 id="automatically-free-a-busy-port-in-python-using-psutil">Automatically Free a Busy Port in Python Using psutil</h1>

<p>If you’ve ever tried to start a Python server and received an error like <strong>“Address already in use”</strong>, this tutorial is for you. We’ll learn how to <strong>detect which process is using a port and safely terminate it</strong> using Python and the <code class="language-plaintext highlighter-rouge">psutil</code> library.</p>

<p>This guide is written for <strong>Python beginners</strong>, with clear explanations, examples, and real-world use cases.</p>

<hr />

<h2 id="what-problem-does-this-solve">What Problem Does This Solve?</h2>

<p>When running a server (TCP, HTTP, Flask, FastAPI, etc.), the program needs exclusive access to a port (like <code class="language-plaintext highlighter-rouge">12345</code> or <code class="language-plaintext highlighter-rouge">8000</code>).</p>

<p>Sometimes:</p>
<ul>
  <li>A previous server didn’t shut down correctly</li>
  <li>Another application is already using the port</li>
  <li>A crashed process is still running in the background</li>
</ul>

<p>This causes errors such as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OSError: [Errno 48] Address already in use
</code></pre></div></div>
<p>or in Windows operating system</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OSError: [WinError 10048] Only one usage of each socket address (protocol/network address/port) is normally permitted
</code></pre></div></div>

<p>This script <strong>automatically finds and kills the process using the port</strong>, then starts the server cleanly.</p>

<hr />

<h2 id="installing-required-library">Installing Required Library</h2>

<p>We use the <code class="language-plaintext highlighter-rouge">psutil</code> library to inspect running processes.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>psutil
</code></pre></div></div>

<hr />

<h2 id="full-working-code">Full Working Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pip install psutil
</span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">psutil</span>


<span class="k">def</span> <span class="nf">scan_and_terminate</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
    <span class="s">"""
    Check if a process is using the given port.
    If yes, terminate that process.
    Returns True if a process was killed.
    """</span>
    <span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="n">proc</span><span class="p">.</span><span class="n">connections</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">"inet"</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">.</span><span class="n">laddr</span><span class="p">.</span><span class="n">port</span> <span class="o">==</span> <span class="n">port</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">proc</span><span class="p">.</span><span class="n">info</span><span class="p">[</span><span class="s">"name"</span><span class="p">],</span> <span class="n">proc</span><span class="p">.</span><span class="n">pid</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[INFO] Port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s"> busy!"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[INFO] Terminating </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s"> (PID </span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
            <span class="n">proc</span><span class="p">.</span><span class="n">kill</span><span class="p">()</span>
            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>


<span class="k">def</span> <span class="nf">terminate_process_on_port</span><span class="p">(</span><span class="n">port</span><span class="p">):</span>
    <span class="s">"""
    Scan all running processes and terminate
    the one holding the given port.
    """</span>
    <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">psutil</span><span class="p">.</span><span class="n">process_iter</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s">"pid"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">scan_and_terminate</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
                <span class="k">return</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">psutil</span><span class="p">.</span><span class="n">AccessDenied</span><span class="p">,</span> <span class="n">psutil</span><span class="p">.</span><span class="n">NoSuchProcess</span><span class="p">):</span>
            <span class="k">pass</span>


<span class="k">def</span> <span class="nf">start_server</span><span class="p">():</span>
    <span class="s">"""
    Start a TCP server after freeing the port
    """</span>
    <span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">12345</span>

    <span class="c1"># Ensure port is free
</span>    <span class="n">terminate_process_on_port</span><span class="p">(</span><span class="n">PORT</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
    <span class="n">s</span><span class="p">.</span><span class="n">listen</span><span class="p">()</span>

    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[INFO] Server running on </span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">PORT</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">start_server</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="code-explanation-beginner-friendly">Code Explanation (Beginner Friendly)</h2>

<h3 id="1-scanning-processes-for-port-usage">1. Scanning Processes for Port Usage</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">proc</span><span class="p">.</span><span class="n">connections</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">"inet"</span><span class="p">)</span>
</code></pre></div></div>

<p>This checks all <strong>network connections</strong> of a process (TCP &amp; UDP).</p>

<p>We compare the local port:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">conn</span><span class="p">.</span><span class="n">laddr</span><span class="p">.</span><span class="n">port</span> <span class="o">==</span> <span class="n">port</span><span class="p">:</span>
</code></pre></div></div>

<p>If it matches, the process is using the port.</p>

<hr />

<h3 id="2-terminating-the-process">2. Terminating the Process</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">proc</span><span class="p">.</span><span class="n">kill</span><span class="p">()</span>
</code></pre></div></div>

<p>This forcefully stops the process holding the port.</p>

<p>We then pause briefly:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div></div>

<p>This gives the OS time to release the port.</p>

<hr />

<h3 id="3-iterating-over-all-running-processes">3. Iterating Over All Running Processes</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">psutil</span><span class="p">.</span><span class="n">process_iter</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s">"pid"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">])</span>
</code></pre></div></div>

<p>This safely loops over <strong>all running processes</strong> without crashing if access is denied.</p>

<hr />

<h3 id="4-starting-the-tcp-server">4. Starting the TCP Server</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
</code></pre></div></div>

<p>Once the port is free, the server starts successfully.</p>

<hr />

<h2 id="why-this-code-is-important">Why This Code Is Important</h2>

<ul>
  <li>Prevents <strong>“Address already in use”</strong> errors</li>
  <li>Automates cleanup during development</li>
  <li>Makes scripts <strong>self-healing</strong></li>
  <li>Saves time restarting servers manually</li>
</ul>

<hr />

<h2 id="real-world-use-cases">Real-World Use Cases</h2>

<h3 id="-development-servers">✅ Development Servers</h3>
<ul>
  <li>Flask / FastAPI</li>
  <li>Socket servers</li>
  <li>Local testing environments</li>
</ul>

<h3 id="-game-servers">✅ Game Servers</h3>
<ul>
  <li>Multiplayer socket-based games</li>
</ul>

<h3 id="-embedded--iot-systems">✅ Embedded &amp; IoT Systems</h3>
<ul>
  <li>Restarting services automatically</li>
</ul>

<h3 id="-cicd--automation">✅ CI/CD &amp; Automation</h3>
<ul>
  <li>Ensure ports are free before deployment</li>
</ul>

<hr />

<h2 id="safety-notes">Safety Notes</h2>

<ul>
  <li>This script <strong>kills processes forcefully</strong></li>
  <li>Use only in <strong>development environments</strong></li>
  <li>Avoid running as root unless necessary</li>
  <li>Never blindly kill ports on production machines</li>
</ul>

<hr />

<h2 id="common-questions-faq">Common Questions (FAQ)</h2>

<p><strong>Q: Will this work on macOS, Linux, and Windows?</strong><br />
Yes. <code class="language-plaintext highlighter-rouge">psutil</code> is cross-platform.</p>

<p><strong>Q: Can I terminate multiple processes on the same port?</strong><br />
Ports are exclusive—only one process can bind to a port at a time.</p>

<p><strong>Q: Can I make it safer?</strong><br />
Yes! You can prompt the user before killing the process.</p>

<hr />

<h2 id="beginner-exercise">Beginner Exercise</h2>

<p>Try modifying the script to:</p>
<ul>
  <li>Ask the user before terminating a process</li>
  <li>Log killed processes to a file</li>
  <li>Support multiple ports</li>
</ul>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>This script is a powerful example of how Python can interact with the operating system to solve real-world problems. Learning <code class="language-plaintext highlighter-rouge">psutil</code> opens the door to system monitoring, automation, and professional-grade tools.</p>

<p>Happy hacking!</p>]]></content><author><name>PyShine</name></author><category term="Python" /><category term="Networking" /><category term="python" /><category term="psutil" /><category term="sockets" /><category term="tcp" /><category term="dev-tools" /><summary type="html"><![CDATA[How to detect and safely terminate processes occupying a TCP port in Python using psutil. A beginner-friendly, real-world tutorial.]]></summary></entry><entry><title type="html">AnimeGANv3 ONNX GUI – Complete Beginner’s Guide</title><link href="https://www.pyshine.com/Tkinter-AnimeGanv3-ONNX-GUI/" rel="alternate" type="text/html" title="AnimeGANv3 ONNX GUI – Complete Beginner’s Guide" /><published>2025-11-27T00:00:00+00:00</published><updated>2025-11-27T00:00:00+00:00</updated><id>https://www.pyshine.com/Tkinter-AnimeGanv3-ONNX-GUI</id><content type="html" xml:base="https://www.pyshine.com/Tkinter-AnimeGanv3-ONNX-GUI/"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>AnimeGANv3 allows you to transform images into anime-style artwork using pre-trained ONNX models.In this tutorial, we will build a <strong>Tkinter GUI application</strong> that:</p>

<ul>
  <li>Automatically installs required Python packages</li>
  <li>Lets you select an image</li>
  <li>Converts it into anime style using ONNX models</li>
  <li>Allows you to view, save, or revert to the original image</li>
</ul>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/18NOZhaZpSU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<p>No prior experience with ONNX or GUI programming is needed.</p>

<hr />

<h2 id="understanding-the-requirements">Understanding the Requirements</h2>

<h3 id="required-packages">Required Packages:</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Pillow&gt;=10</code> – for image processing</li>
  <li><code class="language-plaintext highlighter-rouge">numpy</code> – numerical operations</li>
  <li><code class="language-plaintext highlighter-rouge">opencv-contrib-python</code> – image manipulation</li>
  <li><code class="language-plaintext highlighter-rouge">onnxruntime</code> – run ONNX models</li>
  <li><code class="language-plaintext highlighter-rouge">tkinter</code> – GUI (usually comes with Python)</li>
</ul>

<p>Our app will:</p>

<ul>
  <li>Ensure required packages are installed automatically</li>
  <li>Download AnimeGANv3 models if missing</li>
  <li>Resize images for GUI display</li>
  <li>Transform images to anime style</li>
  <li>Save results to your disk</li>
</ul>

<hr />

<h2 id="step-1-setting-up-the-environment">Step 1: Setting Up the Environment</h2>

<p>It is recommended to use Python &gt;=3.8 and &lt;=3.11. Open your terminal and install packages manually (optional, automatic installer included in code):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>Pillow&gt;<span class="o">=</span>10 numpy opencv-contrib-python onnxruntime
</code></pre></div></div>

<hr />

<h2 id="step-2-automatic-package-installer">Step 2: Automatic Package Installer</h2>

<p>Our code automatically installs missing packages:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">required_packages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"Pillow&gt;=10"</span><span class="p">,</span>
    <span class="s">"numpy"</span><span class="p">,</span>
    <span class="s">"opencv-contrib-python"</span><span class="p">,</span>
    <span class="s">"onnxruntime"</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">install_package</span><span class="p">(</span><span class="n">pkg</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[INFO] Installing </span><span class="si">{</span><span class="n">pkg</span><span class="si">}</span><span class="s"> ..."</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="p">.</span><span class="n">check_call</span><span class="p">([</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">,</span> <span class="s">"-m"</span><span class="p">,</span> <span class="s">"pip"</span><span class="p">,</span> <span class="s">"install"</span><span class="p">,</span> <span class="s">"--upgrade"</span><span class="p">,</span> <span class="n">pkg</span><span class="p">])</span>

<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">required_packages</span><span class="p">:</span>
    <span class="n">pkg_name</span> <span class="o">=</span> <span class="n">pkg</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'&gt;='</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">pkg_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
        <span class="n">install_package</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-3-loading-and-downloading-onnx-models">Step 3: Loading and Downloading ONNX Models</h2>

<p>AnimeGANv3 comes with two styles: <strong>Hayao</strong> and <strong>Shinkai</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">STYLE_MODELS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"Hayao"</span><span class="p">:</span> <span class="s">"AnimeGANv3_Hayao_36.onnx"</span><span class="p">,</span>
    <span class="s">"Shinkai"</span><span class="p">:</span> <span class="s">"AnimeGANv3_Shinkai_37.onnx"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">"https://github.com/TachibanaYoshino/AnimeGANv3/releases/download/v1.1.0/"</span>
<span class="n">MAX_DISPLAY_SIZE</span> <span class="o">=</span> <span class="mi">512</span>

<span class="k">def</span> <span class="nf">get_model_path</span><span class="p">(</span><span class="n">style_name</span><span class="p">):</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">STYLE_MODELS</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"models"</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ensure_model</span><span class="p">(</span><span class="n">style_name</span><span class="p">):</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">get_model_path</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">"models"</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">BASE_URL</span> <span class="o">+</span> <span class="n">STYLE_MODELS</span><span class="p">[</span><span class="n">style_name</span><span class="p">]</span>
        <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[INFO] Downloaded </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s"> model to </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_path</span>
</code></pre></div></div>

<hr />

<h2 id="step-4-onnxanime-wrapper-class">Step 4: ONNXAnime Wrapper Class</h2>

<p>This class handles image transformation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">onnxruntime</span> <span class="k">as</span> <span class="n">ort</span>

<span class="k">class</span> <span class="nc">ONNXAnime</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onnx_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">ort</span><span class="p">.</span><span class="n">InferenceSession</span><span class="p">(</span><span class="n">onnx_path</span><span class="p">)</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">get_inputs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">input_name</span> <span class="o">=</span> <span class="n">inp</span><span class="p">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">inp</span><span class="p">.</span><span class="n">shape</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_bgr_or_rgba</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img_bgr_or_rgba</span>
        <span class="k">if</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGRA2BGR</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
        <span class="n">target_h</span><span class="p">,</span> <span class="n">target_w</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">img_resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">target_w</span><span class="p">,</span> <span class="n">target_h</span><span class="p">))</span>
        <span class="n">img_resized</span> <span class="o">=</span> <span class="n">img_resized</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span><span class="o">/</span><span class="mf">127.5</span> <span class="o">-</span> <span class="mf">1.0</span>
        <span class="n">tensor</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img_resized</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">{</span><span class="bp">self</span><span class="p">.</span><span class="n">input_name</span><span class="p">:</span> <span class="n">tensor</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">out_img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">((</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="mf">127.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">out_img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_RGB2BGR</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-5-building-the-tkinter-gui">Step 5: Building the Tkinter GUI</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="n">tk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">filedialog</span><span class="p">,</span> <span class="n">messagebox</span><span class="p">,</span> <span class="n">ttk</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageTk</span>

<span class="k">class</span> <span class="nc">AnimeApp</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">master</span> <span class="o">=</span> <span class="n">master</span>
        <span class="n">master</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"PyShine Anime GUI"</span><span class="p">)</span>
        <span class="n">master</span><span class="p">.</span><span class="n">geometry</span><span class="p">(</span><span class="s">"450x700"</span><span class="p">)</span>

        <span class="n">tk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Select image → choose style → Convert"</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
        <span class="n">frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">tk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Select Image"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">load_image</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">"Hayao"</span><span class="p">)</span>
        <span class="n">ttk</span><span class="p">.</span><span class="n">OptionMenu</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="s">"Hayao"</span><span class="p">,</span> <span class="s">"Shinkai"</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="n">tk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Convert"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">convert</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="n">tk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Save"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">save</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>
        <span class="n">tk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Original"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">show_original</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">MAX_DISPLAY_SIZE</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">MAX_DISPLAY_SIZE</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s">"gray"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">input_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">output_img</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">orig_img_pil</span> <span class="o">=</span> <span class="bp">None</span>
</code></pre></div></div>

<hr />

<h2 id="step-6-loading-and-displaying-images">Step 6: Loading and Displaying Images</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">load_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="p">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">"Image files"</span><span class="p">,</span> <span class="s">"*.jpg *.jpeg *.png"</span><span class="p">)])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span> <span class="k">return</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">input_path</span> <span class="o">=</span> <span class="n">path</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="n">convert</span><span class="p">(</span><span class="s">"RGB"</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">orig_img_pil</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">display_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="n">MAX_DISPLAY_SIZE</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="n">img</span><span class="p">.</span><span class="n">height</span><span class="p">))</span>
    <span class="n">display_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">height</span><span class="o">*</span><span class="n">MAX_DISPLAY_SIZE</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="n">img</span><span class="p">.</span><span class="n">height</span><span class="p">))</span>
    <span class="n">img_display</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">resize</span><span class="p">((</span><span class="n">display_w</span><span class="p">,</span> <span class="n">display_h</span><span class="p">),</span> <span class="n">Image</span><span class="p">.</span><span class="n">Resampling</span><span class="p">.</span><span class="n">LANCZOS</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img_display</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">display_w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">display_h</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">create_image</span><span class="p">(</span><span class="n">display_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">display_h</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-7-converting-images">Step 7: Converting Images</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_path</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">ensure_model</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">input_path</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span>
    <span class="n">anime</span> <span class="o">=</span> <span class="n">ONNXAnime</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">anime</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">output_img</span> <span class="o">=</span> <span class="n">out</span>
    <span class="n">out_display</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">))</span>
    <span class="n">out_display</span> <span class="o">=</span> <span class="n">out_display</span><span class="p">.</span><span class="n">resize</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">winfo_width</span><span class="p">(),</span> <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">winfo_height</span><span class="p">()),</span> <span class="n">Image</span><span class="p">.</span><span class="n">Resampling</span><span class="p">.</span><span class="n">LANCZOS</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">out_display</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">create_image</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">winfo_width</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">winfo_height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-8-saving-and-showing-original-image">Step 8: Saving and Showing Original Image</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">output_img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="p">.</span><span class="n">asksaveasfilename</span><span class="p">(</span><span class="n">defaultextension</span><span class="o">=</span><span class="s">".png"</span><span class="p">,</span> <span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">"PNG"</span><span class="p">,</span><span class="s">"*.png"</span><span class="p">),(</span><span class="s">"JPEG"</span><span class="p">,</span><span class="s">"*.jpg"</span><span class="p">)])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">cv2</span><span class="p">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">output_img</span><span class="p">)</span>
    <span class="n">messagebox</span><span class="p">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s">"Saved"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Saved to </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show_original</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">orig_img_pil</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">img_display</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">orig_img_pil</span><span class="p">.</span><span class="n">resize</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">winfo_width</span><span class="p">(),</span> <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">winfo_height</span><span class="p">()),</span> <span class="n">Image</span><span class="p">.</span><span class="n">Resampling</span><span class="p">.</span><span class="n">LANCZOS</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img_display</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">create_image</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">winfo_width</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">winfo_height</span><span class="p">()</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-9-running-the-app">Step 9: Running the App</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">AnimeApp</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">root</span><span class="p">.</span><span class="n">mainloop</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="sample-images">Sample Images</h2>

<p><img src="https://www.pyshine.com/assets/img/posts/samples/image1.png" alt="image1" /></p>

<hr />

<p><img src="https://www.pyshine.com/assets/img/posts/samples/image2.png" alt="image2" /></p>

<hr />

<p><img src="https://www.pyshine.com/assets/img/posts/samples/image3.png" alt="image3" /></p>

<h2 id="complete-code">Complete Code</h2>

<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="c1"># Fail-safe automatic installer for bare env
</span><span class="n">required_packages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">"Pillow&gt;=10"</span><span class="p">,</span>
    <span class="s">"numpy"</span><span class="p">,</span>
    <span class="s">"opencv-contrib-python"</span><span class="p">,</span>
    <span class="s">"onnxruntime"</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">install_package</span><span class="p">(</span><span class="n">pkg</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[INFO] Installing </span><span class="si">{</span><span class="n">pkg</span><span class="si">}</span><span class="s"> ..."</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="p">.</span><span class="n">check_call</span><span class="p">([</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">,</span> <span class="s">"-m"</span><span class="p">,</span> <span class="s">"pip"</span><span class="p">,</span> <span class="s">"install"</span><span class="p">,</span> <span class="s">"--upgrade"</span><span class="p">,</span> <span class="n">pkg</span><span class="p">])</span>

<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">required_packages</span><span class="p">:</span>
    <span class="n">pkg_name</span> <span class="o">=</span> <span class="n">pkg</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'&gt;='</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">pkg_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
        <span class="n">install_package</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span>


<span class="c1"># Import all after installation
</span><span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="n">tk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">filedialog</span><span class="p">,</span> <span class="n">messagebox</span><span class="p">,</span> <span class="n">ttk</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageTk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">onnxruntime</span> <span class="k">as</span> <span class="n">ort</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="c1"># Ensure Pillow has Resampling.LANCZOS
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="n">Resampling</span><span class="p">.</span><span class="n">LANCZOS</span>
<span class="k">except</span> <span class="nb">AttributeError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[INFO] Pillow version is too old, upgrading..."</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="p">.</span><span class="n">check_call</span><span class="p">([</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">,</span> <span class="s">"-m"</span><span class="p">,</span> <span class="s">"pip"</span><span class="p">,</span> <span class="s">"install"</span><span class="p">,</span> <span class="s">"--upgrade"</span><span class="p">,</span> <span class="s">"Pillow&gt;=10"</span><span class="p">])</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageTk</span>

<span class="k">print</span><span class="p">(</span><span class="s">"[INFO] All required packages are installed and imported successfully!"</span><span class="p">)</span>


<span class="c1"># AnimeGANv3 ONNX Model Config
</span><span class="n">STYLE_MODELS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"Hayao"</span><span class="p">:</span> <span class="s">"AnimeGANv3_Hayao_36.onnx"</span><span class="p">,</span>
    <span class="s">"Shinkai"</span><span class="p">:</span> <span class="s">"AnimeGANv3_Shinkai_37.onnx"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">"https://github.com/TachibanaYoshino/AnimeGANv3/releases/download/v1.1.0/"</span>

<span class="n">MAX_DISPLAY_SIZE</span> <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># Max width/height for GUI display
</span>
<span class="k">def</span> <span class="nf">get_model_path</span><span class="p">(</span><span class="n">style_name</span><span class="p">):</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">STYLE_MODELS</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"models"</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ensure_model</span><span class="p">(</span><span class="n">style_name</span><span class="p">):</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">get_model_path</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model_path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s">"models"</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">BASE_URL</span> <span class="o">+</span> <span class="n">STYLE_MODELS</span><span class="p">[</span><span class="n">style_name</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">urllib</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[INFO] Downloaded </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s"> model to </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Download error"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Could not download </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s"> model:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">model_path</span>

<span class="k">def</span> <span class="nf">safe_dim</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="nb">TypeError</span><span class="p">,</span> <span class="nb">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">default</span>


<span class="c1"># ONNX AnimeGANv3 Wrapper
</span><span class="k">class</span> <span class="nc">ONNXAnime</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">onnx_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">ort</span><span class="p">.</span><span class="n">InferenceSession</span><span class="p">(</span><span class="n">onnx_path</span><span class="p">)</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">get_inputs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">input_name</span> <span class="o">=</span> <span class="n">inp</span><span class="p">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span> <span class="o">=</span> <span class="n">inp</span><span class="p">.</span><span class="n">shape</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[INFO] Model expects input shape:"</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_bgr_or_rgba</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img_bgr_or_rgba</span>
        <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Input image is None"</span><span class="p">)</span>

        <span class="n">orig_h</span><span class="p">,</span> <span class="n">orig_w</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[DEBUG] Original input image shape: </span><span class="si">{</span><span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGRA2BGR</span><span class="p">)</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s">"Unsupported model input shape: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="c1"># Determine target height/width
</span>        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># NCHW
</span>            <span class="n">target_h</span> <span class="o">=</span> <span class="n">safe_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">target_w</span> <span class="o">=</span> <span class="n">safe_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># NHWC
</span>            <span class="n">target_h</span> <span class="o">=</span> <span class="n">safe_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">target_w</span> <span class="o">=</span> <span class="n">safe_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s">"Unsupported model input shape: </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[DEBUG] Resizing input for model: (</span><span class="si">{</span><span class="n">target_h</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">target_w</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
        <span class="n">img_resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">target_w</span><span class="p">,</span> <span class="n">target_h</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_AREA</span><span class="p">)</span>
        <span class="n">img_resized</span> <span class="o">=</span> <span class="n">img_resized</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">127.5</span> <span class="o">-</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># NCHW
</span>            <span class="n">tensor</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img_resized</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># NHWC
</span>            <span class="n">tensor</span> <span class="o">=</span> <span class="n">img_resized</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">{</span><span class="bp">self</span><span class="p">.</span><span class="n">input_name</span><span class="p">:</span> <span class="n">tensor</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[DEBUG] Raw model output shape: </span><span class="si">{</span><span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span><span class="p">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># NCHW
</span>            <span class="n">out_img</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">out</span><span class="p">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># NHWC
</span>            <span class="n">out_img</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s">"Unsupported model output shape: </span><span class="si">{</span><span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="n">out_img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">((</span><span class="n">out_img</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">127.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">out_bgr</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">out_img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_RGB2BGR</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[DEBUG] Converted output image shape (before GUI resize): </span><span class="si">{</span><span class="n">out_bgr</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out_bgr</span>


<span class="c1"># GUI App
</span><span class="k">class</span> <span class="nc">AnimeApp</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">master</span> <span class="o">=</span> <span class="n">master</span>
        <span class="n">master</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"PyShine Anime GUI"</span><span class="p">)</span>
        <span class="n">master</span><span class="p">.</span><span class="n">geometry</span><span class="p">(</span><span class="s">"450x700"</span><span class="p">)</span>

        <span class="n">tk</span><span class="p">.</span><span class="n">Label</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Select image → choose style → Convert"</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
        <span class="n">frame</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

      
        <span class="c1"># OptionMenu for style selection 
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">StringVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">"Hayao"</span><span class="p">)</span>  <span class="c1"># default value
</span>        <span class="n">ttk</span><span class="p">.</span><span class="n">OptionMenu</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="o">*</span><span class="n">STYLE_MODELS</span><span class="p">.</span><span class="n">keys</span><span class="p">()).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Select"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">load_image</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Convert"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">convert</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Save"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">save</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tk</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">"Original"</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">show_original</span><span class="p">).</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="p">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Canvas for image display 
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">MAX_DISPLAY_SIZE</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">MAX_DISPLAY_SIZE</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s">"gray"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Variables 
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">input_path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">output_img</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">orig_img_pil</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># original PIL image for showing anytime
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">orig_w</span> <span class="o">=</span> <span class="mi">512</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">orig_h</span> <span class="o">=</span> <span class="mi">512</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">display_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># reference to Tkinter image
</span>

    <span class="k">def</span> <span class="nf">load_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="p">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">"Image files"</span><span class="p">,</span> <span class="s">"*.jpg *.jpeg *.png"</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">input_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">).</span><span class="n">convert</span><span class="p">(</span><span class="s">"RGB"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">orig_img_pil</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># save original for Show Original
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">orig_w</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">orig_h</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">MAX_DISPLAY_SIZE</span><span class="o">/</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_w</span><span class="p">,</span> <span class="n">MAX_DISPLAY_SIZE</span><span class="o">/</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_h</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">display_scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="n">display_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_w</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">display_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_h</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>

        <span class="n">img_display</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">resize</span><span class="p">((</span><span class="n">display_w</span><span class="p">,</span> <span class="n">display_h</span><span class="p">),</span> <span class="n">Image</span><span class="p">.</span><span class="n">Resampling</span><span class="p">.</span><span class="n">LANCZOS</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img_display</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">display_w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">display_h</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">create_image</span><span class="p">(</span><span class="n">display_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">display_h</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[DEBUG] GUI displaying input image shape: </span><span class="si">{</span><span class="n">display_w</span><span class="si">}</span><span class="s">x</span><span class="si">{</span><span class="n">display_h</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">show_original</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">orig_img_pil</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">"No image"</span><span class="p">,</span> <span class="s">"Please load an image first."</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">display_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_w</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">display_scale</span><span class="p">)</span>
        <span class="n">display_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_h</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">display_scale</span><span class="p">)</span>
        <span class="n">img_display</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">orig_img_pil</span><span class="p">.</span><span class="n">resize</span><span class="p">((</span><span class="n">display_w</span><span class="p">,</span> <span class="n">display_h</span><span class="p">),</span> <span class="n">Image</span><span class="p">.</span><span class="n">Resampling</span><span class="p">.</span><span class="n">LANCZOS</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img_display</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">display_w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">display_h</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">create_image</span><span class="p">(</span><span class="n">display_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">display_h</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[DEBUG] GUI displaying original input image shape: </span><span class="si">{</span><span class="n">display_w</span><span class="si">}</span><span class="s">x</span><span class="si">{</span><span class="n">display_h</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">input_path</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">"No image"</span><span class="p">,</span> <span class="s">"Please select an image first."</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">style_var</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">model_path</span> <span class="o">=</span> <span class="n">ensure_model</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_path</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">input_path</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span>
            <span class="n">anime</span> <span class="o">=</span> <span class="n">ONNXAnime</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">anime</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">output_img</span> <span class="o">=</span> <span class="n">out</span>

            <span class="c1"># Resize to original image for saving
</span>            <span class="n">out_display</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_w</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">orig_h</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_AREA</span><span class="p">)</span>

            <span class="c1"># Resize for GUI display
</span>            <span class="n">display_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_w</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">display_scale</span><span class="p">)</span>
            <span class="n">display_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_h</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">display_scale</span><span class="p">)</span>
            <span class="n">out_display_pil</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">out_display</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">))</span>
            <span class="n">out_display_pil</span> <span class="o">=</span> <span class="n">out_display_pil</span><span class="p">.</span><span class="n">resize</span><span class="p">((</span><span class="n">display_w</span><span class="p">,</span> <span class="n">display_h</span><span class="p">),</span> <span class="n">Image</span><span class="p">.</span><span class="n">Resampling</span><span class="p">.</span><span class="n">LANCZOS</span><span class="p">)</span>

            <span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="p">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">out_display_pil</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">display_w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">display_h</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">create_image</span><span class="p">(</span><span class="n">display_w</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">display_h</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">tk_img</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[DEBUG] GUI displaying output image shape: </span><span class="si">{</span><span class="n">display_w</span><span class="si">}</span><span class="s">x</span><span class="si">{</span><span class="n">display_h</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showerror</span><span class="p">(</span><span class="s">"Failed to convert image"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">output_img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="p">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">"No output"</span><span class="p">,</span> <span class="s">"No anime image to save."</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="p">.</span><span class="n">asksaveasfilename</span><span class="p">(</span><span class="n">defaultextension</span><span class="o">=</span><span class="s">".png"</span><span class="p">,</span>
                                            <span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">"PNG"</span><span class="p">,</span><span class="s">"*.png"</span><span class="p">),(</span><span class="s">"JPEG"</span><span class="p">,</span><span class="s">"*.jpg"</span><span class="p">)])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">save_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">output_img</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">orig_w</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">orig_h</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_AREA</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[DEBUG] Saving output image resized shape: </span><span class="si">{</span><span class="n">save_img</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">cv2</span><span class="p">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">save_img</span><span class="p">)</span>
        <span class="n">messagebox</span><span class="p">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s">"Saved"</span><span class="p">,</span> <span class="sa">f</span><span class="s">"Saved to </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="c1"># Run App
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="c1"># Define a style for the OptionMenu
</span>    <span class="n">style</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">Style</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">style</span><span class="p">.</span><span class="n">theme_use</span><span class="p">(</span><span class="s">'clam'</span><span class="p">)</span>  <span class="c1"># or 'default', 'alt'
</span>    <span class="n">style</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="s">'TMenubutton'</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s">'white'</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="n">style_var</span> <span class="o">=</span> <span class="n">tk</span><span class="p">.</span><span class="n">StringVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">"Hayao"</span><span class="p">)</span>
    <span class="n">option</span> <span class="o">=</span> <span class="n">ttk</span><span class="p">.</span><span class="n">OptionMenu</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">style_var</span><span class="p">,</span> <span class="n">style_var</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="s">"Hayao"</span><span class="p">,</span> <span class="s">"Shinkai"</span><span class="p">)</span>
    <span class="c1"># option.pack(padx=20, pady=20)
</span>    <span class="n">AnimeApp</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">root</span><span class="p">.</span><span class="n">mainloop</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>You now have a <strong>fully functional AnimeGANv3 ONNX GUI</strong>!You learned:</p>

<ul>
  <li>Automatic package installation</li>
  <li>Downloading ONNX models</li>
  <li>Transforming images with ONNX</li>
  <li>Displaying images in Tkinter</li>
  <li>Saving results and viewing original image</li>
</ul>

<p>Experiment with different styles and images to create your own anime artwork!</p>

<hr />

<p><strong>Website:</strong> https://www.pyshine.com
<strong>Author:</strong> PyShine</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="animegan" /><category term="onnx" /><category term="gui" /><category term="beginner" /><category term="tutorial" /><summary type="html"><![CDATA[Step-by-step beginner-friendly tutorial to use AnimeGANv3 ONNX with a Tkinter GUI for transforming images into anime style.]]></summary></entry><entry><title type="html">High-Resolution ASCII Image Converter in Python – Beginner’s Guide</title><link href="https://www.pyshine.com/High-Resolution-ASCII-Image-Converter/" rel="alternate" type="text/html" title="High-Resolution ASCII Image Converter in Python – Beginner’s Guide" /><published>2025-11-26T00:00:00+00:00</published><updated>2025-11-26T00:00:00+00:00</updated><id>https://www.pyshine.com/High-Resolution-ASCII-Image-Converter</id><content type="html" xml:base="https://www.pyshine.com/High-Resolution-ASCII-Image-Converter/"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>Have you ever wanted to turn your favorite images into <strong>high-resolution ASCII art</strong>?
In this tutorial, we’ll build a Python program that converts images into <strong>full-color, pixel-aligned ASCII art</strong>.</p>

<p>This guide is written for <strong>beginners</strong>, and no prior experience with image processing is required.</p>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/Iek-azP5o1s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<h2 id="understanding-the-requirements">Understanding the Requirements</h2>

<p>Before we start coding, let’s understand the tools and concepts:</p>

<h3 id="requirements">Requirements:</h3>

<ul>
  <li><strong>Python 3 installed</strong></li>
  <li>Basic familiarity with Python functions, lists, and loops</li>
  <li>Libraries:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">numpy</code></li>
      <li><code class="language-plaintext highlighter-rouge">opencv-python</code></li>
      <li><code class="language-plaintext highlighter-rouge">Pillow</code> (PIL)</li>
    </ul>
  </li>
</ul>

<p>The program will:</p>

<ul>
  <li>Load an image</li>
  <li>Resize it to match ASCII character grid</li>
  <li>Match each block of pixels to a character</li>
  <li>Recreate the image using ASCII characters with original colors</li>
  <li>Provide character usage statistics</li>
</ul>

<hr />

<h2 id="installing-required-libraries">Installing Required Libraries</h2>

<p>Run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>numpy opencv-contrib-python pillow
</code></pre></div></div>

<hr />

<h2 id="creating-the-ascii-converter">Creating the ASCII Converter</h2>

<p>Create a new Python file called <strong><code class="language-plaintext highlighter-rouge">ascii_matcher_hd.py</code></strong> and start coding.</p>

<h3 id="1-import-modules">1. Import Modules</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">platform</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageFont</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageOps</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">os</code> and <code class="language-plaintext highlighter-rouge">platform</code> → to detect system fonts</li>
  <li><code class="language-plaintext highlighter-rouge">numpy</code> → efficient numerical operations</li>
  <li><code class="language-plaintext highlighter-rouge">cv2</code> → image processing</li>
  <li><code class="language-plaintext highlighter-rouge">PIL</code> → drawing ASCII characters on images</li>
</ul>

<hr />

<h3 id="2-define-ascii-characters">2. Define ASCII Characters</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ASCII</span> <span class="o">=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">127</span><span class="p">)]</span>
</code></pre></div></div>

<ul>
  <li>ASCII characters from <strong>space (32)</strong> to <strong>tilde (126)</strong>.</li>
  <li>These will be used to recreate the image.</li>
</ul>

<hr />

<h3 id="3-load-a-monospace-font">3. Load a Monospace Font</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">load_monospace_font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span>
    <span class="n">mac</span> <span class="o">=</span> <span class="p">[</span><span class="s">"/System/Library/Fonts/Menlo.ttc"</span><span class="p">,</span> <span class="s">"/System/Library/Fonts/Monaco.ttf"</span><span class="p">]</span>
    <span class="n">win</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s">"C:\Windows\Fonts\consola.ttf"</span><span class="p">,</span> <span class="sa">r</span><span class="s">"C:\Windows\Fonts\cour.ttf"</span><span class="p">]</span>
    <span class="n">linux</span> <span class="o">=</span> <span class="p">[</span><span class="s">"/usr/share/fonts/truetype/dejavu/DejaVuSansMono.ttf"</span><span class="p">,</span> <span class="s">"/usr/share/fonts/truetype/liberation/LiberationMono-Regular.ttf"</span><span class="p">]</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">mac</span> <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">"Darwin"</span> <span class="k">else</span> <span class="n">win</span> <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">"Windows"</span> <span class="k">else</span> <span class="n">linux</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">search</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ImageFont</span><span class="p">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"⚠ Using fallback font"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ImageFont</span><span class="p">.</span><span class="n">load_default</span><span class="p">()</span>

<span class="n">font</span> <span class="o">=</span> <span class="n">load_monospace_font</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Cross-platform font loading ensures consistent ASCII alignment.</li>
  <li>Uses a fallback if no system font is found.</li>
</ul>

<hr />

<h3 id="4-get-font-cell-size">4. Get Font Cell Size</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_font_cell</span><span class="p">(</span><span class="n">font</span><span class="p">):</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">getbbox</span><span class="p">(</span><span class="s">"M"</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">CELL</span> <span class="o">=</span> <span class="n">get_font_cell</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Font cell ="</span><span class="p">,</span> <span class="n">CELL</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Each ASCII character is drawn in a <strong>fixed cell size</strong>.</li>
  <li>Important for accurate image reconstruction.</li>
</ul>

<hr />

<h3 id="5-precompute-glyph-bitmaps">5. Precompute Glyph Bitmaps</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">glyph_bitmap</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">CELL</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">"L"</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="n">d</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ch</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="k">return</span> <span class="n">arr</span>

<span class="n">GLYPHS</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ch</span><span class="p">,</span> <span class="n">glyph_bitmap</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">ASCII</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Precomputes grayscale representation for each ASCII character.</li>
  <li>Speeds up the matching process.</li>
</ul>

<hr />

<h3 id="6-enhance-image-contrast">6. Enhance Image Contrast</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">enhance_contrast</span><span class="p">(</span><span class="n">gray</span><span class="p">):</span>
    <span class="n">clahe</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">createCLAHE</span><span class="p">(</span><span class="n">clipLimit</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">tileGridSize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">clahe</span><span class="p">.</span><span class="nb">apply</span><span class="p">((</span><span class="n">gray</span> <span class="o">*</span> <span class="mi">255</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">))</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">power</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Uses <strong>CLAHE</strong> for low-contrast images.</li>
  <li>Applies a gamma correction for brightness enhancement.</li>
</ul>

<hr />

<h3 id="7-convert-image-to-ascii">7. Convert Image to ASCII</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">image_to_ascii</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span> <span class="n">brightness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">FileNotFoundError</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">cw</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">CELL</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cols</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cw</span><span class="o">/</span><span class="n">ch</span><span class="p">))</span>
    <span class="n">target_px</span> <span class="o">=</span> <span class="p">(</span><span class="n">cols</span><span class="o">*</span><span class="n">cw</span><span class="p">,</span> <span class="n">rows</span><span class="o">*</span><span class="n">ch</span><span class="p">)</span>
    <span class="n">img_small</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">target_px</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_AREA</span><span class="p">)</span>

    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img_small</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_RGB2GRAY</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">enhance_contrast</span><span class="p">(</span><span class="n">gray</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gray</span> <span class="o">*</span> <span class="n">brightness</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">"RGB"</span><span class="p">,</span> <span class="n">target_px</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

    <span class="n">char_usage</span> <span class="o">=</span> <span class="p">{</span><span class="n">ch</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">ASCII</span><span class="p">}</span>
    <span class="n">total_used</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">cw</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">ch</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="n">gray</span><span class="p">[</span><span class="n">y0</span><span class="p">:</span><span class="n">y0</span><span class="o">+</span><span class="n">ch</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span><span class="n">x0</span><span class="o">+</span><span class="n">cw</span><span class="p">]</span>

            <span class="n">best</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">GLYPHS</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">patch</span> <span class="o">-</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">best_char</span> <span class="o">=</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">char_usage</span><span class="p">[</span><span class="n">best_char</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">total_used</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">img_small</span><span class="p">[</span><span class="n">y0</span><span class="p">:</span><span class="n">y0</span><span class="o">+</span><span class="n">ch</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span><span class="n">x0</span><span class="o">+</span><span class="n">cw</span><span class="p">].</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
            <span class="n">draw</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">best_char</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="n">out</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Saved:"</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== CHARACTER USAGE REPORT ==="</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Total characters used:"</span><span class="p">,</span> <span class="n">total_used</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">char_usage</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"'</span><span class="si">{</span><span class="n">ch</span><span class="si">}</span><span class="s">' : </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Resizes the image to match <strong>ASCII grid</strong>.</li>
  <li>Matches each pixel block with the <strong>best-fitting ASCII character</strong>.</li>
  <li>Draws ASCII characters using <strong>average color</strong> from the original image.</li>
  <li>Prints <strong>character usage statistics</strong>.</li>
</ul>

<hr />

<h3 id="8-example-run">8. Example Run</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">image_to_ascii</span><span class="p">(</span><span class="s">"cat.png"</span><span class="p">,</span> <span class="s">"ascii_hd.png"</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">brightness</span><span class="o">=</span><span class="mf">1.6</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Converts <code class="language-plaintext highlighter-rouge">cat.png</code> into <code class="language-plaintext highlighter-rouge">ascii_hd.png</code>.</li>
  <li>Adjust <code class="language-plaintext highlighter-rouge">cols</code> and <code class="language-plaintext highlighter-rouge">brightness</code> for different resolution and contrast.</li>
</ul>

<hr />

<h2 id="running-the-script">Running the Script</h2>

<ol>
  <li>Save your file as <code class="language-plaintext highlighter-rouge">ascii_matcher_hd.py</code>.</li>
  <li>Place an image in the same folder, e.g., <code class="language-plaintext highlighter-rouge">cat.png</code>.</li>
  <li>Run the script:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ascii_matcher_hd.py
</code></pre></div></div>

<h2 id="complete-code">Complete code</h2>

<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">platform</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageFont</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageOps</span>


<span class="c1"># ASCII CHARSET (printables)
</span><span class="n">ASCII</span> <span class="o">=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">127</span><span class="p">)]</span>


<span class="c1"># LOAD CROSS-PLATFORM MONOSPACE FONT
</span><span class="k">def</span> <span class="nf">load_monospace_font</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="p">.</span><span class="n">system</span><span class="p">()</span>

    <span class="n">mac</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"/System/Library/Fonts/Menlo.ttc"</span><span class="p">,</span>
        <span class="s">"/System/Library/Fonts/Monaco.ttf"</span>
    <span class="p">]</span>
    <span class="n">win</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">r</span><span class="s">"C:\Windows\Fonts\consola.ttf"</span><span class="p">,</span>
        <span class="sa">r</span><span class="s">"C:\Windows\Fonts\cour.ttf"</span>
    <span class="p">]</span>
    <span class="n">linux</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"/usr/share/fonts/truetype/dejavu/DejaVuSansMono.ttf"</span><span class="p">,</span>
        <span class="s">"/usr/share/fonts/truetype/liberation/LiberationMono-Regular.ttf"</span>
    <span class="p">]</span>

    <span class="n">search</span> <span class="o">=</span> <span class="n">mac</span> <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">"Darwin"</span> <span class="k">else</span> <span class="n">win</span> <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">"Windows"</span> <span class="k">else</span> <span class="n">linux</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">search</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ImageFont</span><span class="p">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"Using fallback font"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ImageFont</span><span class="p">.</span><span class="n">load_default</span><span class="p">()</span>

<span class="n">font</span> <span class="o">=</span> <span class="n">load_monospace_font</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>


<span class="c1"># GET FONT CELL SIZE (precise height)
</span><span class="k">def</span> <span class="nf">get_font_cell</span><span class="p">(</span><span class="n">font</span><span class="p">):</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">getbbox</span><span class="p">(</span><span class="s">"M"</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">CELL</span> <span class="o">=</span> <span class="n">get_font_cell</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Font cell ="</span><span class="p">,</span> <span class="n">CELL</span><span class="p">)</span>


<span class="c1"># PRECOMPUTE GLYPH BITMAPS
</span><span class="k">def</span> <span class="nf">glyph_bitmap</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">CELL</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">"L"</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="n">d</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ch</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="k">return</span> <span class="n">arr</span>

<span class="n">GLYPHS</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ch</span><span class="p">,</span> <span class="n">glyph_bitmap</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">ASCII</span><span class="p">]</span>


<span class="c1"># NORMALIZATION + CONTRAST BOOST FUNCTION
</span><span class="k">def</span> <span class="nf">enhance_contrast</span><span class="p">(</span><span class="n">gray</span><span class="p">):</span>
    <span class="c1"># CLAHE = best for low contrast images
</span>    <span class="n">clahe</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">createCLAHE</span><span class="p">(</span><span class="n">clipLimit</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">tileGridSize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">clahe</span><span class="p">.</span><span class="nb">apply</span><span class="p">((</span><span class="n">gray</span> <span class="o">*</span> <span class="mi">255</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">))</span> <span class="o">/</span> <span class="mf">255.0</span>

    <span class="c1"># light gamma for more brightness pop
</span>    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">power</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="c1"># MAIN: HI-RES PIXEL-ALIGNED FULL-COLOR ASCII CONVERTER
</span><span class="k">def</span> <span class="nf">image_to_ascii</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span> <span class="n">brightness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">FileNotFoundError</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">cw</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">CELL</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cols</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cw</span><span class="o">/</span><span class="n">ch</span><span class="p">))</span>

    <span class="n">target_px</span> <span class="o">=</span> <span class="p">(</span><span class="n">cols</span><span class="o">*</span><span class="n">cw</span><span class="p">,</span> <span class="n">rows</span><span class="o">*</span><span class="n">ch</span><span class="p">)</span>
    <span class="n">img_small</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">target_px</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_AREA</span><span class="p">)</span>

    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img_small</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_RGB2GRAY</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">enhance_contrast</span><span class="p">(</span><span class="n">gray</span><span class="p">)</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gray</span> <span class="o">*</span> <span class="n">brightness</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">"RGB"</span><span class="p">,</span> <span class="n">target_px</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

  
    <span class="c1"># CHARACTER USAGE COUNTER
</span>    <span class="n">char_usage</span> <span class="o">=</span> <span class="p">{</span><span class="n">ch</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">ASCII</span><span class="p">}</span>
    <span class="n">total_used</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>

            <span class="n">x0</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">cw</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">ch</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="n">gray</span><span class="p">[</span><span class="n">y0</span><span class="p">:</span><span class="n">y0</span><span class="o">+</span><span class="n">ch</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span><span class="n">x0</span><span class="o">+</span><span class="n">cw</span><span class="p">]</span>

            <span class="c1"># best ASCII match by L1 distance
</span>            <span class="n">best</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">GLYPHS</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">patch</span> <span class="o">-</span> <span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">best_char</span> <span class="o">=</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">char_usage</span><span class="p">[</span><span class="n">best_char</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">total_used</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># original mean color
</span>            <span class="n">color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">img_small</span><span class="p">[</span><span class="n">y0</span><span class="p">:</span><span class="n">y0</span><span class="o">+</span><span class="n">ch</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span><span class="n">x0</span><span class="o">+</span><span class="n">cw</span><span class="p">].</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
            <span class="n">draw</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">best_char</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="n">out</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Saved:"</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span>


    <span class="c1"># PRINT CHARACTER STATISTICS
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== CHARACTER USAGE REPORT ==="</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Total characters used:"</span><span class="p">,</span> <span class="n">total_used</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">char_usage</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"'</span><span class="si">{</span><span class="n">ch</span><span class="si">}</span><span class="s">' : </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">image_to_ascii</span><span class="p">(</span><span class="s">"cat.png"</span><span class="p">,</span> <span class="s">"ascii_hd.png"</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">brightness</span><span class="o">=</span><span class="mf">1.6</span><span class="p">)</span>

</code></pre></div></div>

<p>Example image via these parameters:</p>

<p><code class="language-plaintext highlighter-rouge">image_to_ascii("cat.png","ascii_hd.png",cols=400,brightness=1.6)</code></p>

<p><img src="https://www.pyshine.com/assets/img/posts/ascii_hd_cat.png" alt="ascii_hd_cat" /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python main.py
Font cell <span class="o">=</span> <span class="o">(</span>12, 15<span class="o">)</span>
Saved: ascii_hd.png

<span class="o">===</span> CHARACTER USAGE REPORT <span class="o">===</span>
Total characters used: 128000
<span class="s1">'N'</span> : 56261
<span class="s1">' '</span> : 28717
<span class="s1">'M'</span> : 21530
<span class="s1">'U'</span> : 10621
<span class="s1">'%'</span> : 6287
<span class="s1">'|'</span> : 1990
<span class="s1">'W'</span> : 520
<span class="s1">'`'</span> : 380
<span class="s1">'0'</span> : 284
<span class="s1">'['</span> : 158
<span class="s1">'*'</span> : 154
<span class="s1">'C'</span> : 107
<span class="s1">'R'</span> : 89
<span class="s1">'J'</span> : 83
<span class="s1">'~'</span> : 81
<span class="s1">'@'</span> : 80
<span class="s1">'K'</span> : 80
<span class="s1">'B'</span> : 75
<span class="s1">'w'</span> : 65
<span class="s1">'&lt;'</span> : 40
<span class="s1">'Z'</span> : 38
<span class="s1">'#'</span> : 36
<span class="s1">'^'</span> : 34
<span class="s1">'D'</span> : 33
<span class="s1">'L'</span> : 33
<span class="s1">'r'</span> : 32
<span class="s1">'&gt;'</span> : 24
<span class="s1">'/'</span> : 14
<span class="s1">'-'</span> : 13
<span class="s1">'m'</span> : 11
<span class="s1">'q'</span> : 11
<span class="s1">'9'</span> : 10
<span class="s1">'!'</span> : 8
<span class="s1">'3'</span> : 8
<span class="s1">'2'</span> : 7
<span class="s1">'H'</span> : 7
<span class="s1">'+'</span> : 6
<span class="s1">'A'</span> : 6
<span class="s1">'a'</span> : 6
<span class="s1">'1'</span> : 5
<span class="s1">'\'</span> : 5
<span class="s1">'d'</span> : 5
<span class="s1">'k'</span> : 5
<span class="s1">'$'</span> : 4
<span class="s1">'4'</span> : 4
<span class="s1">'X'</span> : 4
<span class="s1">'u'</span> : 4
<span class="s1">'6'</span> : 3
<span class="s1">'8'</span> : 3
<span class="s1">':'</span> : 3
<span class="s1">'f'</span> : 3
<span class="s1">'e'</span> : 2
<span class="s1">'{'</span> : 2
<span class="s1">'"'</span> : 1
<span class="s1">'('</span> : 1
<span class="s1">')'</span> : 1
<span class="s1">'7'</span> : 1
<span class="s1">'P'</span> : 1
<span class="s1">'Q'</span> : 1
<span class="s1">'S'</span> : 1
<span class="s1">'o'</span> : 1
<span class="s1">'y'</span> : 1
</code></pre></div></div>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>You now have a <strong>high-resolution, full-color ASCII converter</strong> in Python!</p>

<p>This tutorial introduces:</p>

<ul>
  <li>Image resizing and processing with OpenCV</li>
  <li>Using PIL for drawing ASCII characters</li>
  <li>Precomputing glyphs for efficiency</li>
  <li>Pixel-aligned ASCII reconstruction</li>
  <li>Character usage analytics</li>
</ul>

<p>Experiment with different images, font sizes, columns, and brightness to create stunning ASCII art.</p>

<hr />

<p><strong>Website:</strong> https://www.pyshine.com
<strong>Author:</strong> PyShine</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="ascii" /><category term="image-processing" /><category term="beginner" /><category term="tutorial" /><summary type="html"><![CDATA[Learn how to convert images to high-resolution ASCII art in Python. Step-by-step beginner-friendly guide to build a pixel-aligned full-color ASCII converter.]]></summary></entry><entry><title type="html">Convert Images to Animated ASCII Art in Python – Beginner’s Guide</title><link href="https://www.pyshine.com/Image-to-ASCII/" rel="alternate" type="text/html" title="Convert Images to Animated ASCII Art in Python – Beginner’s Guide" /><published>2025-11-25T00:00:00+00:00</published><updated>2025-11-25T00:00:00+00:00</updated><id>https://www.pyshine.com/Image-to-ASCII</id><content type="html" xml:base="https://www.pyshine.com/Image-to-ASCII/"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>Ever wondered how to turn an image into awesome ASCII art directly inside your terminal?
In this beginner-friendly tutorial, you’ll learn how to load an image, convert it to grayscale, map pixels to ASCII characters, and display it line-by-line with a smooth animated effect.</p>

<p>This project is perfect for beginners learning:</p>

<ul>
  <li>Basic <strong>image processing</strong></li>
  <li><strong>OpenCV</strong> fundamentals</li>
  <li>ASCII art generation</li>
  <li>Terminal animation</li>
</ul>

<hr />

<h2 id="requirements">Requirements</h2>

<p>Install the required library:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>opencv-contrib-python
</code></pre></div></div>

<p>You also need an image file named:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ia.png
</code></pre></div></div>

<p>Place it in the same folder as your script. Of course you can try any other image name but remember to change that name in the code as well.</p>

<hr />

<h2 id="understanding-the-code">Understanding the Code</h2>

<h2 id="1-importing-libraries">1. Importing Libraries</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
</code></pre></div></div>

<ul>
  <li><strong>cv2</strong> → Image loading and resizing</li>
  <li><strong>time</strong> → Adding animation timing</li>
  <li><strong>os</strong> → Optional file management</li>
</ul>

<hr />

<h2 id="2-ascii-character-set">2. ASCII Character Set</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ASCII</span> <span class="o">=</span> <span class="s">"@%#*+=-:. "</span>
</code></pre></div></div>

<p>Characters are arranged from <strong>darkest</strong> (<code class="language-plaintext highlighter-rouge">@</code>) to <strong>lightest</strong> ().
Each grayscale pixel finds its closest match in this set.</p>

<hr />

<h2 id="3-load-the-image">3. Load the Image</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">"ia.png"</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
<span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">FileNotFoundError</span><span class="p">(</span><span class="s">"Image issue!"</span><span class="p">)</span>
</code></pre></div></div>

<p>Loads the image as grayscale.
If missing → raises an error.</p>

<hr />

<h2 id="4-resize-while-keeping-aspect-ratio">4. Resize While Keeping Aspect Ratio</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span>
<span class="n">new_w</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">w</span>
<span class="n">new_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_w</span> <span class="o">*</span> <span class="n">ratio</span> <span class="o">*</span> <span class="mf">0.55</span><span class="p">)</span>
<span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">))</span>
</code></pre></div></div>

<p>Why multiply by <strong>0.55</strong>?
Because terminal text cells are <strong>taller</strong> than they are <strong>wide</strong>, so we shrink vertically to maintain the correct proportions.</p>

<hr />

<h2 id="5-convert-pixels-to-ascii-with-animation">5. Convert Pixels to ASCII (With Animation!)</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resized</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">ASCII</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ASCII</span><span class="p">)</span> <span class="o">//</span> <span class="mi">256</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]))</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Converts each pixel intensity to a matching ASCII character</li>
  <li>Builds each line as a string</li>
  <li>Prints it with a short delay to create the animation effect</li>
</ul>

<hr />

<h2 id="full-source-code">Full Source Code</h2>
<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">ASCII</span> <span class="o">=</span> <span class="s">"@%#*+=-:. "</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">"ia.png"</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>
<span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">FileNotFoundError</span><span class="p">(</span><span class="s">"Image issue!"</span><span class="p">)</span>

<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span>
<span class="n">new_w</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">w</span>
<span class="n">new_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_w</span> <span class="o">*</span> <span class="n">ratio</span> <span class="o">*</span> <span class="mf">0.55</span><span class="p">)</span>
<span class="n">resized</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resized</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="n">ASCII</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ASCII</span><span class="p">)</span> <span class="o">//</span> <span class="mi">256</span><span class="p">]</span>
                   <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]))</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="running-the-script">Running the Script</h2>

<p>Save the script as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ascii_art.py
</code></pre></div></div>

<p>Run it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python ascii_art.py
</code></pre></div></div>

<p>Your ASCII animation will begin drawing line-by-line!</p>

<hr />

<h2 id="full-source-code-colored-version">Full Source Code (Colored version)</h2>
<p>Try the following for colorful version:</p>

<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cv2</span><span class="p">,</span> <span class="n">time</span>

<span class="n">ASCII</span> <span class="o">=</span> <span class="s">" .:-=+*#%@"</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">"ia.png"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">raise</span> <span class="nb">FileNotFoundError</span><span class="p">()</span>
<span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">new_w</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">new_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_w</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">))</span>
<span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

<span class="k">for</span> <span class="n">gy</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"</span><span class="se">\033</span><span class="s">[38;2;</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s">;</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s">;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s">m</span><span class="si">{</span><span class="n">ASCII</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">9</span><span class="o">//</span><span class="mi">255</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s">[0m"</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gy</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="breaking-down-the-code-for-colorful-ascii-art">Breaking Down the Code for COLORFUL ASCII ART</h2>

<ol>
  <li>Importing Libraries</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cv2</span><span class="p">,</span> <span class="n">time</span>
</code></pre></div></div>
<ul>
  <li>cv2 → OpenCV library for image processing</li>
  <li>time → To add a small delay for animated printing</li>
</ul>

<ol>
  <li>ASCII Characters</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ASCII</span> <span class="o">=</span> <span class="s">" .:-=+*#%@"</span>
</code></pre></div></div>

<p>Each character represents a different brightness level</p>

<p>” “ is the lightest, “@” is the darkest</p>

<ol>
  <li>Loading the Image</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">"ia.png"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">img</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 
    <span class="k">raise</span> <span class="nb">FileNotFoundError</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>Reads the image file</li>
  <li>Throws an error if the image is missing</li>
</ul>

<ol>
  <li>Resizing the Image</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">new_w</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">new_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_w</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">))</span>
</code></pre></div></div>

<ul>
  <li>Maintains aspect ratio</li>
  <li>Scales the width to 80 characters</li>
  <li>0.5 factor compensates for character height vs width</li>
</ul>

<ol>
  <li>Converting to Grayscale</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Converts image to grayscale</li>
  <li>Each pixel now represents brightness (0–255)</li>
</ul>

<ol>
  <li>Mapping Pixels to ASCII Characters with Color</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">gy</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s">"</span><span class="se">\033</span><span class="s">[38;2;</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s">;</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s">;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s">m</span><span class="si">{</span><span class="n">ASCII</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">9</span><span class="o">//</span><span class="mi">255</span><span class="p">]</span><span class="si">}</span><span class="se">\033</span><span class="s">[0m"</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gy</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Loops over each row of pixels</li>
  <li>Maps brightness to ASCII character</li>
  <li>Colors characters using ANSI escape codes:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\033[38;2;R;G;Bm
</code></pre></div></div>

<ul>
  <li>Sets RGB foreground color</li>
  <li><code class="language-plaintext highlighter-rouge">\033[0m</code> resets formatting</li>
  <li><code class="language-plaintext highlighter-rouge">time.sleep(0.01)</code> adds a small delay to create a smooth printing effect</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>You now know how to:</p>

<ul>
  <li>Load and process images with OpenCV</li>
  <li>Convert image pixels to ASCII brightness levels</li>
  <li>Create cool terminal animations</li>
</ul>

<p>Try modifying:</p>

<ul>
  <li>The ASCII character set</li>
  <li>Image size</li>
  <li>Animation speed</li>
</ul>

<p>Tips:</p>

<ul>
  <li>Increase new_w for higher-resolution ASCII art.</li>
  <li>Use a terminal with truecolor support for best results.</li>
  <li>You can experiment with different ASCII character sets for different artistic styles.</li>
</ul>

<p>Enjoy experimenting, and happy coding!</p>

<hr />

<p><strong>Website:</strong> https://www.pyshine.com
<strong>Author:</strong> PyShine</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="ascii" /><category term="opencv" /><category term="terminal" /><category term="beginner" /><category term="tutorial" /><summary type="html"><![CDATA[Learn how to convert any image into animated ASCII art using Python and OpenCV. Perfect for beginners exploring image processing and terminal graphics.]]></summary></entry><entry><title type="html">FastAPI Lab 3 – Build a Simple To-Do List API</title><link href="https://www.pyshine.com/Lab3-FastAPI-Todo-List/" rel="alternate" type="text/html" title="FastAPI Lab 3 – Build a Simple To-Do List API" /><published>2025-11-23T00:00:00+00:00</published><updated>2025-11-23T00:00:00+00:00</updated><id>https://www.pyshine.com/Lab3-FastAPI-Todo-List</id><content type="html" xml:base="https://www.pyshine.com/Lab3-FastAPI-Todo-List/"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>Have you ever wondered how apps like  <strong>Google Keep</strong> ,  <strong>Todoist</strong> , or even your phone’s reminder app manage and organize your tasks behind the scenes? In this lab, you’ll step into the world of web APIs and build your very own <strong>Simple To-Do List API</strong> using <strong>FastAPI</strong> and  <strong>Pydantic</strong> .</p>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/EHBkr1hAfVw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<p>With this API, you’ll be able to  <strong>add tasks</strong> ,  <strong>view all tasks</strong> , and understand how data flows between clients and servers — the same concepts used in real-world apps.</p>

<p>Don’t worry if you’ve never worked with APIs before — this guide is  <strong>beginner-friendly</strong> , walks you through every step, and requires no prior experience. By the end, you’ll have a working backend that could be the foundation for your own productivity app!</p>

<hr />

<h2 id="understanding-the-requirements">Understanding the Requirements</h2>

<p>You will build an API that:</p>

<ul>
  <li>Stores tasks in memory (no database required)</li>
  <li>Allows adding tasks via POST requests</li>
  <li>Allows viewing all tasks via GET requests</li>
  <li>Uses Pydantic to validate incoming task data</li>
</ul>

<hr />

<h2 id="setting-up">Setting Up</h2>

<p>Install FastAPI and Uvicorn:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>fastapi uvicorn
</code></pre></div></div>

<hr />

<h2 id="get-requests">GET Requests</h2>

<ul>
  <li>Purpose: Retrieve or fetch data from a server.</li>
  <li>Effect on Server: Does not change server data (read-only).</li>
  <li>Data Transmission: Data is sent via URL query parameters (visible in the URL).</li>
  <li>Idempotence: Yes — making the same GET request multiple times produces the same result.</li>
  <li>Caching: GET requests can be cached by browsers and proxies.</li>
  <li>Use Case Examples:</li>
  <li>Viewing all tasks in a to-do list API</li>
  <li>Retrieving a user profile</li>
  <li>Loading a web page</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/tasks"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"tasks"</span><span class="p">:</span> <span class="n">tasks</span><span class="p">}</span>
</code></pre></div></div>

<p>Visiting <code class="language-plaintext highlighter-rouge">/tasks</code> in your browser or via curl retrieves all tasks.</p>

<h2 id="post-requests">POST Requests</h2>

<ul>
  <li>Purpose: Send data to the server to create or update resources.</li>
  <li>Effect on Server: Changes server state (e.g., adds a new record).</li>
  <li>Data Transmission: Data is sent in the request body (not visible in the URL).</li>
  <li>Idempotence: Usually no — repeating a POST request can create multiple resources.</li>
  <li>Caching: POST requests are usually not cached.</li>
  <li>Use Case Examples:</li>
  <li>Adding a new task to a to-do list</li>
  <li>Creating a new user account</li>
  <li>Submitting a form</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/add"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_task</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Task</span><span class="p">):</span>
    <span class="n">tasks</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">task</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"message"</span><span class="p">:</span> <span class="s">"Task added!"</span><span class="p">,</span> <span class="s">"task"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">task</span><span class="p">}</span>

</code></pre></div></div>

<h2 id="key-differences-between-get-and-post">Key Differences Between GET and POST</h2>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>GET</th>
      <th>POST</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Purpose</td>
      <td>Retrieve data</td>
      <td>Send or create data</td>
    </tr>
    <tr>
      <td>Alters Server Data</td>
      <td>No</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td>Data Location</td>
      <td>URL query parameters</td>
      <td>Request body</td>
    </tr>
    <tr>
      <td>Visibility</td>
      <td>URL visible</td>
      <td>Body hidden</td>
    </tr>
    <tr>
      <td>Idempotent</td>
      <td>Yes</td>
      <td>Usually No</td>
    </tr>
    <tr>
      <td>Caching</td>
      <td>Can be cached</td>
      <td>Usually not cached</td>
    </tr>
  </tbody>
</table>

<h3 id="summary">Summary:</h3>

<ul>
  <li>Use GET to read data without changing anything.</li>
  <li>Use POST to send data or make changes to the server.</li>
</ul>

<h2 id="writing-the-to-do-api">Writing the To-Do API</h2>

<p>Create a file named <strong><code class="language-plaintext highlighter-rouge">main.py</code></strong> and add:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="c1"># In-memory "database"
</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Data model for creating tasks
</span><span class="k">class</span> <span class="nc">Task</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">task</span><span class="p">:</span> <span class="nb">str</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/add"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_task</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Task</span><span class="p">):</span>
    <span class="n">tasks</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">task</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"message"</span><span class="p">:</span> <span class="s">"Task added!"</span><span class="p">,</span> <span class="s">"task"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">task</span><span class="p">}</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/tasks"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"tasks"</span><span class="p">:</span> <span class="n">tasks</span><span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="code-explanation">Code Explanation</h2>

<h3 id="1-importing-libraries">1. Importing Libraries</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">FastAPI</code> → to create API endpoints</li>
  <li><code class="language-plaintext highlighter-rouge">BaseModel</code> → to define and validate request data</li>
</ul>

<h3 id="2-creating-the-app">2. Creating the App</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="3-creating-an-in-memory-database">3. Creating an In-Memory Database</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">tasks</code> is a simple Python list that stores all task strings</li>
</ul>

<h3 id="4-defining-the-task-model">4. Defining the Task Model</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Task</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">task</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></div>

<ul>
  <li>Ensures that the incoming request contains a string field named <code class="language-plaintext highlighter-rouge">task</code></li>
</ul>

<h3 id="5-adding-tasks">5. Adding Tasks</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/add"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_task</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Task</span><span class="p">):</span>
    <span class="n">tasks</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">task</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"message"</span><span class="p">:</span> <span class="s">"Task added!"</span><span class="p">,</span> <span class="s">"task"</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">task</span><span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Accepts POST requests to <code class="language-plaintext highlighter-rouge">/add</code></li>
  <li>Validates the request body with Pydantic <code class="language-plaintext highlighter-rouge">Task</code> model</li>
  <li>Adds the task to the in-memory list</li>
  <li>Returns a JSON response confirming the addition</li>
</ul>

<h3 id="6-retrieving-all-tasks">6. Retrieving All Tasks</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/tasks"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"tasks"</span><span class="p">:</span> <span class="n">tasks</span><span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Accepts GET requests to <code class="language-plaintext highlighter-rouge">/tasks</code></li>
  <li>Returns all tasks stored in memory</li>
</ul>

<hr />

<h2 id="running-the-server">Running the Server</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> uvicorn main:app <span class="nt">--reload</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--reload</code> automatically restarts the server when you edit the code</li>
</ul>

<hr />

<h2 id="testing-your-api">Testing Your API</h2>

<h3 id="add-a-task">Add a Task</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST <span class="s2">"http://127.0.0.1:8000/add"</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-d</span> <span class="s1">'{"task":"Buy groceries"}'</span>
</code></pre></div></div>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task added!"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"task"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Buy groceries"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="view-all-tasks">View All Tasks</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/tasks
</code></pre></div></div>

<p>Response:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Buy groceries"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>You have now created a <strong>Simple To-Do List API</strong> in Python using FastAPI:</p>

<ul>
  <li>Learned to handle POST and GET requests</li>
  <li>Used Pydantic for request validation</li>
  <li>Stored data in memory</li>
  <li>Built a working backend API for tasks</li>
</ul>

<p>You can expand this lab in the future by:</p>

<ul>
  <li>Adding task deletion</li>
  <li>Adding completion status</li>
  <li>Connecting to a database</li>
</ul>

<hr />

<p><strong>Website:</strong> https://www.pyshine.com
<strong>Author:</strong> PyShine</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="fastapi" /><category term="api" /><category term="backend" /><category term="tutorial" /><category term="beginner" /><summary type="html"><![CDATA[Lab 3 beginner-friendly tutorial to create a Simple To-Do List API using FastAPI and Pydantic. Step-by-step guide for beginners.]]></summary></entry><entry><title type="html">Python Avatars – Generate Random SVG Avatars for Beginners</title><link href="https://www.pyshine.com/Make-Avatar-in-Python/" rel="alternate" type="text/html" title="Python Avatars – Generate Random SVG Avatars for Beginners" /><published>2025-11-21T00:00:00+00:00</published><updated>2025-11-21T00:00:00+00:00</updated><id>https://www.pyshine.com/Make-Avatar-in-Python</id><content type="html" xml:base="https://www.pyshine.com/Make-Avatar-in-Python/"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>Creating unique avatars is fun and useful for websites, apps, or games.<br />
In this tutorial, you’ll learn how to generate <strong>random avatars</strong> using Python with the <code class="language-plaintext highlighter-rouge">python_avatars</code> library.</p>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/_CqlRwTf_xY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<p>No prior experience is required — this guide is for <strong>absolute beginners</strong>.</p>

<hr />

<h2 id="understanding-the-requirements">Understanding the Requirements</h2>

<p>You will learn how to:</p>

<ul>
  <li>Install and use <code class="language-plaintext highlighter-rouge">python_avatars</code></li>
  <li>Generate a <strong>random avatar</strong></li>
  <li>Customize features like hair, eyes, mouth, clothing, and colors</li>
  <li>Save your avatar as an <strong>SVG file</strong></li>
</ul>

<h3 id="prerequisites">Prerequisites:</h3>

<ul>
  <li>Python 3 installed</li>
  <li>Basic knowledge of Python (variables, imports, functions)</li>
</ul>

<hr />

<h2 id="setting-up-your-environment">Setting Up Your Environment</h2>

<p>Install the <code class="language-plaintext highlighter-rouge">python_avatars</code> package:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>python-avatars
</code></pre></div></div>

<p>You also need Python’s built-in <code class="language-plaintext highlighter-rouge">random</code> module, which requires no installation.</p>

<hr />

<h2 id="writing-the-avatar-script">Writing the Avatar Script</h2>

<p>Create a new Python file, e.g., <strong><code class="language-plaintext highlighter-rouge">avatar_gen.py</code></strong>, and add:</p>

<style>
  .copy-code-button {
	box-shadow:inset 0px 1px 0px 0px #bbdaf7;
	background:linear-gradient(to bottom, #79bbff 5%, #378de5 100%);
	background-color:#79bbff;
	border-radius:6px;
	border:1px solid #84bbf3;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:0px 1px 0px #528ecc;
}
.copy-code-button:hover {
	background:linear-gradient(to bottom, #378de5 5%, #79bbff 100%);
	background-color:#378de5;
}
.copy-code-button:active {
	position:relative;
	top:1px;
}
</style>

<div class="code-header">
  <button class="copy-code-button">
    Copy code to clipboard
  </button>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">python_avatars</span> <span class="k">as</span> <span class="n">pa</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="k">as</span> <span class="n">r</span>

<span class="c1"># Create an avatar with random features
</span><span class="n">avatar</span> <span class="o">=</span> <span class="n">pa</span><span class="p">.</span><span class="n">Avatar</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">AvatarStyle</span><span class="p">.</span><span class="n">CIRCLE</span><span class="p">,</span>
    <span class="o">**</span><span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">enum</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">enum</span> <span class="ow">in</span> <span class="p">{</span>
        <span class="s">"background_color"</span><span class="p">:</span> <span class="n">pa</span><span class="p">.</span><span class="n">BackgroundColor</span><span class="p">,</span>
        <span class="s">"top"</span><span class="p">:</span> <span class="n">pa</span><span class="p">.</span><span class="n">HairType</span><span class="p">,</span>
        <span class="s">"eyes"</span><span class="p">:</span> <span class="n">pa</span><span class="p">.</span><span class="n">EyeType</span><span class="p">,</span>
        <span class="s">"mouth"</span><span class="p">:</span> <span class="n">pa</span><span class="p">.</span><span class="n">MouthType</span><span class="p">,</span>
        <span class="s">"clothing"</span><span class="p">:</span> <span class="n">pa</span><span class="p">.</span><span class="n">ClothingType</span><span class="p">,</span>
        <span class="s">"hair_color"</span><span class="p">:</span> <span class="n">pa</span><span class="p">.</span><span class="n">HairColor</span><span class="p">,</span>
        <span class="s">"clothing_color"</span><span class="p">:</span> <span class="n">pa</span><span class="p">.</span><span class="n">ClothingColor</span>
    <span class="p">}.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">skin_color</span><span class="o">=</span><span class="sa">f</span><span class="s">"#</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mh">0xFFFFFF</span><span class="p">)</span><span class="si">:</span><span class="mi">06</span><span class="n">x</span><span class="si">}</span><span class="s">"</span>  <span class="c1"># Random skin color
</span><span class="p">)</span>

<span class="c1"># Render the avatar as SVG
</span><span class="n">avatar</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"avatar.svg"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="code-explanation">Code Explanation</h2>

<h3 id="1-importing-libraries">1. Importing Libraries</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">python_avatars</span> <span class="k">as</span> <span class="n">pa</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="k">as</span> <span class="n">r</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">python_avatars</code> → main library to create avatars</li>
  <li><code class="language-plaintext highlighter-rouge">random</code> → choose random features</li>
</ul>

<h3 id="2-creating-an-avatar">2. Creating an Avatar</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">avatar</span> <span class="o">=</span> <span class="n">pa</span><span class="p">.</span><span class="n">Avatar</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">AvatarStyle</span><span class="p">.</span><span class="n">CIRCLE</span><span class="p">,</span>
    <span class="o">**</span><span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">enum</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">enum</span> <span class="ow">in</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">skin_color</span><span class="o">=</span><span class="sa">f</span><span class="s">"#</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mh">0xFFFFFF</span><span class="p">)</span><span class="si">:</span><span class="mi">06</span><span class="n">x</span><span class="si">}</span><span class="s">"</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">style=pa.AvatarStyle.CIRCLE</code> → gives your avatar a circular shape</li>
  <li><code class="language-plaintext highlighter-rouge">**{p: r.choice(list(enum)) ...}</code> → randomly selects a value for each attribute</li>
  <li><code class="language-plaintext highlighter-rouge">skin_color=f"#{r.randint(0,0xFFFFFF):06x}"</code> → random hexadecimal color for skin</li>
</ul>

<h3 id="3-random-features">3. Random Features</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">background_color</code> → random background</li>
  <li><code class="language-plaintext highlighter-rouge">top</code> → hair or hat type</li>
  <li><code class="language-plaintext highlighter-rouge">eyes</code>, <code class="language-plaintext highlighter-rouge">mouth</code> → facial features</li>
  <li><code class="language-plaintext highlighter-rouge">clothing</code> → shirt or outfit</li>
  <li><code class="language-plaintext highlighter-rouge">hair_color</code>, <code class="language-plaintext highlighter-rouge">clothing_color</code> → random colors</li>
</ul>

<h3 id="4-rendering-the-avatar">4. Rendering the Avatar</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">avatar</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"avatar.svg"</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Saves your generated avatar as <code class="language-plaintext highlighter-rouge">avatar.svg</code> in the current folder</li>
  <li>You can open it in any browser or SVG viewer</li>
</ul>

<hr />

<h2 id="running-the-script">Running the Script</h2>

<ol>
  <li>Save the file as <strong><code class="language-plaintext highlighter-rouge">avatar_gen.py</code></strong></li>
  <li>Open your terminal and navigate to the folder</li>
  <li>Run:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python avatar_gen.py
</code></pre></div></div>

<ol>
  <li>Check the folder for <strong><code class="language-plaintext highlighter-rouge">avatar.svg</code></strong> and open it in a browser</li>
</ol>

<hr />

<h2 id="customizing-your-avatars">Customizing Your Avatars</h2>

<p>You can change features manually:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">avatar</span> <span class="o">=</span> <span class="n">pa</span><span class="p">.</span><span class="n">Avatar</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">AvatarStyle</span><span class="p">.</span><span class="n">CIRCLE</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">HairType</span><span class="p">.</span><span class="n">LONG</span><span class="p">,</span>
    <span class="n">eyes</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">EyeType</span><span class="p">.</span><span class="n">HAPPY</span><span class="p">,</span>
    <span class="n">mouth</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">MouthType</span><span class="p">.</span><span class="n">SMILE</span><span class="p">,</span>
    <span class="n">background_color</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">BackgroundColor</span><span class="p">.</span><span class="n">BLUE</span><span class="p">,</span>
    <span class="n">skin_color</span><span class="o">=</span><span class="s">"#FFCCAA"</span><span class="p">,</span>
    <span class="n">hair_color</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">HairColor</span><span class="p">.</span><span class="n">BLACK</span><span class="p">,</span>
    <span class="n">clothing</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">ClothingType</span><span class="p">.</span><span class="n">SHIRT</span><span class="p">,</span>
    <span class="n">clothing_color</span><span class="o">=</span><span class="n">pa</span><span class="p">.</span><span class="n">ClothingColor</span><span class="p">.</span><span class="n">RED</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This allows you to create <strong>unique avatars</strong> instead of fully random ones.</p>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>You now know how to:</p>

<ul>
  <li>Generate random avatars in Python</li>
  <li>Customize avatar features</li>
  <li>Save avatars as SVG files</li>
</ul>

<p>This is perfect for profile pictures, games, or web projects.<br />
Experiment with different styles, colors, and shapes to make avatars <strong>truly unique</strong>!</p>

<hr />

<p><strong>Website:</strong> https://www.pyshine.com<br />
<strong>Author:</strong> PyShine</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="avatar" /><category term="SVG" /><category term="python_avatars" /><category term="beginner" /><category term="tutorial" /><summary type="html"><![CDATA[Beginner-friendly tutorial to create random avatars in Python using python_avatars. Step-by-step guide to generate personalized SVG avatars.]]></summary></entry><entry><title type="html">FastAPI Lab2 – Personalized Jokes API with Categories</title><link href="https://www.pyshine.com/Lab2-Personalized-Jokes-API-with-Categories/" rel="alternate" type="text/html" title="FastAPI Lab2 – Personalized Jokes API with Categories" /><published>2025-11-20T00:00:00+00:00</published><updated>2025-11-20T00:00:00+00:00</updated><id>https://www.pyshine.com/Lab2-Personalized-Jokes-API-with-Categories</id><content type="html" xml:base="https://www.pyshine.com/Lab2-Personalized-Jokes-API-with-Categories/"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>Welcome to <strong>Lab 2</strong> of your FastAPI learning journey!
In the previous lab, you built a basic Jokes API.
Now, it’s time to <strong>upgrade your API</strong> by adding <strong>categories</strong> and <strong>query parameters</strong>.</p>

<p>This tutorial is beginner‑friendly and explains everything step-by-step.</p>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/CHAl7isKo9c" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<p>By the end of this lab, you will know how to:</p>

<ul>
  <li>Add query parameters to FastAPI routes</li>
  <li>Pass values dynamically through URLs</li>
  <li>Create customized API responses</li>
  <li>Use PyJokes categories</li>
</ul>

<hr />

<h2 id="understanding-the-requirements">Understanding the Requirements</h2>

<p>You will build an API that:</p>

<ul>
  <li>Accepts a query parameter named <code class="language-plaintext highlighter-rouge">category</code></li>
  <li>Supports multiple categories:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">neutral</code></li>
      <li><code class="language-plaintext highlighter-rouge">chuck</code></li>
      <li><code class="language-plaintext highlighter-rouge">all</code></li>
    </ul>
  </li>
  <li>Returns a random joke from the selected category</li>
  <li>Prints the selected category and joke in the console for debugging</li>
</ul>

<hr />

<h2 id="setting-up">Setting Up</h2>

<p>Install the required packages:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>fastapi uvicorn pyjokes
</code></pre></div></div>

<p>Create a file named <strong><code class="language-plaintext highlighter-rouge">main.py</code></strong>.</p>

<hr />

<h2 id="writing-the-api-code">Writing the API Code</h2>

<p>Here is your full Lab 2 code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Lab2: Personalized Jokes API with Categories
# pip install fastapi uvicorn pyjokes
# Command to run app: 
# python -m uvicorn main:app --reload
</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Query</span>
<span class="kn">import</span> <span class="nn">pyjokes</span> 

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/joke"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">tell_a_joke</span><span class="p">(</span><span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
    <span class="n">default</span><span class="o">=</span><span class="s">"neutral"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">"Category of Joke: neutral, chuck, all"</span>
<span class="p">)):</span>
    <span class="s">"""
    Returns a random joke.
    Optional query parameter: category (default: neutral)
    """</span>
    <span class="n">joke</span> <span class="o">=</span> <span class="n">pyjokes</span><span class="p">.</span><span class="n">get_joke</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Category: </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s"> | Joke: </span><span class="si">{</span><span class="n">joke</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"category"</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span> <span class="s">"joke"</span><span class="p">:</span> <span class="n">joke</span><span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="code-explanation">Code Explanation</h2>

<h3 id="1-importing-modules">1. Importing Modules</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Query</span>
<span class="kn">import</span> <span class="nn">pyjokes</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Query</code> allows you to define query parameters with defaults and descriptions.</li>
</ul>

<h3 id="2-creating-the-app">2. Creating the App</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="3-defining-the-endpoint">3. Defining the Endpoint</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/joke"</span><span class="p">)</span>
</code></pre></div></div>

<p>This means:</p>

<blockquote>
  <p>When someone visits <code class="language-plaintext highlighter-rouge">/joke</code>, run the following function.</p>
</blockquote>

<h3 id="4-adding-a-query-parameter">4. Adding a Query Parameter</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">category</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">"neutral"</span><span class="p">,</span>
                      <span class="n">description</span><span class="o">=</span><span class="s">"Category of Joke: neutral, chuck, all"</span><span class="p">)</span>
</code></pre></div></div>

<p>This allows the user to request:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/joke?category=neutral
/joke?category=chuck
/joke?category=all
</code></pre></div></div>

<p>If no category is given, it defaults to <code class="language-plaintext highlighter-rouge">"neutral"</code>.</p>

<h3 id="5-getting-the-joke">5. Getting the Joke</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">joke</span> <span class="o">=</span> <span class="n">pyjokes</span><span class="p">.</span><span class="n">get_joke</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
</code></pre></div></div>

<p>PyJokes automatically selects a random joke from that category.</p>

<h3 id="6-returning-json-response">6. Returning JSON Response</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="p">{</span><span class="s">"category"</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span> <span class="s">"joke"</span><span class="p">:</span> <span class="n">joke</span><span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="running-the-api">Running the API</h2>

<p>Run the server using:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> uvicorn main:app <span class="nt">--reload</span>
</code></pre></div></div>

<hr />

<h2 id="testing-your-api">Testing Your API</h2>

<p>Open your browser or use curl/Postman:</p>

<h3 id="neutral-jokes-default">Neutral jokes (default)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/joke
</code></pre></div></div>

<h3 id="chuck-norris-jokes">Chuck Norris jokes:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/joke?category=chuck
</code></pre></div></div>

<h3 id="all-jokes">All jokes:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/joke?category=all
</code></pre></div></div>

<hr />

<h2 id="automatic-api-documentation">Automatic API Documentation</h2>

<p>FastAPI gives you free docs again!</p>

<h3 id="swagger-ui">Swagger UI</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/docs
</code></pre></div></div>

<h3 id="redoc">ReDoc</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/redoc
</code></pre></div></div>

<p>Here you can test the <code class="language-plaintext highlighter-rouge">category</code> query parameter interactively.</p>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>In this lab, you learned how to:</p>

<ul>
  <li>Add query parameters with defaults</li>
  <li>Make your API dynamic</li>
  <li>Personalize responses</li>
  <li>Use PyJokes categories</li>
  <li>Read logs printed in your server console</li>
</ul>

<p>You now have a flexible Jokes API that users can interact with!</p>

<hr />

<p><strong>Website:</strong> https://www.pyshine.com
<strong>Author:</strong> PyShine</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="fastapi" /><category term="api" /><category term="backend" /><category term="tutorial" /><category term="beginner" /><summary type="html"><![CDATA[FastAPI Lab 2 – Build a Personalized Jokes API with categories using FastAPI and PyJokes. Beginner-friendly step-by-step tutorial.]]></summary></entry><entry><title type="html">FastAPI Lab1 – Build Your First Joke API</title><link href="https://www.pyshine.com/Lab1-of-FastAPI-for-Beginners/" rel="alternate" type="text/html" title="FastAPI Lab1 – Build Your First Joke API" /><published>2025-11-17T00:00:00+00:00</published><updated>2025-11-17T00:00:00+00:00</updated><id>https://www.pyshine.com/Lab1-of-FastAPI-for-Beginners</id><content type="html" xml:base="https://www.pyshine.com/Lab1-of-FastAPI-for-Beginners/"><![CDATA[<h2 id="introduction">Introduction</h2>

<p>FastAPI is one of the fastest-growing Python frameworks for building APIs.
It is <strong>super fast</strong>, easy to learn, and perfect for beginners.</p>

<p>In this tutorial, you’ll build your <strong>first FastAPI application</strong> — a simple API that returns a random joke using the <code class="language-plaintext highlighter-rouge">pyjokes</code> library.</p>

<p>This guide is written for <strong>absolute beginners</strong>, so no prior backend experience is required.</p>

<div class="video-container">
  <iframe width="560" height="315" src="https://www.youtube.com/embed/Q-14n6CqhGI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<hr />

<h2 id="understanding-the-requirements">Understanding the Requirements</h2>

<p>Before writing any code, let’s understand what tools we’ll use:</p>

<h3 id="what-you-need">What you need:</h3>

<ul>
  <li><strong>Python 3 installed</strong></li>
  <li>Basic understanding of functions and imports</li>
  <li>A terminal or command prompt</li>
  <li>Two simple Python libraries:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">fastapi</code></li>
      <li><code class="language-plaintext highlighter-rouge">uvicorn</code></li>
      <li><code class="language-plaintext highlighter-rouge">pyjokes</code></li>
    </ul>
  </li>
</ul>

<p>The application we build will:</p>

<ul>
  <li>Start a FastAPI server</li>
  <li>Provide an endpoint <code class="language-plaintext highlighter-rouge">/joke</code></li>
  <li>Return a random joke in JSON format when visited</li>
</ul>

<hr />

<h2 id="setting-up-your-environment">Setting Up Your Environment</h2>

<p>Open your terminal and install the required libraries:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>fastapi uvicorn pyjokes
</code></pre></div></div>

<p>To confirm installation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> pip show fastapi
python <span class="nt">-m</span> pip show uvicorn
python <span class="nt">-m</span> pip show pyjokes
</code></pre></div></div>

<p>Everything should show a valid version number.</p>

<hr />

<h2 id="creating-your-fastapi-app">Creating Your FastAPI App</h2>

<p>Create a new file called <strong><code class="language-plaintext highlighter-rouge">main.py</code></strong> and add the following code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">import</span> <span class="nn">pyjokes</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/joke"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">tell_joke</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">joke</span> <span class="p">:</span><span class="o">=</span> <span class="n">pyjokes</span><span class="p">.</span><span class="n">get_joke</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"joke"</span><span class="p">:</span> <span class="n">joke</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="code-explanation">Code Explanation</h3>

<h4 id="1-importing-modules">1. Importing Modules</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">import</span> <span class="nn">pyjokes</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">FastAPI</code> lets you create API endpoints easily.</li>
  <li><code class="language-plaintext highlighter-rouge">pyjokes</code> gives us ready-made programming jokes.</li>
</ul>

<h4 id="2-creating-an-app-instance">2. Creating an App Instance</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
</code></pre></div></div>

<p>This creates your FastAPI application. Think of it as the “brain” of your API.</p>

<h4 id="3-creating-an-endpoint">3. Creating an Endpoint</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/joke"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">tell_joke</span><span class="p">():</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@app.get("/joke")</code> tells FastAPI:
    <blockquote>
      <p>“When someone visits <code class="language-plaintext highlighter-rouge">/joke</code>, run the function below.”</p>

    </blockquote>
  </li>
</ul>

<h4 id="4-returning-a-joke">4. Returning a Joke</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="p">{</span><span class="s">"joke"</span><span class="p">:</span> <span class="n">joke</span><span class="p">}</span>
</code></pre></div></div>

<p>FastAPI automatically converts this Python dict into JSON.</p>

<hr />

<h2 id="running-the-fastapi-app">Running the FastAPI App</h2>

<p>Use the following command in the folder where <code class="language-plaintext highlighter-rouge">main.py</code> is saved:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> uvicorn main:app <span class="nt">--reload</span>
</code></pre></div></div>

<h3 id="what-this-means">What this means:</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">uvicorn</code> → server that runs FastAPI</li>
  <li><code class="language-plaintext highlighter-rouge">main</code> → the filename <code class="language-plaintext highlighter-rouge">main.py</code></li>
  <li><code class="language-plaintext highlighter-rouge">app</code> → the FastAPI instance inside that file</li>
  <li><code class="language-plaintext highlighter-rouge">--reload</code> → restart automatically whenever you edit the file</li>
</ul>

<hr />

<h2 id="testing-your-api">Testing Your API</h2>

<p>Once the server is running, open your browser and visit:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/joke
</code></pre></div></div>

<p>You should see something like:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"joke"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Why do programmers prefer dark mode? Because light attracts bugs!"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="bonus-automatic-documentation">Bonus: Automatic Documentation!</h2>

<p>FastAPI automatically generates documentation pages.</p>

<p>Open these:</p>

<h3 id="swagger-ui">Swagger UI</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/docs
</code></pre></div></div>

<h3 id="redoc">ReDoc</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://127.0.0.1:8000/redoc
</code></pre></div></div>

<p><img src="https://www.pyshine.com/assets/img/posts/2025-11-17-Lab1-of-FastAPI-for-Beginners/1763597234731.png" alt="1763597234731" /></p>

<p>You get beautiful, interactive API docs <strong>for free</strong>.</p>

<hr />

<h2 id="complete-source-code">Complete Source Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pip install fastapi uvicorn pyjokes
</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">import</span> <span class="nn">pyjokes</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/joke"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">tell_joke</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">joke</span> <span class="p">:</span><span class="o">=</span> <span class="n">pyjokes</span><span class="p">.</span><span class="n">get_joke</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"joke"</span><span class="p">:</span> <span class="n">joke</span><span class="p">}</span>

<span class="c1"># Run using:
# python -m uvicorn main:app --reload
</span></code></pre></div></div>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>You have now built your <strong>first FastAPI project</strong>!</p>

<p>You learned:</p>

<ul>
  <li>How to install FastAPI</li>
  <li>How to create an API endpoint</li>
  <li>How to return JSON responses</li>
  <li>How to run a development server</li>
  <li>How to access auto-generated API docs</li>
</ul>

<p>This is only the beginning — FastAPI can handle authentication, databases, async tasks, and much more.</p>

<p>Happy coding!</p>

<hr />

<p><strong>Website:</strong> https://www.pyshine.com
<strong>Author:</strong> PyShine</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="fastapi" /><category term="api" /><category term="webdev" /><category term="backend" /><category term="beginner" /><category term="tutorial" /><summary type="html"><![CDATA[A complete beginner-friendly FastAPI tutorial. Learn how to build a simple API that returns random jokes using FastAPI and PyJokes.]]></summary></entry></feed>