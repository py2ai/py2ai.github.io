<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://www.pyshine.com/atom.xml" rel="self" type="application/atom+xml" /><link href="https://www.pyshine.com/" rel="alternate" type="text/html" hreflang="en" /><updated>2025-11-07T12:49:47+00:00</updated><id>https://www.pyshine.com/atom.xml</id><title type="html">PyShine</title><subtitle>Simple and practical Python tutorials for everyone. Learn, build, and explore AI and coding step by step — no jargon, just clear explanations.</subtitle><author><name>PyShine Team</name></author><entry><title type="html">Create Excel Files with Python – Complete Beginner’s Guide</title><link href="https://www.pyshine.com/Make-Excel-File-Quickly-in-Python/" rel="alternate" type="text/html" title="Create Excel Files with Python – Complete Beginner’s Guide" /><published>2025-11-07T00:00:00+00:00</published><updated>2025-11-07T00:00:00+00:00</updated><id>https://www.pyshine.com/Make-Excel-File-Quickly-in-Python</id><content type="html" xml:base="https://www.pyshine.com/Make-Excel-File-Quickly-in-Python/"><![CDATA[<h1 id="create-excel-files-with-python--complete-beginners-guide">Create Excel Files with Python – Complete Beginner’s Guide</h1>

<h3 id="learn-how-to-automate-excel-file-creation-with-pythons-openpyxl-library">Learn How to Automate Excel File Creation with Python’s openpyxl Library</h3>

<p>Excel spreadsheets are everywhere in the business world, but did you know you can create them automatically using Python? This beginner-friendly tutorial will teach you how to generate Excel files with multiple sheets using the <strong>openpyxl</strong> library. You’ll learn everything from installation to creating organized data sheets – perfect for automating reports or organizing data!</p>

<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#what-were-building">What We’re Building</a></li>
  <li><a href="#why-use-python-for-excel">Why Use Python for Excel?</a></li>
  <li><a href="#step-0-installing-openpyxl">Step 0: Installing openpyxl</a></li>
  <li><a href="#step-1-importing-the-library">Step 1: Importing the Library</a></li>
  <li><a href="#step-2-creating-your-first-workbook">Step 2: Creating Your First Workbook</a></li>
  <li><a href="#step-3-understanding-sheets-and-active-sheet">Step 3: Understanding Sheets and Active Sheet</a></li>
  <li><a href="#step-4-naming-your-first-sheet">Step 4: Naming Your First Sheet</a></li>
  <li><a href="#step-5-adding-data-to-cells">Step 5: Adding Data to Cells</a></li>
  <li><a href="#step-6-adding-multiple-rows-with-append">Step 6: Adding Multiple Rows with append()</a></li>
  <li><a href="#step-7-creating-a-second-sheet">Step 7: Creating a Second Sheet</a></li>
  <li><a href="#step-8-organizing-related-data">Step 8: Organizing Related Data</a></li>
  <li><a href="#step-9-saving-your-excel-file">Step 9: Saving Your Excel File</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#understanding-the-output">Understanding the Output</a></li>
  <li><a href="#common-mistakes-to-avoid">Common Mistakes to Avoid</a></li>
  <li><a href="#next-steps">Next Steps</a></li>
</ul>

<hr />

<h2 id="what-were-building">What We’re Building</h2>

<p>In this tutorial, we’ll create an Excel file called <strong>“garden_data.xlsx”</strong> that contains two sheets:</p>

<ol>
  <li><strong>“Trees” sheet</strong>: Lists different types of trees and their heights</li>
  <li><strong>“Fruits” sheet</strong>: Shows fruits and their colors</li>
</ol>

<p>This demonstrates how to organize related but separate data in different tabs within the same Excel file.</p>

<hr />

<h2 id="why-use-python-for-excel">Why Use Python for Excel?</h2>

<ul>
  <li><strong>Automate repetitive tasks</strong>: Generate weekly/monthly reports automatically</li>
  <li><strong>Handle large datasets</strong>: Process thousands of rows efficiently</li>
  <li><strong>Integrate with other systems</strong>: Pull data from databases or APIs into Excel</li>
  <li><strong>Reduce errors</strong>: Eliminate manual copy-paste mistakes</li>
  <li><strong>Schedule tasks</strong>: Run Python scripts to update Excel files automatically</li>
</ul>

<hr />

<h2 id="step-0-installing-openpyxl">Step 0: Installing openpyxl</h2>

<p>Before we start coding, we need to install the openpyxl library. Open your command prompt or terminal and type:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>openpyxl
</code></pre></div></div>
<h3 id="what-is-pip">What is pip?</h3>

<p>pip is Python’s package manager that helps install external libraries</p>

<p>It comes automatically with Python (if you installed Python from python.org)</p>

<h3 id="verifying-installation">Verifying Installation:</h3>
<p>After installation, you can verify it worked by opening Python and typing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import openpyxl
</code></pre></div></div>

<p>If no error appears, you’re ready to go!</p>

<hr />

<h2 id="step-1-importing-the-library">Step 1: Importing the Library</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from openpyxl import Workbook
</code></pre></div></div>

<p>Let’s break this down:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">from openpyxl</code>: We’re taking something from the openpyxl library</li>
  <li><code class="language-plaintext highlighter-rouge">import Workbook</code>: We’re specifically importing the Workbook class</li>
</ul>

<h3 id="whats-a-workbook">What’s a Workbook?</h3>

<ul>
  <li>In Excel terms, a Workbook is the entire Excel file (the .xlsx file)</li>
  <li>It can contain multiple Sheets (the tabs you see at the bottom)</li>
  <li>The Workbook class is like a blueprint for creating Excel files</li>
</ul>

<hr />

<h2 id="step-2-creating-your-first-workbook">Step 2: Creating Your First Workbook</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a new Excel workbook
</span><span class="n">workbook</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">()</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">"garden_data.xlsx"</span>
</code></pre></div></div>

<h3 id="understanding-this-code">Understanding this code:</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">workbook = Workbook()</code>: Creates a new, empty Excel workbook in memory</li>
  <li>Think of this as opening Excel and creating a “New Blank Workbook”</li>
  <li><code class="language-plaintext highlighter-rouge">filename = "garden_data.xlsx"</code>: Sets the name for our output file</li>
</ul>

<h3 id="important-notes">Important Notes:</h3>

<ul>
  <li>The workbook exists only in computer memory until we save it</li>
  <li>We can name our file anything, but .xlsx is the standard Excel extension</li>
</ul>

<hr />

<h2 id="step-3-understanding-sheets-and-active-sheet">Step 3: Understanding Sheets and Active Sheet</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># The default workbook starts with one sheet
sheet1 = workbook.active
</code></pre></div></div>

<h3 id="what-is-a-sheet">What is a Sheet?</h3>

<ul>
  <li>Sheets are the individual tabs in an Excel file</li>
  <li>By default, every new Excel workbook starts with one sheet (usually named “Sheet1”)</li>
</ul>

<h3 id="what-does-active-mean">What does <code class="language-plaintext highlighter-rouge">.active</code> mean?</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">workbook.active</code> gets the currently active (selected) sheet</li>
  <li>Since we just created the workbook, there’s only one sheet, so it’s automatically active</li>
</ul>

<hr />

<h2 id="step-4-naming-your-first-sheet">Step 4: Naming Your First Sheet</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sheet1</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Trees"</span>
</code></pre></div></div>

<h3 id="why-rename-sheets">Why rename sheets?</h3>

<ul>
  <li>Default names like “Sheet1” aren’t descriptive</li>
  <li>Good sheet names help people understand what data they contain</li>
  <li>In our case, “Trees” clearly indicates this sheet contains tree data</li>
</ul>

<h3 id="sheet-name-rules">Sheet Name Rules:</h3>

<ul>
  <li>Maximum 31 characters</li>
  <li>Cannot contain: <code class="language-plaintext highlighter-rouge">: \ / ? * [ ]</code></li>
  <li>Cannot be blank</li>
</ul>

<hr />

<h2 id="step-5-adding-data-to-cells">Step 5: Adding Data to Cells</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add data to the Trees sheet
</span><span class="n">sheet1</span><span class="p">[</span><span class="s">"A1"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Tree Name"</span>   <span class="c1"># First Column
</span><span class="n">sheet1</span><span class="p">[</span><span class="s">"B1"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Height (m)"</span>  <span class="c1"># Second Column
</span></code></pre></div></div>

<h3 id="understanding-excel-cell-references">Understanding Excel Cell References:</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">A1</code> means Column A, Row 1</li>
  <li><code class="language-plaintext highlighter-rouge">B1</code> means Column B, Row 1</li>
  <li>This is the same coordinate system you use in Excel</li>
</ul>

<h3 id="what-were-creating">What we’re creating:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| A        | B          |
|----------|------------|
| Tree Name| Height (m) |
</code></pre></div></div>

<h3 id="why-add-headers">Why add headers?</h3>

<ul>
  <li>Headers describe what each column contains</li>
  <li>Makes your data understandable to others</li>
  <li>Follows good data organization practices</li>
</ul>

<hr />

<h2 id="step-6-adding-multiple-rows-with-append">Step 6: Adding Multiple Rows with append()</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sheet1</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Mango"</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>   <span class="c1"># First Row
</span><span class="n">sheet1</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Apple"</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>    <span class="c1"># Second Row
</span><span class="n">sheet1</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Banana"</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>   <span class="c1"># Third Row
</span></code></pre></div></div>

<h3 id="how-append-works">How append() works:</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">append()</code> adds a new row at the bottom of your data</li>
  <li>Each item in the list becomes a cell in that row</li>
  <li><code class="language-plaintext highlighter-rouge">["Mango", 10]</code> becomes: Cell A2 = “Mango”, Cell B2 = 10</li>
</ul>

<h3 id="visualizing-the-data">Visualizing the data:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| A         | B          |
|-----------|------------|
| Tree Name | Height (m) |
| Mango     | 10         |
| Apple     | 6          |
| Banana    | 5          |
</code></pre></div></div>

<h3 id="why-use-append-instead-of-cell-references">Why use append() instead of cell references?</h3>

<ul>
  <li>Faster for adding multiple rows</li>
  <li>Less error-prone than manually tracking row numbers</li>
  <li>More readable code</li>
</ul>

<hr />

<h2 id="step-7-creating-a-second-sheet">Step 7: Creating a Second Sheet</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create another sheet for Fruits
</span><span class="n">sheet2</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">.</span><span class="n">create_sheet</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Fruits"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="multiple-sheets-organization">Multiple Sheets Organization:</h3>

<ul>
  <li>
    <p>Different types of data belong in different sheets</p>
  </li>
  <li>
    <p>“Trees” sheet: Information about trees</p>
  </li>
  <li>
    <p>“Fruits” sheet: Information about fruits</p>
  </li>
  <li>
    <p>This keeps related data together and separate from unrelated data</p>
  </li>
</ul>

<h3 id="what-happens-behind-the-scenes">What happens behind the scenes:</h3>

<ul>
  <li>Python creates a new sheet tab in the workbook</li>
  <li>The new sheet becomes the active sheet temporarily</li>
  <li>We now have two sheets: “Trees” and “Fruits”</li>
</ul>

<hr />

<h2 id="step-8-organizing-related-data">Step 8: Organizing Related Data</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sheet2</span><span class="p">[</span><span class="s">"A1"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Fruit Name"</span>
<span class="n">sheet2</span><span class="p">[</span><span class="s">"B1"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Color"</span>
<span class="n">sheet2</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Mango"</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">])</span>
<span class="n">sheet2</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Apple"</span><span class="p">,</span> <span class="s">"Red"</span><span class="p">])</span>
<span class="n">sheet2</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Banana"</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="creating-consistent-structure">Creating Consistent Structure:</h3>

<ul>
  <li>Both sheets have similar layouts (headers in row 1, data below)</li>
  <li>This makes the Excel file easy to navigate and understand</li>
  <li>Notice how “Mango” appears in both sheets but with different information</li>
</ul>

<h2 id="the-fruits-sheet-looks-like">The Fruits sheet looks like:</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| A         | B      |
|-----------|--------|
| Fruit Name| Color  |
| Mango     | Yellow |
| Apple     | Red    |
| Banana    | Yellow |
</code></pre></div></div>

<hr />

<h2 id="step-9-saving-your-excel-file">Step 9: Saving Your Excel File</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Save the workbook
</span><span class="n">workbook</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s"> created, Trees and Fruits!"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="why-do-we-need-to-save">Why do we need to save?</h2>

<ul>
  <li>Until now, everything existed only in computer memory</li>
  <li><code class="language-plaintext highlighter-rouge">workbook.save()</code> writes the data to an actual file on your computer</li>
  <li>Without saving, your work would be lost when the program ends</li>
</ul>

<h2 id="file-location">File Location:</h2>

<ul>
  <li>The file saves in the same folder where your Python script is running</li>
  <li>You can specify a path: <code class="language-plaintext highlighter-rouge">workbook.save("C:/Users/Name/Documents/garden_data.xlsx")</code></li>
</ul>

<h3 id="the-print-statement">The print() statement:</h3>

<ul>
  <li>Provides confirmation that the script ran successfully</li>
  <li><code class="language-plaintext highlighter-rouge">f"{filename}"</code> inserts the filename into the message</li>
  <li>Output: <code class="language-plaintext highlighter-rouge">garden_data.xlsx created, Trees and Fruits!</code></li>
</ul>

<hr />

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># simple_excel_two_sheets.py
</span><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">Workbook</span>

<span class="c1"># Create a new Excel workbook
</span><span class="n">workbook</span> <span class="o">=</span> <span class="n">Workbook</span><span class="p">()</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">"garden_data.xlsx"</span>
<span class="c1"># The default workbook starts with one sheet
</span><span class="n">sheet1</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">.</span><span class="n">active</span>
<span class="n">sheet1</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"Trees"</span>

<span class="c1"># Add data to the Trees sheet
</span><span class="n">sheet1</span><span class="p">[</span><span class="s">"A1"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Tree Name"</span>   <span class="c1"># First Column
</span><span class="n">sheet1</span><span class="p">[</span><span class="s">"B1"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Height (m)"</span>  <span class="c1"># Second Column
</span><span class="n">sheet1</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Mango"</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span> <span class="c1"># First Row
</span><span class="n">sheet1</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Apple"</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>  <span class="c1"># Second Row
</span><span class="n">sheet1</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Banana"</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="c1"># Third Row
</span>
<span class="c1"># Create another sheet for Fruits
</span><span class="n">sheet2</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">.</span><span class="n">create_sheet</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Fruits"</span><span class="p">)</span>
<span class="n">sheet2</span><span class="p">[</span><span class="s">"A1"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Fruit Name"</span>
<span class="n">sheet2</span><span class="p">[</span><span class="s">"B1"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Color"</span>
<span class="n">sheet2</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Mango"</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">])</span>
<span class="n">sheet2</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Apple"</span><span class="p">,</span> <span class="s">"Red"</span><span class="p">])</span>
<span class="n">sheet2</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Banana"</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">])</span>

<span class="c1"># Save the workbook
</span><span class="n">workbook</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s"> created, Trees and Fruits!"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="understanding-the-output">Understanding the Output</h2>

<p>After running the code, you’ll find “garden_data.xlsx” in your project folder. When you open it:</p>

<h3 id="sheet-1---trees">Sheet 1 - “Trees”:</h3>

<ul>
  <li>Shows three types of trees with their heights</li>
  <li>Organized with clear headers</li>
  <li>Ready for further analysis or reporting</li>
</ul>

<h3 id="sheet-2---fruits">Sheet 2 - “Fruits”:</h3>

<ul>
  <li>Shows the same plants but focused on fruit characteristics</li>
  <li>Demonstrates how different aspects of related data can be separated</li>
</ul>

<h3 id="file-properties">File Properties:</h3>

<ul>
  <li>Format: Standard Excel (.xlsx) format</li>
  <li>Compatibility: Can be opened in Excel, Google Sheets, LibreOffice</li>
  <li>Structure: Professional-looking with proper headers and organization</li>
</ul>

<hr />

<h2 id="common-mistakes-to-avoid">Common Mistakes to Avoid</h2>

<ol>
  <li>Forgetting to save: Your work won’t be preserved without workbook.save()</li>
  <li>Incorrect cell references:
    <ul>
      <li>Wrong: <code class="language-plaintext highlighter-rouge">sheet1["1A"]</code> (number first)</li>
      <li>Right: <code class="language-plaintext highlighter-rouge">sheet1["A1"]</code> (letter first)</li>
    </ul>
  </li>
  <li>Missing installation: Forgetting to run <code class="language-plaintext highlighter-rouge">pip install openpyxl</code> first</li>
  <li>File permission issues: Trying to save to protected folders</li>
  <li>Overwriting files: Saving with same filename overwrites existing files</li>
</ol>

<hr />

<h2 id="next-steps">Next Steps</h2>

<p>Now that you can create basic Excel files, try these enhancements:</p>

<h3 id="add-more-data">Add More Data:</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add more tree data
</span><span class="n">sheet1</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Oak"</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>
<span class="n">sheet1</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="s">"Pine"</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

</code></pre></div></div>

<h3 id="format-cells">Format Cells:</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">openpyxl.styles</span> <span class="kn">import</span> <span class="n">Font</span>

<span class="c1"># Make headers bold
</span><span class="n">sheet1</span><span class="p">[</span><span class="s">"A1"</span><span class="p">].</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sheet1</span><span class="p">[</span><span class="s">"B1"</span><span class="p">].</span><span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="add-formulas">Add Formulas:</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calculate average height
</span><span class="n">sheet1</span><span class="p">[</span><span class="s">"A5"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Average Height:"</span>
<span class="n">sheet1</span><span class="p">[</span><span class="s">"B5"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"=AVERAGE(B2:B4)"</span>
</code></pre></div></div>

<h3 id="read-existing-files">Read Existing Files:</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>

<span class="c1"># Open the file we just created
</span><span class="n">workbook</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="s">"garden_data.xlsx"</span><span class="p">)</span>
<span class="n">sheet</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">.</span><span class="n">active</span>
<span class="k">print</span><span class="p">(</span><span class="n">sheet</span><span class="p">[</span><span class="s">"A2"</span><span class="p">].</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Prints "Mango"
</span></code></pre></div></div>

<hr />

<p>Congratulations! You’ve just automated Excel file creation using Python. This fundamental skill opens doors to automated reporting, data processing, and much more. The simple garden data example demonstrates principles you can apply to business reports, scientific data, or any structured information that needs organizing.</p>

<p><em>Try modifying the code to create your own custom Excel files – the possibilities are endless!</em></p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="excel" /><category term="openpyxl" /><category term="beginner" /><category term="data-processing" /><category term="tutorial" /><summary type="html"><![CDATA[Learn how to create Excel workbooks with multiple sheets using Python's openpyxl library. Step-by-step tutorial for absolute beginners.]]></summary></entry><entry><title type="html">Animated Flower Tree with Python Turtle – Growing &amp;amp; Falling Flowers</title><link href="https://www.pyshine.com/Tree-grow-and-falling-flowers/" rel="alternate" type="text/html" title="Animated Flower Tree with Python Turtle – Growing &amp;amp; Falling Flowers" /><published>2025-11-06T00:00:00+00:00</published><updated>2025-11-06T00:00:00+00:00</updated><id>https://www.pyshine.com/Tree-grow-and-falling-flowers</id><content type="html" xml:base="https://www.pyshine.com/Tree-grow-and-falling-flowers/"><![CDATA[<h1 id="animated-flower-tree-with-python-turtle--growing--falling-flowers">Animated Flower Tree with Python Turtle – Growing &amp; Falling Flowers</h1>

<h3 id="create-stunning-animated-nature-scenes-with-pythons-built-in-turtle-module">Create Stunning Animated Nature Scenes with Python’s Built-in Turtle Module</h3>

<p>Python’s Turtle graphics module isn’t just for simple shapes – it can create beautiful, complex animations with physics simulations! This tutorial shows you how to build an <strong>animated flowering tree</strong> where blossoms gradually grow on branches and then gently fall with realistic physics. You’ll learn recursive tree generation, color blending, growth animation, and basic physics simulation – all with pure Python.</p>

<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#what-youll-learn">What You’ll Learn</a></li>
  <li><a href="#step-1-setting-up-the-environment">Step 1: Setting Up the Environment</a></li>
  <li><a href="#step-2-generating-the-tree-structure">Step 2: Generating the Tree Structure</a></li>
  <li><a href="#step-3-color-blending-for-natural-look">Step 3: Color Blending for Natural Look</a></li>
  <li><a href="#step-4-drawing-flowers-with-growth-animation">Step 4: Drawing Flowers with Growth Animation</a></li>
  <li><a href="#step-5-physics-for-falling-flowers">Step 5: Physics for Falling Flowers</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-it-works">How It Works</a></li>
  <li><a href="#customization-ideas">Customization Ideas</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
</ul>

<hr />

<h2 id="overview">Overview</h2>

<p>This project creates a <strong>procedurally generated tree</strong> with these animated features:</p>

<ol>
  <li><strong>Recursive tree generation</strong> with random branching angles</li>
  <li><strong>Color blending</strong> from brown trunk to green branches</li>
  <li><strong>Gradual flower growth</strong> animation</li>
  <li><strong>Realistic flower falling</strong> with gravity and wind physics</li>
  <li><strong>Natural swaying motion</strong> for attached flowers</li>
</ol>

<hr />

<h2 id="what-youll-learn">What You’ll Learn</h2>

<ul>
  <li><strong>Recursive algorithms</strong> for tree generation</li>
  <li><strong>Turtle graphics</strong> advanced techniques</li>
  <li><strong>Color theory</strong> and RGB blending</li>
  <li><strong>Animation principles</strong> with growth stages</li>
  <li><strong>Basic physics simulation</strong> (gravity, wind, rotation)</li>
  <li><strong>Object-oriented thinking</strong> with flower data structures</li>
</ul>

<hr />

<h2 id="step-1-setting-up-the-environment">Step 1: Setting Up the Environment</h2>

<p>We start by importing necessary modules and setting up configuration constants.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span> 
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">seed</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Settings 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span>          <span class="c1"># Window dimensions
</span><span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">7</span>                <span class="c1"># Recursion depth for tree
</span><span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>              <span class="c1"># Initial branch length
</span><span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>                  <span class="c1"># Base branching angle
</span><span class="n">GRAVITY</span> <span class="o">=</span> <span class="mf">1.5</span>            <span class="c1"># Physics constants
</span><span class="n">WIND</span> <span class="o">=</span> <span class="mf">2.0</span>               <span class="c1"># Wind strength
</span><span class="n">FPS</span> <span class="o">=</span> <span class="mf">0.02</span>               <span class="c1"># Animation frame delay
</span><span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>                <span class="c1"># Seed for reproducible randomness
</span>
<span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>

</code></pre></div></div>

<p>Key Settings Explained:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DEPTH</code> Controls how detailed the tree is (higher = more branches)</li>
  <li><code class="language-plaintext highlighter-rouge">LENGTH</code> Starting branch length in pixels</li>
  <li><code class="language-plaintext highlighter-rouge">GRAVITY/WIND</code> Physics parameters for falling animation</li>
  <li><code class="language-plaintext highlighter-rouge">seed(192)</code> Ensures the same tree generates every time</li>
</ul>

<hr />

<h2 id="step-2-generating-the-tree-structure">Step 2: Generating the Tree Structure</h2>

<p>We use recursion to generate tree parameters before drawing.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s">"""Recursively generate tree branch parameters"""</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    
    <span class="c1"># Randomize angles and lengths for natural look
</span>    <span class="n">a1</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Child branches are shorter
</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    
    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
    
    <span class="c1"># Recursive calls for sub-branches
</span>    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="s">"""Generator for branch parameters"""</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>

</code></pre></div></div>

<p>How Recursion Works:</p>

<ul>
  <li>Each branch splits into two sub-branches</li>
  <li>Sub-branches have randomized angles and lengths</li>
  <li>Process continues until depth reaches 0</li>
  <li>Parameters are stored for consistent drawing</li>
</ul>

<hr />

<h2 id="step-3-color-blending-for-natural-look">Step 3: Color Blending for Natural Look</h2>

<p>We blend colors from brown (trunk) to green (branches) based on branch level.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="s">"""Linear color interpolation between two RGB colors"""</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># Usage in drawing:
</span><span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEPTH</span> <span class="o">-</span> <span class="n">depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">DEPTH</span>  <span class="c1"># Normalized position (0=trunk, 1=tip)
</span><span class="n">brown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">69</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">19</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
<span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
<span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blend</span><span class="p">(</span><span class="n">brown</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="color-theory">Color Theory:</h3>

<ul>
  <li>Brown trunk: (139/255, 69/255, 19/255) - earthy, strong</li>
  <li>Green tips: (34/255, 139/255, 34/255) - vibrant, leafy</li>
  <li>Linear interpolation: Creates smooth color transitions</li>
</ul>

<hr />

<h2 id="step-4-drawing-flowers-with-growth-animation">Step 4: Drawing Flowers with Growth Animation</h2>

<p>Flowers are drawn as pentagram shapes with gradual growth animation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_flower_at_position</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">growth_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="s">"""Draw a flower at specific position with growth animation"""</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">setheading</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>
    
    <span class="c1"># Apply growth factor to size
</span>    <span class="n">current_size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">growth_factor</span>
    <span class="k">if</span> <span class="n">current_size</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># Don't draw if too small
</span>        <span class="k">return</span>
        
    <span class="n">pen</span><span class="p">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">begin_fill</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">current_size</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>  <span class="c1"># Draw petal
</span>        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>                 <span class="c1"># Turn for next petal
</span>    <span class="n">pen</span><span class="p">.</span><span class="n">end_fill</span><span class="p">()</span>
    
    <span class="c1"># Draw flower center
</span>    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">current_size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">animate_flower_growth</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">tree_pen</span><span class="p">,</span> <span class="n">flower_positions</span><span class="p">):</span>
    <span class="s">"""Animate flowers growing on the tree"""</span>
    <span class="n">flower_pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">flower_pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">flower_pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">flower_pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    
    <span class="n">growth_stages</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of growth stages
</span>    
    <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">growth_stages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">flower_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">growth_factor</span> <span class="o">=</span> <span class="n">stage</span> <span class="o">/</span> <span class="n">growth_stages</span>  <span class="c1"># 0 to 1
</span>        
        <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flower_positions</span><span class="p">:</span>
            <span class="n">draw_flower_at_position</span><span class="p">(</span>
                <span class="n">flower_pen</span><span class="p">,</span> 
                <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> 
                <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> 
                <span class="n">flower</span><span class="p">[</span><span class="s">'color'</span><span class="p">],</span> 
                <span class="n">flower</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span> 
                <span class="n">growth_factor</span><span class="o">=</span><span class="n">growth_factor</span>
            <span class="p">)</span>
        
        <span class="n">screen</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="growth-animation-features">Growth Animation Features:</h3>

<ul>
  <li>20 growth stages for smooth appearance</li>
  <li>Size scaling from 0% to 100%</li>
  <li>Separate turtle for flowers vs tree</li>
  <li>Controlled frame rate for smooth animation</li>
</ul>

<hr />

<h3 id="step-5-physics-for-falling-flowers">Step 5: Physics for Falling Flowers</h3>

<p>Realistic falling animation with gravity, wind, and rotation physics.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_flowers_fall</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">tree_pen</span><span class="p">,</span> <span class="n">flower_pen</span><span class="p">,</span> <span class="n">flower_positions</span><span class="p">):</span>
    <span class="s">"""Animate flowers falling with physics simulation"""</span>
    
    <span class="n">velocities</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store velocity for each flower
</span>    <span class="n">rotations</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># Store rotation for each flower
</span>    
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">flower_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="c1"># Randomly detach flowers over time
</span>        <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flower_positions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.03</span><span class="p">:</span>
                <span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">flower_id</span> <span class="o">=</span> <span class="n">flower</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
                
                <span class="c1"># Initialize physics properties
</span>                <span class="n">velocities</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">WIND</span><span class="p">,</span> <span class="n">WIND</span><span class="p">),</span>  <span class="c1"># Horizontal velocity (wind)
</span>                    <span class="o">-</span><span class="n">GRAVITY</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>  <span class="c1"># Vertical velocity
</span>                <span class="p">]</span>
                <span class="n">rotations</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>  <span class="c1"># Initial rotation
</span>        
        <span class="c1"># Update falling flowers
</span>        <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flower_positions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]:</span>
                <span class="n">flower_id</span> <span class="o">=</span> <span class="n">flower</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
                <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="n">velocities</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span>
                
                <span class="c1"># Apply physics
</span>                <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">vx</span>
                <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">vy</span>
                <span class="n">vy</span> <span class="o">-=</span> <span class="n">GRAVITY</span> <span class="o">*</span> <span class="mf">0.08</span>  <span class="c1"># Gravity acceleration
</span>                
                <span class="c1"># Air resistance and random movement
</span>                <span class="n">vx</span> <span class="o">*=</span> <span class="mf">0.998</span>
                <span class="n">vy</span> <span class="o">*=</span> <span class="mf">0.998</span>
                <span class="n">vx</span> <span class="o">+=</span> <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.008</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">)</span>
                
                <span class="c1"># Update rotation based on horizontal movement
</span>                <span class="n">rotations</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">+=</span> <span class="n">vx</span> <span class="o">*</span> <span class="mi">3</span>
                
                <span class="c1"># Ground collision
</span>                <span class="k">if</span> <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">20</span><span class="p">:</span>
                    <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">20</span>  <span class="c1"># Stop at ground
</span>                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
                        <span class="n">vy</span> <span class="o">=</span> <span class="o">-</span><span class="n">vy</span> <span class="o">*</span> <span class="mf">0.2</span>  <span class="c1"># Bounce
</span>                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vy</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Stop moving
</span>                
                <span class="n">velocities</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">]</span>
                
                <span class="c1"># Draw with current rotation
</span>                <span class="n">draw_flower_at_position</span><span class="p">(</span>
                    <span class="n">flower_pen</span><span class="p">,</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'color'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span> 
                    <span class="n">rotations</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span>
                <span class="p">)</span>
        
        <span class="n">screen</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="physics-simulation-elements">Physics Simulation Elements:</h3>

<ul>
  <li>Gravity: Constant downward acceleration</li>
  <li>Wind: Random horizontal movement</li>
  <li>Rotation: Flowers spin as they fall</li>
  <li>Air resistance: Velocity gradually decreases</li>
  <li>Ground collision: Realistic bouncing and stopping</li>
  <li>Random variations: Natural, non-uniform movement</li>
</ul>

<hr />

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># source code at www.pyshine.com
</span><span class="kn">import</span> <span class="nn">turtle</span> 
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">seed</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Settings 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">GRAVITY</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">WIND</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>

<span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>

<span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">draw_flower_at_position</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">growth_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="s">"""Draw a flower at a specific position with growth animation"""</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">setheading</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>
    
    <span class="c1"># Apply growth factor to size
</span>    <span class="n">current_size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">growth_factor</span>
    <span class="k">if</span> <span class="n">current_size</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># Don't draw if too small
</span>        <span class="k">return</span>
        
    <span class="n">pen</span><span class="p">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">begin_fill</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">current_size</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">end_fill</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">current_size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">draw_tree_with_flowers</span><span class="p">():</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Screen</span><span class="p">()</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Turtle Tree with Growing and Falling Flowers"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">"black"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">tracer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Turn off animation for initial drawing
</span>    
    <span class="c1"># Create main tree pen
</span>    <span class="n">tree_pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>

    <span class="c1"># Store flower positions during tree drawing
</span>    <span class="n">flower_positions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">draw_branch</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="s">"""Recursively draw tree branches and record flower positions."""</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Record leaf/flower position but don't draw yet
</span>            <span class="n">size</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
            <span class="n">flower_positions</span><span class="p">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">'x'</span><span class="p">:</span> <span class="n">tree_pen</span><span class="p">.</span><span class="n">xcor</span><span class="p">(),</span>
                <span class="s">'y'</span><span class="p">:</span> <span class="n">tree_pen</span><span class="p">.</span><span class="n">ycor</span><span class="p">(),</span>
                <span class="s">'color'</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                <span class="s">'size'</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                <span class="s">'attached'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">'grown'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>  <span class="c1"># Flower hasn't grown yet
</span>                <span class="s">'id'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">flower_positions</span><span class="p">)</span>  <span class="c1"># Unique ID for each flower
</span>            <span class="p">})</span>
            <span class="k">return</span>
            
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEPTH</span> <span class="o">-</span> <span class="n">depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">DEPTH</span>
        <span class="n">brown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">69</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">19</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blend</span><span class="p">(</span><span class="n">brown</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.12</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">DEPTH</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Record branch flower position but don't draw yet
</span>            <span class="n">size</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
            <span class="n">flower_positions</span><span class="p">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s">'x'</span><span class="p">:</span> <span class="n">tree_pen</span><span class="p">.</span><span class="n">xcor</span><span class="p">(),</span>
                <span class="s">'y'</span><span class="p">:</span> <span class="n">tree_pen</span><span class="p">.</span><span class="n">ycor</span><span class="p">(),</span>
                <span class="s">'color'</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                <span class="s">'size'</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                <span class="s">'attached'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="s">'grown'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>  <span class="c1"># Flower hasn't grown yet
</span>                <span class="s">'id'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">flower_positions</span><span class="p">)</span>  <span class="c1"># Unique ID for each flower
</span>            <span class="p">})</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>
            
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">draw_branch</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
        <span class="n">draw_branch</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="c1"># Draw the initial tree structure (without flowers)
</span>    <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>
    <span class="n">draw_branch</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
    
    <span class="n">screen</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>  <span class="c1"># Show the initial tree
</span>    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Tree structure complete. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">flower_positions</span><span class="p">)</span><span class="si">}</span><span class="s"> flower positions recorded."</span><span class="p">)</span>
    
    <span class="c1"># Now animate flowers growing
</span>    <span class="n">animate_flower_growth</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">tree_pen</span><span class="p">,</span> <span class="n">flower_positions</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">animate_flower_growth</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">tree_pen</span><span class="p">,</span> <span class="n">flower_positions</span><span class="p">):</span>
    <span class="s">"""Animate flowers growing on the tree"""</span>
    
    <span class="c1"># Create a separate pen for flowers
</span>    <span class="n">flower_pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">flower_pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">flower_pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">flower_pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"Flowers growing..."</span><span class="p">)</span>
    
    <span class="c1"># Grow flowers gradually
</span>    <span class="n">growth_stages</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of growth stages
</span>    <span class="n">breeze_phase</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">breeze_strength</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">breeze_frequency</span> <span class="o">=</span> <span class="mf">0.08</span>
    
    <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">growth_stages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">flower_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="c1"># Calculate breeze effect for subtle movement
</span>        <span class="n">breeze_phase</span> <span class="o">+=</span> <span class="n">breeze_frequency</span>
        <span class="n">current_breeze</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">breeze_phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">breeze_strength</span>
        
        <span class="c1"># Calculate growth factor (0 to 1)
</span>        <span class="n">growth_factor</span> <span class="o">=</span> <span class="n">stage</span> <span class="o">/</span> <span class="n">growth_stages</span>
        
        <span class="c1"># Draw each flower with current growth factor
</span>        <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flower_positions</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flower</span><span class="p">[</span><span class="s">'grown'</span><span class="p">]:</span>
                <span class="c1"># Slight sway with breeze
</span>                <span class="n">sway_x</span> <span class="o">=</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">stage</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span>
                
                <span class="n">draw_flower_at_position</span><span class="p">(</span>
                    <span class="n">flower_pen</span><span class="p">,</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+</span> <span class="n">sway_x</span><span class="p">,</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'color'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span> 
                    <span class="n">current_breeze</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">growth_factor</span>
                <span class="p">)</span>
        
        <span class="n">screen</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>
    
    <span class="c1"># Mark all flowers as fully grown
</span>    <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flower_positions</span><span class="p">:</span>
        <span class="n">flower</span><span class="p">[</span><span class="s">'grown'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"All flowers have grown!"</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Pause to show fully grown flowers
</span>    
    <span class="c1"># Now start the falling animation
</span>    <span class="n">make_flowers_fall</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">tree_pen</span><span class="p">,</span> <span class="n">flower_pen</span><span class="p">,</span> <span class="n">flower_positions</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_flowers_fall</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">tree_pen</span><span class="p">,</span> <span class="n">flower_pen</span><span class="p">,</span> <span class="n">initial_flowers</span><span class="p">):</span>
    <span class="s">"""Animate flowers falling from the tree"""</span>
    
    <span class="c1"># Create a separate pen for falling flowers
</span>    <span class="n">fall_pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">fall_pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">fall_pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fall_pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    
    <span class="c1"># Copy initial flowers for animation
</span>    <span class="n">flowers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">initial_flowers</span><span class="p">:</span>
        <span class="n">flowers</span><span class="p">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s">'x'</span><span class="p">:</span> <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span>
            <span class="s">'y'</span><span class="p">:</span> <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> 
            <span class="s">'color'</span><span class="p">:</span> <span class="n">flower</span><span class="p">[</span><span class="s">'color'</span><span class="p">],</span>
            <span class="s">'size'</span><span class="p">:</span> <span class="n">flower</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span>
            <span class="s">'attached'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">'grown'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">'id'</span><span class="p">:</span> <span class="n">flower</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
        <span class="p">})</span>
    
    <span class="c1"># Initialize velocities and rotations
</span>    <span class="n">velocities</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">rotations</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fallen_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">breeze_phase</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">breeze_strength</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">breeze_frequency</span> <span class="o">=</span> <span class="mf">0.08</span>

    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Flowers starting to fall..."</span><span class="p">)</span>

    <span class="c1"># Store which flowers are currently attached to the tree
</span>    <span class="n">attached_flowers</span> <span class="o">=</span> <span class="p">{</span><span class="n">flower</span><span class="p">[</span><span class="s">'id'</span><span class="p">]:</span> <span class="n">flower</span> <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flowers</span> <span class="k">if</span> <span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]}</span>
    
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">fall_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">flower_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear the flower pen to remove flowers from tree
</span>        
        <span class="c1"># Calculate breeze effect
</span>        <span class="n">breeze_phase</span> <span class="o">+=</span> <span class="n">breeze_frequency</span>
        <span class="n">current_breeze</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">breeze_phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">breeze_strength</span>

        <span class="c1"># Check for flowers starting to fall
</span>        <span class="n">flowers_to_detach</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flowers</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">frame_count</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> 
                <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.03</span> <span class="ow">and</span> <span class="n">frame_count</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">flowers_to_detach</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">flower</span><span class="p">[</span><span class="s">'id'</span><span class="p">])</span>
        
        <span class="c1"># Detach the flowers
</span>        <span class="k">for</span> <span class="n">flower_id</span> <span class="ow">in</span> <span class="n">flowers_to_detach</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flowers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flower</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span> <span class="o">==</span> <span class="n">flower_id</span> <span class="ow">and</span> <span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]:</span>
                    <span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">velocities</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">WIND</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">WIND</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">+</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">,</span>
                        <span class="o">-</span><span class="n">GRAVITY</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="n">rotations</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
                    <span class="n">fallen_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># Remove from attached flowers
</span>                    <span class="k">if</span> <span class="n">flower_id</span> <span class="ow">in</span> <span class="n">attached_flowers</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">attached_flowers</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span>
                    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"🌸 Flower </span><span class="si">{</span><span class="n">flower_id</span><span class="si">}</span><span class="s"> dropped! </span><span class="si">{</span><span class="n">fallen_count</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">flowers</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="c1"># Draw only the flowers that are still attached to the tree
</span>        <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">attached_flowers</span><span class="p">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]:</span>
                <span class="c1"># Draw attached flower with slight sway
</span>                <span class="n">sway_x</span> <span class="o">=</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">frame_count</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span>
                <span class="n">draw_flower_at_position</span><span class="p">(</span>
                    <span class="n">flower_pen</span><span class="p">,</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+</span> <span class="n">sway_x</span><span class="p">,</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'color'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span> 
                    <span class="n">current_breeze</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="p">)</span>

        <span class="c1"># Update and draw falling flowers
</span>        <span class="n">all_fallen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attached_flowers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">active_falling_flowers</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="k">for</span> <span class="n">flower</span> <span class="ow">in</span> <span class="n">flowers</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flower</span><span class="p">[</span><span class="s">'attached'</span><span class="p">]:</span>
                <span class="c1"># Update falling flower physics
</span>                <span class="n">flower_id</span> <span class="o">=</span> <span class="n">flower</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
                <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="n">velocities</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">flower_id</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                
                <span class="c1"># Apply physics
</span>                <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">vx</span> <span class="o">+</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.05</span>
                <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">vy</span>
                <span class="n">vy</span> <span class="o">-=</span> <span class="n">GRAVITY</span> <span class="o">*</span> <span class="mf">0.08</span>
                <span class="n">vx</span> <span class="o">+=</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.015</span> <span class="o">+</span> <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.008</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">)</span>
                <span class="n">vx</span> <span class="o">*=</span> <span class="mf">0.998</span>
                <span class="n">vy</span> <span class="o">*=</span> <span class="mf">0.998</span>
                
                <span class="c1"># Update rotation
</span>                <span class="k">if</span> <span class="n">flower_id</span> <span class="ow">in</span> <span class="n">rotations</span><span class="p">:</span>
                    <span class="n">rotations</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">+=</span> <span class="n">vx</span> <span class="o">*</span> <span class="mi">3</span>
                
                <span class="c1"># Ground collision
</span>                <span class="n">ground_level</span> <span class="o">=</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="n">flower</span><span class="p">[</span><span class="s">'size'</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.4</span> <span class="o">+</span> <span class="mi">20</span>
                <span class="k">if</span> <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ground_level</span><span class="p">:</span>
                    <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ground_level</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
                        <span class="n">vy</span> <span class="o">=</span> <span class="o">-</span><span class="n">vy</span> <span class="o">*</span> <span class="mf">0.2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vy</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">vx</span> <span class="o">*=</span> <span class="mf">0.8</span>
                
                <span class="n">velocities</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">]</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="n">rotations</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">flower_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                
                <span class="c1"># Draw falling flower
</span>                <span class="n">draw_flower_at_position</span><span class="p">(</span>
                    <span class="n">fall_pen</span><span class="p">,</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'color'</span><span class="p">],</span> 
                    <span class="n">flower</span><span class="p">[</span><span class="s">'size'</span><span class="p">],</span> 
                    <span class="n">rotation</span>
                <span class="p">)</span>
                
                <span class="k">if</span> <span class="n">vy</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">vx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">active_falling_flowers</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">screen</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>
        
        <span class="c1"># End condition: all flowers have fallen and stopped moving
</span>        <span class="k">if</span> <span class="n">all_fallen</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">active_falling_flowers</span> <span class="ow">and</span> <span class="n">frame_count</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"All </span><span class="si">{</span><span class="n">fallen_count</span><span class="si">}</span><span class="s"> flowers have fallen!"</span><span class="p">)</span>
    
    <span class="c1"># Keep the window open
</span>    <span class="n">screen</span><span class="p">.</span><span class="n">exitonclick</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">draw_tree_with_flowers</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="how-it-works">How It Works</h2>

<ul>
  <li>Tree Generation: Recursive algorithm builds tree structure with random variations</li>
  <li>Flower Placement: Flowers are positioned at branch endpoints during tree drawing</li>
  <li>Growth Animation: Flowers appear gradually over 20 animation frames</li>
  <li>Physics Simulation: Each flower gets velocity and rotation properties</li>
  <li>Natural Falling: Random detachment with gravity, wind, and collision detection</li>
</ul>

<hr />

<h2 id="customization-ideas">Customization Ideas</h2>

<ul>
  <li>Seasonal Colors: Change flower colors for different seasons</li>
  <li>Different Tree Types: Modify branching patterns for various tree species</li>
  <li>Weather Effects: Add rain, snow, or stronger wind</li>
  <li>Interactive Elements: Click to make flowers fall or grow new ones</li>
  <li>Background: Add sky, ground, or other landscape elements</li>
</ul>

<hr />

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>Recursive Algorithms: Perfect for tree-like structures and branching patterns</li>
  <li>Turtle Graphics: Advanced techniques beyond basic shapes</li>
  <li>Animation Principles: Gradual growth, smooth transitions, frame control</li>
  <li>Physics Simulation: Gravity, wind, rotation, and collision detection</li>
  <li>Color Theory: Natural color blending and RGB manipulation</li>
  <li>Data Structures: Using dictionaries to track multiple animated objects</li>
</ul>

<hr />

<p>This project demonstrates that Python’s Turtle graphics can create much more than simple drawings. By combining recursive algorithms, color theory, and physics simulation, you can build beautiful, complex animations that bring digital nature to life. The techniques learned here can be applied to game development, data visualization, or interactive art projects.</p>

<p>Try modifying the parameters to create your own unique animated scenes!</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="turtle-graphics" /><category term="animation" /><category term="recursion" /><category term="physics" /><category term="tutorial" /><summary type="html"><![CDATA[Learn how to create a beautiful animated tree with growing and falling flowers using Python's Turtle graphics module. Step-by-step tutorial with physics simulation.]]></summary></entry><entry><title type="html">Matrix Multiplication Performance Comparison Python vs C++ vs NumPy</title><link href="https://www.pyshine.com/Matrix-Multiplication-Perfomance-Comparison/" rel="alternate" type="text/html" title="Matrix Multiplication Performance Comparison Python vs C++ vs NumPy" /><published>2025-11-05T00:00:00+00:00</published><updated>2025-11-05T00:00:00+00:00</updated><id>https://www.pyshine.com/Matrix-Multiplication-Perfomance-Comparison</id><content type="html" xml:base="https://www.pyshine.com/Matrix-Multiplication-Perfomance-Comparison/"><![CDATA[<h1 id="matrix-multiplication-performance-comparison-python-vs-c-vs-numpy">Matrix Multiplication Performance Comparison: Python vs C++ vs NumPy</h1>

<h3 id="beginner-friendly-tutorial-to-understand-matrix-computation-and-optimization">Beginner-Friendly Tutorial to Understand Matrix Computation and Optimization</h3>

<p>This tutorial will walk you through performing <strong>matrix multiplication</strong> using three approaches:</p>
<ol>
  <li>Naive Python nested loops</li>
  <li>Compiled C++ code executed from Python</li>
  <li>Optimized NumPy operations</li>
</ol>

<p>We’ll compare the execution times and understand why optimized libraries like NumPy are much faster.</p>

<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#setup-and-imports">Setup and Imports</a></li>
  <li><a href="#generate-random-matrices">Generate Random Matrices</a></li>
  <li><a href="#naive-python-multiplication">Naive Python Multiplication</a></li>
  <li><a href="#c-multiplication-from-python">C++ Multiplication from Python</a></li>
  <li><a href="#numpy-multiplication">NumPy Multiplication</a></li>
  <li><a href="#performance-comparison">Performance Comparison</a></li>
  <li><a href="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#running-the-code">Running the Code</a></li>
  <li><a href="#why-some-are-faster">Why Some Are Faster</a></li>
</ul>

<hr />

<h2 id="introduction">Introduction</h2>

<p>Matrix multiplication is a fundamental operation in mathematics, computer science, and data science. However, <strong>naive implementations in Python</strong> are slow for large matrices because Python loops are interpreted at runtime.</p>

<p>Optimized libraries like <strong>NumPy</strong> and compiled languages like <strong>C++</strong> can significantly reduce computation time.</p>

<hr />

<h2 id="setup-and-imports">Setup and Imports</h2>

<p>We’ll use the following Python libraries:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>          <span class="c1"># To measure execution time
</span><span class="kn">import</span> <span class="nn">subprocess</span>    <span class="c1"># To compile and run C++ code from Python
</span><span class="n">tempfile</span>             <span class="c1"># To create temporary files for C++ code
</span><span class="kn">import</span> <span class="nn">os</span>            <span class="c1"># To handle file operations
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>   <span class="c1"># Highly optimized matrix operations
</span></code></pre></div></div>

<p>Make sure you have <strong>NumPy</strong> installed. You can install it using:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>numpy
</code></pre></div></div>
<hr />

<h2 id="generate-random-matrices">Generate Random Matrices</h2>

<p>We’ll generate two square matrices <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code> of size <code class="language-plaintext highlighter-rouge">N x N</code> with random integers between 0 and 10.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Matrix Size
</span><span class="n">N</span> <span class="o">=</span> <span class="mi">600</span>  <span class="c1"># Increase N to see larger performance differences
</span>
<span class="c1"># Generate Matrices
</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
</code></pre></div></div>

<blockquote>
  <p>Tip: For beginners, start with smaller values like <code class="language-plaintext highlighter-rouge">N=100</code> to test the code faster.</p>
</blockquote>

<hr />

<h2 id="naive-python-multiplication">Naive Python Multiplication</h2>

<p>Using nested loops, we multiply matrices manually.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">start_py</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">N</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
<span class="n">end_py</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">python_time</span> <span class="o">=</span> <span class="n">end_py</span> <span class="o">-</span> <span class="n">start_py</span>
</code></pre></div></div>

<h3 id="how-it-works">How It Works</h3>
<ul>
  <li>We create an empty matrix <code class="language-plaintext highlighter-rouge">C</code> with zeros.</li>
  <li>Three nested loops compute the dot product.</li>
  <li>Time is recorded using <code class="language-plaintext highlighter-rouge">time.time()</code>.</li>
</ul>

<p><strong>Note:</strong> This is extremely slow for large matrices due to Python’s interpreted loops.</p>

<hr />

<h2 id="c-multiplication-from-python">C++ Multiplication from Python</h2>

<p>We can speed things up using <strong>C++</strong>, a compiled language. We’ll:</p>
<ol>
  <li>Write the C++ code to a temporary file.</li>
  <li>Compile it using <code class="language-plaintext highlighter-rouge">g++</code>.</li>
  <li>Run the executable and capture the runtime.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cpp_code</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;cstdlib&gt;
#include &lt;ctime&gt;
using namespace std;
int main(){{
    int N = </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s">;
    vector&lt;vector&lt;int&gt;&gt; A(N, vector&lt;int&gt;(N));
    vector&lt;vector&lt;int&gt;&gt; B(N, vector&lt;int&gt;(N));
    vector&lt;vector&lt;long long&gt;&gt; C(N, vector&lt;long long&gt;(N, 0));
    srand(time(0));
    for(int i=0;i&lt;N;i++)
        for(int j=0;j&lt;N;j++){{
            A[i][j] = rand() % 11;
            B[i][j] = rand() % 11;
        }}
    clock_t start = clock();
    for(int i=0;i&lt;N;i++)
        for(int j=0;j&lt;N;j++)
            for(int k=0;k&lt;N;k++)
                C[i][j] += (long long)A[i][k]*B[k][j];
    clock_t end = clock();
    cout &lt;&lt; double(end-start)/CLOCKS_PER_SEC &lt;&lt; endl;
    return 0;
}}
"""</span>

<span class="c1"># Write to temp file
</span><span class="k">with</span> <span class="n">tempfile</span><span class="p">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">".cpp"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cpp_file</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">cpp_code</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>

<span class="n">exe_file</span> <span class="o">=</span> <span class="n">cpp_file</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">".cpp"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

<span class="c1"># Compile
</span><span class="n">compile_proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">"g++"</span><span class="p">,</span> <span class="n">cpp_file</span><span class="p">,</span> <span class="s">"-O2"</span><span class="p">,</span> <span class="s">"-o"</span><span class="p">,</span> <span class="n">exe_file</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">compile_proc</span><span class="p">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"C++ Compilation failed!"</span><span class="p">,</span> <span class="n">compile_proc</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">exe_file</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">cpp_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>

<span class="c1"># Cleanup
</span><span class="n">ios</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cpp_file</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span> <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">exe_file</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Explanation:</strong></p>
<ul>
  <li>We generate the matrices inside C++ with <code class="language-plaintext highlighter-rouge">rand()</code>.</li>
  <li>Use triple nested loops to calculate multiplication.</li>
  <li>Capture execution time using <code class="language-plaintext highlighter-rouge">clock()</code>.</li>
  <li>Compile with <code class="language-plaintext highlighter-rouge">-O2</code> optimization flag.</li>
</ul>

<hr />

<h2 id="numpy-multiplication">NumPy Multiplication</h2>

<p>NumPy provides optimized matrix multiplication using highly efficient C/Fortran libraries under the hood.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">A_np</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">B_np</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="n">start_np</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">C_np</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A_np</span><span class="p">,</span> <span class="n">B_np</span><span class="p">)</span>
<span class="n">end_np</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">numpy_time</span> <span class="o">=</span> <span class="n">end_np</span> <span class="o">-</span> <span class="n">start_np</span>
</code></pre></div></div>
<h3 id="why-numpy-is-fast">Why NumPy is Fast</h3>
<ul>
  <li>NumPy leverages <strong>vectorized operations</strong>.</li>
  <li>Internal loops are compiled in <strong>C/Fortran</strong>, avoiding Python overhead.</li>
  <li>Utilizes CPU cache and SIMD instructions for speed.</li>
</ul>

<hr />

<h2 id="performance-comparison">Performance Comparison</h2>

<p>Finally, let’s compare all three methods:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== Performance Comparison ==="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Python: </span><span class="si">{</span><span class="n">python_time</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> s"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"C++: </span><span class="si">{</span><span class="n">cpp_time</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> s"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"NumPy: </span><span class="si">{</span><span class="n">numpy_time</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> s"</span><span class="p">)</span>
</code></pre></div></div>

<p>You will usually find:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Python &gt;&gt; C++ &gt;&gt; NumPy
</code></pre></div></div>
<p>for execution speed, with NumPy being the fastest.</p>

<hr />

<h2 id="key-takeaways">Key Takeaways</h2>
<ul>
  <li>Naive Python loops are slow for large matrices.</li>
  <li>C++ is faster due to compilation, but requires more setup.</li>
  <li>NumPy is both <strong>fast</strong> and <strong>easy to use</strong> in Python.</li>
  <li>Optimized libraries are crucial for performance-critical applications.</li>
</ul>

<hr />

<h2 id="running-the-code">Running the Code</h2>

<ol>
  <li>Copy the code into a <code class="language-plaintext highlighter-rouge">.py</code> file.</li>
  <li>Ensure you have <strong>NumPy</strong> and <strong>g++ compiler</strong> installed.</li>
  <li>Run the Python script:</li>
</ol>

<hr />

<h2 id="why-some-are-faster">Why Some Are Faster</h2>

<p>The speed differences are due to how the code is executed:</p>

<ul>
  <li><strong>Python</strong>: Slower because it interprets loops at runtime in a high-level language, which adds overhead for each iteration.</li>
  <li><strong>C++</strong>: Faster because it is compiled into machine code, reducing runtime overhead. The <code class="language-plaintext highlighter-rouge">-O2</code> flag also optimizes loops.</li>
  <li><strong>NumPy</strong>: Fastest because it is written in C and Fortran under the hood and uses highly optimized, vectorized operations that leverage CPU features.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python matrix_comparison.py
</code></pre></div></div>
<h3 id="complete-code">Complete Code</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span><span class="p">,</span> <span class="n">subprocess</span><span class="p">,</span> <span class="n">tempfile</span><span class="p">,</span> <span class="n">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span> <span class="c1"># Highly optimized C/Fortran based
</span>
<span class="c1"># Matrix Size
</span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Adjust bigger N shows bigger speed difference
# Generate Matrices
</span><span class="n">A</span><span class="p">,</span><span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">,(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>

<span class="c1"># Python Naive matrix Multiplication
</span><span class="n">start_py</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">N</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
<span class="n">end_py</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">python_time</span> <span class="o">=</span> <span class="n">end_py</span> <span class="o">-</span> <span class="n">start_py</span>

<span class="c1"># C++ version from Python
</span><span class="n">cpp_code</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;cstdlib&gt;
#include &lt;ctime&gt;
using namespace std;
int main(){{
    int N = </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s">;
    vector&lt;vector&lt;int&gt; &gt; A(N, vector&lt;int&gt;(N));
    vector&lt;vector&lt;int&gt; &gt; B(N, vector&lt;int&gt;(N));
    vector&lt;vector&lt;long long&gt; &gt;
    C(N, vector&lt;long long&gt;(N, 0));
    
    srand(time(0));
    for(int i=0; i&lt;N; i++)
        for(int j=0; j&lt;N; j++) {{
            A[i][j] = rand() % 11;
            B[i][j] = rand() % 11;
        }}
    clock_t start = clock();
    for (int i=0; i&lt;N; i++)
        for(int j=0; j&lt;N; j++)
            for(int k=0; k&lt;N; k++)
                C[i][j] += (long long)A[i][k]*B[k][j];
    clock_t end  = clock();
    double duration = double(end-start)/CLOCKS_PER_SEC;
    cout &lt;&lt; duration &lt;&lt; endl;
    return 0;
}}
"""</span> 

<span class="c1"># Write C++ code to temp file
</span><span class="k">with</span> <span class="n">tempfile</span><span class="p">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                 <span class="n">suffix</span><span class="o">=</span><span class="s">".cpp"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cpp_file</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">cpp_code</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">exe_file</span> <span class="o">=</span> <span class="n">cpp_file</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">".cpp"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
<span class="n">compile_proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">"g++"</span><span class="p">,</span> <span class="n">cpp_file</span><span class="p">,</span>
                               <span class="s">"-O2"</span><span class="p">,</span> <span class="s">"-o"</span><span class="p">,</span> <span class="n">exe_file</span><span class="p">],</span>
                              <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">compile_proc</span><span class="p">.</span><span class="n">returncode</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"C++ Compilation failed!"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">compile_proc</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Run C++ executable and capture time
</span>    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">exe_file</span><span class="p">],</span>
                            <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">cpp_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>

<span class="c1"># Cleanup temporary files
</span><span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cpp_file</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">exe_file</span><span class="p">)</span>

<span class="c1"># Numpy Matrix Multiplication
</span><span class="n">A_np</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">B_np</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="n">start_np</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">C_np</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A_np</span><span class="p">,</span> <span class="n">B_np</span><span class="p">)</span>
<span class="n">end_np</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">numpy_time</span> <span class="o">=</span> <span class="n">end_np</span> <span class="o">-</span> <span class="n">start_np</span>

<span class="c1"># Compare All
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">=== Performance Comparison ==="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Python: </span><span class="si">{</span><span class="n">python_time</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> s"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"C++: </span><span class="si">{</span><span class="n">cpp_time</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> s"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Numpy: </span><span class="si">{</span><span class="n">numpy_time</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s"> s"</span><span class="p">)</span>
</code></pre></div></div>

<p>You’ll see execution times for Python, C++, and NumPy.</p>

<hr />

<p>This tutorial demonstrates how <strong>choosing the right tools</strong> can drastically impact performance in numerical computing.</p>]]></content><author><name>PyShine Team</name></author><category term="matrix-multiplication" /><category term="Python" /><category term="C++" /><category term="NumPy" /><category term="performance" /><summary type="html"><![CDATA[Learn how to compare matrix multiplication speeds using naive Python, compiled C++, and optimized NumPy.]]></summary></entry><entry><title type="html">Make a Tree with falling Flowers</title><link href="https://www.pyshine.com/Make-a-tree-with-Falling-Flowers/" rel="alternate" type="text/html" title="Make a Tree with falling Flowers" /><published>2025-11-04T00:00:00+00:00</published><updated>2025-11-04T00:00:00+00:00</updated><id>https://www.pyshine.com/Make-a-tree-with-Falling-Flowers</id><content type="html" xml:base="https://www.pyshine.com/Make-a-tree-with-Falling-Flowers/"><![CDATA[<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ol>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#setup-and-imports">Setup and Imports</a></li>
  <li><a href="#generating-branch-parameters">Generating Branch Parameters</a></li>
  <li><a href="#tree-and-flower-drawing-functions">Tree and Flower Drawing Functions</a></li>
  <li><a href="#animating-falling-blossoms">Animating Falling Blossoms</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-it-works">How It Works</a></li>
  <li><a href="#run-the-script">Run the Script</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ol>

<hr />

<h2 id="overview">Overview</h2>
<p>This tutorial expands on our previous <strong>Cherry Blossom Tree</strong> by adding <strong>animated falling petals</strong> that gently sway in the wind and settle on the ground.<br />
We’ll use <code class="language-plaintext highlighter-rouge">turtle</code> graphics and a lightweight physics simulation with gravity, wind, and smooth animation updates.</p>

<hr />

<h2 id="setup-and-imports">Setup and Imports</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">seed</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># === Settings ===
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">GRAVITY</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">WIND</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>
</code></pre></div></div>
<p>We initialize the screen size, branch depth, and animation constants for wind and gravity.</p>

<hr />

<h2 id="generating-branch-parameters">Generating Branch Parameters</h2>

<p>Before drawing, we create random parameters for branch angles and lengths.<br />
This ensures a natural look while keeping the structure reproducible.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">record_my_params()</code> function recursively stores all angles and lengths before we start drawing.</p>

<hr />

<h2 id="tree-and-flower-drawing-functions">Tree and Flower Drawing Functions</h2>

<p>We use helper functions to <strong>blend colors</strong>, <strong>draw flowers</strong>, and <strong>build branches</strong> recursively.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">draw_flower</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">setheading</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">begin_fill</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">end_fill</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
</code></pre></div></div>
<p>Each blossom is drawn using a <strong>five-petal shape</strong> with subtle pink tones.</p>

<hr />

<h2 id="animating-falling-blossoms">Animating Falling Blossoms</h2>

<p>After building the tree, we animate petals detaching, swaying in the wind, and landing softly.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Main animation loop
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">fall_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">draw_tree</span><span class="p">()</span>

    <span class="n">breeze_phase</span> <span class="o">+=</span> <span class="n">breeze_frequency</span>
    <span class="n">current_breeze</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">breeze_phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">breeze_strength</span>

    <span class="c1"># Detach blossoms randomly
</span>    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flowers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">and</span> <span class="n">frame_count</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.04</span><span class="p">:</span>
            <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">velocities</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">WIND</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">WIND</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">+</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">,</span>
                <span class="o">-</span><span class="n">GRAVITY</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">rotations</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
            <span class="n">fallen_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"🌸 dropped! Total fallen: </span><span class="si">{</span><span class="n">fallen_count</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">flowers</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="c1"># Move and draw each blossom
</span>    <span class="p">...</span>
</code></pre></div></div>
<p>The simulation uses <strong>gravity and sinusoidal wind motion</strong> for realistic drifting.</p>

<hr />

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">seed</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># === Settings ===
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">GRAVITY</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">WIND</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>

<span class="c1"># === Pre-generate random branch params ===
</span><span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>


<span class="k">def</span> <span class="nf">turtle_tree</span><span class="p">():</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Screen</span><span class="p">()</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Turtle Tree with Falling Flowers"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">"black"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">tracer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">tree_pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">fall_pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">fall_pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">fall_pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fall_pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>

    <span class="n">flowers</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [x, y, color, size, attached]
</span>    <span class="n">fallen_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># &lt;--- NEW counter
</span>
    <span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_flower</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">setheading</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">begin_fill</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">pen</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
            <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">end_fill</span><span class="p">()</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">draw_tree</span><span class="p">():</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">setheading</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">draw_branch</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEPTH</span> <span class="o">-</span> <span class="n">depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">DEPTH</span>
            <span class="n">brown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">69</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">19</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
            <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blend</span><span class="p">(</span><span class="n">brown</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">tree_pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">tree_pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">tree_pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">tree_pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
            <span class="n">draw_branch</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">tree_pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
            <span class="n">draw_branch</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">tree_pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
            <span class="n">tree_pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

        <span class="n">draw_branch</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

    <span class="c1"># === Build tree &amp; record flower positions ===
</span>    <span class="n">tree_pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">tree_pen</span><span class="p">.</span><span class="n">setheading</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_flowers</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
            <span class="n">flowers</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">tree_pen</span><span class="p">.</span><span class="n">xcor</span><span class="p">(),</span> <span class="n">tree_pen</span><span class="p">.</span><span class="n">ycor</span><span class="p">(),</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="bp">True</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.12</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">DEPTH</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
            <span class="n">flowers</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">tree_pen</span><span class="p">.</span><span class="n">xcor</span><span class="p">(),</span> <span class="n">tree_pen</span><span class="p">.</span><span class="n">ycor</span><span class="p">(),</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="bp">True</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">add_flowers</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
        <span class="n">add_flowers</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="n">add_flowers</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Tree complete with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">flowers</span><span class="p">)</span><span class="si">}</span><span class="s"> blossoms"</span><span class="p">)</span>

    <span class="n">velocities</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">rotations</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">breeze_phase</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">breeze_strength</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">breeze_frequency</span> <span class="o">=</span> <span class="mf">0.08</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">tree_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">fall_pen</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">draw_tree</span><span class="p">()</span>

        <span class="n">breeze_phase</span> <span class="o">+=</span> <span class="n">breeze_frequency</span>
        <span class="n">current_breeze</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">breeze_phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">breeze_strength</span>

        <span class="c1"># Detach blossoms
</span>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flowers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">and</span> <span class="n">frame_count</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.04</span><span class="p">:</span>
                <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">velocities</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">WIND</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">WIND</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">+</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.4</span><span class="p">,</span>
                    <span class="o">-</span><span class="n">GRAVITY</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">rotations</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
                <span class="n">fallen_count</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># increment counter
</span>                <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"🌸 dropped! Total fallen: </span><span class="si">{</span><span class="n">fallen_count</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">flowers</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

        <span class="n">all_fallen</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flowers</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">attached</span> <span class="o">=</span> <span class="n">f</span>
            <span class="k">if</span> <span class="n">attached</span><span class="p">:</span>
                <span class="n">sway_x</span> <span class="o">=</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">frame_count</span> <span class="o">*</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span>
                <span class="n">draw_flower</span><span class="p">(</span><span class="n">tree_pen</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sway_x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">all_fallen</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flower_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="n">velocities</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">flower_id</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">vx</span> <span class="o">+</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.05</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="n">vy</span>
                <span class="n">vy</span> <span class="o">-=</span> <span class="n">GRAVITY</span> <span class="o">*</span> <span class="mf">0.08</span>
                <span class="n">vx</span> <span class="o">+=</span> <span class="n">current_breeze</span> <span class="o">*</span> <span class="mf">0.015</span> <span class="o">+</span> <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.008</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">)</span>
                <span class="n">vx</span> <span class="o">*=</span> <span class="mf">0.998</span>
                <span class="n">vy</span> <span class="o">*=</span> <span class="mf">0.998</span>
                <span class="k">if</span> <span class="n">flower_id</span> <span class="ow">in</span> <span class="n">rotations</span><span class="p">:</span>
                    <span class="n">rotations</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">+=</span> <span class="n">vx</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">ground_level</span> <span class="o">=</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="mf">1.5</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">ground_level</span><span class="p">:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">ground_level</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
                        <span class="n">vy</span> <span class="o">=</span> <span class="o">-</span><span class="n">vy</span> <span class="o">*</span> <span class="mf">0.2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vy</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">vx</span> <span class="o">*=</span> <span class="mf">0.8</span>
                <span class="n">velocities</span><span class="p">[</span><span class="n">flower_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">]</span>
                <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="n">rotations</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">flower_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">draw_flower</span><span class="p">(</span><span class="n">fall_pen</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">vy</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">vx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">all_fallen</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">screen</span><span class="p">.</span><span class="n">update</span><span class="p">()</span>
        <span class="c1"># time.sleep(FPS)
</span>        <span class="k">if</span> <span class="n">all_fallen</span> <span class="ow">and</span> <span class="n">frame_count</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"All </span><span class="si">{</span><span class="n">fallen_count</span><span class="si">}</span><span class="s"> flowers have fallen!"</span><span class="p">)</span>
    <span class="n">turtle</span><span class="p">.</span><span class="n">done</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">turtle_tree</span><span class="p">()</span>

</code></pre></div></div>

<hr />

<h2 id="how-it-works">How It Works</h2>
<ul>
  <li><strong>Tree Drawing:</strong> Recursive function generates symmetrical branches.</li>
  <li><strong>Blossom Attachment:</strong> Each flower starts attached to a branch.</li>
  <li><strong>Falling Motion:</strong> Randomly detaches and moves downward using basic gravity physics.</li>
  <li><strong>Wind:</strong> Adds horizontal sway using a sine wave pattern.</li>
  <li><strong>Collision Detection:</strong> Flowers stop gently upon reaching the ground.</li>
</ul>

<hr />

<h2 id="run-the-script">Run the Script</h2>

<p>Save as <code class="language-plaintext highlighter-rouge">falling_cherry_tree.py</code> and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 falling_cherry_tree.py
</code></pre></div></div>

<p>You’ll see a black background with blossoms drifting gracefully from the branches and settling at the base.</p>

<hr />

<h2 id="conclusion">Conclusion</h2>
<p>This project brings life to your fractal tree by adding <strong>motion and realism</strong>.<br />
Experiment with <code class="language-plaintext highlighter-rouge">WIND</code>, <code class="language-plaintext highlighter-rouge">GRAVITY</code>, and <code class="language-plaintext highlighter-rouge">FPS</code> to create slow drifting or stormy blossom effects 🌸💨<br />
Next, try combining this animation with <strong>sound or seasonal background music</strong> for a serene interactive art piece!</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="turtle" /><category term="animation" /><category term="graphics" /><category term="nature" /><summary type="html"><![CDATA[Python Turtle Graphics Tutorial to animate falling cherry blossoms]]></summary></entry><entry><title type="html">Make a Tree with Blossoms in Python</title><link href="https://www.pyshine.com/Make-a-tree-with-Flowers/" rel="alternate" type="text/html" title="Make a Tree with Blossoms in Python" /><published>2025-11-04T00:00:00+00:00</published><updated>2025-11-04T00:00:00+00:00</updated><id>https://www.pyshine.com/Make-a-tree-with-Flowers</id><content type="html" xml:base="https://www.pyshine.com/Make-a-tree-with-Flowers/"><![CDATA[<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ol>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#setup-and-imports">Setup and Imports</a></li>
  <li><a href="#generating-random-branch-parameters">Generating Random Branch Parameters</a></li>
  <li><a href="#drawing-functions">Drawing Functions</a></li>
  <li><a href="#main-tree-function">Main Tree Function</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-it-works">How It Works</a></li>
  <li><a href="#run-the-script">Run the Script</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ol>

<hr />

<h2 id="overview">Overview</h2>
<p>This tutorial demonstrates how to create a <strong>beautiful cherry blossom tree</strong> using Python’s <code class="language-plaintext highlighter-rouge">turtle</code> graphics module.<br />
The program uses recursion to generate realistic branches, randomization for natural variation, and color blending to simulate blooming flowers.</p>

<hr />

<h2 id="setup-and-imports">Setup and Imports</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">seed</span>

<span class="c1"># Settings
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>
</code></pre></div></div>

<p>We set up the screen dimensions, recursion depth, branch length, and base branch angle.</p>

<hr />

<h2 id="generating-random-branch-parameters">Generating Random Branch Parameters</h2>

<p>Before drawing, we pre-generate random angles and lengths for each branch.<br />
This ensures consistent structure each time the script runs (because we fixed the random seed).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>
</code></pre></div></div>

<hr />

<h2 id="drawing-functions">Drawing Functions</h2>

<p>Two helper functions are used:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">blend()</code> for color blending</li>
  <li><code class="language-plaintext highlighter-rouge">draw_flower()</code> for drawing small cherry blossoms</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">draw_flower</span><span class="p">():</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">begin_fill</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">end_fill</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
</code></pre></div></div>

<hr />

<h2 id="main-tree-function">Main Tree Function</h2>

<p>The recursive function <code class="language-plaintext highlighter-rouge">draw_branch()</code> handles branching, coloring, and flower placement.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_branch</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">draw_flower</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEPTH</span> <span class="o">-</span> <span class="n">depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">DEPTH</span>
    <span class="n">brown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">69</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">19</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blend</span><span class="p">(</span><span class="n">brown</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.12</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">DEPTH</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">draw_flower</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
    <span class="n">draw_branch</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
    <span class="n">draw_branch</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s"> Depth: </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">seed</span>

<span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>

<span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>

<span class="k">def</span> <span class="nf">turtle_tree</span><span class="p">():</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Screen</span><span class="p">()</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Turtle Tree with Flowers"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">"black"</span><span class="p">)</span>
    <span class="n">pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_flower</span><span class="p">():</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">begin_fill</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">pen</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
            <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">end_fill</span><span class="p">()</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">draw_branch</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">draw_flower</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEPTH</span> <span class="o">-</span> <span class="n">depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">DEPTH</span>
        <span class="n">brown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">69</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">19</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blend</span><span class="p">(</span><span class="n">brown</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.12</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">DEPTH</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">draw_flower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">draw_branch</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
        <span class="n">draw_branch</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s"> Depth: </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>
    <span class="n">draw_branch</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Tree complete."</span><span class="p">)</span>
    <span class="n">turtle</span><span class="p">.</span><span class="n">done</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">turtle_tree</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="how-it-works">How It Works</h2>
<ul>
  <li><strong>Recursion:</strong> Each branch splits into two sub-branches with random angles and lengths.</li>
  <li><strong>Color blending:</strong> Gradually transitions from brown to green as branches move outward.</li>
  <li><strong>Flowers:</strong> Small pink blossoms are drawn at branch tips and occasionally mid-branch.</li>
  <li><strong>Param reuse:</strong> Pre-generated parameters keep the tree consistent on reruns.</li>
</ul>

<hr />

<h2 id="run-the-script">Run the Script</h2>

<p>Save as <code class="language-plaintext highlighter-rouge">turtle_tree.py</code> and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 turtle_tree.py
</code></pre></div></div>

<p>A black screen with a growing cherry blossom tree should appear.</p>

<hr />

<h2 id="conclusion">Conclusion</h2>
<p>This project combines <strong>recursion</strong>, <strong>randomness</strong>, and <strong>color blending</strong> to simulate organic growth.<br />
You can modify parameters like <code class="language-plaintext highlighter-rouge">DEPTH</code>, <code class="language-plaintext highlighter-rouge">LENGTH</code>, and flower colors to create your own natural variations!</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="turtle" /><category term="recursion" /><category term="graphics" /><category term="fractal" /><summary type="html"><![CDATA[Python Turtle Graphics Tutorial to quickly draw a Tree]]></summary></entry><entry><title type="html">Run C++ Code from Python – Step-by-Step Guide</title><link href="https://www.pyshine.com/Run-C++-in-Python/" rel="alternate" type="text/html" title="Run C++ Code from Python – Step-by-Step Guide" /><published>2025-11-03T00:00:00+00:00</published><updated>2025-11-03T00:00:00+00:00</updated><id>https://www.pyshine.com/Run-C++-in-Python</id><content type="html" xml:base="https://www.pyshine.com/Run-C++-in-Python/"><![CDATA[<h1 id="run-c-code-from-python--step-by-step-guide">Run C++ Code from Python – Step-by-Step Guide</h1>

<h3 id="beginner-friendly-tutorial--learn-how-python-can-compile-and-execute-c-code">Beginner-Friendly Tutorial – Learn How Python Can Compile and Execute C++ Code</h3>

<p>Python is an incredibly versatile language, but sometimes you might need the speed and performance of C++. This tutorial explains how to <strong>run C++ code directly from Python</strong>, making it easy to integrate both languages. You’ll learn how to write, compile, and execute a temporary C++ program from a Python script using the <strong><code class="language-plaintext highlighter-rouge">subprocess</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tempfile</code></strong> modules. This is a great way to understand cross-language execution and automation using Python!</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#why-run-c-from-python">Why Run C++ from Python?</a></li>
  <li><a href="#step-1-writing-c-code-in-python">Step 1: Writing C++ Code in Python</a></li>
  <li><a href="#step-2-compiling-c-code">Step 2: Compiling C++ Code</a></li>
  <li><a href="#step-3-executing-the-compiled-program">Step 3: Executing the Compiled Program</a></li>
  <li><a href="#step-4-cleaning-up-temporary-files">Step 4: Cleaning Up Temporary Files</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-it-works">How It Works</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-experiments">Further Experiments</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>This project shows how Python can act as a <strong>controller for compiling and executing C++ code</strong>. The program:</p>

<ol>
  <li>Writes a simple <strong>C++ Hello World</strong> program to a temporary file.</li>
  <li>Uses <strong><code class="language-plaintext highlighter-rouge">subprocess.run()</code></strong> to compile it using the <strong>g++ compiler</strong>.</li>
  <li>Executes the compiled program and displays the C++ output inside Python.</li>
  <li>Cleans up all temporary files automatically.</li>
</ol>

<h2 id="why-run-c-from-python">Why Run C++ from Python?</h2>

<ul>
  <li>Combine <strong>Python’s flexibility</strong> with <strong>C++’s performance</strong>.</li>
  <li>Automate <strong>testing of C++ code</strong> or <strong>generate code dynamically</strong>.</li>
  <li>Build hybrid systems where Python handles logic and C++ handles computation-heavy tasks.</li>
</ul>

<h2 id="step-1-writing-c-code-in-python">Step 1: Writing C++ Code in Python</h2>

<p>The script starts with a simple Python print, followed by defining C++ code as a multi-line string.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">subprocess</span>  <span class="c1"># To run external programs
</span><span class="kn">import</span> <span class="nn">tempfile</span>    <span class="c1"># To create temporary files for C++ code
</span><span class="kn">import</span> <span class="nn">os</span>          <span class="c1"># To handle file operations
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Hello World from Python!"</span><span class="p">)</span>  <span class="c1"># Simple Python print
</span>
<span class="n">cpp_code</span> <span class="o">=</span> <span class="s">"""
#include &lt;iostream&gt;
using namespace std;

int main() {
    cout &lt;&lt; "Hello World from C++!" &lt;&lt; endl;
    return 0;
}
"""</span>
</code></pre></div></div>

<p>Here, the <strong>C++ code is stored as a string</strong> that will later be written to a temporary file.</p>

<hr />

<h2 id="setting-up-g-on-your-system">Setting Up <code class="language-plaintext highlighter-rouge">g++</code> on Your System</h2>

<p>You need a working C++ compiler (<code class="language-plaintext highlighter-rouge">g++</code>) to run this tutorial. Follow the steps below depending on your OS.</p>

<h3 id="windows">Windows</h3>
<ol>
  <li>Install <strong>MinGW-w64</strong> (Minimalist GNU for Windows):
    <ul>
      <li>Visit: <a href="https://winlibs.com/">https://winlibs.com/</a> or <a href="https://sourceforge.net/projects/mingw-w64/">https://sourceforge.net/projects/mingw-w64/</a></li>
      <li>Download and install it.</li>
    </ul>
  </li>
  <li>Add the <strong><code class="language-plaintext highlighter-rouge">bin</code> directory</strong> (e.g., <code class="language-plaintext highlighter-rouge">C:\mingw64\bin</code>) to your <strong>PATH environment variable</strong>.</li>
  <li>Open Command Prompt and type:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g++ <span class="nt">--version</span>
</code></pre></div>    </div>
    <p>If it prints version info, you’re ready to go!</p>
  </li>
</ol>

<h3 id="macos">macOS</h3>
<ol>
  <li>Install <strong>Xcode Command Line Tools</strong> by running:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xcode-select <span class="nt">--install</span>
</code></pre></div>    </div>
  </li>
  <li>Verify installation with:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g++ <span class="nt">--version</span>
</code></pre></div>    </div>
    <p>You should see Apple’s <code class="language-plaintext highlighter-rouge">clang</code> compiler, which works for this tutorial.</p>
  </li>
</ol>

<h3 id="linux-ubuntudebian">Linux (Ubuntu/Debian)</h3>
<ol>
  <li>Open Terminal and install <code class="language-plaintext highlighter-rouge">g++</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>g++
</code></pre></div>    </div>
  </li>
  <li>Verify installation:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g++ <span class="nt">--version</span>
</code></pre></div>    </div>
    <hr />
  </li>
</ol>

<h2 id="step-2-compiling-c-code">Step 2: Compiling C++ Code</h2>

<p>We create a temporary <code class="language-plaintext highlighter-rouge">.cpp</code> file and compile it using the <strong>g++ compiler</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tempfile</span><span class="p">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">".cpp"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cpp_file</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">cpp_code</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>

<span class="n">exe_file</span> <span class="o">=</span> <span class="n">cpp_file</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">".cpp"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

<span class="n">compile_proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
    <span class="p">[</span><span class="s">"g++"</span><span class="p">,</span> <span class="n">cpp_file</span><span class="p">,</span> <span class="s">"-o"</span><span class="p">,</span> <span class="n">exe_file</span><span class="p">],</span>
    <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">tempfile.NamedTemporaryFile()</code></strong> creates a unique <code class="language-plaintext highlighter-rouge">.cpp</code> file in the system’s temporary directory.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">subprocess.run()</code></strong> executes the g++ compiler to compile the file into an executable.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">capture_output=True</code></strong> captures any compilation messages.</li>
</ul>

<h2 id="step-3-executing-the-compiled-program">Step 3: Executing the Compiled Program</h2>

<p>After successful compilation, Python runs the compiled C++ binary.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">compile_proc</span><span class="p">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"C++ compilation failed!"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">compile_proc</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">exe_file</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Output from C++:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre></div></div>

<p>If compilation fails, Python displays the compiler error messages. If it succeeds, it prints the <strong>C++ program output</strong>.</p>

<h3 id="example-output">Example Output:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World from Python!
Output from C++:
Hello World from C++!
</code></pre></div></div>

<h2 id="step-4-cleaning-up-temporary-files">Step 4: Cleaning Up Temporary Files</h2>

<p>Finally, we remove temporary files created during compilation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cpp_file</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">exe_file</span><span class="p">)</span>
</code></pre></div></div>

<p>This ensures no leftover files clutter your system.</p>

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Hello World from Python!"</span><span class="p">)</span>

<span class="n">cpp_code</span> <span class="o">=</span> <span class="s">"""
#include &lt;iostream&gt;
using namespace std;

int main() {
    cout &lt;&lt; "Hello World from C++!" &lt;&lt; endl;
    return 0;
}
"""</span>

<span class="k">with</span> <span class="n">tempfile</span><span class="p">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">".cpp"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cpp_file</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">cpp_code</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>

<span class="n">exe_file</span> <span class="o">=</span> <span class="n">cpp_file</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">".cpp"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

<span class="n">compile_proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">"g++"</span><span class="p">,</span> <span class="n">cpp_file</span><span class="p">,</span> <span class="s">"-o"</span><span class="p">,</span> <span class="n">exe_file</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">if</span> <span class="n">compile_proc</span><span class="p">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"C++ compilation failed!"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">compile_proc</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">exe_file</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Output from C++:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>

<span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cpp_file</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">exe_file</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="how-it-works">How It Works</h2>

<ol>
  <li><strong>Python writes C++ code</strong> to a temporary file.</li>
  <li><strong>g++ compiles</strong> the code into an executable.</li>
  <li><strong>Python runs the executable</strong> and prints its output.</li>
  <li><strong>Cleanup</strong> removes temporary files for a tidy finish.</li>
</ol>

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>Use <strong><code class="language-plaintext highlighter-rouge">subprocess.run()</code></strong> to execute system commands from Python.</li>
  <li>Create <strong>temporary files</strong> using <code class="language-plaintext highlighter-rouge">tempfile</code> safely.</li>
  <li>Capture <strong>compiler output and program results</strong>.</li>
  <li>Integrate Python and C++ seamlessly for automation or hybrid projects.</li>
</ul>

<h2 id="further-experiments">Further Experiments</h2>

<ul>
  <li>Modify the C++ code dynamically (e.g., generate code from user input).</li>
  <li>Run multiple C++ snippets from one Python script.</li>
  <li>Measure <strong>execution time differences</strong> between Python and C++.</li>
  <li>Use <strong>Python to benchmark or visualize C++ results</strong>.</li>
</ul>

<hr />

<p>With this simple integration, you’ve built a <strong>bridge between Python and C++</strong>, unlocking a world of hybrid programming possibilities. You can extend this example to dynamically generate more complex C++ programs, compile them on the fly, and benchmark their performance using Python scripts.</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="cpp" /><category term="automation" /><category term="interoperability" /><category term="tutorial" /><summary type="html"><![CDATA[Learn how to compile and execute C++ code directly from Python using subprocess and tempfile modules.]]></summary></entry><entry><title type="html">Fractal Tree Generator in Python with Turtle</title><link href="https://www.pyshine.com/Turtle-Recursive-Tree-copy/" rel="alternate" type="text/html" title="Fractal Tree Generator in Python with Turtle" /><published>2025-11-02T00:00:00+00:00</published><updated>2025-11-02T00:00:00+00:00</updated><id>https://www.pyshine.com/Turtle-Recursive-Tree%20copy</id><content type="html" xml:base="https://www.pyshine.com/Turtle-Recursive-Tree-copy/"><![CDATA[<h1 id="fractal-tree-generator-in-python">Fractal Tree Generator in Python</h1>

<h3 id="a-beginners-guide-to-recursion-and-turtle-graphics">A Beginner’s Guide to Recursion and Turtle Graphics</h3>

<p>In this tutorial, you’ll learn how to create a <strong>beautiful fractal tree</strong> using <strong>Python’s turtle graphics module</strong>. The project combines <strong>recursion</strong>, <strong>randomness</strong>, and <strong>geometry</strong> to draw realistic, organic-looking trees.</p>

<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#project-setup">Project Setup</a></li>
  <li><a href="#recursive-tree-logic">Recursive Tree Logic</a></li>
  <li><a href="#randomization-for-natural-shapes">Randomization for Natural Shapes</a></li>
  <li><a href="#drawing-with-turtle">Drawing with Turtle</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-to-run">How to Run</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-experiments">Further Experiments</a></li>
</ul>

<hr />

<h2 id="overview">Overview</h2>

<p>Fractals are <strong>self-similar geometric patterns</strong> that repeat at smaller scales. Trees are a perfect example — each branch splits into smaller branches that resemble the whole tree.</p>

<p>In this project, we’ll use <strong>recursive functions</strong> to draw a tree, where each branch spawns two smaller branches at random angles and lengths.</p>

<p>Here’s what we’ll build:</p>
<ul>
  <li>Recursive branching up to a defined depth</li>
  <li>Randomized angles and lengths for organic look</li>
  <li>A vibrant turtle graphics visualization</li>
</ul>

<hr />

<h2 id="project-setup">Project Setup</h2>

<p>First, let’s import the required modules and set up some global parameters:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span><span class="p">,</span> <span class="n">random</span>

<span class="c1"># Screen dimensions
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span>

<span class="c1"># Tree configuration
</span><span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span>      <span class="c1"># Levels of recursion (branch generations)
</span><span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>    <span class="c1"># Average branch length
</span><span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>        <span class="c1"># Average branch angle in degrees
</span>
<span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>  <span class="c1"># Fix the random seed for reproducibility
</span></code></pre></div></div>

<hr />

<h2 id="recursive-tree-logic">Recursive Tree Logic</h2>

<p>The magic of this fractal tree lies in recursion — a function that calls itself to create smaller branches.</p>

<p>We’ll use a helper function called <code class="language-plaintext highlighter-rouge">record_my_params()</code> to <strong>generate and store random parameters</strong> for branch angles and lengths at every recursive level.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s">"""Recursively generate random branch parameters"""</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>

    <span class="c1"># Random left and right angles
</span>    <span class="n">a1</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">BA</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">BA</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">BA</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">BA</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Random left and right branch lengths
</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>

    <span class="c1"># Store the parameters for reuse
</span>    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>

    <span class="c1"># Recurse for next levels
</span>    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Initialize all branch parameters once
</span><span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
</code></pre></div></div>

<p>This step ensures that even if we re-run the drawing, we use <strong>the same random tree structure</strong>, resulting in reproducibility.</p>

<hr />

<h2 id="randomization-for-natural-shapes">Randomization for Natural Shapes</h2>

<p>In nature, no two branches are exactly alike — randomness is key to realism.</p>

<p>Here’s what we randomized:</p>
<ul>
  <li><strong>Branch Angles (<code class="language-plaintext highlighter-rouge">a1</code>, <code class="language-plaintext highlighter-rouge">a2</code>)</strong> → vary around ±10° from the base angle <code class="language-plaintext highlighter-rouge">BA</code>.</li>
  <li><strong>Branch Lengths (<code class="language-plaintext highlighter-rouge">l1</code>, <code class="language-plaintext highlighter-rouge">l2</code>)</strong> → randomly between 60% and 80% of the parent branch.</li>
</ul>

<p>This small variation makes the generated tree look <strong>organic and lifelike</strong> rather than geometric.</p>

<hr />

<h2 id="drawing-with-turtle">Drawing with Turtle</h2>

<p>Now, we’ll use the <strong>Turtle Graphics</strong> library to draw the tree recursively.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>

<span class="k">def</span> <span class="nf">turtle_tree</span><span class="p">():</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Screen</span><span class="p">()</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Turtle Tree"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">"black"</span><span class="p">)</span>

    <span class="n">pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">color</span><span class="p">(</span><span class="s">"lime"</span><span class="p">)</span>

    <span class="c1"># Start position and orientation
</span>    <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">draw_tree</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Left branch
</span>        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">draw_tree</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Right branch
</span>        <span class="n">pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
        <span class="n">draw_tree</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Return to original orientation and backtrack
</span>        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s"> Depth: </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="n">draw_tree</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Turtle finished drawing..."</span><span class="p">)</span>
    <span class="n">turtle</span><span class="p">.</span><span class="n">done</span><span class="p">()</span>
</code></pre></div></div>

<p>When you run this, you’ll see your turtle gracefully draw the branches, recursively building the entire tree structure.</p>

<hr />

<h2 id="complete-code">Complete Code</h2>

<p>Here’s the complete Python script for your fractal tree:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span><span class="p">,</span> <span class="n">random</span>
<span class="n">W</span><span class="p">,</span><span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># Recursive level or generations of branch
</span><span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span> <span class="c1"># Average branch length
</span><span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span> <span class="c1"># Branch Angle on average
</span><span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span> 
<span class="c1"># Generate Random angle and length sequence
</span><span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s">"""Recursively generate random branch parameters"""</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> 
    <span class="c1"># Random branch angles (variation around BA)
</span>    <span class="n">a1</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">BA</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">BA</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># left angle
</span>    <span class="n">a2</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">BA</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">BA</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># right angle
</span>    <span class="c1"># Random branch lenghts (60% to 80% of parent)
</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># left length
</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># right length
</span>    <span class="c1"># Store parameters (for reuse later on)
</span>    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">level</span><span class="p">))</span>
    <span class="c1"># Recurse deeper
</span>    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Call once to populate the branch_params list
</span><span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
<span class="c1"># Iterator to reuse identical random parameters
</span><span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span> <span class="k">yield</span> <span class="n">p</span> 

<span class="k">def</span> <span class="nf">turtle_tree</span><span class="p">():</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Screen</span><span class="p">();</span> <span class="n">screen</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">W</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Turtle Tree"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">"black"</span><span class="p">)</span>
    <span class="n">pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">();</span> <span class="n">pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">pen</span><span class="p">.</span><span class="n">color</span><span class="p">(</span><span class="s">"lime"</span><span class="p">);</span> <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">();</span><span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">30</span><span class="p">);</span><span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">draw_tree</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> 
        <span class="n">pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">depth</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span><span class="n">draw_tree</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">);</span><span class="n">draw_tree</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">);</span> <span class="n">pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s"> Depth: </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">draw_tree</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Turtle finished drawing..."</span><span class="p">)</span>
    <span class="n">turtle</span><span class="p">.</span><span class="n">done</span><span class="p">()</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">turtle_tree</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="how-to-run">How to Run</h2>

<ol>
  <li>Install Python (3.8+ recommended).</li>
  <li>Save the code as <code class="language-plaintext highlighter-rouge">turtle_tree.py</code>.</li>
  <li>Run it in your terminal or IDE:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python turtle_tree.py
</code></pre></div>    </div>
  </li>
  <li>Watch the tree being drawn branch by branch on a black canvas.</li>
</ol>

<hr />

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li><strong>Recursion</strong>: Each branch draws smaller branches by calling itself.</li>
  <li><strong>Randomization</strong>: Adds organic variety to otherwise mathematical patterns.</li>
  <li><strong>Parameter Storage</strong>: Precomputing random parameters ensures consistent results.</li>
  <li><strong>Turtle Graphics</strong>: Provides a simple way to visualize geometric structures.</li>
</ul>

<hr />

<h2 id="further-experiments">Further Experiments</h2>

<ul>
  <li>Change colors for different depth levels (green → brown gradient)</li>
  <li>Add wind animation by slightly rotating angles in real-time</li>
  <li>Generate holiday trees with random decorations</li>
  <li>Try increasing <code class="language-plaintext highlighter-rouge">DEPTH</code> for more detailed fractals (but slower drawing)</li>
</ul>

<hr />

<p>With just a few lines of recursive code, you’ve created an <strong>organic fractal tree</strong> that grows beautifully on your screen. This project is a fun introduction to <strong>recursive graphics and procedural generation</strong> — concepts that power both <strong>natural simulations</strong> and <strong>game development</strong>!</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="turtle" /><category term="recursion" /><category term="graphics" /><category term="fractal" /><summary type="html"><![CDATA[Learn how to build a beautiful recursive fractal tree using Python’s turtle graphics module with randomness for natural effects.]]></summary></entry><entry><title type="html">Music Maker with Save Load Clear &amp;amp; Slider</title><link href="https://www.pyshine.com/Pygame-Music-Maker-with-Threads-copy/" rel="alternate" type="text/html" title="Music Maker with Save Load Clear &amp;amp; Slider" /><published>2025-11-01T00:00:00+00:00</published><updated>2025-11-01T00:00:00+00:00</updated><id>https://www.pyshine.com/Pygame-Music-Maker-with-Threads%20copy</id><content type="html" xml:base="https://www.pyshine.com/Pygame-Music-Maker-with-Threads-copy/"><![CDATA[<h1 id="pyshine-music-maker--the-ultimate-step-sequencer-tutorial">PyShine Music Maker – The Ultimate Step Sequencer Tutorial</h1>

<h3 id="build-a-visual-music-sequencer-with-pygame-json-saveload-clear-slider-and-real-time-waveform-visualization">Build a Visual Music Sequencer with Pygame, JSON Save/Load, Clear, Slider, and Real-Time Waveform Visualization</h3>

<p>This comprehensive tutorial will help you build a <strong>feature-packed music maker app</strong> using <strong>Python</strong> and <strong>Pygame</strong>. You’ll not only learn to synthesize musical notes using NumPy but also understand threading, grid-based sequencing, waveform visualization, and dynamic user controls such as buttons and sliders.</p>

<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ol>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#setting-up-pygame">Setting Up Pygame</a></li>
  <li><a href="#creating-synthetic-piano-notes">Creating Synthetic Piano Notes</a></li>
  <li><a href="#sequencer-pattern--grid-layout">Sequencer Pattern &amp; Grid Layout</a></li>
  <li><a href="#buttons-save-load-clear">Buttons: Save, Load, Clear</a></li>
  <li><a href="#slider-for-loop-control">Slider for Loop Control</a></li>
  <li><a href="#waveform-visualization">Waveform Visualization</a></li>
  <li><a href="#playback-thread">Playback Thread</a></li>
  <li><a href="#main-loop--event-handling">Main Loop &amp; Event Handling</a></li>
  <li><a href="#running-the-application">Running the Application</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-ideas">Further Ideas</a></li>
</ol>

<hr />

<h2 id="overview">Overview</h2>

<p>The <strong>PyShine Music Maker</strong> combines interactive graphics and synthesized audio, offering an accessible introduction to digital sound processing and event-driven programming. It’s an <strong>interactive step sequencer</strong> that lets you visually create patterns, loop them, and hear your creations immediately. The program includes:</p>

<ul>
  <li>A <strong>7-note synth</strong> (C–B) generated mathematically.</li>
  <li><strong>Grid-based pattern editing</strong> with 32 steps.</li>
  <li><strong>Save/Load features</strong> using JSON for persistence.</li>
  <li>A <strong>Clear All</strong> button to reset instantly.</li>
  <li>A <strong>loop slider</strong> to adjust playback range dynamically.</li>
  <li><strong>Waveform visualization</strong> for real-time feedback.</li>
</ul>

<p>This tutorial is perfect for anyone learning how graphics, sound, and time-based logic interact in Python. You’ll gain insights into <strong>digital signal processing</strong>, <strong>event handling</strong>, and <strong>multi-threaded programming</strong>.</p>

<p>Each section is fully expanded, so by the end, you’ll have a working DAW-style sequencer and a deep understanding of how everything connects.</p>

<p>Dont worry, if you dont know about DAW. What is this DAW? Digital Audio Workstation (DAW) is a software platform for recording, editing, mixing, and producing audio digitally. Examples include Ableton Live, FL Studio, Logic Pro, and Cubase. Sequencer is a tool or module inside the DAW (or standalone) that lets you arrange musical events (notes, beats, or samples) over time in a grid or timeline format.</p>

<p>So a DAW-style sequencer mimics the way professional music software arranges musical notes and beats</p>

<ul>
  <li>Horizontal axis = time/steps (when notes play)</li>
  <li>Vertical axis = pitch/note (which note plays)</li>
</ul>

<p>Typically includes looping, step triggering, and visual feedback for composing music.</p>

<hr />

<h2 id="setting-up-pygame">Setting Up Pygame</h2>

<p>We start by setting up the core components. Pygame handles both graphics and audio, while NumPy handles waveform generation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">threading</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">pygame.mixer</code> module is responsible for audio playback. The frequency <code class="language-plaintext highlighter-rouge">44100</code> Hz corresponds to CD-quality audio. After initializing the libraries, we define the display:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">750</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"PyShine Music Maker (Save/Load + Clear + Slider)"</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li><strong>W</strong> and <strong>H</strong> define the window size.</li>
  <li><strong>font</strong> creates text for labels.</li>
  <li><strong>clock</strong> controls frame rate and smooth rendering.</li>
</ul>

<p>We use a window size of <strong>480×750</strong> so that we have ample vertical space for the waveform, buttons, and grid. You’ll redraw everything every frame for smooth interaction.</p>

<p>💡 <em>Tip:</em> Redrawing the whole UI per frame may seem wasteful, but it’s standard in Pygame’s immediate mode rendering system and ensures crisp, consistent visuals.</p>

<p>Try running the above code — you should see a black window open with a title. That’s your base canvas for all future drawings.</p>

<hr />

<h2 id="creating-synthetic-piano-notes">Creating Synthetic Piano Notes</h2>

<p>Music is vibration — and vibration is math. A musical note is simply a sine wave oscillating at a specific frequency. By summing multiple harmonics, we get richer sounds. Let’s create a function to generate synthetic piano tones.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fs</span> <span class="o">=</span> <span class="mi">44100</span>  <span class="c1"># samples per second
</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># seconds per note
</span>
<span class="k">def</span> <span class="nf">make_note</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span> <span class="o">*</span> <span class="n">duration</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">env</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span> <span class="o">*</span> <span class="mi">32767</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="n">stereo</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">audio</span><span class="p">,</span> <span class="n">audio</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">stereo</span><span class="p">),</span> <span class="n">wave</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">np.linspace</code> creates evenly spaced samples across the note’s duration.</li>
  <li><code class="language-plaintext highlighter-rouge">env</code> adds a <strong>natural decay</strong> envelope (simulating how a note fades).</li>
  <li>The three sine terms form the base and its <strong>second and third harmonics</strong>.</li>
</ul>

<p>Next, generate seven notes:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">notes</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span><span class="mf">261.63</span><span class="p">,</span><span class="s">'D'</span><span class="p">:</span><span class="mf">293.63</span><span class="p">,</span><span class="s">'E'</span><span class="p">:</span><span class="mf">329.63</span><span class="p">,</span><span class="s">'F'</span><span class="p">:</span><span class="mf">349.23</span><span class="p">,</span><span class="s">'G'</span><span class="p">:</span><span class="mf">392.00</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="mf">440.00</span><span class="p">,</span><span class="s">'B'</span><span class="p">:</span><span class="mf">493.88</span><span class="p">}</span>
<span class="n">sounds</span><span class="p">,</span> <span class="n">wave_data</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">snd</span><span class="p">,</span> <span class="n">wave</span> <span class="o">=</span> <span class="n">make_note</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">sounds</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span>
    <span class="n">wave_data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">wave</span>
</code></pre></div></div>

<p>Each sound object can be played instantly with <code class="language-plaintext highlighter-rouge">sounds[n].play()</code>, while <code class="language-plaintext highlighter-rouge">wave_data[n]</code> stores the corresponding waveform for visualization. Try printing one waveform — it’s an array of thousands of amplitude samples.</p>

<p>By synthesizing tones mathematically, you’re effectively writing your own instrument.</p>

<hr />

<h2 id="sequencer-pattern--grid-layout">Sequencer Pattern &amp; Grid Layout</h2>

<p>A <strong>sequencer</strong> is a visual representation of musical timing. Here, rows are notes and columns are beats (steps). Each cell can be toggled on/off to represent a note being played.</p>

<h3 id="creating-a-pattern-structure">Creating a Pattern Structure</h3>

<p>We’ll define 32 steps and a default melody pattern.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">steps</span> <span class="o">=</span> <span class="mi">32</span>

<span class="k">def</span> <span class="nf">default_pattern</span><span class="p">():</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">8</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">24</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span> <span class="n">pat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">default_pattern</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></div>

<p>Each note has an array of length 32 containing 0s and 1s. A <code class="language-plaintext highlighter-rouge">1</code> means that note should play on that step.</p>

<h3 id="grid-geometry">Grid Geometry</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">margin_left</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">grid_top</span> <span class="o">=</span> <span class="mi">320</span>
<span class="n">cell_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">margin_left</span> <span class="o">-</span> <span class="mi">40</span> <span class="o">-</span> <span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps</span>
<span class="n">cell_h</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div></div>

<p>We calculate dynamic dimensions to ensure a uniform layout.</p>

<h3 id="drawing-the-grid">Drawing the Grid</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_grid</span><span class="p">():</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">grid_top</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cell_w</span><span class="p">,</span> <span class="n">cell_h</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">cell_w</span> <span class="o">+</span> <span class="n">spacing</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">cell_h</span> <span class="o">+</span> <span class="n">spacing</span>
</code></pre></div></div>

<p>Every redraw shows current pattern states. Toggling cells simply flips between 0 and 1.</p>

<p>💡 <em>Pro Tip:</em> This data-driven grid mirrors how MIDI clip editors work in professional DAWs.</p>

<hr />

<h2 id="buttons-save-load-clear">Buttons: Save, Load, Clear</h2>

<p>We’ll now add <strong>Save</strong>, <strong>Load</strong>, and <strong>Clear</strong> buttons for control. These features make your sequencer persistent and user-friendly.</p>

<h3 id="creating-buttons">Creating Buttons</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">50</span>
<span class="n">save_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">load_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">clear_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">340</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
</code></pre></div></div>

<p>Each <code class="language-plaintext highlighter-rouge">pygame.Rect</code> defines the clickable area for a button.</p>

<h3 id="drawing-buttons">Drawing Buttons</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_button</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)):</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">rect</span><span class="p">.</span><span class="n">w</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">rect</span><span class="p">.</span><span class="n">h</span><span class="o">//</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="handling-events">Handling Events</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">):</span>
    <span class="n">save_pattern</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">):</span>
    <span class="n">load_pattern</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">clear_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="save-and-load-logic">Save and Load Logic</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">save_pattern</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pattern.json'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">load_pattern</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">pattern</span>
    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'pattern.json'</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pattern.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="why-use-json">Why Use JSON?</h3>
<p>It’s lightweight, readable, and editable. You can even open your melody file in a text editor and modify it manually.</p>

<p>The <strong>Clear</strong> button resets all notes, making quick restarts effortless.</p>

<p>This section establishes the basic file management and editing functions that make your app feel professional and reusable.</p>

<hr />

<h2 id="slider-for-loop-control">Slider for Loop Control</h2>

<p>The <strong>loop slider</strong> determines how many steps are played before restarting. This allows you to fine-tune short loops during composition.</p>

<h3 id="define-geometry">Define Geometry</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">slider_x</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">slider_y</span> <span class="o">=</span> <span class="mi">260</span>
<span class="n">slider_w</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">slider_x</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">slider_h</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">slider_val</span> <span class="o">=</span> <span class="mi">31</span>
<span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div></div>

<h3 id="drawing">Drawing</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_slider</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">handle_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">handle_x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s">"Loop end: </span><span class="si">{</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">30</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">handle_x</span>
</code></pre></div></div>

<h3 id="event-handling">Event Handling</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span> <span class="ow">and</span> <span class="n">slider_y</span> <span class="o">&lt;=</span> <span class="n">event</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">slider_y</span> <span class="o">+</span> <span class="n">slider_h</span><span class="p">:</span>
    <span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
    <span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEMOTION</span> <span class="ow">and</span> <span class="n">slider_dragging</span><span class="p">:</span>
    <span class="n">rel_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">slider_x</span><span class="p">,</span> <span class="n">slider_w</span><span class="p">))</span>
    <span class="n">slider_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">rel_x</span> <span class="o">/</span> <span class="n">slider_w</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<p>This simple code lets you dynamically shorten or extend the loop range visually.</p>

<hr />

<h2 id="waveform-visualization">Waveform Visualization</h2>

<p>The waveform visually represents sound energy across time. By showing the amplitude of the audio signal, users gain a deeper understanding of how sound behaves.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
<span class="n">current_frame_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">draw_waveform</span><span class="p">():</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rect</span><span class="o">=</span><span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="mi">120</span><span class="p">))</span>
    <span class="n">mid_y</span> <span class="o">=</span> <span class="mi">180</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="n">W</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">mid_y</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">mid_y</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"Waveform"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
</code></pre></div></div>

<p>Each new note updates the <code class="language-plaintext highlighter-rouge">wave_buffer</code>, shifting data like an oscilloscope trace.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_frame_wave</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>You can extend this with note-specific colors or FFT-based frequency visualizations for advanced analysis.</p>

<hr />

<h2 id="playback-thread">Playback Thread</h2>

<p>We separate playback from UI rendering for responsiveness. Threading allows smooth visuals while maintaining precise timing.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">playback_loop</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">step</span><span class="p">,</span> <span class="n">wave_buffer</span><span class="p">,</span> <span class="n">current_frame_wave</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">playing</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last</span> <span class="o">&gt;=</span> <span class="n">beat_time</span><span class="p">:</span>
            <span class="n">active_notes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span> <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">step</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">active_notes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">active_notes</span><span class="p">:</span>
                    <span class="n">sounds</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">play</span><span class="p">()</span>
                    <span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="n">W</span><span class="o">//</span><span class="mi">2</span><span class="p">:],</span> <span class="n">wave_data</span><span class="p">[</span><span class="n">n</span><span class="p">][:</span><span class="n">W</span><span class="o">//</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="n">slider_val</span> <span class="k">else</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">playback_loop</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></div>

<p>This ensures the app continues to draw and respond even as notes play precisely in rhythm.</p>

<hr />

<h2 id="main-loop--event-handling">Main Loop &amp; Event Handling</h2>

<p>The main loop manages all user input, drawing, and updates. It listens for mouse clicks to toggle notes, adjust sliders, or click buttons.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">playing</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">beat_time</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">step</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mouse_pos</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="n">get_pos</span><span class="p">()</span>
            <span class="c1"># handle buttons and slider
</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">draw_button</span><span class="p">(</span><span class="n">save_btn</span><span class="p">,</span> <span class="s">"SAVE"</span><span class="p">)</span>
    <span class="n">draw_button</span><span class="p">(</span><span class="n">load_btn</span><span class="p">,</span> <span class="s">"LOAD"</span><span class="p">)</span>
    <span class="n">draw_button</span><span class="p">(</span><span class="n">clear_btn</span><span class="p">,</span> <span class="s">"CLEAR"</span><span class="p">)</span>
    <span class="n">draw_slider</span><span class="p">(</span><span class="n">slider_x</span><span class="p">,</span> <span class="n">slider_y</span><span class="p">,</span> <span class="n">slider_w</span><span class="p">,</span> <span class="n">slider_h</span><span class="p">,</span> <span class="n">slider_val</span><span class="p">)</span>
    <span class="n">draw_waveform</span><span class="p">()</span>
    <span class="n">draw_grid</span><span class="p">()</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</code></pre></div></div>

<p>This loop ties together all the UI elements into one cohesive, reactive system.</p>

<hr />

<h3 id="a-sample-jingle-bells-melody-json-file">A sample Jingle bells Melody json file</h3>

<p>jingle.json</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jingle bells {"C": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "D": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0], "E": [1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], "F": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "G": [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0], "A": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}
</code></pre></div></div>

<h2 id="complete-code">Complete Code</h2>

<h3 id="pyshine_music_maker">pyshine_music_maker</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">threading</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>

<span class="c1"># Settings 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">750</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"PyShine Music Maker (Save/Load + Clear + Slider)"</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="c1"># Synthetic piano 
</span><span class="n">fs</span> <span class="o">=</span> <span class="mi">44100</span>
<span class="n">waveform_height</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">waveform_buffer_len</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="k">def</span> <span class="nf">make_note</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">*</span><span class="n">duration</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">env</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span><span class="o">*</span><span class="mi">32767</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">audio</span><span class="p">,</span><span class="n">audio</span><span class="p">))),</span> <span class="n">wave</span>

<span class="n">notes</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span><span class="mf">261.63</span><span class="p">,</span><span class="s">'D'</span><span class="p">:</span><span class="mf">293.66</span><span class="p">,</span><span class="s">'E'</span><span class="p">:</span><span class="mf">329.63</span><span class="p">,</span><span class="s">'F'</span><span class="p">:</span><span class="mf">349.23</span><span class="p">,</span>
         <span class="s">'G'</span><span class="p">:</span><span class="mf">392.00</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="mf">440.00</span><span class="p">,</span><span class="s">'B'</span><span class="p">:</span><span class="mf">493.88</span><span class="p">}</span>

<span class="n">sounds</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">wave_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">snd</span><span class="p">,</span> <span class="n">wave</span> <span class="o">=</span> <span class="n">make_note</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">sounds</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span>
    <span class="n">wave_data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">wave</span>

<span class="c1"># Pattern 
</span><span class="n">steps</span> <span class="o">=</span> <span class="mi">32</span>
<span class="k">def</span> <span class="nf">default_pattern</span><span class="p">():</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">8</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">9</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">17</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">24</span><span class="p">),(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">25</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span> <span class="n">pat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">default_pattern</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Layout 
</span><span class="n">margin_left</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">waveform_top</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">grid_top</span> <span class="o">=</span> <span class="n">waveform_top</span> <span class="o">+</span> <span class="n">waveform_height</span> <span class="o">+</span> <span class="mi">50</span>
<span class="n">grid_width</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">margin_left</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">cell_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_width</span> <span class="o">-</span> <span class="n">spacing</span><span class="o">*</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">steps</span>
<span class="n">cell_h</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># Buttons 
</span><span class="n">btn_w</span> <span class="o">=</span> <span class="mi">120</span>  <span class="c1"># reduced width
</span><span class="n">btn_h</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">save_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">load_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">clear_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">340</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>

<span class="c1"># Slider 
</span><span class="n">slider_x</span> <span class="o">=</span> <span class="n">margin_left</span>
<span class="n">slider_y</span> <span class="o">=</span> <span class="n">grid_top</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">slider_w</span> <span class="o">=</span> <span class="n">grid_width</span>
<span class="n">slider_h</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">slider_val</span> <span class="o">=</span> <span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># return cell id default at last step
</span><span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">draw_slider</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
    <span class="n">handle_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">handle_x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">handle_x</span>

<span class="c1"># Playback 
</span><span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">bpm</span> <span class="o">=</span> <span class="mi">180</span>
<span class="n">playing</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">beat_time</span> <span class="o">=</span> <span class="mi">60</span><span class="o">/</span><span class="n">bpm</span>
<span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Rolling waveform 
</span><span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">waveform_buffer_len</span><span class="p">)</span>
<span class="n">current_frame_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>

<span class="c1"># Draw waveform 
</span><span class="k">def</span> <span class="nf">draw_waveform</span><span class="p">():</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rect</span><span class="o">=</span><span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">waveform_top</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">waveform_height</span><span class="p">))</span>
    <span class="n">mid_y</span> <span class="o">=</span> <span class="n">waveform_top</span> <span class="o">+</span> <span class="n">waveform_height</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="n">W</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">W</span> <span class="k">else</span> <span class="n">np</span><span class="p">.</span><span class="n">pad</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">,</span> <span class="p">(</span><span class="n">W</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">),</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">mid_y</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">waveform_height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">mid_y</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">*</span><span class="n">waveform_height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">))</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mid_y</span><span class="p">),</span> <span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">mid_y</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>


<span class="c1"># Playback thread 
</span><span class="k">def</span> <span class="nf">playback_loop</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">step</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">wave_buffer</span><span class="p">,</span> <span class="n">current_frame_wave</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">playing</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last</span> <span class="o">&gt;=</span> <span class="n">beat_time</span><span class="p">:</span>
            <span class="n">step_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">wave_data</span><span class="p">.</span><span class="n">values</span><span class="p">()))))</span>
            <span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span><span class="p">)[</span><span class="n">step</span><span class="p">]:</span>
                    <span class="n">sounds</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">play</span><span class="p">()</span>
                    <span class="n">step_wave</span> <span class="o">+=</span> <span class="n">wave_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">active</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
                <span class="n">step_wave</span> <span class="o">=</span> <span class="n">step_wave</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">step_wave</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">step_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">step_wave</span><span class="p">)</span>
            <span class="n">current_frame_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">step_wave</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">),</span>
                                           <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_wave</span><span class="p">)),</span> <span class="n">step_wave</span><span class="p">)</span>
            <span class="c1"># Increment step
</span>            <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># If step exceeds slider_val, loop back to start (0) or slider start
</span>            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">slider_val</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># you can also set to slider_start if you want
</span>            <span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_frame_wave</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">current_frame_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">current_frame_wave</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.005</span><span class="p">)</span>

<span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">playback_loop</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># File picker overlay with blinking cursor 
</span><span class="k">def</span> <span class="nf">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.json'</span><span class="p">)]</span>
    <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">input_text</span> <span class="o">=</span> <span class="s">"new_file.json"</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="s">""</span>
    <span class="n">typing_active</span> <span class="o">=</span> <span class="n">for_save</span>
    <span class="n">cursor_visible</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">cursor_timer</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">while</span> <span class="n">picker_open</span><span class="p">:</span>
        <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">"Enter filename to SAVE:"</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="s">"Select file to LOAD:"</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>

        <span class="n">file_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">file_rects</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">fname</span><span class="p">,</span> <span class="n">rect</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">for_save</span><span class="p">:</span>
            <span class="n">input_rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span> <span class="n">input_rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">input_text</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">input_rect</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">cursor_timer</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">cursor_visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">cursor_visible</span>
                <span class="n">cursor_timer</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cursor_visible</span> <span class="ow">and</span> <span class="n">typing_active</span><span class="p">:</span>
                <span class="n">cursor_x</span> <span class="o">=</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">font</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="n">input_text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cursor_y</span> <span class="o">=</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">5</span>
                <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">cursor_x</span><span class="p">,</span> <span class="n">cursor_y</span><span class="p">),</span> <span class="p">(</span><span class="n">cursor_x</span><span class="p">,</span> <span class="n">cursor_y</span> <span class="o">+</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
                <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
                <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">file_rects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">for_save</span><span class="p">:</span>
                        <span class="n">selected</span> <span class="o">=</span> <span class="n">fname</span>
                        <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">for_save</span> <span class="ow">and</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                    <span class="n">typing_active</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">typing_active</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">typing_active</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_BACKSPACE</span><span class="p">:</span>
                    <span class="n">input_text</span> <span class="o">=</span> <span class="n">input_text</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_RETURN</span><span class="p">:</span>
                    <span class="n">selected</span> <span class="o">=</span> <span class="n">input_text</span>
                    <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">input_text</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="nb">unicode</span>

    <span class="k">return</span> <span class="n">selected</span>

<span class="c1"># Main loop 
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>

    <span class="c1"># Buttons
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">180</span><span class="p">),</span> <span class="n">save_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">load_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">clear_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"SAVE"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">save_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"LOAD"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">load_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"CLEAR"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">clear_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">clear_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>

    <span class="c1"># Slider
</span>    <span class="n">slider_handle</span> <span class="o">=</span> <span class="n">draw_slider</span><span class="p">(</span><span class="n">slider_x</span><span class="p">,</span> <span class="n">slider_y</span><span class="p">,</span> <span class="n">slider_w</span><span class="p">,</span> <span class="n">slider_h</span><span class="p">,</span> <span class="n">slider_val</span><span class="p">)</span>

    <span class="c1"># Waveform
</span>    <span class="n">draw_waveform</span><span class="p">()</span>

    <span class="c1"># Grid
</span>    <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">grid_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">cell_h</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cell_w</span><span class="p">,</span> <span class="n">cell_h</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span> <span class="k">if</span> <span class="n">pattern</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span><span class="p">)[</span><span class="n">c</span><span class="p">]</span> <span class="k">else</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">step</span><span class="p">:</span> <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

    <span class="c1"># Events 
</span>    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="k">if</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">target_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target_file</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_file</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".json"</span><span class="p">):</span>
                        <span class="n">target_file</span> <span class="o">+=</span> <span class="s">".json"</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span><span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"Saved to:"</span><span class="p">,</span> <span class="n">target_file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">chosen_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chosen_file</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chosen_file</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">loaded_pattern</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{}</span>
                        <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">loaded_pattern</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"Loaded:"</span><span class="p">,</span> <span class="n">chosen_file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">clear_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Cleared all cells"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">slider_x</span><span class="p">,</span> <span class="n">slider_y</span><span class="p">,</span> <span class="n">slider_w</span><span class="p">,</span> <span class="n">slider_h</span><span class="p">).</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Toggle grid cells
</span>                <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">grid_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cell_w</span><span class="p">,</span><span class="n">cell_h</span><span class="p">).</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                            <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
            <span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEMOTION</span> <span class="ow">and</span> <span class="n">slider_dragging</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="c1"># Clamp and convert to cell id
</span>            <span class="n">slider_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">mx</span> <span class="o">-</span> <span class="n">slider_x</span><span class="p">)</span> <span class="o">/</span> <span class="n">slider_w</span> <span class="o">*</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">slider_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">slider_val</span><span class="p">))</span>

    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>


</code></pre></div></div>

<h2 id="running-the-application">Running the Application</h2>

<p>Install dependencies and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pygame numpy
python pyshine_music_maker.py
</code></pre></div></div>

<p>Click cells to activate notes, save and load patterns, clear the grid, and adjust the loop length with the slider.</p>

<hr />

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>Audio synthesis using NumPy sine waves and harmonics.</li>
  <li>Threaded design for real-time interactivity.</li>
  <li>Dynamic GUI layout in Pygame.</li>
  <li>JSON-based pattern persistence.</li>
  <li>Visualization of digital waveforms.</li>
</ul>

<hr />

<h2 id="further-ideas">Further Ideas</h2>

<ul>
  <li>Add more octaves and instruments.</li>
  <li>Implement a tempo (BPM) slider.</li>
  <li>Add real-time recording or export to WAV/MIDI.</li>
  <li>Use color-coded notes by frequency.</li>
  <li>Animate transitions between steps for visual rhythm tracking.</li>
</ul>

<hr />

<p>This in-depth guide transforms your simple code into a <strong>mini music production environment</strong> — blending coding, sound design, and interactive graphics beautifully.</p>]]></content><author><name>PyShine Team</name></author><category term="pygame" /><category term="music" /><category term="interactive" /><category term="beginner" /><category term="python" /><summary type="html"><![CDATA[A deeply detailed beginner-friendly guide to building a complete interactive music maker in Python with Pygame, featuring waveform visualization, save/load, clear button, threading, and loop control slider.]]></summary></entry><entry><title type="html">Mini Paint (Smooth Circular Brush) in Python</title><link href="https://www.pyshine.com/Paint-Brush-Python-copy/" rel="alternate" type="text/html" title="Mini Paint (Smooth Circular Brush) in Python" /><published>2025-10-31T00:00:00+00:00</published><updated>2025-10-31T00:00:00+00:00</updated><id>https://www.pyshine.com/Paint-Brush-Python%20copy</id><content type="html" xml:base="https://www.pyshine.com/Paint-Brush-Python-copy/"><![CDATA[<h1 id="️-mini-paint-tutorial-smooth-circular-brush">🖌️ Mini Paint Tutorial (Smooth Circular Brush)</h1>

<h3 id="educational-python-project--create-an-interactive-painting-app">Educational Python Project – Create an Interactive Painting App</h3>

<p>This tutorial walks through building a <strong>Mini Paint application</strong> using <strong>Python and Pygame</strong>. The app allows users to <strong>draw with smooth circular brushes</strong>, choose from multiple colors, and select different brush sizes.</p>

<hr />

<h2 id="features">Features</h2>

<ul>
  <li>✅ 7 colors</li>
  <li>✅ 4 brush sizes</li>
  <li>✅ Smooth, circle-based strokes</li>
  <li>✅ Compact toolbar (portrait 400x900)</li>
</ul>

<hr />

<h2 id="requirements">Requirements</h2>

<ul>
  <li>Python 3.x</li>
  <li>Pygame library</li>
</ul>

<p>Install Pygame if you don’t have it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pygame
</code></pre></div></div>

<hr />

<h2 id="step-1-setup-pygame-window">Step 1: Setup Pygame Window</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># Screen setup
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">900</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Mini Paint - Smooth Circles"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-2-define-colors-and-brush-sizes">Step 2: Define Colors and Brush Sizes</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="c1"># Red
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1"># Orange
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1"># Yellow
</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="c1"># Green
</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>     <span class="c1"># Blue
</span>    <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span>    <span class="c1"># Indigo
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>  <span class="c1"># White (eraser)
</span><span class="p">]</span>

<span class="n">brush_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
<span class="n">current_color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">current_size</span> <span class="o">=</span> <span class="n">brush_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<hr />

<h2 id="step-3-setup-toolbar">Step 3: Setup Toolbar</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">toolbar_height</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">color_buttons</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">size_buttons</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Color buttons
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">10</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">color_buttons</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">rect</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

<span class="c1"># Size buttons
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">brush_sizes</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">90</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">75</span>
    <span class="n">size_buttons</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
</code></pre></div></div>

<hr />

<h2 id="step-4-create-smooth-brush-function">Step 4: Create Smooth Brush Function</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_smooth_circle_line</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-5-main-loop">Step 5: Main Loop</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drawing</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="c1"># Select color
</span>            <span class="k">for</span> <span class="n">rect</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color_buttons</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">):</span>
                    <span class="n">current_color</span> <span class="o">=</span> <span class="n">c</span>
            <span class="c1"># Select brush size
</span>            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size_buttons</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">my</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">current_size</span> <span class="o">=</span> <span class="n">s</span>
            <span class="c1"># Start drawing
</span>            <span class="k">if</span> <span class="n">my</span> <span class="o">&gt;</span> <span class="n">toolbar_height</span><span class="p">:</span>
                <span class="n">drawing</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">last_pos</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>

        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
            <span class="n">drawing</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Drawing
</span>    <span class="k">if</span> <span class="n">drawing</span><span class="p">:</span>
        <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">my</span> <span class="o">&gt;</span> <span class="n">toolbar_height</span> <span class="ow">and</span> <span class="n">last_pos</span><span class="p">:</span>
            <span class="n">draw_smooth_circle_line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">current_color</span><span class="p">,</span> <span class="n">last_pos</span><span class="p">,</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">),</span> <span class="n">current_size</span><span class="p">)</span>
        <span class="n">last_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">)</span>

    <span class="c1"># Toolbar background
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">toolbar_height</span><span class="p">))</span>

    <span class="c1"># Draw color buttons
</span>    <span class="k">for</span> <span class="n">rect</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color_buttons</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">current_color</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Draw brush size selectors
</span>    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size_buttons</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">current_size</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="complete-python-code">Complete Python Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">math</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># Screen setup 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">900</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Mini Paint - Smooth Circles"</span><span class="p">)</span>

<span class="c1"># Colors
</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="c1"># Red
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1"># Orange
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1"># Yellow
</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="c1"># Green
</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>     <span class="c1"># Blue
</span>    <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span>    <span class="c1"># Indigo
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>  <span class="c1"># White (eraser)
</span><span class="p">]</span>
<span class="n">brush_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
<span class="n">current_color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">current_size</span> <span class="o">=</span> <span class="n">brush_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Toolbar setup 
</span><span class="n">toolbar_height</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">color_buttons</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">size_buttons</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Color button positions
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">10</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">color_buttons</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">rect</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

<span class="c1"># Size buttons (circles)
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">brush_sizes</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">90</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">75</span>
    <span class="n">size_buttons</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

<span class="n">drawing</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">draw_smooth_circle_line</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
    <span class="s">"""Draw smooth brush stroke using overlapping circles"""</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="p">)</span>

<span class="c1"># Main Loop
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

        <span class="c1"># Mouse down
</span>        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="c1"># Select color
</span>            <span class="k">for</span> <span class="n">rect</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color_buttons</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">):</span>
                    <span class="n">current_color</span> <span class="o">=</span> <span class="n">c</span>
            <span class="c1"># Select brush size
</span>            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size_buttons</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">my</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">current_size</span> <span class="o">=</span> <span class="n">s</span>
            <span class="c1"># Start drawing
</span>            <span class="k">if</span> <span class="n">my</span> <span class="o">&gt;</span> <span class="n">toolbar_height</span><span class="p">:</span>
                <span class="n">drawing</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">last_pos</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>

        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
            <span class="n">drawing</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Drawing with smooth circular brush 
</span>    <span class="k">if</span> <span class="n">drawing</span><span class="p">:</span>
        <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">my</span> <span class="o">&gt;</span> <span class="n">toolbar_height</span> <span class="ow">and</span> <span class="n">last_pos</span><span class="p">:</span>
            <span class="n">draw_smooth_circle_line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">current_color</span><span class="p">,</span> <span class="n">last_pos</span><span class="p">,</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">),</span> <span class="n">current_size</span><span class="p">)</span>
        <span class="n">last_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">)</span>

    <span class="c1"># Toolbar background 
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">toolbar_height</span><span class="p">))</span>

    <span class="c1"># Draw color buttons
</span>    <span class="k">for</span> <span class="n">rect</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color_buttons</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">current_color</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Draw brush size selectors
</span>    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size_buttons</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">current_size</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>You now have a working Mini Paint application with smooth circular brushes, multiple colors, and variable brush sizes! This is a fun project to practice <strong>interactive GUI programming in Python using Pygame</strong>.</p>

<p>Enjoy painting!</p>]]></content><author><name>PyShine Team</name></author><category term="mini-paint" /><category term="pygame" /><category term="interactive-drawing" /><category term="python-tutorial" /><summary type="html"><![CDATA[Build a simple interactive painting app with smooth circular brushes using Python and Pygame.]]></summary></entry><entry><title type="html">Music Maker with Save/Load in Python</title><link href="https://www.pyshine.com/Pygame-Music-Maker-Box/" rel="alternate" type="text/html" title="Music Maker with Save/Load in Python" /><published>2025-10-31T00:00:00+00:00</published><updated>2025-10-31T00:00:00+00:00</updated><id>https://www.pyshine.com/Pygame-Music-Maker-Box</id><content type="html" xml:base="https://www.pyshine.com/Pygame-Music-Maker-Box/"><![CDATA[<h1 id="interactive-music-maker-in-python-with-pygame">Interactive Music Maker in Python with Pygame</h1>

<h3 id="beginner-friendly-tutorial--build-a-synth-piano-with-saveload">Beginner-Friendly Tutorial – Build a Synth Piano with Save/Load</h3>

<p>This tutorial walks you through creating an <strong>interactive music maker</strong> using <strong>Python and Pygame</strong>. You’ll learn how to build a <strong>synthetic piano</strong>, <strong>draw a sequencer grid</strong>, and <strong>save/load your music patterns</strong>. By the end, you’ll have a working <strong>step sequencer</strong> for simple melodies.</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#setting-up-pygame">Setting Up Pygame</a></li>
  <li><a href="#creating-the-synthetic-piano">Creating the Synthetic Piano</a></li>
  <li><a href="#sequencer-grid--layout">Sequencer Grid &amp; Layout</a></li>
  <li><a href="#save--load-buttons">Save &amp; Load Buttons</a></li>
  <li><a href="#event-handling">Event Handling</a></li>
  <li><a href="#playback-logic">Playback Logic</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-to-run">How to Run</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-ideas">Further Ideas</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>This project creates a <strong>simple step sequencer</strong> where each row represents a note (C, D, E, F, G, A) and each column is a step in the melody. You can toggle notes on/off, <strong>play the melody</strong>, and <strong>save/load patterns</strong> to/from files.</p>

<p>Key features:</p>
<ul>
  <li>Real-time playback of a synthetic piano</li>
  <li>Clickable grid for sequencing notes</li>
  <li>Save and load your music patterns using JSON</li>
  <li>Beginner-friendly Pygame implementation</li>
</ul>

<h2 id="setting-up-pygame">Setting Up Pygame</h2>

<p>Start by importing libraries and initializing Pygame.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="window-and-font">Window and Font</h3>

<p>Set the window size, caption, and font.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Music Maker(Save/Load)"</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="creating-the-synthetic-piano">Creating the Synthetic Piano</h2>

<p>We’ll synthesize simple piano notes using <strong>numpy arrays</strong> and exponential decay envelopes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fs</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">44100</span><span class="p">,</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">make_note</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">*</span><span class="n">duration</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># decay envelope
</span>    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">env</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span><span class="o">*</span><span class="mi">32767</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">audio</span><span class="p">,</span><span class="n">audio</span><span class="p">)))</span>

<span class="n">notes</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span><span class="mf">261.63</span><span class="p">,</span><span class="s">'D'</span><span class="p">:</span><span class="mf">293.66</span><span class="p">,</span><span class="s">'E'</span><span class="p">:</span><span class="mf">329.63</span><span class="p">,</span><span class="s">'F'</span><span class="p">:</span><span class="mf">349.23</span><span class="p">,</span><span class="s">'G'</span><span class="p">:</span><span class="mf">392.00</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="mf">440.00</span><span class="p">}</span>
<span class="n">sounds</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">make_note</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div></div>

<p>This creates <strong>6 piano notes</strong> using a <strong>harmonic sum of sine waves</strong>.</p>

<h2 id="sequencer-grid--layout">Sequencer Grid &amp; Layout</h2>

<p>Define a <strong>default pattern</strong> and layout for the grid.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">steps</span> <span class="o">=</span> <span class="mi">32</span>

<span class="k">def</span> <span class="nf">default_pattern</span><span class="p">():</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">8</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">9</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">17</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">24</span><span class="p">),(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">25</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span> <span class="n">pat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">default_pattern</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Layout
</span><span class="n">margin_left</span><span class="p">,</span> <span class="n">margin_top</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">150</span>
<span class="n">grid_width</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">margin_left</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">cell_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_width</span> <span class="o">-</span> <span class="n">spacing</span><span class="o">*</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">steps</span>
<span class="n">cell_h</span> <span class="o">=</span> <span class="mi">50</span>
</code></pre></div></div>

<p>Each <strong>cell in the grid</strong> represents a step in a sequence.</p>

<h2 id="save--load-buttons">Save &amp; Load Buttons</h2>

<p>Create <strong>buttons</strong> at the top for saving and loading your patterns.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">50</span>
<span class="n">save_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">load_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">btn_w</span> <span class="o">-</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
</code></pre></div></div>

<p>We’ll also add a <strong>file picker overlay</strong> for selecting files.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.txt'</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">for_save</span> <span class="ow">and</span> <span class="s">"new_file.txt"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">files</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"new_file.txt"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

    <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">while</span> <span class="n">picker_open</span><span class="p">:</span>
        <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">"Select file to SAVE:"</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="s">"Select file to LOAD:"</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">file_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">file_rects</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">fname</span><span class="p">,</span> <span class="n">rect</span><span class="p">))</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
                <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
                <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">file_rects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                        <span class="n">selected</span> <span class="o">=</span> <span class="n">fname</span>
                        <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">selected</span>
</code></pre></div></div>

<h2 id="event-handling">Event Handling</h2>

<p>Handle mouse clicks for <strong>toggle notes</strong> and <strong>buttons</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
        <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
        <span class="k">if</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
            <span class="n">target_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_file</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span><span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
            <span class="n">chosen_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chosen_file</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chosen_file</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Toggle grid cell
</span>            <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">margin_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cell_w</span><span class="p">,</span><span class="n">cell_h</span><span class="p">).</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                        <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span>
</code></pre></div></div>

<h2 id="playback-logic">Playback Logic</h2>

<p>Define <strong>bpm, step, and timing</strong> for playback.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">step</span><span class="p">,</span> <span class="n">bpm</span><span class="p">,</span> <span class="n">playing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="bp">True</span>
<span class="n">beat_time</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">60</span><span class="o">/</span><span class="n">bpm</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">if</span> <span class="n">playing</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">last</span> <span class="o">&gt;=</span> <span class="n">beat_time</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">step</span><span class="p">]:</span> <span class="n">sounds</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">play</span><span class="p">()</span>
    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">steps</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>

<span class="c1">#  Settings 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">" Music Maker(Save/Load)"</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="c1">#  Synthetic piano 
</span><span class="n">fs</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">44100</span><span class="p">,</span> <span class="mi">1</span>
<span class="k">def</span> <span class="nf">make_note</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">*</span><span class="n">duration</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">env</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span><span class="o">*</span><span class="mi">32767</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">audio</span><span class="p">,</span><span class="n">audio</span><span class="p">)))</span>

<span class="n">notes</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span><span class="mf">261.63</span><span class="p">,</span><span class="s">'D'</span><span class="p">:</span><span class="mf">293.66</span><span class="p">,</span><span class="s">'E'</span><span class="p">:</span><span class="mf">329.63</span><span class="p">,</span><span class="s">'F'</span><span class="p">:</span><span class="mf">349.23</span><span class="p">,</span><span class="s">'G'</span><span class="p">:</span><span class="mf">392.00</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="mf">440.00</span><span class="p">}</span>
<span class="n">sounds</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">make_note</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">.</span><span class="n">items</span><span class="p">()}</span>

<span class="c1">#  Default pattern (Twinkle Twinkle) 
</span><span class="n">steps</span> <span class="o">=</span> <span class="mi">32</span>
<span class="k">def</span> <span class="nf">default_pattern</span><span class="p">():</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">8</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">9</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">17</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">24</span><span class="p">),(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">25</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span> <span class="n">pat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">default_pattern</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1">#  Layout 
</span><span class="n">margin_left</span><span class="p">,</span> <span class="n">margin_top</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">150</span>
<span class="n">grid_width</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">margin_left</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">cell_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_width</span> <span class="o">-</span> <span class="n">spacing</span><span class="o">*</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">steps</span>
<span class="n">cell_h</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1">#  Buttons at Top 
</span><span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">50</span>
<span class="n">save_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">load_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">btn_w</span> <span class="o">-</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>

<span class="c1">#  Playback 
</span><span class="n">step</span><span class="p">,</span> <span class="n">bpm</span><span class="p">,</span> <span class="n">playing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="bp">True</span>
<span class="n">beat_time</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">60</span><span class="o">/</span><span class="n">bpm</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1">#  Pygame-native file picker 
</span><span class="k">def</span> <span class="nf">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.txt'</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">for_save</span> <span class="ow">and</span> <span class="s">"new_file.txt"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>  <span class="c1"># allow saving to new file
</span>        <span class="n">files</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"new_file.txt"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

    <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">while</span> <span class="n">picker_open</span><span class="p">:</span>
        <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">"Select file to SAVE:"</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="s">"Select file to LOAD:"</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">file_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">file_rects</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">fname</span><span class="p">,</span> <span class="n">rect</span><span class="p">))</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
                <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
                <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">file_rects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                        <span class="n">selected</span> <span class="o">=</span> <span class="n">fname</span>
                        <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">selected</span>

<span class="c1">#  Main loop 
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>

    <span class="c1"># Draw buttons
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">180</span><span class="p">),</span> <span class="n">save_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">load_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"SAVE"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">save_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">65</span><span class="p">,</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"LOAD"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">load_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">65</span><span class="p">,</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>

    <span class="c1"># Draw grid
</span>    <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">margin_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">cell_h</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cell_w</span><span class="p">,</span> <span class="n">cell_h</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span> <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">else</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">step</span><span class="p">:</span> <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

    <span class="c1">#  Events 
</span>    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="k">if</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">target_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target_file</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span><span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"Saved to:"</span><span class="p">,</span> <span class="n">target_file</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"Save error:"</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">chosen_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chosen_file</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chosen_file</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                                <span class="n">pattern</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">}</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"Loaded:"</span><span class="p">,</span> <span class="n">chosen_file</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"Load error:"</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
                        <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Toggle grid cell
</span>                <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">margin_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cell_w</span><span class="p">,</span><span class="n">cell_h</span><span class="p">).</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                            <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span>

    <span class="c1">#  Playback 
</span>    <span class="k">if</span> <span class="n">playing</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">last</span> <span class="o">&gt;=</span> <span class="n">beat_time</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">step</span><span class="p">]:</span> <span class="n">sounds</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">play</span><span class="p">()</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">steps</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

</code></pre></div></div>

<p>An example Twinkle Twinkle Little Star music text file is here. Copy the following and paste in a new 
twinkle.txt file you can load it later</p>

<h3 id="twinkletxt">twinkle.txt</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{"C": [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "D": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0], "E": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0], "F": [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0], "G": [0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0], "A": [0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}
</code></pre></div></div>

<h2 id="how-to-run">How to Run</h2>

<ol>
  <li>Install dependencies:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pygame numpy
</code></pre></div>    </div>
  </li>
  <li>Save the <code class="language-plaintext highlighter-rouge">.py</code> file.</li>
  <li>Run:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python music_maker.py
</code></pre></div>    </div>
  </li>
  <li>Click on the grid to toggle notes.</li>
  <li>Use <strong>SAVE</strong> and <strong>LOAD</strong> to persist your patterns.</li>
</ol>

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>Using <strong>Pygame mixer</strong> for custom audio playback</li>
  <li>Creating <strong>synthetic piano notes</strong> with Numpy</li>
  <li>Implementing a <strong>step sequencer grid</strong></li>
  <li>Saving/loading JSON data interactively</li>
  <li>Handling Pygame <strong>mouse events and UI</strong></li>
</ul>

<h2 id="further-ideas">Further Ideas</h2>

<ul>
  <li>Add more notes (B, higher octaves)</li>
  <li>Change <strong>instruments</strong> with different waveforms</li>
  <li>Export pattern to <strong>MIDI</strong></li>
  <li>Add <strong>tempo control slider</strong></li>
  <li>Enhance UI with <strong>colors and animations</strong></li>
</ul>

<hr />

<p>This beginner-friendly tutorial introduces <strong>music programming in Python</strong> and <strong>interactive sequencer logic</strong>. With practice, you can expand this into a <strong>full-fledged music maker</strong> with more features.</p>]]></content><author><name>PyShine Team</name></author><category term="pygame" /><category term="music" /><category term="interactive" /><category term="beginner" /><category term="python" /><summary type="html"><![CDATA[Step-by-step beginner-friendly tutorial on building an interactive music maker with Pygame, including save/load functionality.]]></summary></entry></feed>