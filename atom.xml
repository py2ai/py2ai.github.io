<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://www.pyshine.com/atom.xml" rel="self" type="application/atom+xml" /><link href="https://www.pyshine.com/" rel="alternate" type="text/html" hreflang="en" /><updated>2025-11-04T01:04:42+00:00</updated><id>https://www.pyshine.com/atom.xml</id><title type="html">PyShine</title><subtitle>AI tutorials, insights, and resources on artificial intelligence and machine learning in Python. Learn the latest techniques and best practices.</subtitle><author><name>PyShine Team</name></author><entry><title type="html">Make A Tree With Flowers</title><link href="https://www.pyshine.com/Make-a-tree-with-Flowers/" rel="alternate" type="text/html" title="Make A Tree With Flowers" /><published>2025-11-04T00:00:00+00:00</published><updated>2025-11-04T00:00:00+00:00</updated><id>https://www.pyshine.com/Make-a-tree-with-Flowers</id><content type="html" xml:base="https://www.pyshine.com/Make-a-tree-with-Flowers/"><![CDATA[<h1 id="-turtle-tree-with-blossoms--python-turtle-graphics-tutorial">ðŸŒ¸ Turtle Tree with Blossoms â€” Python Turtle Graphics Tutorial</h1>

<p><strong>Date:</strong> 2025-11-04</p>

<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ol>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#setup-and-imports">Setup and Imports</a></li>
  <li><a href="#generating-random-branch-parameters">Generating Random Branch Parameters</a></li>
  <li><a href="#drawing-functions">Drawing Functions</a></li>
  <li><a href="#main-tree-function">Main Tree Function</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-it-works">How It Works</a></li>
  <li><a href="#run-the-script">Run the Script</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ol>

<hr />

<h2 id="overview">Overview</h2>
<p>This tutorial demonstrates how to create a <strong>beautiful cherry blossom tree</strong> using Pythonâ€™s <code class="language-plaintext highlighter-rouge">turtle</code> graphics module.<br />
The program uses recursion to generate realistic branches, randomization for natural variation, and color blending to simulate blooming flowers.</p>

<hr />

<h2 id="setup-and-imports">Setup and Imports</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">seed</span>

<span class="c1"># Settings
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>
</code></pre></div></div>

<p>We set up the screen dimensions, recursion depth, branch length, and base branch angle.</p>

<hr />

<h2 id="generating-random-branch-parameters">Generating Random Branch Parameters</h2>

<p>Before drawing, we pre-generate random angles and lengths for each branch.<br />
This ensures consistent structure each time the script runs (because we fixed the random seed).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">record_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
    <span class="n">record_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">record_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">record_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>
</code></pre></div></div>

<hr />

<h2 id="drawing-functions">Drawing Functions</h2>

<p>Two helper functions are used:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">blend()</code> for color blending</li>
  <li><code class="language-plaintext highlighter-rouge">draw_flower()</code> for drawing small cherry blossoms</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">draw_flower</span><span class="p">():</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">begin_fill</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">end_fill</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
</code></pre></div></div>

<hr />

<h2 id="main-tree-function">Main Tree Function</h2>

<p>The recursive function <code class="language-plaintext highlighter-rouge">draw_branch()</code> handles branching, coloring, and flower placement.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_branch</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">draw_flower</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEPTH</span> <span class="o">-</span> <span class="n">depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">DEPTH</span>
    <span class="n">brown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">69</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">19</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blend</span><span class="p">(</span><span class="n">brown</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.12</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">DEPTH</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">draw_flower</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
    <span class="n">draw_branch</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
    <span class="n">draw_branch</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s"> Depth: </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">seed</span>

<span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>

<span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">record_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">BA</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">BA</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>
    <span class="n">record_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">record_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">record_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>

<span class="k">def</span> <span class="nf">turtle_tree</span><span class="p">():</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Screen</span><span class="p">()</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Turtle Tree with Flowers"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">"black"</span><span class="p">)</span>
    <span class="n">pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
            <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">c1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_flower</span><span class="p">():</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">fillcolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">begin_fill</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">pen</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
            <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">144</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">end_fill</span><span class="p">()</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">draw_branch</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">draw_flower</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">DEPTH</span> <span class="o">-</span> <span class="n">depth</span><span class="p">)</span> <span class="o">/</span> <span class="n">DEPTH</span>
        <span class="n">brown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">69</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">19</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">139</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="mi">34</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blend</span><span class="p">(</span><span class="n">brown</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">pencolor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.12</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">DEPTH</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">draw_flower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">draw_branch</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
        <span class="n">draw_branch</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s"> Depth: </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>
    <span class="n">draw_branch</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Tree complete."</span><span class="p">)</span>
    <span class="n">turtle</span><span class="p">.</span><span class="n">done</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">turtle_tree</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="how-it-works">How It Works</h2>
<ul>
  <li><strong>Recursion:</strong> Each branch splits into two sub-branches with random angles and lengths.</li>
  <li><strong>Color blending:</strong> Gradually transitions from brown to green as branches move outward.</li>
  <li><strong>Flowers:</strong> Small pink blossoms are drawn at branch tips and occasionally mid-branch.</li>
  <li><strong>Param reuse:</strong> Pre-generated parameters keep the tree consistent on reruns.</li>
</ul>

<hr />

<h2 id="run-the-script">Run the Script</h2>

<p>Save as <code class="language-plaintext highlighter-rouge">turtle_tree.py</code> and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 turtle_tree.py
</code></pre></div></div>

<p>A black screen with a growing cherry blossom tree should appear.</p>

<hr />

<h2 id="conclusion">Conclusion</h2>
<p>This project combines <strong>recursion</strong>, <strong>randomness</strong>, and <strong>color blending</strong> to simulate organic growth.<br />
You can modify parameters like <code class="language-plaintext highlighter-rouge">DEPTH</code>, <code class="language-plaintext highlighter-rouge">LENGTH</code>, and flower colors to create your own natural variations!</p>]]></content><author><name>PyShine Team</name></author><summary type="html"><![CDATA[ðŸŒ¸ Turtle Tree with Blossoms â€” Python Turtle Graphics Tutorial]]></summary></entry><entry><title type="html">Run C++ Code from Python â€“ Step-by-Step Guide</title><link href="https://www.pyshine.com/Run-C++-in-Python/" rel="alternate" type="text/html" title="Run C++ Code from Python â€“ Step-by-Step Guide" /><published>2025-11-03T00:00:00+00:00</published><updated>2025-11-03T00:00:00+00:00</updated><id>https://www.pyshine.com/Run-C++-in-Python</id><content type="html" xml:base="https://www.pyshine.com/Run-C++-in-Python/"><![CDATA[<h1 id="run-c-code-from-python--step-by-step-guide">Run C++ Code from Python â€“ Step-by-Step Guide</h1>

<h3 id="beginner-friendly-tutorial--learn-how-python-can-compile-and-execute-c-code">Beginner-Friendly Tutorial â€“ Learn How Python Can Compile and Execute C++ Code</h3>

<p>Python is an incredibly versatile language, but sometimes you might need the speed and performance of C++. This tutorial explains how to <strong>run C++ code directly from Python</strong>, making it easy to integrate both languages. Youâ€™ll learn how to write, compile, and execute a temporary C++ program from a Python script using the <strong><code class="language-plaintext highlighter-rouge">subprocess</code></strong> and <strong><code class="language-plaintext highlighter-rouge">tempfile</code></strong> modules. This is a great way to understand cross-language execution and automation using Python!</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#why-run-c-from-python">Why Run C++ from Python?</a></li>
  <li><a href="#step-1-writing-c-code-in-python">Step 1: Writing C++ Code in Python</a></li>
  <li><a href="#step-2-compiling-c-code">Step 2: Compiling C++ Code</a></li>
  <li><a href="#step-3-executing-the-compiled-program">Step 3: Executing the Compiled Program</a></li>
  <li><a href="#step-4-cleaning-up-temporary-files">Step 4: Cleaning Up Temporary Files</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-it-works">How It Works</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-experiments">Further Experiments</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>This project shows how Python can act as a <strong>controller for compiling and executing C++ code</strong>. The program:</p>

<ol>
  <li>Writes a simple <strong>C++ Hello World</strong> program to a temporary file.</li>
  <li>Uses <strong><code class="language-plaintext highlighter-rouge">subprocess.run()</code></strong> to compile it using the <strong>g++ compiler</strong>.</li>
  <li>Executes the compiled program and displays the C++ output inside Python.</li>
  <li>Cleans up all temporary files automatically.</li>
</ol>

<h2 id="why-run-c-from-python">Why Run C++ from Python?</h2>

<ul>
  <li>Combine <strong>Pythonâ€™s flexibility</strong> with <strong>C++â€™s performance</strong>.</li>
  <li>Automate <strong>testing of C++ code</strong> or <strong>generate code dynamically</strong>.</li>
  <li>Build hybrid systems where Python handles logic and C++ handles computation-heavy tasks.</li>
</ul>

<h2 id="step-1-writing-c-code-in-python">Step 1: Writing C++ Code in Python</h2>

<p>The script starts with a simple Python print, followed by defining C++ code as a multi-line string.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">subprocess</span>  <span class="c1"># To run external programs
</span><span class="kn">import</span> <span class="nn">tempfile</span>    <span class="c1"># To create temporary files for C++ code
</span><span class="kn">import</span> <span class="nn">os</span>          <span class="c1"># To handle file operations
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Hello World from Python!"</span><span class="p">)</span>  <span class="c1"># Simple Python print
</span>
<span class="n">cpp_code</span> <span class="o">=</span> <span class="s">"""
#include &lt;iostream&gt;
using namespace std;

int main() {
    cout &lt;&lt; "Hello World from C++!" &lt;&lt; endl;
    return 0;
}
"""</span>
</code></pre></div></div>

<p>Here, the <strong>C++ code is stored as a string</strong> that will later be written to a temporary file.</p>

<hr />

<h2 id="setting-up-g-on-your-system">Setting Up <code class="language-plaintext highlighter-rouge">g++</code> on Your System</h2>

<p>You need a working C++ compiler (<code class="language-plaintext highlighter-rouge">g++</code>) to run this tutorial. Follow the steps below depending on your OS.</p>

<h3 id="windows">Windows</h3>
<ol>
  <li>Install <strong>MinGW-w64</strong> (Minimalist GNU for Windows):
    <ul>
      <li>Visit: <a href="https://winlibs.com/">https://winlibs.com/</a> or <a href="https://sourceforge.net/projects/mingw-w64/">https://sourceforge.net/projects/mingw-w64/</a></li>
      <li>Download and install it.</li>
    </ul>
  </li>
  <li>Add the <strong><code class="language-plaintext highlighter-rouge">bin</code> directory</strong> (e.g., <code class="language-plaintext highlighter-rouge">C:\mingw64\bin</code>) to your <strong>PATH environment variable</strong>.</li>
  <li>Open Command Prompt and type:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g++ <span class="nt">--version</span>
</code></pre></div>    </div>
    <p>If it prints version info, youâ€™re ready to go!</p>
  </li>
</ol>

<h3 id="macos">macOS</h3>
<ol>
  <li>Install <strong>Xcode Command Line Tools</strong> by running:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xcode-select <span class="nt">--install</span>
</code></pre></div>    </div>
  </li>
  <li>Verify installation with:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g++ <span class="nt">--version</span>
</code></pre></div>    </div>
    <p>You should see Appleâ€™s <code class="language-plaintext highlighter-rouge">clang</code> compiler, which works for this tutorial.</p>
  </li>
</ol>

<h3 id="linux-ubuntudebian">Linux (Ubuntu/Debian)</h3>
<ol>
  <li>Open Terminal and install <code class="language-plaintext highlighter-rouge">g++</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>g++
</code></pre></div>    </div>
  </li>
  <li>Verify installation:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g++ <span class="nt">--version</span>
</code></pre></div>    </div>
    <hr />
  </li>
</ol>

<h2 id="step-2-compiling-c-code">Step 2: Compiling C++ Code</h2>

<p>We create a temporary <code class="language-plaintext highlighter-rouge">.cpp</code> file and compile it using the <strong>g++ compiler</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">tempfile</span><span class="p">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">".cpp"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cpp_file</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">cpp_code</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>

<span class="n">exe_file</span> <span class="o">=</span> <span class="n">cpp_file</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">".cpp"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

<span class="n">compile_proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span>
    <span class="p">[</span><span class="s">"g++"</span><span class="p">,</span> <span class="n">cpp_file</span><span class="p">,</span> <span class="s">"-o"</span><span class="p">,</span> <span class="n">exe_file</span><span class="p">],</span>
    <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">tempfile.NamedTemporaryFile()</code></strong> creates a unique <code class="language-plaintext highlighter-rouge">.cpp</code> file in the systemâ€™s temporary directory.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">subprocess.run()</code></strong> executes the g++ compiler to compile the file into an executable.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">capture_output=True</code></strong> captures any compilation messages.</li>
</ul>

<h2 id="step-3-executing-the-compiled-program">Step 3: Executing the Compiled Program</h2>

<p>After successful compilation, Python runs the compiled C++ binary.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">compile_proc</span><span class="p">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"C++ compilation failed!"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">compile_proc</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">exe_file</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Output from C++:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>
</code></pre></div></div>

<p>If compilation fails, Python displays the compiler error messages. If it succeeds, it prints the <strong>C++ program output</strong>.</p>

<h3 id="example-output">Example Output:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World from Python!
Output from C++:
Hello World from C++!
</code></pre></div></div>

<h2 id="step-4-cleaning-up-temporary-files">Step 4: Cleaning Up Temporary Files</h2>

<p>Finally, we remove temporary files created during compilation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cpp_file</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">exe_file</span><span class="p">)</span>
</code></pre></div></div>

<p>This ensures no leftover files clutter your system.</p>

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Hello World from Python!"</span><span class="p">)</span>

<span class="n">cpp_code</span> <span class="o">=</span> <span class="s">"""
#include &lt;iostream&gt;
using namespace std;

int main() {
    cout &lt;&lt; "Hello World from C++!" &lt;&lt; endl;
    return 0;
}
"""</span>

<span class="k">with</span> <span class="n">tempfile</span><span class="p">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s">".cpp"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cpp_file</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">name</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">cpp_code</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>

<span class="n">exe_file</span> <span class="o">=</span> <span class="n">cpp_file</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">".cpp"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

<span class="n">compile_proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="s">"g++"</span><span class="p">,</span> <span class="n">cpp_file</span><span class="p">,</span> <span class="s">"-o"</span><span class="p">,</span> <span class="n">exe_file</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">if</span> <span class="n">compile_proc</span><span class="p">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"C++ compilation failed!"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">compile_proc</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">([</span><span class="n">exe_file</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Output from C++:"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>

<span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cpp_file</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">exe_file</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="how-it-works">How It Works</h2>

<ol>
  <li><strong>Python writes C++ code</strong> to a temporary file.</li>
  <li><strong>g++ compiles</strong> the code into an executable.</li>
  <li><strong>Python runs the executable</strong> and prints its output.</li>
  <li><strong>Cleanup</strong> removes temporary files for a tidy finish.</li>
</ol>

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>Use <strong><code class="language-plaintext highlighter-rouge">subprocess.run()</code></strong> to execute system commands from Python.</li>
  <li>Create <strong>temporary files</strong> using <code class="language-plaintext highlighter-rouge">tempfile</code> safely.</li>
  <li>Capture <strong>compiler output and program results</strong>.</li>
  <li>Integrate Python and C++ seamlessly for automation or hybrid projects.</li>
</ul>

<h2 id="further-experiments">Further Experiments</h2>

<ul>
  <li>Modify the C++ code dynamically (e.g., generate code from user input).</li>
  <li>Run multiple C++ snippets from one Python script.</li>
  <li>Measure <strong>execution time differences</strong> between Python and C++.</li>
  <li>Use <strong>Python to benchmark or visualize C++ results</strong>.</li>
</ul>

<hr />

<p>With this simple integration, youâ€™ve built a <strong>bridge between Python and C++</strong>, unlocking a world of hybrid programming possibilities. You can extend this example to dynamically generate more complex C++ programs, compile them on the fly, and benchmark their performance using Python scripts.</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="cpp" /><category term="automation" /><category term="interoperability" /><category term="tutorial" /><summary type="html"><![CDATA[Learn how to compile and execute C++ code directly from Python using subprocess and tempfile modules.]]></summary></entry><entry><title type="html">Fractal Tree Generator in Python with Turtle</title><link href="https://www.pyshine.com/Turtle-Recursive-Tree-copy/" rel="alternate" type="text/html" title="Fractal Tree Generator in Python with Turtle" /><published>2025-11-02T00:00:00+00:00</published><updated>2025-11-02T00:00:00+00:00</updated><id>https://www.pyshine.com/Turtle-Recursive-Tree%20copy</id><content type="html" xml:base="https://www.pyshine.com/Turtle-Recursive-Tree-copy/"><![CDATA[<h1 id="fractal-tree-generator-in-python">Fractal Tree Generator in Python</h1>

<h3 id="a-beginners-guide-to-recursion-and-turtle-graphics">A Beginnerâ€™s Guide to Recursion and Turtle Graphics</h3>

<p>In this tutorial, youâ€™ll learn how to create a <strong>beautiful fractal tree</strong> using <strong>Pythonâ€™s turtle graphics module</strong>. The project combines <strong>recursion</strong>, <strong>randomness</strong>, and <strong>geometry</strong> to draw realistic, organic-looking trees.</p>

<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#project-setup">Project Setup</a></li>
  <li><a href="#recursive-tree-logic">Recursive Tree Logic</a></li>
  <li><a href="#randomization-for-natural-shapes">Randomization for Natural Shapes</a></li>
  <li><a href="#drawing-with-turtle">Drawing with Turtle</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-to-run">How to Run</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-experiments">Further Experiments</a></li>
</ul>

<hr />

<h2 id="overview">Overview</h2>

<p>Fractals are <strong>self-similar geometric patterns</strong> that repeat at smaller scales. Trees are a perfect example â€” each branch splits into smaller branches that resemble the whole tree.</p>

<p>In this project, weâ€™ll use <strong>recursive functions</strong> to draw a tree, where each branch spawns two smaller branches at random angles and lengths.</p>

<p>Hereâ€™s what weâ€™ll build:</p>
<ul>
  <li>Recursive branching up to a defined depth</li>
  <li>Randomized angles and lengths for organic look</li>
  <li>A vibrant turtle graphics visualization</li>
</ul>

<hr />

<h2 id="project-setup">Project Setup</h2>

<p>First, letâ€™s import the required modules and set up some global parameters:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span><span class="p">,</span> <span class="n">random</span>

<span class="c1"># Screen dimensions
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span>

<span class="c1"># Tree configuration
</span><span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span>      <span class="c1"># Levels of recursion (branch generations)
</span><span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span>    <span class="c1"># Average branch length
</span><span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span>        <span class="c1"># Average branch angle in degrees
</span>
<span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>  <span class="c1"># Fix the random seed for reproducibility
</span></code></pre></div></div>

<hr />

<h2 id="recursive-tree-logic">Recursive Tree Logic</h2>

<p>The magic of this fractal tree lies in recursion â€” a function that calls itself to create smaller branches.</p>

<p>Weâ€™ll use a helper function called <code class="language-plaintext highlighter-rouge">record_my_params()</code> to <strong>generate and store random parameters</strong> for branch angles and lengths at every recursive level.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s">"""Recursively generate random branch parameters"""</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>

    <span class="c1"># Random left and right angles
</span>    <span class="n">a1</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">BA</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">BA</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">BA</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">BA</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Random left and right branch lengths
</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>

    <span class="c1"># Store the parameters for reuse
</span>    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span><span class="p">))</span>

    <span class="c1"># Recurse for next levels
</span>    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Initialize all branch parameters once
</span><span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
</code></pre></div></div>

<p>This step ensures that even if we re-run the drawing, we use <strong>the same random tree structure</strong>, resulting in reproducibility.</p>

<hr />

<h2 id="randomization-for-natural-shapes">Randomization for Natural Shapes</h2>

<p>In nature, no two branches are exactly alike â€” randomness is key to realism.</p>

<p>Hereâ€™s what we randomized:</p>
<ul>
  <li><strong>Branch Angles (<code class="language-plaintext highlighter-rouge">a1</code>, <code class="language-plaintext highlighter-rouge">a2</code>)</strong> â†’ vary around Â±10Â° from the base angle <code class="language-plaintext highlighter-rouge">BA</code>.</li>
  <li><strong>Branch Lengths (<code class="language-plaintext highlighter-rouge">l1</code>, <code class="language-plaintext highlighter-rouge">l2</code>)</strong> â†’ randomly between 60% and 80% of the parent branch.</li>
</ul>

<p>This small variation makes the generated tree look <strong>organic and lifelike</strong> rather than geometric.</p>

<hr />

<h2 id="drawing-with-turtle">Drawing with Turtle</h2>

<p>Now, weâ€™ll use the <strong>Turtle Graphics</strong> library to draw the tree recursively.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">p</span>

<span class="k">def</span> <span class="nf">turtle_tree</span><span class="p">():</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Screen</span><span class="p">()</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Turtle Tree"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">"black"</span><span class="p">)</span>

    <span class="n">pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">color</span><span class="p">(</span><span class="s">"lime"</span><span class="p">)</span>

    <span class="c1"># Start position and orientation
</span>    <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">draw_tree</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Left branch
</span>        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">draw_tree</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Right branch
</span>        <span class="n">pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">)</span>
        <span class="n">draw_tree</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Return to original orientation and backtrack
</span>        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s"> Depth: </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="n">draw_tree</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Turtle finished drawing..."</span><span class="p">)</span>
    <span class="n">turtle</span><span class="p">.</span><span class="n">done</span><span class="p">()</span>
</code></pre></div></div>

<p>When you run this, youâ€™ll see your turtle gracefully draw the branches, recursively building the entire tree structure.</p>

<hr />

<h2 id="complete-code">Complete Code</h2>

<p>Hereâ€™s the complete Python script for your fractal tree:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">turtle</span><span class="p">,</span> <span class="n">random</span>
<span class="n">W</span><span class="p">,</span><span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span>
<span class="n">DEPTH</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># Recursive level or generations of branch
</span><span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">80</span> <span class="c1"># Average branch length
</span><span class="n">BA</span> <span class="o">=</span> <span class="mi">25</span> <span class="c1"># Branch Angle on average
</span><span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span> 
<span class="c1"># Generate Random angle and length sequence
</span><span class="n">branch_params</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">record_my_params</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s">"""Recursively generate random branch parameters"""</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> 
    <span class="c1"># Random branch angles (variation around BA)
</span>    <span class="n">a1</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">BA</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">BA</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># left angle
</span>    <span class="n">a2</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">BA</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">BA</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># right angle
</span>    <span class="c1"># Random branch lenghts (60% to 80% of parent)
</span>    <span class="n">l1</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># left length
</span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span> <span class="c1"># right length
</span>    <span class="c1"># Store parameters (for reuse later on)
</span>    <span class="n">branch_params</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">level</span><span class="p">))</span>
    <span class="c1"># Recurse deeper
</span>    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">record_my_params</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Call once to populate the branch_params list
</span><span class="n">record_my_params</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
<span class="c1"># Iterator to reuse identical random parameters
</span><span class="k">def</span> <span class="nf">param_gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">branch_params</span><span class="p">:</span> <span class="k">yield</span> <span class="n">p</span> 

<span class="k">def</span> <span class="nf">turtle_tree</span><span class="p">():</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Screen</span><span class="p">();</span> <span class="n">screen</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span><span class="n">W</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Turtle Tree"</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">bgcolor</span><span class="p">(</span><span class="s">"black"</span><span class="p">)</span>
    <span class="n">pen</span> <span class="o">=</span> <span class="n">turtle</span><span class="p">.</span><span class="n">Turtle</span><span class="p">();</span> <span class="n">pen</span><span class="p">.</span><span class="n">hideturtle</span><span class="p">()</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">speed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">pen</span><span class="p">.</span><span class="n">color</span><span class="p">(</span><span class="s">"lime"</span><span class="p">);</span> <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">pen</span><span class="p">.</span><span class="n">penup</span><span class="p">();</span><span class="n">pen</span><span class="p">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">H</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">30</span><span class="p">);</span><span class="n">pen</span><span class="p">.</span><span class="n">pendown</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">param_gen</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">draw_tree</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> 
        <span class="n">pen</span><span class="p">.</span><span class="n">pensize</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">depth</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span><span class="n">draw_tree</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">right</span><span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">);</span><span class="n">draw_tree</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pen</span><span class="p">.</span><span class="n">left</span><span class="p">(</span><span class="n">a2</span><span class="p">);</span> <span class="n">pen</span><span class="p">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'Level: </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s"> Depth: </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
    <span class="n">draw_tree</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">,</span> <span class="n">DEPTH</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Turtle finished drawing..."</span><span class="p">)</span>
    <span class="n">turtle</span><span class="p">.</span><span class="n">done</span><span class="p">()</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">turtle_tree</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="how-to-run">How to Run</h2>

<ol>
  <li>Install Python (3.8+ recommended).</li>
  <li>Save the code as <code class="language-plaintext highlighter-rouge">turtle_tree.py</code>.</li>
  <li>Run it in your terminal or IDE:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python turtle_tree.py
</code></pre></div>    </div>
  </li>
  <li>Watch the tree being drawn branch by branch on a black canvas.</li>
</ol>

<hr />

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li><strong>Recursion</strong>: Each branch draws smaller branches by calling itself.</li>
  <li><strong>Randomization</strong>: Adds organic variety to otherwise mathematical patterns.</li>
  <li><strong>Parameter Storage</strong>: Precomputing random parameters ensures consistent results.</li>
  <li><strong>Turtle Graphics</strong>: Provides a simple way to visualize geometric structures.</li>
</ul>

<hr />

<h2 id="further-experiments">Further Experiments</h2>

<ul>
  <li>Change colors for different depth levels (green â†’ brown gradient)</li>
  <li>Add wind animation by slightly rotating angles in real-time</li>
  <li>Generate holiday trees with random decorations</li>
  <li>Try increasing <code class="language-plaintext highlighter-rouge">DEPTH</code> for more detailed fractals (but slower drawing)</li>
</ul>

<hr />

<p>With just a few lines of recursive code, youâ€™ve created an <strong>organic fractal tree</strong> that grows beautifully on your screen. This project is a fun introduction to <strong>recursive graphics and procedural generation</strong> â€” concepts that power both <strong>natural simulations</strong> and <strong>game development</strong>!</p>]]></content><author><name>PyShine Team</name></author><category term="python" /><category term="turtle" /><category term="recursion" /><category term="graphics" /><category term="fractal" /><summary type="html"><![CDATA[Learn how to build a beautiful recursive fractal tree using Pythonâ€™s turtle graphics module with randomness for natural effects.]]></summary></entry><entry><title type="html">Music Maker with Save Load Clear &amp;amp; Slider</title><link href="https://www.pyshine.com/Pygame-Music-Maker-with-Threads-copy/" rel="alternate" type="text/html" title="Music Maker with Save Load Clear &amp;amp; Slider" /><published>2025-11-01T00:00:00+00:00</published><updated>2025-11-01T00:00:00+00:00</updated><id>https://www.pyshine.com/Pygame-Music-Maker-with-Threads%20copy</id><content type="html" xml:base="https://www.pyshine.com/Pygame-Music-Maker-with-Threads-copy/"><![CDATA[<h1 id="pyshine-music-maker--the-ultimate-step-sequencer-tutorial">PyShine Music Maker â€“ The Ultimate Step Sequencer Tutorial</h1>

<h3 id="build-a-visual-music-sequencer-with-pygame-json-saveload-clear-slider-and-real-time-waveform-visualization">Build a Visual Music Sequencer with Pygame, JSON Save/Load, Clear, Slider, and Real-Time Waveform Visualization</h3>

<p>This comprehensive tutorial will help you build a <strong>feature-packed music maker app</strong> using <strong>Python</strong> and <strong>Pygame</strong>. Youâ€™ll not only learn to synthesize musical notes using NumPy but also understand threading, grid-based sequencing, waveform visualization, and dynamic user controls such as buttons and sliders.</p>

<hr />

<h2 id="table-of-contents">Table of Contents</h2>
<ol>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#setting-up-pygame">Setting Up Pygame</a></li>
  <li><a href="#creating-synthetic-piano-notes">Creating Synthetic Piano Notes</a></li>
  <li><a href="#sequencer-pattern--grid-layout">Sequencer Pattern &amp; Grid Layout</a></li>
  <li><a href="#buttons-save-load-clear">Buttons: Save, Load, Clear</a></li>
  <li><a href="#slider-for-loop-control">Slider for Loop Control</a></li>
  <li><a href="#waveform-visualization">Waveform Visualization</a></li>
  <li><a href="#playback-thread">Playback Thread</a></li>
  <li><a href="#main-loop--event-handling">Main Loop &amp; Event Handling</a></li>
  <li><a href="#running-the-application">Running the Application</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-ideas">Further Ideas</a></li>
</ol>

<hr />

<h2 id="overview">Overview</h2>

<p>The <strong>PyShine Music Maker</strong> combines interactive graphics and synthesized audio, offering an accessible introduction to digital sound processing and event-driven programming. Itâ€™s an <strong>interactive step sequencer</strong> that lets you visually create patterns, loop them, and hear your creations immediately. The program includes:</p>

<ul>
  <li>A <strong>7-note synth</strong> (Câ€“B) generated mathematically.</li>
  <li><strong>Grid-based pattern editing</strong> with 32 steps.</li>
  <li><strong>Save/Load features</strong> using JSON for persistence.</li>
  <li>A <strong>Clear All</strong> button to reset instantly.</li>
  <li>A <strong>loop slider</strong> to adjust playback range dynamically.</li>
  <li><strong>Waveform visualization</strong> for real-time feedback.</li>
</ul>

<p>This tutorial is perfect for anyone learning how graphics, sound, and time-based logic interact in Python. Youâ€™ll gain insights into <strong>digital signal processing</strong>, <strong>event handling</strong>, and <strong>multi-threaded programming</strong>.</p>

<p>Each section is fully expanded, so by the end, youâ€™ll have a working DAW-style sequencer and a deep understanding of how everything connects.</p>

<p>Dont worry, if you dont know about DAW. What is this DAW? Digital Audio Workstation (DAW) is a software platform for recording, editing, mixing, and producing audio digitally. Examples include Ableton Live, FL Studio, Logic Pro, and Cubase. Sequencer is a tool or module inside the DAW (or standalone) that lets you arrange musical events (notes, beats, or samples) over time in a grid or timeline format.</p>

<p>So a DAW-style sequencer mimics the way professional music software arranges musical notes and beats</p>

<ul>
  <li>Horizontal axis = time/steps (when notes play)</li>
  <li>Vertical axis = pitch/note (which note plays)</li>
</ul>

<p>Typically includes looping, step triggering, and visual feedback for composing music.</p>

<hr />

<h2 id="setting-up-pygame">Setting Up Pygame</h2>

<p>We start by setting up the core components. Pygame handles both graphics and audio, while NumPy handles waveform generation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">threading</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">pygame.mixer</code> module is responsible for audio playback. The frequency <code class="language-plaintext highlighter-rouge">44100</code> Hz corresponds to CD-quality audio. After initializing the libraries, we define the display:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">750</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"PyShine Music Maker (Save/Load + Clear + Slider)"</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li><strong>W</strong> and <strong>H</strong> define the window size.</li>
  <li><strong>font</strong> creates text for labels.</li>
  <li><strong>clock</strong> controls frame rate and smooth rendering.</li>
</ul>

<p>We use a window size of <strong>480Ã—750</strong> so that we have ample vertical space for the waveform, buttons, and grid. Youâ€™ll redraw everything every frame for smooth interaction.</p>

<p>ðŸ’¡ <em>Tip:</em> Redrawing the whole UI per frame may seem wasteful, but itâ€™s standard in Pygameâ€™s immediate mode rendering system and ensures crisp, consistent visuals.</p>

<p>Try running the above code â€” you should see a black window open with a title. Thatâ€™s your base canvas for all future drawings.</p>

<hr />

<h2 id="creating-synthetic-piano-notes">Creating Synthetic Piano Notes</h2>

<p>Music is vibration â€” and vibration is math. A musical note is simply a sine wave oscillating at a specific frequency. By summing multiple harmonics, we get richer sounds. Letâ€™s create a function to generate synthetic piano tones.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fs</span> <span class="o">=</span> <span class="mi">44100</span>  <span class="c1"># samples per second
</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># seconds per note
</span>
<span class="k">def</span> <span class="nf">make_note</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span> <span class="o">*</span> <span class="n">duration</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">env</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span> <span class="o">*</span> <span class="mi">32767</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="n">stereo</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">audio</span><span class="p">,</span> <span class="n">audio</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">stereo</span><span class="p">),</span> <span class="n">wave</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">np.linspace</code> creates evenly spaced samples across the noteâ€™s duration.</li>
  <li><code class="language-plaintext highlighter-rouge">env</code> adds a <strong>natural decay</strong> envelope (simulating how a note fades).</li>
  <li>The three sine terms form the base and its <strong>second and third harmonics</strong>.</li>
</ul>

<p>Next, generate seven notes:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">notes</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span><span class="mf">261.63</span><span class="p">,</span><span class="s">'D'</span><span class="p">:</span><span class="mf">293.63</span><span class="p">,</span><span class="s">'E'</span><span class="p">:</span><span class="mf">329.63</span><span class="p">,</span><span class="s">'F'</span><span class="p">:</span><span class="mf">349.23</span><span class="p">,</span><span class="s">'G'</span><span class="p">:</span><span class="mf">392.00</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="mf">440.00</span><span class="p">,</span><span class="s">'B'</span><span class="p">:</span><span class="mf">493.88</span><span class="p">}</span>
<span class="n">sounds</span><span class="p">,</span> <span class="n">wave_data</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">snd</span><span class="p">,</span> <span class="n">wave</span> <span class="o">=</span> <span class="n">make_note</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">sounds</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span>
    <span class="n">wave_data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">wave</span>
</code></pre></div></div>

<p>Each sound object can be played instantly with <code class="language-plaintext highlighter-rouge">sounds[n].play()</code>, while <code class="language-plaintext highlighter-rouge">wave_data[n]</code> stores the corresponding waveform for visualization. Try printing one waveform â€” itâ€™s an array of thousands of amplitude samples.</p>

<p>By synthesizing tones mathematically, youâ€™re effectively writing your own instrument.</p>

<hr />

<h2 id="sequencer-pattern--grid-layout">Sequencer Pattern &amp; Grid Layout</h2>

<p>A <strong>sequencer</strong> is a visual representation of musical timing. Here, rows are notes and columns are beats (steps). Each cell can be toggled on/off to represent a note being played.</p>

<h3 id="creating-a-pattern-structure">Creating a Pattern Structure</h3>

<p>Weâ€™ll define 32 steps and a default melody pattern.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">steps</span> <span class="o">=</span> <span class="mi">32</span>

<span class="k">def</span> <span class="nf">default_pattern</span><span class="p">():</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">8</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">24</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span> <span class="n">pat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">default_pattern</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></div>

<p>Each note has an array of length 32 containing 0s and 1s. A <code class="language-plaintext highlighter-rouge">1</code> means that note should play on that step.</p>

<h3 id="grid-geometry">Grid Geometry</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">margin_left</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">grid_top</span> <span class="o">=</span> <span class="mi">320</span>
<span class="n">cell_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">margin_left</span> <span class="o">-</span> <span class="mi">40</span> <span class="o">-</span> <span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">steps</span>
<span class="n">cell_h</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div></div>

<p>We calculate dynamic dimensions to ensure a uniform layout.</p>

<h3 id="drawing-the-grid">Drawing the Grid</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_grid</span><span class="p">():</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">grid_top</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cell_w</span><span class="p">,</span> <span class="n">cell_h</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">cell_w</span> <span class="o">+</span> <span class="n">spacing</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">cell_h</span> <span class="o">+</span> <span class="n">spacing</span>
</code></pre></div></div>

<p>Every redraw shows current pattern states. Toggling cells simply flips between 0 and 1.</p>

<p>ðŸ’¡ <em>Pro Tip:</em> This data-driven grid mirrors how MIDI clip editors work in professional DAWs.</p>

<hr />

<h2 id="buttons-save-load-clear">Buttons: Save, Load, Clear</h2>

<p>Weâ€™ll now add <strong>Save</strong>, <strong>Load</strong>, and <strong>Clear</strong> buttons for control. These features make your sequencer persistent and user-friendly.</p>

<h3 id="creating-buttons">Creating Buttons</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">50</span>
<span class="n">save_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">load_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">clear_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">340</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
</code></pre></div></div>

<p>Each <code class="language-plaintext highlighter-rouge">pygame.Rect</code> defines the clickable area for a button.</p>

<h3 id="drawing-buttons">Drawing Buttons</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_button</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)):</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">rect</span><span class="p">.</span><span class="n">w</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">rect</span><span class="p">.</span><span class="n">h</span><span class="o">//</span><span class="mi">3</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="handling-events">Handling Events</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">):</span>
    <span class="n">save_pattern</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">):</span>
    <span class="n">load_pattern</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">clear_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="save-and-load-logic">Save and Load Logic</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">save_pattern</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pattern.json'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">load_pattern</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">pattern</span>
    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'pattern.json'</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pattern.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="why-use-json">Why Use JSON?</h3>
<p>Itâ€™s lightweight, readable, and editable. You can even open your melody file in a text editor and modify it manually.</p>

<p>The <strong>Clear</strong> button resets all notes, making quick restarts effortless.</p>

<p>This section establishes the basic file management and editing functions that make your app feel professional and reusable.</p>

<hr />

<h2 id="slider-for-loop-control">Slider for Loop Control</h2>

<p>The <strong>loop slider</strong> determines how many steps are played before restarting. This allows you to fine-tune short loops during composition.</p>

<h3 id="define-geometry">Define Geometry</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">slider_x</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">slider_y</span> <span class="o">=</span> <span class="mi">260</span>
<span class="n">slider_w</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">slider_x</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">slider_h</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">slider_val</span> <span class="o">=</span> <span class="mi">31</span>
<span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div></div>

<h3 id="drawing">Drawing</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_slider</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">handle_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">handle_x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s">"Loop end: </span><span class="si">{</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">30</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">handle_x</span>
</code></pre></div></div>

<h3 id="event-handling">Event Handling</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span> <span class="ow">and</span> <span class="n">slider_y</span> <span class="o">&lt;=</span> <span class="n">event</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">slider_y</span> <span class="o">+</span> <span class="n">slider_h</span><span class="p">:</span>
    <span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
    <span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEMOTION</span> <span class="ow">and</span> <span class="n">slider_dragging</span><span class="p">:</span>
    <span class="n">rel_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">slider_x</span><span class="p">,</span> <span class="n">slider_w</span><span class="p">))</span>
    <span class="n">slider_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">rel_x</span> <span class="o">/</span> <span class="n">slider_w</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<p>This simple code lets you dynamically shorten or extend the loop range visually.</p>

<hr />

<h2 id="waveform-visualization">Waveform Visualization</h2>

<p>The waveform visually represents sound energy across time. By showing the amplitude of the audio signal, users gain a deeper understanding of how sound behaves.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
<span class="n">current_frame_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">draw_waveform</span><span class="p">():</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rect</span><span class="o">=</span><span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="mi">120</span><span class="p">))</span>
    <span class="n">mid_y</span> <span class="o">=</span> <span class="mi">180</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="n">W</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">mid_y</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">mid_y</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"Waveform"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
</code></pre></div></div>

<p>Each new note updates the <code class="language-plaintext highlighter-rouge">wave_buffer</code>, shifting data like an oscilloscope trace.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_frame_wave</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<p>You can extend this with note-specific colors or FFT-based frequency visualizations for advanced analysis.</p>

<hr />

<h2 id="playback-thread">Playback Thread</h2>

<p>We separate playback from UI rendering for responsiveness. Threading allows smooth visuals while maintaining precise timing.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">playback_loop</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">step</span><span class="p">,</span> <span class="n">wave_buffer</span><span class="p">,</span> <span class="n">current_frame_wave</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">playing</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last</span> <span class="o">&gt;=</span> <span class="n">beat_time</span><span class="p">:</span>
            <span class="n">active_notes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span> <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">step</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">active_notes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">active_notes</span><span class="p">:</span>
                    <span class="n">sounds</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">play</span><span class="p">()</span>
                    <span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="n">W</span><span class="o">//</span><span class="mi">2</span><span class="p">:],</span> <span class="n">wave_data</span><span class="p">[</span><span class="n">n</span><span class="p">][:</span><span class="n">W</span><span class="o">//</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="n">slider_val</span> <span class="k">else</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">playback_loop</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></div>

<p>This ensures the app continues to draw and respond even as notes play precisely in rhythm.</p>

<hr />

<h2 id="main-loop--event-handling">Main Loop &amp; Event Handling</h2>

<p>The main loop manages all user input, drawing, and updates. It listens for mouse clicks to toggle notes, adjust sliders, or click buttons.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">playing</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">beat_time</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">step</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mouse_pos</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="n">get_pos</span><span class="p">()</span>
            <span class="c1"># handle buttons and slider
</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">draw_button</span><span class="p">(</span><span class="n">save_btn</span><span class="p">,</span> <span class="s">"SAVE"</span><span class="p">)</span>
    <span class="n">draw_button</span><span class="p">(</span><span class="n">load_btn</span><span class="p">,</span> <span class="s">"LOAD"</span><span class="p">)</span>
    <span class="n">draw_button</span><span class="p">(</span><span class="n">clear_btn</span><span class="p">,</span> <span class="s">"CLEAR"</span><span class="p">)</span>
    <span class="n">draw_slider</span><span class="p">(</span><span class="n">slider_x</span><span class="p">,</span> <span class="n">slider_y</span><span class="p">,</span> <span class="n">slider_w</span><span class="p">,</span> <span class="n">slider_h</span><span class="p">,</span> <span class="n">slider_val</span><span class="p">)</span>
    <span class="n">draw_waveform</span><span class="p">()</span>
    <span class="n">draw_grid</span><span class="p">()</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</code></pre></div></div>

<p>This loop ties together all the UI elements into one cohesive, reactive system.</p>

<hr />

<h3 id="a-sample-jingle-bells-melody-json-file">A sample Jingle bells Melody json file</h3>

<p>jingle.json</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jingle bells {"C": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "D": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0], "E": [1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], "F": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "G": [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0], "A": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}
</code></pre></div></div>

<h2 id="complete-code">Complete Code</h2>

<h3 id="pyshine_music_maker">pyshine_music_maker</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">threading</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>

<span class="c1"># Settings 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">750</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"PyShine Music Maker (Save/Load + Clear + Slider)"</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="c1"># Synthetic piano 
</span><span class="n">fs</span> <span class="o">=</span> <span class="mi">44100</span>
<span class="n">waveform_height</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">waveform_buffer_len</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1</span>
<span class="n">duration</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="k">def</span> <span class="nf">make_note</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">*</span><span class="n">duration</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">env</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span><span class="o">*</span><span class="mi">32767</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">audio</span><span class="p">,</span><span class="n">audio</span><span class="p">))),</span> <span class="n">wave</span>

<span class="n">notes</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span><span class="mf">261.63</span><span class="p">,</span><span class="s">'D'</span><span class="p">:</span><span class="mf">293.66</span><span class="p">,</span><span class="s">'E'</span><span class="p">:</span><span class="mf">329.63</span><span class="p">,</span><span class="s">'F'</span><span class="p">:</span><span class="mf">349.23</span><span class="p">,</span>
         <span class="s">'G'</span><span class="p">:</span><span class="mf">392.00</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="mf">440.00</span><span class="p">,</span><span class="s">'B'</span><span class="p">:</span><span class="mf">493.88</span><span class="p">}</span>

<span class="n">sounds</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">wave_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">snd</span><span class="p">,</span> <span class="n">wave</span> <span class="o">=</span> <span class="n">make_note</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">sounds</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">snd</span>
    <span class="n">wave_data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">wave</span>

<span class="c1"># Pattern 
</span><span class="n">steps</span> <span class="o">=</span> <span class="mi">32</span>
<span class="k">def</span> <span class="nf">default_pattern</span><span class="p">():</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">8</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">9</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">17</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">24</span><span class="p">),(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">25</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span> <span class="n">pat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">default_pattern</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Layout 
</span><span class="n">margin_left</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">waveform_top</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">grid_top</span> <span class="o">=</span> <span class="n">waveform_top</span> <span class="o">+</span> <span class="n">waveform_height</span> <span class="o">+</span> <span class="mi">50</span>
<span class="n">grid_width</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">margin_left</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">cell_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_width</span> <span class="o">-</span> <span class="n">spacing</span><span class="o">*</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">steps</span>
<span class="n">cell_h</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># Buttons 
</span><span class="n">btn_w</span> <span class="o">=</span> <span class="mi">120</span>  <span class="c1"># reduced width
</span><span class="n">btn_h</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">save_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">load_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">clear_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">340</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>

<span class="c1"># Slider 
</span><span class="n">slider_x</span> <span class="o">=</span> <span class="n">margin_left</span>
<span class="n">slider_y</span> <span class="o">=</span> <span class="n">grid_top</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">slider_w</span> <span class="o">=</span> <span class="n">grid_width</span>
<span class="n">slider_h</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">slider_val</span> <span class="o">=</span> <span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># return cell id default at last step
</span><span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">draw_slider</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
    <span class="n">handle_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">handle_x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">handle_x</span>

<span class="c1"># Playback 
</span><span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">bpm</span> <span class="o">=</span> <span class="mi">180</span>
<span class="n">playing</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">beat_time</span> <span class="o">=</span> <span class="mi">60</span><span class="o">/</span><span class="n">bpm</span>
<span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># Rolling waveform 
</span><span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">waveform_buffer_len</span><span class="p">)</span>
<span class="n">current_frame_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>

<span class="c1"># Draw waveform 
</span><span class="k">def</span> <span class="nf">draw_waveform</span><span class="p">():</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rect</span><span class="o">=</span><span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">waveform_top</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">waveform_height</span><span class="p">))</span>
    <span class="n">mid_y</span> <span class="o">=</span> <span class="n">waveform_top</span> <span class="o">+</span> <span class="n">waveform_height</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="n">W</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">W</span> <span class="k">else</span> <span class="n">np</span><span class="p">.</span><span class="n">pad</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">,</span> <span class="p">(</span><span class="n">W</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">),</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">mid_y</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">waveform_height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">mid_y</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">*</span><span class="n">waveform_height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">))</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mid_y</span><span class="p">),</span> <span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">mid_y</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>


<span class="c1"># Playback thread 
</span><span class="k">def</span> <span class="nf">playback_loop</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">step</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">wave_buffer</span><span class="p">,</span> <span class="n">current_frame_wave</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">playing</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last</span> <span class="o">&gt;=</span> <span class="n">beat_time</span><span class="p">:</span>
            <span class="n">step_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">wave_data</span><span class="p">.</span><span class="n">values</span><span class="p">()))))</span>
            <span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pattern</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span><span class="p">)[</span><span class="n">step</span><span class="p">]:</span>
                    <span class="n">sounds</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">play</span><span class="p">()</span>
                    <span class="n">step_wave</span> <span class="o">+=</span> <span class="n">wave_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">active</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">active</span><span class="p">:</span>
                <span class="n">step_wave</span> <span class="o">=</span> <span class="n">step_wave</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">step_wave</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">step_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">step_wave</span><span class="p">)</span>
            <span class="n">current_frame_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">interp</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">step_wave</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">),</span>
                                           <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">step_wave</span><span class="p">)),</span> <span class="n">step_wave</span><span class="p">)</span>
            <span class="c1"># Increment step
</span>            <span class="n">step</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># If step exceeds slider_val, loop back to start (0) or slider start
</span>            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">slider_val</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># you can also set to slider_start if you want
</span>            <span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">wave_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">wave_buffer</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">wave_buffer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_frame_wave</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">current_frame_wave</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">roll</span><span class="p">(</span><span class="n">current_frame_wave</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.005</span><span class="p">)</span>

<span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">playback_loop</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># File picker overlay with blinking cursor 
</span><span class="k">def</span> <span class="nf">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.json'</span><span class="p">)]</span>
    <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">input_text</span> <span class="o">=</span> <span class="s">"new_file.json"</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="s">""</span>
    <span class="n">typing_active</span> <span class="o">=</span> <span class="n">for_save</span>
    <span class="n">cursor_visible</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">cursor_timer</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">while</span> <span class="n">picker_open</span><span class="p">:</span>
        <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">"Enter filename to SAVE:"</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="s">"Select file to LOAD:"</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>

        <span class="n">file_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">file_rects</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">fname</span><span class="p">,</span> <span class="n">rect</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">for_save</span><span class="p">:</span>
            <span class="n">input_rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span> <span class="n">input_rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">input_text</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">input_rect</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">cursor_timer</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">cursor_visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">cursor_visible</span>
                <span class="n">cursor_timer</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cursor_visible</span> <span class="ow">and</span> <span class="n">typing_active</span><span class="p">:</span>
                <span class="n">cursor_x</span> <span class="o">=</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">font</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="n">input_text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cursor_y</span> <span class="o">=</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">5</span>
                <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">cursor_x</span><span class="p">,</span> <span class="n">cursor_y</span><span class="p">),</span> <span class="p">(</span><span class="n">cursor_x</span><span class="p">,</span> <span class="n">cursor_y</span> <span class="o">+</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
                <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
                <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">file_rects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">for_save</span><span class="p">:</span>
                        <span class="n">selected</span> <span class="o">=</span> <span class="n">fname</span>
                        <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">for_save</span> <span class="ow">and</span> <span class="n">input_rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                    <span class="n">typing_active</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">typing_active</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">typing_active</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_BACKSPACE</span><span class="p">:</span>
                    <span class="n">input_text</span> <span class="o">=</span> <span class="n">input_text</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_RETURN</span><span class="p">:</span>
                    <span class="n">selected</span> <span class="o">=</span> <span class="n">input_text</span>
                    <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">input_text</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="nb">unicode</span>

    <span class="k">return</span> <span class="n">selected</span>

<span class="c1"># Main loop 
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>

    <span class="c1"># Buttons
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">180</span><span class="p">),</span> <span class="n">save_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">load_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">clear_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"SAVE"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">save_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"LOAD"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">load_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"CLEAR"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">clear_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span> <span class="n">clear_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>

    <span class="c1"># Slider
</span>    <span class="n">slider_handle</span> <span class="o">=</span> <span class="n">draw_slider</span><span class="p">(</span><span class="n">slider_x</span><span class="p">,</span> <span class="n">slider_y</span><span class="p">,</span> <span class="n">slider_w</span><span class="p">,</span> <span class="n">slider_h</span><span class="p">,</span> <span class="n">slider_val</span><span class="p">)</span>

    <span class="c1"># Waveform
</span>    <span class="n">draw_waveform</span><span class="p">()</span>

    <span class="c1"># Grid
</span>    <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">grid_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">cell_h</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cell_w</span><span class="p">,</span> <span class="n">cell_h</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span> <span class="k">if</span> <span class="n">pattern</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span><span class="p">)[</span><span class="n">c</span><span class="p">]</span> <span class="k">else</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">step</span><span class="p">:</span> <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

    <span class="c1"># Events 
</span>    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="k">if</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">target_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target_file</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_file</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".json"</span><span class="p">):</span>
                        <span class="n">target_file</span> <span class="o">+=</span> <span class="s">".json"</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span><span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"Saved to:"</span><span class="p">,</span> <span class="n">target_file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">chosen_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chosen_file</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chosen_file</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">loaded_pattern</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{}</span>
                        <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">loaded_pattern</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"Loaded:"</span><span class="p">,</span> <span class="n">chosen_file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">clear_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Cleared all cells"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">slider_x</span><span class="p">,</span> <span class="n">slider_y</span><span class="p">,</span> <span class="n">slider_w</span><span class="p">,</span> <span class="n">slider_h</span><span class="p">).</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Toggle grid cells
</span>                <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">grid_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cell_w</span><span class="p">,</span><span class="n">cell_h</span><span class="p">).</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                            <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
            <span class="n">slider_dragging</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEMOTION</span> <span class="ow">and</span> <span class="n">slider_dragging</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="c1"># Clamp and convert to cell id
</span>            <span class="n">slider_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">mx</span> <span class="o">-</span> <span class="n">slider_x</span><span class="p">)</span> <span class="o">/</span> <span class="n">slider_w</span> <span class="o">*</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">slider_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">slider_val</span><span class="p">))</span>

    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>


</code></pre></div></div>

<h2 id="running-the-application">Running the Application</h2>

<p>Install dependencies and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pygame numpy
python pyshine_music_maker.py
</code></pre></div></div>

<p>Click cells to activate notes, save and load patterns, clear the grid, and adjust the loop length with the slider.</p>

<hr />

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>Audio synthesis using NumPy sine waves and harmonics.</li>
  <li>Threaded design for real-time interactivity.</li>
  <li>Dynamic GUI layout in Pygame.</li>
  <li>JSON-based pattern persistence.</li>
  <li>Visualization of digital waveforms.</li>
</ul>

<hr />

<h2 id="further-ideas">Further Ideas</h2>

<ul>
  <li>Add more octaves and instruments.</li>
  <li>Implement a tempo (BPM) slider.</li>
  <li>Add real-time recording or export to WAV/MIDI.</li>
  <li>Use color-coded notes by frequency.</li>
  <li>Animate transitions between steps for visual rhythm tracking.</li>
</ul>

<hr />

<p>This in-depth guide transforms your simple code into a <strong>mini music production environment</strong> â€” blending coding, sound design, and interactive graphics beautifully.</p>]]></content><author><name>PyShine Team</name></author><category term="pygame" /><category term="music" /><category term="interactive" /><category term="beginner" /><category term="python" /><summary type="html"><![CDATA[A deeply detailed beginner-friendly guide to building a complete interactive music maker in Python with Pygame, featuring waveform visualization, save/load, clear button, threading, and loop control slider.]]></summary></entry><entry><title type="html">Mini Paint (Smooth Circular Brush) in Python</title><link href="https://www.pyshine.com/Paint-Brush-Python-copy/" rel="alternate" type="text/html" title="Mini Paint (Smooth Circular Brush) in Python" /><published>2025-10-31T00:00:00+00:00</published><updated>2025-10-31T00:00:00+00:00</updated><id>https://www.pyshine.com/Paint-Brush-Python%20copy</id><content type="html" xml:base="https://www.pyshine.com/Paint-Brush-Python-copy/"><![CDATA[<h1 id="ï¸-mini-paint-tutorial-smooth-circular-brush">ðŸ–Œï¸ Mini Paint Tutorial (Smooth Circular Brush)</h1>

<h3 id="educational-python-project--create-an-interactive-painting-app">Educational Python Project â€“ Create an Interactive Painting App</h3>

<p>This tutorial walks through building a <strong>Mini Paint application</strong> using <strong>Python and Pygame</strong>. The app allows users to <strong>draw with smooth circular brushes</strong>, choose from multiple colors, and select different brush sizes.</p>

<hr />

<h2 id="features">Features</h2>

<ul>
  <li>âœ… 7 colors</li>
  <li>âœ… 4 brush sizes</li>
  <li>âœ… Smooth, circle-based strokes</li>
  <li>âœ… Compact toolbar (portrait 400x900)</li>
</ul>

<hr />

<h2 id="requirements">Requirements</h2>

<ul>
  <li>Python 3.x</li>
  <li>Pygame library</li>
</ul>

<p>Install Pygame if you donâ€™t have it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pygame
</code></pre></div></div>

<hr />

<h2 id="step-1-setup-pygame-window">Step 1: Setup Pygame Window</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># Screen setup
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">900</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Mini Paint - Smooth Circles"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-2-define-colors-and-brush-sizes">Step 2: Define Colors and Brush Sizes</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="c1"># Red
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1"># Orange
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1"># Yellow
</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="c1"># Green
</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>     <span class="c1"># Blue
</span>    <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span>    <span class="c1"># Indigo
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>  <span class="c1"># White (eraser)
</span><span class="p">]</span>

<span class="n">brush_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
<span class="n">current_color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">current_size</span> <span class="o">=</span> <span class="n">brush_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<hr />

<h2 id="step-3-setup-toolbar">Step 3: Setup Toolbar</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">toolbar_height</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">color_buttons</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">size_buttons</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Color buttons
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">10</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">color_buttons</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">rect</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

<span class="c1"># Size buttons
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">brush_sizes</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">90</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">75</span>
    <span class="n">size_buttons</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
</code></pre></div></div>

<hr />

<h2 id="step-4-create-smooth-brush-function">Step 4: Create Smooth Brush Function</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_smooth_circle_line</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="step-5-main-loop">Step 5: Main Loop</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">drawing</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="c1"># Select color
</span>            <span class="k">for</span> <span class="n">rect</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color_buttons</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">):</span>
                    <span class="n">current_color</span> <span class="o">=</span> <span class="n">c</span>
            <span class="c1"># Select brush size
</span>            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size_buttons</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">my</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">current_size</span> <span class="o">=</span> <span class="n">s</span>
            <span class="c1"># Start drawing
</span>            <span class="k">if</span> <span class="n">my</span> <span class="o">&gt;</span> <span class="n">toolbar_height</span><span class="p">:</span>
                <span class="n">drawing</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">last_pos</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>

        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
            <span class="n">drawing</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Drawing
</span>    <span class="k">if</span> <span class="n">drawing</span><span class="p">:</span>
        <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">my</span> <span class="o">&gt;</span> <span class="n">toolbar_height</span> <span class="ow">and</span> <span class="n">last_pos</span><span class="p">:</span>
            <span class="n">draw_smooth_circle_line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">current_color</span><span class="p">,</span> <span class="n">last_pos</span><span class="p">,</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">),</span> <span class="n">current_size</span><span class="p">)</span>
        <span class="n">last_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">)</span>

    <span class="c1"># Toolbar background
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">toolbar_height</span><span class="p">))</span>

    <span class="c1"># Draw color buttons
</span>    <span class="k">for</span> <span class="n">rect</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color_buttons</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">current_color</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Draw brush size selectors
</span>    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size_buttons</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">current_size</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="complete-python-code">Complete Python Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">math</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># Screen setup 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">900</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Mini Paint - Smooth Circles"</span><span class="p">)</span>

<span class="c1"># Colors
</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="c1"># Red
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1"># Orange
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1"># Yellow
</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>     <span class="c1"># Green
</span>    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>     <span class="c1"># Blue
</span>    <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span>    <span class="c1"># Indigo
</span>    <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>  <span class="c1"># White (eraser)
</span><span class="p">]</span>
<span class="n">brush_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>
<span class="n">current_color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">current_size</span> <span class="o">=</span> <span class="n">brush_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Toolbar setup 
</span><span class="n">toolbar_height</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">color_buttons</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">size_buttons</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Color button positions
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">10</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">color_buttons</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">rect</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

<span class="c1"># Size buttons (circles)
</span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">brush_sizes</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">90</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">75</span>
    <span class="n">size_buttons</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

<span class="n">drawing</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">draw_smooth_circle_line</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
    <span class="s">"""Draw smooth brush stroke using overlapping circles"""</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">start</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">end</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">distance</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">distance</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">radius</span><span class="p">)</span>

<span class="c1"># Main Loop
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

        <span class="c1"># Mouse down
</span>        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="c1"># Select color
</span>            <span class="k">for</span> <span class="n">rect</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color_buttons</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">):</span>
                    <span class="n">current_color</span> <span class="o">=</span> <span class="n">c</span>
            <span class="c1"># Select brush size
</span>            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size_buttons</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">my</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">current_size</span> <span class="o">=</span> <span class="n">s</span>
            <span class="c1"># Start drawing
</span>            <span class="k">if</span> <span class="n">my</span> <span class="o">&gt;</span> <span class="n">toolbar_height</span><span class="p">:</span>
                <span class="n">drawing</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">last_pos</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>

        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONUP</span><span class="p">:</span>
            <span class="n">drawing</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">last_pos</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Drawing with smooth circular brush 
</span>    <span class="k">if</span> <span class="n">drawing</span><span class="p">:</span>
        <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">my</span> <span class="o">&gt;</span> <span class="n">toolbar_height</span> <span class="ow">and</span> <span class="n">last_pos</span><span class="p">:</span>
            <span class="n">draw_smooth_circle_line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">current_color</span><span class="p">,</span> <span class="n">last_pos</span><span class="p">,</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">),</span> <span class="n">current_size</span><span class="p">)</span>
        <span class="n">last_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">)</span>

    <span class="c1"># Toolbar background 
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">toolbar_height</span><span class="p">))</span>

    <span class="c1"># Draw color buttons
</span>    <span class="k">for</span> <span class="n">rect</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">color_buttons</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">current_color</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="n">rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Draw brush size selectors
</span>    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">size_buttons</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">s</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">current_size</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>You now have a working Mini Paint application with smooth circular brushes, multiple colors, and variable brush sizes! This is a fun project to practice <strong>interactive GUI programming in Python using Pygame</strong>.</p>

<p>Enjoy painting!</p>]]></content><author><name>PyShine Team</name></author><category term="mini-paint" /><category term="pygame" /><category term="interactive-drawing" /><category term="python-tutorial" /><summary type="html"><![CDATA[Build a simple interactive painting app with smooth circular brushes using Python and Pygame.]]></summary></entry><entry><title type="html">Music Maker with Save/Load in Python</title><link href="https://www.pyshine.com/Pygame-Music-Maker-Box/" rel="alternate" type="text/html" title="Music Maker with Save/Load in Python" /><published>2025-10-31T00:00:00+00:00</published><updated>2025-10-31T00:00:00+00:00</updated><id>https://www.pyshine.com/Pygame-Music-Maker-Box</id><content type="html" xml:base="https://www.pyshine.com/Pygame-Music-Maker-Box/"><![CDATA[<h1 id="interactive-music-maker-in-python-with-pygame">Interactive Music Maker in Python with Pygame</h1>

<h3 id="beginner-friendly-tutorial--build-a-synth-piano-with-saveload">Beginner-Friendly Tutorial â€“ Build a Synth Piano with Save/Load</h3>

<p>This tutorial walks you through creating an <strong>interactive music maker</strong> using <strong>Python and Pygame</strong>. Youâ€™ll learn how to build a <strong>synthetic piano</strong>, <strong>draw a sequencer grid</strong>, and <strong>save/load your music patterns</strong>. By the end, youâ€™ll have a working <strong>step sequencer</strong> for simple melodies.</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#setting-up-pygame">Setting Up Pygame</a></li>
  <li><a href="#creating-the-synthetic-piano">Creating the Synthetic Piano</a></li>
  <li><a href="#sequencer-grid--layout">Sequencer Grid &amp; Layout</a></li>
  <li><a href="#save--load-buttons">Save &amp; Load Buttons</a></li>
  <li><a href="#event-handling">Event Handling</a></li>
  <li><a href="#playback-logic">Playback Logic</a></li>
  <li><a href="#complete-code">Complete Code</a></li>
  <li><a href="#how-to-run">How to Run</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-ideas">Further Ideas</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>This project creates a <strong>simple step sequencer</strong> where each row represents a note (C, D, E, F, G, A) and each column is a step in the melody. You can toggle notes on/off, <strong>play the melody</strong>, and <strong>save/load patterns</strong> to/from files.</p>

<p>Key features:</p>
<ul>
  <li>Real-time playback of a synthetic piano</li>
  <li>Clickable grid for sequencing notes</li>
  <li>Save and load your music patterns using JSON</li>
  <li>Beginner-friendly Pygame implementation</li>
</ul>

<h2 id="setting-up-pygame">Setting Up Pygame</h2>

<p>Start by importing libraries and initializing Pygame.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="window-and-font">Window and Font</h3>

<p>Set the window size, caption, and font.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Music Maker(Save/Load)"</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="creating-the-synthetic-piano">Creating the Synthetic Piano</h2>

<p>Weâ€™ll synthesize simple piano notes using <strong>numpy arrays</strong> and exponential decay envelopes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fs</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">44100</span><span class="p">,</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">make_note</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">*</span><span class="n">duration</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># decay envelope
</span>    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">env</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span><span class="o">*</span><span class="mi">32767</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">audio</span><span class="p">,</span><span class="n">audio</span><span class="p">)))</span>

<span class="n">notes</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span><span class="mf">261.63</span><span class="p">,</span><span class="s">'D'</span><span class="p">:</span><span class="mf">293.66</span><span class="p">,</span><span class="s">'E'</span><span class="p">:</span><span class="mf">329.63</span><span class="p">,</span><span class="s">'F'</span><span class="p">:</span><span class="mf">349.23</span><span class="p">,</span><span class="s">'G'</span><span class="p">:</span><span class="mf">392.00</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="mf">440.00</span><span class="p">}</span>
<span class="n">sounds</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">make_note</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div></div>

<p>This creates <strong>6 piano notes</strong> using a <strong>harmonic sum of sine waves</strong>.</p>

<h2 id="sequencer-grid--layout">Sequencer Grid &amp; Layout</h2>

<p>Define a <strong>default pattern</strong> and layout for the grid.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">steps</span> <span class="o">=</span> <span class="mi">32</span>

<span class="k">def</span> <span class="nf">default_pattern</span><span class="p">():</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">8</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">9</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">17</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">24</span><span class="p">),(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">25</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span> <span class="n">pat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">default_pattern</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Layout
</span><span class="n">margin_left</span><span class="p">,</span> <span class="n">margin_top</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">150</span>
<span class="n">grid_width</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">margin_left</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">cell_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_width</span> <span class="o">-</span> <span class="n">spacing</span><span class="o">*</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">steps</span>
<span class="n">cell_h</span> <span class="o">=</span> <span class="mi">50</span>
</code></pre></div></div>

<p>Each <strong>cell in the grid</strong> represents a step in a sequence.</p>

<h2 id="save--load-buttons">Save &amp; Load Buttons</h2>

<p>Create <strong>buttons</strong> at the top for saving and loading your patterns.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">50</span>
<span class="n">save_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">load_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">btn_w</span> <span class="o">-</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
</code></pre></div></div>

<p>Weâ€™ll also add a <strong>file picker overlay</strong> for selecting files.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.txt'</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">for_save</span> <span class="ow">and</span> <span class="s">"new_file.txt"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">files</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"new_file.txt"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

    <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">while</span> <span class="n">picker_open</span><span class="p">:</span>
        <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">"Select file to SAVE:"</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="s">"Select file to LOAD:"</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">file_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">file_rects</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">fname</span><span class="p">,</span> <span class="n">rect</span><span class="p">))</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
                <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
                <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">file_rects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                        <span class="n">selected</span> <span class="o">=</span> <span class="n">fname</span>
                        <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">selected</span>
</code></pre></div></div>

<h2 id="event-handling">Event Handling</h2>

<p>Handle mouse clicks for <strong>toggle notes</strong> and <strong>buttons</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
        <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
        <span class="k">if</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
            <span class="n">target_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_file</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span><span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
            <span class="n">chosen_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chosen_file</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chosen_file</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Toggle grid cell
</span>            <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">margin_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cell_w</span><span class="p">,</span><span class="n">cell_h</span><span class="p">).</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                        <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span>
</code></pre></div></div>

<h2 id="playback-logic">Playback Logic</h2>

<p>Define <strong>bpm, step, and timing</strong> for playback.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">step</span><span class="p">,</span> <span class="n">bpm</span><span class="p">,</span> <span class="n">playing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="bp">True</span>
<span class="n">beat_time</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">60</span><span class="o">/</span><span class="n">bpm</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">if</span> <span class="n">playing</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">last</span> <span class="o">&gt;=</span> <span class="n">beat_time</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">step</span><span class="p">]:</span> <span class="n">sounds</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">play</span><span class="p">()</span>
    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">steps</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="complete-code">Complete Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">os</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">)</span>

<span class="c1">#  Settings 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">" Music Maker(Save/Load)"</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="c1">#  Synthetic piano 
</span><span class="n">fs</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">44100</span><span class="p">,</span> <span class="mi">1</span>
<span class="k">def</span> <span class="nf">make_note</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="o">*</span><span class="n">duration</span><span class="p">),</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span>
            <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">freq</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="n">env</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave</span><span class="o">*</span><span class="mi">32767</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">audio</span><span class="p">,</span><span class="n">audio</span><span class="p">)))</span>

<span class="n">notes</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span><span class="mf">261.63</span><span class="p">,</span><span class="s">'D'</span><span class="p">:</span><span class="mf">293.66</span><span class="p">,</span><span class="s">'E'</span><span class="p">:</span><span class="mf">329.63</span><span class="p">,</span><span class="s">'F'</span><span class="p">:</span><span class="mf">349.23</span><span class="p">,</span><span class="s">'G'</span><span class="p">:</span><span class="mf">392.00</span><span class="p">,</span><span class="s">'A'</span><span class="p">:</span><span class="mf">440.00</span><span class="p">}</span>
<span class="n">sounds</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">make_note</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">.</span><span class="n">items</span><span class="p">()}</span>

<span class="c1">#  Default pattern (Twinkle Twinkle) 
</span><span class="n">steps</span> <span class="o">=</span> <span class="mi">32</span>
<span class="k">def</span> <span class="nf">default_pattern</span><span class="p">():</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">}</span>
    <span class="n">melody</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">8</span><span class="p">),(</span><span class="s">'A'</span><span class="p">,</span><span class="mi">9</span><span class="p">),(</span><span class="s">'G'</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">16</span><span class="p">),(</span><span class="s">'F'</span><span class="p">,</span><span class="mi">17</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="s">'E'</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">24</span><span class="p">),(</span><span class="s">'D'</span><span class="p">,</span><span class="mi">25</span><span class="p">),(</span><span class="s">'C'</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">melody</span><span class="p">:</span> <span class="n">pat</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">p</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">pat</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="n">default_pattern</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1">#  Layout 
</span><span class="n">margin_left</span><span class="p">,</span> <span class="n">margin_top</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">150</span>
<span class="n">grid_width</span> <span class="o">=</span> <span class="n">W</span> <span class="o">-</span> <span class="n">margin_left</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">spacing</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">cell_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_width</span> <span class="o">-</span> <span class="n">spacing</span><span class="o">*</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">steps</span>
<span class="n">cell_h</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1">#  Buttons at Top 
</span><span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">50</span>
<span class="n">save_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>
<span class="n">load_btn</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">btn_w</span> <span class="o">-</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">btn_w</span><span class="p">,</span> <span class="n">btn_h</span><span class="p">)</span>

<span class="c1">#  Playback 
</span><span class="n">step</span><span class="p">,</span> <span class="n">bpm</span><span class="p">,</span> <span class="n">playing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="bp">True</span>
<span class="n">beat_time</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">60</span><span class="o">/</span><span class="n">bpm</span><span class="p">,</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1">#  Pygame-native file picker 
</span><span class="k">def</span> <span class="nf">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'.'</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.txt'</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">for_save</span> <span class="ow">and</span> <span class="s">"new_file.txt"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>  <span class="c1"># allow saving to new file
</span>        <span class="n">files</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"new_file.txt"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">files</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

    <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">while</span> <span class="n">picker_open</span><span class="p">:</span>
        <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">"Select file to SAVE:"</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="s">"Select file to LOAD:"</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">file_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">50</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="k">if</span> <span class="n">for_save</span> <span class="k">else</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">file_rects</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">fname</span><span class="p">,</span> <span class="n">rect</span><span class="p">))</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
                <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
                <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">file_rects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                        <span class="n">selected</span> <span class="o">=</span> <span class="n">fname</span>
                        <span class="n">picker_open</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">selected</span>

<span class="c1">#  Main loop 
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>

    <span class="c1"># Draw buttons
</span>    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">180</span><span class="p">),</span> <span class="n">save_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span> <span class="n">load_btn</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"SAVE"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">save_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">65</span><span class="p">,</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"LOAD"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="n">load_btn</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="mi">65</span><span class="p">,</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="mi">15</span><span class="p">))</span>

    <span class="c1"># Draw grid
</span>    <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">margin_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">cell_h</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cell_w</span><span class="p">,</span> <span class="n">cell_h</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span> <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="k">else</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">step</span><span class="p">:</span> <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">rect</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>

    <span class="c1">#  Events 
</span>    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">pos</span>
            <span class="k">if</span> <span class="n">save_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">target_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target_file</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file</span><span class="p">,</span><span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"Saved to:"</span><span class="p">,</span> <span class="n">target_file</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"Save error:"</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">load_btn</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                <span class="n">chosen_file</span> <span class="o">=</span> <span class="n">file_picker_overlay</span><span class="p">(</span><span class="n">for_save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chosen_file</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chosen_file</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                                <span class="n">pattern</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">}</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"Loaded:"</span><span class="p">,</span> <span class="n">chosen_file</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">"Load error:"</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
                        <span class="n">pattern</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">steps</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Toggle grid cell
</span>                <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">margin_top</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">cell_h</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">margin_left</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">cell_w</span><span class="o">+</span><span class="n">spacing</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cell_w</span><span class="p">,</span><span class="n">cell_h</span><span class="p">).</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
                            <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">^=</span> <span class="mi">1</span>

    <span class="c1">#  Playback 
</span>    <span class="k">if</span> <span class="n">playing</span> <span class="ow">and</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">last</span> <span class="o">&gt;=</span> <span class="n">beat_time</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">step</span><span class="p">]:</span> <span class="n">sounds</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">play</span><span class="p">()</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">steps</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

</code></pre></div></div>

<p>An example Twinkle Twinkle Little Star music text file is here. Copy the following and paste in a new 
twinkle.txt file you can load it later</p>

<h3 id="twinkletxt">twinkle.txt</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{"C": [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "D": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0], "E": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0], "F": [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0], "G": [0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0], "A": [0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}
</code></pre></div></div>

<h2 id="how-to-run">How to Run</h2>

<ol>
  <li>Install dependencies:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pygame numpy
</code></pre></div>    </div>
  </li>
  <li>Save the <code class="language-plaintext highlighter-rouge">.py</code> file.</li>
  <li>Run:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python music_maker.py
</code></pre></div>    </div>
  </li>
  <li>Click on the grid to toggle notes.</li>
  <li>Use <strong>SAVE</strong> and <strong>LOAD</strong> to persist your patterns.</li>
</ol>

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>Using <strong>Pygame mixer</strong> for custom audio playback</li>
  <li>Creating <strong>synthetic piano notes</strong> with Numpy</li>
  <li>Implementing a <strong>step sequencer grid</strong></li>
  <li>Saving/loading JSON data interactively</li>
  <li>Handling Pygame <strong>mouse events and UI</strong></li>
</ul>

<h2 id="further-ideas">Further Ideas</h2>

<ul>
  <li>Add more notes (B, higher octaves)</li>
  <li>Change <strong>instruments</strong> with different waveforms</li>
  <li>Export pattern to <strong>MIDI</strong></li>
  <li>Add <strong>tempo control slider</strong></li>
  <li>Enhance UI with <strong>colors and animations</strong></li>
</ul>

<hr />

<p>This beginner-friendly tutorial introduces <strong>music programming in Python</strong> and <strong>interactive sequencer logic</strong>. With practice, you can expand this into a <strong>full-fledged music maker</strong> with more features.</p>]]></content><author><name>PyShine Team</name></author><category term="pygame" /><category term="music" /><category term="interactive" /><category term="beginner" /><category term="python" /><summary type="html"><![CDATA[Step-by-step beginner-friendly tutorial on building an interactive music maker with Pygame, including save/load functionality.]]></summary></entry><entry><title type="html">Gravitational Time Dilation Simulation in Python</title><link href="https://www.pyshine.com/Time-Runs-Differently-Under-Gravity/" rel="alternate" type="text/html" title="Gravitational Time Dilation Simulation in Python" /><published>2025-10-30T00:00:00+00:00</published><updated>2025-10-30T00:00:00+00:00</updated><id>https://www.pyshine.com/Time-Runs-Differently-Under-Gravity</id><content type="html" xml:base="https://www.pyshine.com/Time-Runs-Differently-Under-Gravity/"><![CDATA[<h1 id="gravitational-time-dilation-simulation-with-pygame">Gravitational Time Dilation Simulation with Pygame</h1>

<h3 id="educational-python-project--visualize-how-gravity-affects-time">Educational Python Project â€“ Visualize How Gravity Affects Time</h3>

<p>This tutorial walks through building an <strong>interactive Gravitational Time Dilation Simulation</strong> using <strong>Python and Pygame</strong>. The simulation demonstrates how <strong>time passes differently under varying gravitational strengths</strong>, comparing a clock at Earthâ€™s surface to a clock under stronger or weaker gravity.</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#theory-gravitational-time-dilation">Theory: Gravitational Time Dilation</a></li>
  <li><a href="#pygame-setup">Pygame Setup</a></li>
  <li><a href="#clock-display">Clock Display</a></li>
  <li><a href="#gravity-adjustment">Gravity Adjustment</a></li>
  <li><a href="#matplotlib-live-plot">Matplotlib Live Plot</a></li>
  <li><a href="#relative-year-info">Relative Year Info</a></li>
  <li><a href="#complete-python-code">Complete Python Code</a></li>
  <li><a href="#how-to-run">How to Run</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-ideas">Further Ideas</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>This project simulates <strong>gravitational time dilation</strong> using Python. You can interactively increase or decrease gravity and watch how the time on the gravity clock diverges from the Earth clock.</p>

<h2 id="theory-gravitational-time-dilation">Theory: Gravitational Time Dilation</h2>

<p>According to general relativity, <strong>time passes differently under different gravitational potentials</strong>. A clock closer to a massive object ticks slower than a clock further away. The simulation uses the formula:</p>

\[\text{time factor} = \frac{1}{\sqrt{1 - \frac{2 G M}{r c^2}}}\]

<p>Where:</p>
<ul>
  <li>(G) is the gravitational constant</li>
  <li>(M) is the mass of the object (Earth)</li>
  <li>(r) is the distance from the center of the mass</li>
  <li>(c) is the speed of light</li>
</ul>

<h2 id="pygame-setup">Pygame Setup</h2>

<p>We initialize a Pygame window and define fonts for various display elements:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">280</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Gravitational Time Dilation Clock"</span><span class="p">)</span>
</code></pre></div></div>

<p>Fonts are adjustable at the top:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FONT_SIZE_INFO</span> <span class="o">=</span> <span class="mi">28</span>
<span class="n">FONT_SIZE_CLOCK</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">FONT_SIZE_SMALL</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">font_info</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">FONT_SIZE_INFO</span><span class="p">)</span>
<span class="n">font_clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">FONT_SIZE_CLOCK</span><span class="p">)</span>
<span class="n">font_small</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">FONT_SIZE_SMALL</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="clock-display">Clock Display</h2>

<p>The simulation shows two clocks:</p>
<ul>
  <li><strong>Earth Clock</strong>: baseline reference</li>
  <li><strong>Gravity Clock</strong>: affected by gravity changes</li>
</ul>

<h2 id="gravity-adjustment">Gravity Adjustment</h2>

<p>You can use the <strong>UP and DOWN arrow keys</strong> to increase or decrease gravity. The clocks update in real-time, and the relative rate is displayed.</p>

<h2 id="matplotlib-live-plot">Matplotlib Live Plot</h2>

<p>A live Matplotlib plot shows the <strong>relative clock rate vs gravity</strong>. The plot features:</p>
<ul>
  <li>Blue line with sky-blue dots</li>
  <li>Gradient shadow under the curve</li>
  <li>Dynamic Y-axis</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s">'blue'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s">'skyblue'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="relative-year-info">Relative Year Info</h2>

<p>The simulation also shows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 Year @ Earth = N Year @ Gravity Clock
</code></pre></div></div>

<p>This uses the <code class="language-plaintext highlighter-rouge">relative_rate</code> variable to dynamically display how 1 Earth year corresponds to a different duration on the gravity clock.</p>

<h2 id="complete-python-code">Complete Python Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1">#  Constants 
</span><span class="n">G</span> <span class="o">=</span> <span class="mf">6.67430e-11</span>           <span class="c1"># Gravitational constant (mÂ³/kgÂ·sÂ²)
</span><span class="n">c</span> <span class="o">=</span> <span class="mi">299792458</span>             <span class="c1"># Speed of light (m/s)
</span><span class="n">M</span> <span class="o">=</span> <span class="mf">5.972e24</span>              <span class="c1"># Mass of Earth (kg)
</span><span class="n">R_earth</span> <span class="o">=</span> <span class="mf">6.371e6</span>         <span class="c1"># Radius of Earth (m)
</span><span class="n">g_surface</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">R_earth</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># Surface gravity of Earth (m/sÂ²)
</span><span class="n">r_s</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">G</span> <span class="o">*</span> <span class="n">M</span> <span class="o">/</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span>    <span class="c1"># Schwarzschild radius for Earth (m)
</span><span class="n">gf_earth</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">M</span><span class="o">/</span><span class="p">(</span><span class="n">R_earth</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># Time dilation factor at Earth surface
</span><span class="n">SECONDS_PER_EARTH_YEAR</span> <span class="o">=</span> <span class="mf">365.25</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span>  <span class="c1"># Seconds in one Earth year
</span>
<span class="c1">#  Adjustable font sizes 
</span><span class="n">FONT_SIZE_INFO</span> <span class="o">=</span> <span class="mi">28</span>       <span class="c1"># Info line font
</span><span class="n">FONT_SIZE_CLOCK</span> <span class="o">=</span> <span class="mi">50</span>      <span class="c1"># Clock fonts
</span><span class="n">FONT_SIZE_SMALL</span> <span class="o">=</span> <span class="mi">40</span>      <span class="c1"># Gravity / Relative Rate text
</span>
<span class="c1">#  Pygame setup 
</span><span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">280</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Gravitational Time Dilation Clock"</span><span class="p">)</span>
<span class="n">font_info</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">FONT_SIZE_INFO</span><span class="p">)</span>
<span class="n">font_clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">FONT_SIZE_CLOCK</span><span class="p">)</span>
<span class="n">font_small</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">FONT_SIZE_SMALL</span><span class="p">)</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="c1">#  Initial conditions 
</span><span class="n">gravity</span> <span class="o">=</span> <span class="n">g_surface</span>
<span class="n">keys</span> <span class="o">=</span> <span class="p">{</span><span class="s">"up"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"down"</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
<span class="n">t_earth</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">t_gravity</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">prev_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1">#  Matplotlib setup 
</span><span class="n">plt</span><span class="p">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="p">.</span><span class="n">patch</span><span class="p">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">'black'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s">'black'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'x'</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s">'lime'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'y'</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s">'lime'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">xaxis</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">'lime'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">yaxis</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">'lime'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">'lime'</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.12</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="n">canvas</span><span class="p">.</span><span class="n">manager</span><span class="p">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s">"Gravitational Time Dilation vs. Local Gravity"</span><span class="p">)</span>

<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s">'blue'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">'o'</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s">'skyblue'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"Gravity (m/sÂ², log scale)"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"Relative Rate (Earth Clock / Gravity Clock)"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">'log'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'gray'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'--'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">gravities</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">relative_rates</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">#  Function to calculate gravity factor safely 
</span><span class="k">def</span> <span class="nf">gravity_factor_from_g</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">M</span><span class="o">/</span><span class="n">g</span><span class="p">),</span> <span class="n">r_s</span> <span class="o">*</span> <span class="mf">1.0001</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">M</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="c1">#  Format time function 
</span><span class="k">def</span> <span class="nf">format_time</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">t_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">t_int</span> <span class="o">//</span> <span class="mi">3600</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_int</span> <span class="o">%</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">//</span> <span class="mi">60</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">t_int</span> <span class="o">%</span> <span class="mi">60</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s">"</span>

<span class="c1">#  Main loop 
</span><span class="n">running</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">while</span> <span class="n">running</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_UP</span><span class="p">:</span>
                <span class="n">keys</span><span class="p">[</span><span class="s">"up"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_DOWN</span><span class="p">:</span>
                <span class="n">keys</span><span class="p">[</span><span class="s">"down"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">KEYUP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_UP</span><span class="p">:</span>
                <span class="n">keys</span><span class="p">[</span><span class="s">"up"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_DOWN</span><span class="p">:</span>
                <span class="n">keys</span><span class="p">[</span><span class="s">"down"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1">#  Compute delta time 
</span>    <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">delta_earth</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">prev_time</span>
    <span class="n">prev_time</span> <span class="o">=</span> <span class="n">current_time</span>

    <span class="c1">#  Update gravity 
</span>    <span class="k">if</span> <span class="n">keys</span><span class="p">[</span><span class="s">"up"</span><span class="p">]:</span>
        <span class="n">gravity</span> <span class="o">*=</span> <span class="mi">10</span><span class="o">**</span><span class="mf">0.05</span>
    <span class="k">if</span> <span class="n">keys</span><span class="p">[</span><span class="s">"down"</span><span class="p">]:</span>
        <span class="n">gravity</span> <span class="o">/=</span> <span class="mi">10</span><span class="o">**</span><span class="mf">0.05</span>
    <span class="n">gravity</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gravity</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">)</span>

    <span class="c1">#  Update clocks 
</span>    <span class="n">t_earth</span> <span class="o">+=</span> <span class="n">delta_earth</span> <span class="o">/</span> <span class="n">gf_earth</span>
    <span class="n">gf</span> <span class="o">=</span> <span class="n">gravity_factor_from_g</span><span class="p">(</span><span class="n">gravity</span><span class="p">)</span>
    <span class="n">t_gravity</span> <span class="o">+=</span> <span class="n">delta_earth</span> <span class="o">/</span> <span class="n">gf</span>
    <span class="n">relative_rate</span> <span class="o">=</span> <span class="n">gf_earth</span> <span class="o">/</span> <span class="n">gf</span>

    <span class="c1">#  Update Matplotlib plot 
</span>    <span class="k">if</span> <span class="n">keys</span><span class="p">[</span><span class="s">"up"</span><span class="p">]</span> <span class="ow">or</span> <span class="n">keys</span><span class="p">[</span><span class="s">"down"</span><span class="p">]:</span>
        <span class="n">gravities</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">gravity</span><span class="p">)</span>
        <span class="n">relative_rates</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">relative_rate</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gravities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">gravities</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">relative_rates</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">line</span><span class="p">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">gravities</span><span class="p">,</span> <span class="n">relative_rates</span><span class="p">)</span>

        <span class="c1"># Remove old gradient fills
</span>        <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">.</span><span class="n">collections</span><span class="p">:</span>
            <span class="n">coll</span><span class="p">.</span><span class="n">remove</span><span class="p">()</span>

        <span class="c1"># Gradient shadow under the curve
</span>        <span class="n">alpha_max</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">n_layers</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_layers</span><span class="p">):</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha_max</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">n_layers</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span>
                <span class="n">gravities</span><span class="p">,</span>
                <span class="p">[</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">n_layers</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">relative_rates</span><span class="p">],</span>
                <span class="n">relative_rates</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s">'skyblue'</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
            <span class="p">)</span>

        <span class="c1"># Dynamic Y-axis limits
</span>        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">relative_rates</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.1</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">relative_rates</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">.</span><span class="n">relim</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="n">scalex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">scaley</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">pause</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>

    <span class="c1">#  Compute 1 Year equivalence 
</span>    <span class="n">gravity_years</span> <span class="o">=</span> <span class="n">relative_rate</span>  <span class="c1"># 1 Earth year = relative_rate Gravity Clock years
</span>    <span class="n">info_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"1 Year @ Earth = </span><span class="si">{</span><span class="n">gravity_years</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="s"> Year @ Gravity Clock"</span>

    <span class="c1">#  Draw Pygame display 
</span>    <span class="n">screen</span><span class="p">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font_info</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">info_str</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font_clock</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s">"Earth Clock: </span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">t_earth</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font_clock</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s">"Gravity Clock: </span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">t_gravity</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">120</span><span class="p">))</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font_small</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s">"Gravity: </span><span class="si">{</span><span class="n">gravity</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">e</span><span class="si">}</span><span class="s"> m/sÂ²"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">180</span><span class="p">))</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">font_small</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s">"Relative Rate: </span><span class="si">{</span><span class="n">relative_rate</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">230</span><span class="p">))</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="how-to-run">How to Run</h2>

<ol>
  <li>Install required libraries:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install pygame matplotlib
</code></pre></div></div>

<ol>
  <li>Run the Python script:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python gravitational_time_dilation.py
</code></pre></div></div>

<ol>
  <li>Clikc on the PyGame window and then Use <strong>UP/DOWN arrow keys</strong> to change gravity interactively.</li>
</ol>

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>Gravitational time dilation in practice</li>
  <li>Interactive simulations with Pygame</li>
  <li>Real-time plotting with Matplotlib</li>
  <li>Combining physics with visualization for education</li>
</ul>

<h2 id="further-ideas">Further Ideas</h2>

<ul>
  <li>Add multiple objects with different masses</li>
  <li>Show a 3D representation of gravity wells</li>
  <li>Include relativistic effects at high velocities</li>
  <li>Export simulation data for further analysis</li>
</ul>]]></content><author><name>PyShine Team</name></author><category term="gravitational-time-dilation" /><category term="relativity" /><category term="python-simulation" /><category term="interactive" /><summary type="html"><![CDATA[Interactive simulation showing Earth Clock vs Gravity Clock and how gravity affects time.]]></summary></entry><entry><title type="html">AC to DC conversion Simulation in Python</title><link href="https://www.pyshine.com/AC-to-DC-Full-Wave-Rectifier-in-Pygame/" rel="alternate" type="text/html" title="AC to DC conversion Simulation in Python" /><published>2025-10-29T00:00:00+00:00</published><updated>2025-10-29T00:00:00+00:00</updated><id>https://www.pyshine.com/AC-to-DC-Full-Wave-Rectifier-in-Pygame</id><content type="html" xml:base="https://www.pyshine.com/AC-to-DC-Full-Wave-Rectifier-in-Pygame/"><![CDATA[<h1 id="full-wave-bridge-rectifier-simulation-with-pygame">Full Wave Bridge Rectifier Simulation with Pygame</h1>

<h3 id="educational-python-project--visualize-ac-to-dc-conversion">Educational Python Project â€“ Visualize AC to DC Conversion</h3>

<p>This tutorial walks through building a <strong>Full Wave Bridge Rectifier Simulation</strong> using <strong>Python and Pygame</strong>. The simulation visually demonstrates how <strong>AC (Alternating Current)</strong> is converted into <strong>DC (Direct Current)</strong> using <strong>four diodes</strong> arranged in a bridge circuit.</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#circuit-concept">Circuit Concept</a></li>
  <li><a href="#pygame-setup">Pygame Setup</a></li>
  <li><a href="#drawing-the-circuit">Drawing the Circuit</a></li>
  <li><a href="#waveform-animation">Waveform Animation</a></li>
  <li><a href="#current-flow-visualization">Current Flow Visualization</a></li>
  <li><a href="#complete-python-code">Complete Python Code</a></li>
  <li><a href="#how-to-run">How to Run</a></li>
  <li><a href="#key-learnings">Key Learnings</a></li>
  <li><a href="#further-ideas">Further Ideas</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>This simulation provides an interactive, animated look at how a <strong>bridge rectifier</strong> converts alternating current into pulsating direct current. The display shows:</p>

<ul>
  <li><strong>Top:</strong> Input AC waveform</li>
  <li><strong>Center:</strong> Bridge circuit with diode conduction paths</li>
  <li><strong>Bottom:</strong> Output DC waveform</li>
</ul>

<p>The current flow alternates between two paths during positive and negative half-cycles, visually explaining the rectification process.</p>

<h2 id="circuit-concept">Circuit Concept</h2>

<p>A <strong>full wave bridge rectifier</strong> uses <strong>four diodes (D1â€“D4)</strong> arranged in a diamond shape. During each half-cycle:</p>

<ul>
  <li><strong>Positive Half-Cycle:</strong>
    <ul>
      <li>Current flows through D1 â†’ Load â†’ D4.</li>
      <li>D1 and D4 conduct.</li>
    </ul>
  </li>
  <li><strong>Negative Half-Cycle:</strong>
    <ul>
      <li>Current flows through D3 â†’ Load â†’ D2.</li>
      <li>D2 and D3 conduct.</li>
    </ul>
  </li>
</ul>

<p>Thus, both halves of the AC waveform are converted into unidirectional current, producing a full-wave DC output.</p>

<h2 id="pygame-setup">Pygame Setup</h2>

<p>We start by setting up a <strong>650Ã—900 portrait window</strong> to allow space for the waveforms and the circuit diagram.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">math</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">900</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Full Wave Bridge Rectifier"</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">"Arial"</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">clk</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>
</code></pre></div></div>

<p>We define a dictionary of colors for background, grid, wires, diodes, and active paths:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">C</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"BG"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s">"GRID"</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="s">"WIRE"</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s">"DIODE"</span><span class="p">:</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="s">"IN"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
    <span class="s">"OUT"</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s">"ANODE"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s">"CATHODE"</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s">"POSITIVE_HALF"</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
    <span class="s">"NEGATIVE_HALF"</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="drawing-the-circuit">Drawing the Circuit</h2>

<p>We build a diamond-shaped layout for the diodes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       (D1)
        / \
     D2   D3
        \ /
       (D4)
</code></pre></div></div>

<p>Each diode is drawn with proper anode/cathode markers using <code class="language-plaintext highlighter-rouge">pygame.draw.polygon()</code> and <code class="language-plaintext highlighter-rouge">pygame.draw.circle()</code> for clarity.</p>

<p>Active diodes (the ones conducting in the current half-cycle) are highlighted in bright colors.</p>

<h2 id="waveform-animation">Waveform Animation</h2>

<p>Two waveforms are drawn to represent <strong>input AC</strong> and <strong>output DC</strong> signals:</p>

<ul>
  <li>The <strong>input AC</strong> is plotted as a sine wave (<code class="language-plaintext highlighter-rouge">math.sin()</code>), color-coded for positive (blue) and negative (red) halves.</li>
  <li>The <strong>output DC</strong> is plotted as the <strong>absolute value</strong> of the sine wave, representing rectified output.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">280</span><span class="p">):</span>
    <span class="n">y_val</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">p</span><span class="p">))</span>
    <span class="n">y_pos</span> <span class="o">=</span> <span class="n">box_y</span> <span class="o">+</span> <span class="n">y_val</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">"POSITIVE_HALF"</span><span class="p">]</span> <span class="k">if</span> <span class="n">y_val</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">C</span><span class="p">[</span><span class="s">"NEGATIVE_HALF"</span><span class="p">]</span>
    <span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="mi">140</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="current-flow-visualization">Current Flow Visualization</h2>

<p>To make the current path more interactive, small <strong>moving dots</strong> simulate the direction of electron flow through the active diodes and load resistor. The animation updates continuously using a changing <code class="language-plaintext highlighter-rouge">phase</code> variable.</p>

<p>Positive and negative half-cycles each show distinct paths:</p>

<ul>
  <li><strong>Blue dots:</strong> Positive half (D1â€“D4 conducting)</li>
  <li><strong>Red dots:</strong> Negative half (D2â€“D3 conducting)</li>
</ul>

<p>This helps students visually understand how current always flows in the same direction through the load.</p>

<h2 id="complete-python-code">Complete Python Code</h2>

<p>Below is the complete code that combines everything explained above.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">math</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># Setup 
</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">900</span>  <span class="c1"># Portrait orientation
</span><span class="n">S</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Full Wave Bridge Rectifier"</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">"Arial"</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">clk</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="c1"># Colors
</span><span class="n">C</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"BG"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s">"GRID"</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="s">"WIRE"</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Dimmer for non-active wires
</span>    <span class="s">"DIODE"</span><span class="p">:</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="c1"># Dimmer for non-active diodes
</span>    <span class="s">"IN"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
    <span class="s">"OUT"</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s">"LOAD"</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
    <span class="s">"ANODE"</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>    <span class="c1"># Green for anode
</span>    <span class="s">"CATHODE"</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># Red for cathode
</span>    <span class="s">"POSITIVE_HALF"</span><span class="p">:</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>  <span class="c1"># BLUE for positive half (swapped)
</span>    <span class="s">"NEGATIVE_HALF"</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>   <span class="c1"># RED for negative half (swapped)
</span><span class="p">}</span>

<span class="c1"># Wave and Animation
</span><span class="n">amp</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">phase</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="p">.</span><span class="mi">04</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">draw</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span>
<span class="n">txt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
             <span class="n">F</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">).</span><span class="n">get_rect</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">p</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">grid</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"GRID"</span><span class="p">],</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">H</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="mi">50</span><span class="p">):</span>
        <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"GRID"</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">draw_diode_with_polarity</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">20</span>
    
    <span class="c1"># Create a surface for the diode
</span>    <span class="n">diode_surface</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Surface</span><span class="p">((</span><span class="n">s</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mi">3</span><span class="p">),</span> <span class="n">pygame</span><span class="p">.</span><span class="n">SRCALPHA</span><span class="p">)</span>
    
    <span class="c1"># Use provided color or default
</span>    <span class="k">if</span> <span class="n">active</span> <span class="ow">and</span> <span class="n">color</span><span class="p">:</span>
        <span class="n">diode_color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="n">wire_color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="c1"># Make active diodes brighter
</span>        <span class="n">anode_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Brighter green
</span>        <span class="n">cathode_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># Brighter red
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="n">diode_color</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">"DIODE"</span><span class="p">]</span>
        <span class="n">wire_color</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">]</span>
        <span class="n">anode_color</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">"ANODE"</span><span class="p">]</span>
        <span class="n">cathode_color</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">"CATHODE"</span><span class="p">]</span>
    
    <span class="c1"># Draw diode symbol - reverse the direction if needed
</span>    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="c1"># Reverse diode (cathode on left, anode on right)
</span>        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">diode_color</span><span class="p">,</span> 
                           <span class="p">[(</span><span class="n">s</span><span class="o">*</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">2.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)])</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">wire_color</span><span class="p">,</span> 
                           <span class="p">[(</span><span class="n">s</span><span class="o">*</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">2.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">wire_color</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">2.5</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        
        <span class="c1"># Anode and cathode markers (swapped for reverse diode)
</span>        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">cathode_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># Cathode on left
</span>        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">anode_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">2.5</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span>    <span class="c1"># Anode on right
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Normal diode (anode on left, cathode on right)
</span>        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">diode_color</span><span class="p">,</span> 
                           <span class="p">[(</span><span class="n">s</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">2.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)])</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">wire_color</span><span class="p">,</span> 
                           <span class="p">[(</span><span class="n">s</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">2.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">wire_color</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">2.5</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        
        <span class="c1"># Anode and cathode markers
</span>        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">anode_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">cathode_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">2.5</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span>
    
    <span class="c1"># Rotate the surface
</span>    <span class="n">rotated_surface</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">diode_surface</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    
    <span class="c1"># Get the rect and center it at the position
</span>    <span class="n">rect</span> <span class="o">=</span> <span class="n">rotated_surface</span><span class="p">.</span><span class="n">get_rect</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="n">S</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">rotated_surface</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">waves</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">grid</span><span class="p">()</span>
    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">W</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">H</span><span class="o">//</span><span class="mi">2</span>
    
    <span class="c1"># Input Wave (AC) - TOP (moved 40px down) 
</span>    <span class="n">box_y</span> <span class="o">=</span> <span class="mi">160</span>  <span class="c1"># Was 120, now 160 (40px down)
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"DIODE"</span><span class="p">],</span> <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="mi">150</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">-</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">115</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Draw input wave with color coding
</span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">280</span><span class="p">):</span>
        <span class="n">y_val</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">p</span><span class="p">))</span>
        <span class="n">y_pos</span> <span class="o">=</span> <span class="n">box_y</span> <span class="o">+</span> <span class="n">y_val</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">"POSITIVE_HALF"</span><span class="p">]</span> <span class="k">if</span> <span class="n">y_val</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">C</span><span class="p">[</span><span class="s">"NEGATIVE_HALF"</span><span class="p">]</span>
        <span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="mi">140</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">txt</span><span class="p">(</span><span class="s">"AC Input Waveform"</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">-</span> <span class="mi">90</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"IN"</span><span class="p">])</span>
    <span class="c1"># txt("Live", (cx - 50, box_y + 80), C["IN"])
</span>    <span class="c1"># txt("Neutral", (cx + 50, box_y + 80), C["IN"])
</span>
    <span class="c1"># Output Wave (Full-Wave DC) - BOTTOM (moved 40px up) 
</span>    <span class="n">box_y</span> <span class="o">=</span> <span class="n">H</span> <span class="o">-</span> <span class="mi">160</span>  <span class="c1"># Was H - 120, now H - 160 (40px up)
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"DIODE"</span><span class="p">],</span> <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="mi">150</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">-</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">115</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Draw output wave with color coding based on original input phase
</span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">280</span><span class="p">):</span>
        <span class="n">y_val</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">p</span><span class="p">))</span>
        <span class="n">y_pos</span> <span class="o">=</span> <span class="n">box_y</span> <span class="o">-</span> <span class="n">amp</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">p</span><span class="p">)))</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">"POSITIVE_HALF"</span><span class="p">]</span> <span class="k">if</span> <span class="n">y_val</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">C</span><span class="p">[</span><span class="s">"NEGATIVE_HALF"</span><span class="p">]</span>
        <span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="mi">140</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">txt</span><span class="p">(</span><span class="s">"DC Output Waveform"</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">-</span> <span class="mi">90</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"OUT"</span><span class="p">])</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"-"</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="mi">50</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">+</span> <span class="mi">80</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"OUT"</span><span class="p">])</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"+"</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">+</span> <span class="mi">80</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"OUT"</span><span class="p">])</span>

    <span class="c1"># Bridge Rectifier Circuit - CENTER 
</span>    <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="n">cx</span><span class="p">,</span> <span class="n">H</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mi">120</span>
    
    <span class="c1"># Define the four points of the diamond
</span>    <span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span>      <span class="c1"># Live input
</span>    <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">center_y</span><span class="p">)</span>    <span class="c1"># Positive output
</span>    <span class="n">bottom</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span><span class="p">)</span>   <span class="c1"># Neutral input
</span>    <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">center_y</span><span class="p">)</span>     <span class="c1"># Negative output
</span>
    <span class="c1"># Determine current half cycle for coloring
</span>    <span class="n">current_sine</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">freq</span> <span class="o">*</span> <span class="p">(</span><span class="mi">140</span> <span class="o">+</span> <span class="n">p</span><span class="p">))</span>  <span class="c1"># Sample middle of waveform
</span>    <span class="n">is_positive_half</span> <span class="o">=</span> <span class="n">current_sine</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="n">active_color</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="s">"POSITIVE_HALF"</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_positive_half</span> <span class="k">else</span> <span class="n">C</span><span class="p">[</span><span class="s">"NEGATIVE_HALF"</span><span class="p">]</span>

    <span class="c1"># Draw all wires in dim color first
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">],</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>      <span class="c1"># Top to right
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">],</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>   <span class="c1"># Right to bottom  
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">],</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>    <span class="c1"># Bottom to left
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">],</span> <span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>       <span class="c1"># Left to top
</span>
    <span class="c1"># Highlight active current paths with Z-shape
</span>    <span class="k">if</span> <span class="n">is_positive_half</span><span class="p">:</span>
        <span class="c1"># Positive half cycle: Live â†’ D1 â†’ Positive â†’ Load â†’ Negative â†’ D4 â†’ Neutral
</span>        <span class="c1"># This forms a Z-shape: top-right to bottom-left
</span>        <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>      <span class="c1"># Live to Positive via D1
</span>        <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>    <span class="c1"># Negative to Neutral via D4
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Negative half cycle: Neutral â†’ D3 â†’ Positive â†’ Load â†’ Negative â†’ D2 â†’ Live
</span>        <span class="c1"># This forms the opposite Z-shape: bottom-right to top-left
</span>        <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>   <span class="c1"># Neutral to Positive via D3
</span>        <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>       <span class="c1"># Negative to Live via D2
</span>
    <span class="c1"># Diodes with UPDATED directions (D2 and D3 reversed):
</span>    <span class="c1"># D1: Top-right - Live to Positive (normal direction)
</span>    <span class="c1"># D2: Top-left - Negative to Live (REVERSE direction - NOW NORMAL)
</span>    <span class="c1"># D3: Bottom-right - Neutral to Positive (normal direction - NOW REVERSE)  
</span>    <span class="c1"># D4: Bottom-left - Negative to Neutral (REVERSE direction)
</span>    
    <span class="c1"># Only color the two conducting diodes
</span>    <span class="k">if</span> <span class="n">is_positive_half</span><span class="p">:</span>
        <span class="c1"># Positive half cycle: D1 and D4 conduct (ONLY these two are colored)
</span>        <span class="n">draw_diode_with_polarity</span><span class="p">(((</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">135</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">active_color</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># D1 (normal)
</span>        <span class="n">draw_diode_with_polarity</span><span class="p">(((</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">225</span><span class="p">)</span>  <span class="c1"># D2 (inactive - FIXED: removed color)
</span>        <span class="n">draw_diode_with_polarity</span><span class="p">(((</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># D3 (now reverse - was normal)
</span>        <span class="n">draw_diode_with_polarity</span><span class="p">(((</span><span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">315</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">active_color</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># D4 (reverse)
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Negative half cycle: D2 and D3 conduct (ONLY these two are colored)
</span>        <span class="n">draw_diode_with_polarity</span><span class="p">(((</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">135</span><span class="p">)</span>  <span class="c1"># D1 (inactive)
</span>        <span class="n">draw_diode_with_polarity</span><span class="p">(((</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">225</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">active_color</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># D2 (now normal - was reverse)
</span>        <span class="n">draw_diode_with_polarity</span><span class="p">(((</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">active_color</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># D3 (now reverse - was normal)
</span>        <span class="n">draw_diode_with_polarity</span><span class="p">(((</span><span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mi">315</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># D4 (inactive)
</span>
    <span class="c1"># Label diodes
</span>    <span class="n">txt</span><span class="p">(</span><span class="s">"D1"</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span> <span class="o">+</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.3</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">])</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"D2"</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.3</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">])</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"D3"</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span> <span class="o">+</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.3</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">])</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"D4"</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span><span class="o">*</span><span class="mf">0.3</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">])</span>

    <span class="c1"># AC Input connections - SHORT 20px wires with labels
</span>    <span class="c1"># Live wire - short line upward from top point
</span>    <span class="n">wire_color_live</span> <span class="o">=</span> <span class="n">active_color</span> <span class="k">if</span> <span class="p">(</span><span class="n">is_positive_half</span><span class="p">)</span> <span class="k">else</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">]</span>
    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">wire_color_live</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">is_positive_half</span> <span class="k">else</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"IN"</span><span class="p">],</span> <span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">25</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"L"</span><span class="p">,</span> <span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">40</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"IN"</span><span class="p">])</span>
    
    <span class="c1"># Neutral wire - short line downward from bottom point
</span>    <span class="n">wire_color_neutral</span> <span class="o">=</span> <span class="n">active_color</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_positive_half</span><span class="p">)</span> <span class="k">else</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">]</span>
    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">wire_color_neutral</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">5</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_positive_half</span> <span class="k">else</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="s">"IN"</span><span class="p">],</span> <span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">25</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"N"</span><span class="p">,</span> <span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">40</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"IN"</span><span class="p">])</span>

    <span class="c1"># DC Output connections - SHORT 20px wires with labels
</span>    <span class="c1"># Positive output - short line to right from right point
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"-"</span><span class="p">,</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">35</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">C</span><span class="p">[</span><span class="s">"OUT"</span><span class="p">])</span>
    
    <span class="c1"># Negative output - short line to left from left point
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"+"</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">35</span><span class="p">,</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">C</span><span class="p">[</span><span class="s">"OUT"</span><span class="p">])</span>

    <span class="c1"># Load resistor - placed INSIDE bridge width
</span>    <span class="n">load_width</span><span class="p">,</span> <span class="n">load_height</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">40</span>
    <span class="n">load_x</span><span class="p">,</span> <span class="n">load_y</span> <span class="o">=</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span>
    
    <span class="c1"># Draw load resistor with active color
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="p">(</span><span class="n">load_x</span> <span class="o">-</span> <span class="n">load_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">load_y</span> <span class="o">-</span> <span class="n">load_height</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> 
                            <span class="n">load_width</span><span class="p">,</span> <span class="n">load_height</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"Load"</span><span class="p">,</span> <span class="p">(</span><span class="n">load_x</span><span class="p">,</span> <span class="n">load_y</span><span class="p">),</span> <span class="n">active_color</span><span class="p">)</span>
    
    <span class="c1"># Connect load to bridge - short connections with active color
</span>    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> 
              <span class="p">(</span><span class="n">load_x</span> <span class="o">+</span> <span class="n">load_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">load_y</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> 
              <span class="p">(</span><span class="n">load_x</span> <span class="o">-</span> <span class="n">load_width</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">load_y</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>

    <span class="c1"># Add current flow animation (small moving dots) - REVERSED DIRECTION
</span>    <span class="n">dot_phase</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span>
    <span class="n">dot_size</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="k">if</span> <span class="n">is_positive_half</span><span class="p">:</span>
        <span class="c1"># Positive half current flow: Live â†’ D1 â†’ Positive â†’ Load â†’ Negative â†’ D4 â†’ Neutral
</span>        <span class="k">if</span> <span class="n">dot_phase</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c1"># First segment: Live to Positive via D1 (REVERSED: now from Positive to Live)
</span>            <span class="n">progress</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dot_phase</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Reverse progress
</span>            <span class="n">dot_x</span> <span class="o">=</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">progress</span>
            <span class="n">dot_y</span> <span class="o">=</span> <span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">progress</span>
            <span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dot_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dot_y</span><span class="p">)),</span> <span class="n">dot_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Second segment: Negative to Neutral via D4 (REVERSED: now from Neutral to Negative)
</span>            <span class="n">progress</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">dot_phase</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Reverse progress
</span>            <span class="n">dot_x</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">progress</span>
            <span class="n">dot_y</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">progress</span>
            <span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dot_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dot_y</span><span class="p">)),</span> <span class="n">dot_size</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Negative half current flow: Neutral â†’ D3 â†’ Positive â†’ Load â†’ Negative â†’ D2 â†’ Live
</span>        <span class="k">if</span> <span class="n">dot_phase</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c1"># First segment: Neutral to Positive via D3 (REVERSED: now from Positive to Neutral)
</span>            <span class="n">progress</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dot_phase</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Reverse progress
</span>            <span class="n">dot_x</span> <span class="o">=</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">progress</span>
            <span class="n">dot_y</span> <span class="o">=</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bottom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">progress</span>
            <span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dot_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dot_y</span><span class="p">)),</span> <span class="n">dot_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Second segment: Negative to Live via D2 (REVERSED: now from Live to Negative)
</span>            <span class="n">progress</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">dot_phase</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Reverse progress
</span>            <span class="n">dot_x</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">progress</span>
            <span class="n">dot_y</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">progress</span>
            <span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">active_color</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dot_x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dot_y</span><span class="p">)),</span> <span class="n">dot_size</span><span class="p">)</span>

    <span class="c1"># Add title and description
</span>    <span class="n">txt</span><span class="p">(</span><span class="s">"Full Wave Bridge Rectifier"</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"WIRE"</span><span class="p">])</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"AC to DC Conversion"</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
    
    <span class="c1"># Add connection indicators (adjusted positions)
</span>    <span class="n">txt</span><span class="p">(</span><span class="s">"AC Input"</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">radius</span> <span class="o">-</span> <span class="mi">60</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"IN"</span><span class="p">])</span>
    <span class="n">txt</span><span class="p">(</span><span class="s">"DC Output"</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">+</span> <span class="mi">60</span><span class="p">),</span> <span class="n">C</span><span class="p">[</span><span class="s">"OUT"</span><span class="p">])</span>
    
    <span class="c1"># Show current path description
</span>    <span class="k">if</span> <span class="n">is_positive_half</span><span class="p">:</span>
        <span class="n">path_text</span> <span class="o">=</span> <span class="s">"Current Path (Blue): Live â†’ D1 â†’ (+) â†’ Load â†’ (-) â†’ D4 â†’ Neutral"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path_text</span> <span class="o">=</span> <span class="s">"Current Path (Red): Neutral â†’ D3 â†’ (+) â†’ Load â†’ (-) â†’ D2 â†’ Live"</span>
    <span class="n">txt</span><span class="p">(</span><span class="n">path_text</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">H</span> <span class="o">-</span> <span class="mi">50</span><span class="p">),</span> <span class="n">active_color</span><span class="p">)</span>

<span class="c1"># Main Loop
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">e</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_ESCAPE</span><span class="p">):</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">();</span> <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

    <span class="n">S</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="s">"BG"</span><span class="p">])</span>
    <span class="n">waves</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">+=</span> <span class="n">speed</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clk</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="how-to-run">How to Run</h2>

<ol>
  <li>Install <strong>Pygame</strong> if you havenâ€™t already:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>pygame
</code></pre></div>    </div>
  </li>
  <li>Save the script as <code class="language-plaintext highlighter-rouge">rectifier_sim.py</code>.</li>
  <li>Run it:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python rectifier_sim.py
</code></pre></div>    </div>
  </li>
  <li>Press <strong>[ESC]</strong> to quit.</li>
</ol>

<h2 id="key-learnings">Key Learnings</h2>

<ul>
  <li>How a <strong>Full Wave Bridge Rectifier</strong> works.</li>
  <li>How to <strong>simulate electric circuits visually</strong> using Python.</li>
  <li>Using <strong>Pygame for animation</strong> and dynamic drawing.</li>
  <li>Representing <strong>waveforms and logic</strong> through geometry and color.</li>
</ul>

<h2 id="further-ideas">Further Ideas</h2>

<p>Here are some fun ways to extend the project:</p>

<ul>
  <li>Add a <strong>filter capacitor</strong> to smooth the output waveform.</li>
  <li>Display a <strong>moving average</strong> of the output voltage.</li>
  <li>Add <strong>sound effects</strong> when current changes direction.</li>
  <li>Show <strong>voltage vs time graph</strong> side-by-side with the circuit.</li>
</ul>

<h2 id="credits">Credits</h2>

<p>Developed by <strong>PyShine</strong> â€” bringing electronics and Python to life through visual learning!</p>

<p>If you found this helpful, consider subscribing to <a href="https://www.youtube.com/@pyshine_official">PyShine on YouTube</a>  for more fun Python projects.</p>

<p><strong>Happy Coding &amp; Keep Learning! âš¡</strong></p>]]></content><author><name>PyShine Team</name></author><category term="ad-to-dc" /><category term="full-wave-bridge" /><category term="ac dc rectifier simulation" /><summary type="html"><![CDATA[Full Bridge AC/DC four Diodes based Rectifier]]></summary></entry><entry><title type="html">How to make a GPS Satellite Simulation in Python</title><link href="https://www.pyshine.com/How-to-Simulate-GPS-Satellites/" rel="alternate" type="text/html" title="How to make a GPS Satellite Simulation in Python" /><published>2025-10-24T00:00:00+00:00</published><updated>2025-10-24T00:00:00+00:00</updated><id>https://www.pyshine.com/How-to-Simulate-GPS-Satellites</id><content type="html" xml:base="https://www.pyshine.com/How-to-Simulate-GPS-Satellites/"><![CDATA[<p>For more details:</p>
<h3 id="check-out-our-youtube-short">Check out our YouTube Short!</h3>

<div style="text-align:center;">
  <iframe width="320" height="568" src="https://www.youtube.com/embed/-LxLf4hZzHY?rel=0&amp;autoplay=0" title="YouTube Short" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
  </iframe>
</div>

<h1 id="3d-visualization-of-a-gps-satellite-constellation">3D Visualization of a GPS Satellite Constellation</h1>

<p><strong>A detailed, step-by-step tutorial and annotated markdown blog</strong> that explains a VPython script which renders a 3D visualization of the GPS satellite constellation (24 operational satellites shown across 6 orbital planes). This tutorial covers setup, math, per-line code explanation, optimization tips, debugging, and suggested extensions.</p>

<h2 id="overview">Overview</h2>

<p>The script creates a <strong>3D animation of GPS satellites</strong> orbiting Earth using VPython. It models the <strong>real GPS constellation</strong> with six orbital planes, each containing four satellites, at an altitude of about 20,180 km. The satellites orbit with a 55Â° inclination and leave colorful trails to show their paths.</p>

<h2 id="requirements">Requirements</h2>

<p>To run this visualization, you need:</p>

<ul>
  <li>Python 3.8+</li>
  <li>The <code class="language-plaintext highlighter-rouge">vpython</code> library</li>
</ul>

<p>Install it via pip:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>vpython
</code></pre></div></div>

<blockquote>
  <p>VPython runs in a browser or a standalone window depending on your setup.</p>
</blockquote>

<h2 id="full-source-code">Full Source Code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">vpython</span> <span class="kn">import</span> <span class="n">sphere</span><span class="p">,</span> <span class="n">vector</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> \
    <span class="n">textures</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">cylinder</span><span class="p">,</span> <span class="n">mag</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Scene setup
</span><span class="n">scene</span> <span class="o">=</span> <span class="n">canvas</span><span class="p">(</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">"GPS Satellites:24 | Orbital Planes: 6"</span><span class="p">,</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
    <span class="n">background</span> <span class="o">=</span> <span class="n">color</span><span class="p">.</span><span class="n">black</span><span class="p">,</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Earth and GPS parameters
</span><span class="n">EARTH_RADIUS</span> <span class="o">=</span> <span class="mf">6371e3</span> <span class="c1"># 6,371 km
</span><span class="n">GPS_ALTITUDE</span> <span class="o">=</span> <span class="mf">20180e3</span> <span class="c1"># 20,180 km
</span><span class="n">GPS_RADIUS</span> <span class="o">=</span> <span class="n">EARTH_RADIUS</span> <span class="o">+</span> <span class="n">GPS_ALTITUDE</span>
<span class="n">SCALE</span> <span class="o">=</span> <span class="mf">1e-7</span>
<span class="n">DISP_R</span> <span class="o">=</span> <span class="n">EARTH_RADIUS</span> <span class="o">*</span> <span class="n">SCALE</span>
<span class="n">DISPLAY_GPS_RADIUS</span> <span class="o">=</span> <span class="n">GPS_RADIUS</span> <span class="o">*</span> <span class="n">SCALE</span>

<span class="c1"># Orbital parameters
</span><span class="n">GPS_ORBITAL_PERIOD</span> <span class="o">=</span> <span class="mi">43080</span> <span class="c1"># seconds (11h 58m)
</span><span class="n">SPEED_FACTOR</span> <span class="o">=</span> <span class="mi">3000</span> <span class="c1"># Time scale multiplier for visuals
</span><span class="n">TIME_STEP</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">60</span>
<span class="n">omega_gps</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">GPS_ORBITAL_PERIOD</span> <span class="o">*</span> <span class="n">SPEED_FACTOR</span>

<span class="c1"># Create Earth
</span><span class="n">earth</span> <span class="o">=</span> <span class="n">sphere</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="n">DISP_R</span><span class="p">,</span>
               <span class="n">texture</span><span class="o">=</span><span class="n">textures</span><span class="p">.</span><span class="n">earth</span><span class="p">,</span>
               <span class="n">shininess</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Create GPS satellites
</span><span class="n">num_planes</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">sats_per_plane</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">total_satellites</span> <span class="o">=</span> <span class="n">num_planes</span> <span class="o">*</span> <span class="n">sats_per_plane</span>
<span class="n">satellites</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sat_labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">connection_lines</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Colors for each plane
</span><span class="n">plane_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span><span class="p">.</span><span class="n">red</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">orange</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">yellow</span><span class="p">,</span>
                <span class="n">color</span><span class="p">.</span><span class="n">green</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">cyan</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">magenta</span><span class="p">]</span>

<span class="n">inclination</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
<span class="n">satellite_count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">plane</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_planes</span><span class="p">):</span>
    <span class="n">raan</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">plane</span> <span class="o">/</span> <span class="n">num_planes</span>  <span class="c1"># RAAN evenly spaced
</span>    <span class="k">for</span> <span class="n">sat_in_plane</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sats_per_plane</span><span class="p">):</span>
        <span class="n">true_anomaly</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sat_in_plane</span> <span class="o">/</span> <span class="n">sats_per_plane</span>
        
        <span class="n">sat</span> <span class="o">=</span> <span class="n">sphere</span><span class="p">(</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">DISP_R</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">.</span><span class="n">white</span><span class="p">,</span>
            <span class="n">make_trail</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
            <span class="n">trail_type</span> <span class="o">=</span> <span class="s">"curve"</span><span class="p">,</span>
            <span class="n">trail_radius</span> <span class="o">=</span> <span class="n">DISP_R</span> <span class="o">*</span> <span class="mf">0.025</span><span class="p">,</span>
            <span class="n">trail_color</span> <span class="o">=</span> <span class="n">plane_colors</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
            <span class="n">retain</span><span class="o">=</span><span class="mi">2000</span>
        <span class="p">)</span>

        <span class="n">sat_label</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"GPS </span><span class="si">{</span><span class="n">satellite_count</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">plane_colors</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
            <span class="n">box</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>

        <span class="n">connection_line</span> <span class="o">=</span> <span class="n">cylinder</span><span class="p">(</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">DISP_R</span> <span class="o">*</span> <span class="mf">0.005</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">plane_colors</span><span class="p">[</span><span class="n">plane</span><span class="p">],</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.6</span>
        <span class="p">)</span>

        <span class="n">sat</span><span class="p">.</span><span class="n">raan</span> <span class="o">=</span> <span class="n">raan</span>
        <span class="n">sat</span><span class="p">.</span><span class="n">true_anomaly</span> <span class="o">=</span> <span class="n">true_anomaly</span>
        <span class="n">sat</span><span class="p">.</span><span class="n">plane</span> <span class="o">=</span> <span class="n">plane</span>
        <span class="n">satellites</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sat</span><span class="p">)</span>
        <span class="n">sat_labels</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sat_label</span><span class="p">)</span>
        <span class="n">connection_lines</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">connection_line</span><span class="p">)</span>
        <span class="n">satellite_count</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">satellites</span><span class="p">)</span><span class="si">}</span><span class="s"> GPS satellites in </span><span class="si">{</span><span class="n">num_planes</span><span class="si">}</span><span class="s"> orbital planes"</span><span class="p">)</span>

<span class="c1"># Simulation loop
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">rate</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">earth</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">satellites</span><span class="p">):</span>
        <span class="n">sat</span><span class="p">.</span><span class="n">true_anomaly</span> <span class="o">+=</span> <span class="n">omega_gps</span> <span class="o">*</span> <span class="n">TIME_STEP</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">DISPLAY_GPS_RADIUS</span>

        <span class="c1"># Position in orbital plane
</span>        <span class="n">x_orb</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sat</span><span class="p">.</span><span class="n">true_anomaly</span><span class="p">)</span>
        <span class="n">y_orb</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">z_orb</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sat</span><span class="p">.</span><span class="n">true_anomaly</span><span class="p">)</span>

        <span class="c1"># Apply inclination rotation
</span>        <span class="n">x_incl</span> <span class="o">=</span> <span class="n">x_orb</span>
        <span class="n">y_incl</span> <span class="o">=</span> <span class="n">y_orb</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">inclination</span><span class="p">)</span> <span class="o">-</span> <span class="n">z_orb</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">inclination</span><span class="p">)</span>
        <span class="n">z_incl</span> <span class="o">=</span> <span class="n">y_orb</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">inclination</span><span class="p">)</span> <span class="o">+</span> <span class="n">z_orb</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">inclination</span><span class="p">)</span>

        <span class="c1"># Apply RAAN rotation
</span>        <span class="n">x_final</span> <span class="o">=</span> <span class="n">x_incl</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sat</span><span class="p">.</span><span class="n">raan</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_incl</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sat</span><span class="p">.</span><span class="n">raan</span><span class="p">)</span>
        <span class="n">y_final</span> <span class="o">=</span> <span class="n">x_incl</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sat</span><span class="p">.</span><span class="n">raan</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_incl</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sat</span><span class="p">.</span><span class="n">raan</span><span class="p">)</span>
        <span class="n">z_final</span> <span class="o">=</span> <span class="n">z_incl</span>

        <span class="n">sat</span><span class="p">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="n">x_final</span><span class="p">,</span> <span class="n">y_final</span><span class="p">,</span> <span class="n">z_final</span><span class="p">)</span>
        <span class="n">sat_labels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span> <span class="o">=</span> <span class="n">sat</span><span class="p">.</span><span class="n">pos</span> <span class="o">+</span> <span class="n">vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">DISP_R</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mag</span><span class="p">(</span><span class="n">sat</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sat_dir</span> <span class="o">=</span> <span class="n">sat</span><span class="p">.</span><span class="n">pos</span> <span class="o">/</span> <span class="n">mag</span><span class="p">(</span><span class="n">sat</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="n">ground_point</span> <span class="o">=</span> <span class="n">sat_dir</span> <span class="o">*</span> <span class="n">DISP_R</span>
            <span class="n">connection_lines</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pos</span> <span class="o">=</span> <span class="n">ground_point</span>
            <span class="n">connection_lines</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">axis</span> <span class="o">=</span> <span class="n">sat</span><span class="p">.</span><span class="n">pos</span> <span class="o">-</span> <span class="n">ground_point</span>

        <span class="k">if</span> <span class="n">sat</span><span class="p">.</span><span class="n">true_anomaly</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="n">sat</span><span class="p">.</span><span class="n">true_anomaly</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">pi</span>
            <span class="n">sat</span><span class="p">.</span><span class="n">clear_trail</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="detailed-explanation">Detailed Explanation</h2>

<h3 id="scene-and-scale">Scene and Scale</h3>

<p>We use a <code class="language-plaintext highlighter-rouge">canvas</code> as our 3D scene and apply scaling to shrink Earthâ€™s real radius (6,371 km) and orbit altitude (20,180 km) to manageable VPython units using <code class="language-plaintext highlighter-rouge">SCALE = 1e-7</code>. This keeps visual proportions correct while fitting in the viewport.</p>

<h3 id="orbital-parameters">Orbital Parameters</h3>

<p>The GPS system uses:</p>
<ul>
  <li><strong>6 orbital planes</strong> separated by 60Â° in RAAN.</li>
  <li><strong>4 satellites per plane</strong>, spaced 90Â° apart in true anomaly.</li>
  <li><strong>Inclination:</strong> 55Â° relative to Earthâ€™s equator.</li>
  <li><strong>Orbital Period:</strong> ~12 hours.</li>
</ul>

<p>To make orbits visible, we scale the angular speed by <code class="language-plaintext highlighter-rouge">SPEED_FACTOR = 3000</code> so satellites complete revolutions faster.</p>

<h3 id="satellite-initialization">Satellite Initialization</h3>

<p>Each satellite is created as a small white <code class="language-plaintext highlighter-rouge">sphere</code> with a colored trail. The color corresponds to its orbital plane. We also attach a <code class="language-plaintext highlighter-rouge">label</code> above each satellite and a <code class="language-plaintext highlighter-rouge">cylinder</code> line connecting it to Earthâ€™s surface.</p>

<p>The nested loop structure:</p>
<ul>
  <li>Outer loop (<code class="language-plaintext highlighter-rouge">plane</code>) sets the planeâ€™s RAAN.</li>
  <li>Inner loop (<code class="language-plaintext highlighter-rouge">sat_in_plane</code>) places satellites evenly spaced in that plane.</li>
</ul>

<p>We store each satelliteâ€™s RAAN, true anomaly, and plane index for later updates.</p>

<h3 id="orbital-motion">Orbital Motion</h3>

<p>Each frame (at 60 FPS):</p>
<ol>
  <li>Increment the true anomaly based on angular velocity.</li>
  <li>Compute the position in the orbital plane.</li>
  <li>Apply two rotations:
    <ul>
      <li><strong>Inclination rotation</strong> around the x-axis.</li>
      <li><strong>RAAN rotation</strong> around the z-axis.</li>
    </ul>
  </li>
  <li>Update the satelliteâ€™s position.</li>
  <li>Update its label and connection line.</li>
  <li>Reset the trail after completing a full orbit.</li>
</ol>

<h3 id="earth-rotation">Earth Rotation</h3>

<p>The Earth sphere is rotated slowly with:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">earth</span><span class="p">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</code></pre></div></div>
<p>This simulates Earthâ€™s spin and adds realism.</p>

<h2 id="mathematical-summary">Mathematical Summary</h2>

<table>
  <thead>
    <tr>
      <th>Step</th>
      <th>Rotation Axis</th>
      <th>Formula</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>X-axis</td>
      <td>yâ€™ = y<em>cos(i) - z</em>sin(i)</td>
      <td>Inclination rotation</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Z-axis</td>
      <td>xâ€™â€™ = xâ€™<em>cos(Î©) - yâ€™</em>sin(Î©)</td>
      <td>RAAN rotation</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Î©</code> (RAAN) shifts the orbital plane around Earthâ€™s z-axis. <code class="language-plaintext highlighter-rouge">i</code> (inclination) tilts the plane.</p>

<h2 id="performance-tips">Performance Tips</h2>

<ul>
  <li>Reduce <code class="language-plaintext highlighter-rouge">retain</code> in trails to &lt;1000 to save memory.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">rate(30)</code> if animation is slow.</li>
  <li>Decrease number of satellites for testing.</li>
  <li>Avoid frequent creation/deletion of VPython objects inside the loop.</li>
</ul>

<h2 id="enhancements-you-can-try">Enhancements You Can Try</h2>

<ol>
  <li><strong>Add real-time controls:</strong> buttons for pause/resume, orbit speed, and trail toggle.</li>
  <li><strong>Add real GPS data:</strong> parse TLE files for actual satellite positions.</li>
  <li><strong>Add ground stations:</strong> show visible satellites from a chosen location.</li>
  <li><strong>Add camera animation:</strong> orbit camera around Earth.</li>
</ol>

<h2 id="summary">Summary</h2>

<p>This VPython project demonstrates how to visualize satellite constellations in 3D. You learned:</p>
<ul>
  <li>How to model orbital planes and inclination.</li>
  <li>How to use VPython primitives (<code class="language-plaintext highlighter-rouge">sphere</code>, <code class="language-plaintext highlighter-rouge">cylinder</code>, <code class="language-plaintext highlighter-rouge">label</code>).</li>
  <li>How to simulate orbital motion using angular updates.</li>
</ul>

<p>Itâ€™s a powerful educational example for both orbital mechanics and real-time 3D visualization in Python.</p>]]></content><author><name>PyShine Team</name></author><category term="gps satellites" /><category term="vpython tutorial" /><category term="gps satellites basic tutorial" /><summary type="html"><![CDATA[Visualizing GPS satellites in 3D]]></summary></entry><entry><title type="html">Recursive function to grow TREE in Python</title><link href="https://www.pyshine.com/How-to-make-Fibonacci-Tree/" rel="alternate" type="text/html" title="Recursive function to grow TREE in Python" /><published>2025-10-24T00:00:00+00:00</published><updated>2025-10-24T00:00:00+00:00</updated><id>https://www.pyshine.com/How-to-make-Fibonacci-Tree</id><content type="html" xml:base="https://www.pyshine.com/How-to-make-Fibonacci-Tree/"><![CDATA[<h1 id="fibonacci-tree-growth-multithreaded">Fibonacci Tree Growth (Multithreaded)</h1>

<blockquote>
  <p>A detailed, step-by-step tutorial explaining a Pygame program that draws a Fibonacci-based tree. This tutorial shows how the original recursive growth works and how to modify it so branches grow in parallel using multithreading (safe and practical approach).</p>
</blockquote>

<h2 id="table-of-contents">Table of contents</h2>

<h2 id="table-of-contents-1">Table of Contents</h2>
<ul>
  <li><a href="#1-introduction">Introduction</a></li>
  <li><a href="#2-prerequisites">Prerequisites</a></li>
  <li><a href="#3-project-structure">Project Structure</a></li>
  <li><a href="#4-simple-code">Full Original Code</a></li>
  <li><a href="#5-deep-explanation--line-by-line-and-concept-by-concept">Deep Explanation â€” Line by Line and Concept by Concept</a></li>
  <li><a href="#6-why-and-when-to-parallelize">Why and When to Parallelize</a></li>
  <li><a href="#7-design-choices-for-multithreading">Design Choices for Multithreading</a></li>
  <li><a href="#8-multithreaded-implementation--full-code">Multithreaded Implementation â€” Full Code</a></li>
  <li><a href="#9-how-to-run-and-test">How to Run and Test</a></li>
  <li><a href="#10-performance-considerations--debugging-tips">Performance Considerations &amp; Debugging Tips</a></li>
  <li><a href="#11-faq-and-closing-notes">FAQ and Closing Notes</a></li>
</ul>

<h2 id="1-introduction">1. Introduction</h2>

<p>This tutorial teaches you how a small Pygame program simulates a fractal, Fibonacci-based tree. Branch lengths and spreads follow Fibonacci-derived ratios so the resulting shape looks natural and organic.</p>

<p>Youâ€™ll see:</p>
<ul>
  <li>How the recursive <code class="language-plaintext highlighter-rouge">grow()</code> function builds branches.</li>
  <li>Why some branches look thicker or greener.</li>
  <li>How to convert the growth stage into parallel tasks so multiple branches can be computed at the same time, using Python threads.</li>
</ul>

<p>The tutorial ends with a complete multithreaded version ready to copy and run.</p>

<h2 id="2-prerequisites">2. Prerequisites</h2>

<ul>
  <li>Python 3.8+ (works well with 3.10 / 3.11)</li>
  <li><code class="language-plaintext highlighter-rouge">pygame</code> installed (<code class="language-plaintext highlighter-rouge">pip install pygame</code>)</li>
  <li>Basic knowledge of Python functions and threading concepts</li>
  <li>Optional: <code class="language-plaintext highlighter-rouge">concurrent.futures</code> familiarity</li>
</ul>

<h2 id="3-project-structure">3. Project structure</h2>

<p>Single file: <code class="language-plaintext highlighter-rouge">fibonacci_tree_parallel.py</code> . Run it with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python fibonacci_tree_parallel.py
</code></pre></div></div>

<h2 id="4-simple-code">4. Simple code</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">random</span>

<span class="c1"># INITIAL SETUP 
</span><span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="n">WIN_WIDTH</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">600</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIN_WIDTH</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Fibonacci Tree Growth"</span><span class="p">)</span>

<span class="c1"># COLOR DEFINITIONS 
</span><span class="n">SKY_COLOR</span>   <span class="o">=</span> <span class="p">(</span><span class="mi">135</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">235</span><span class="p">)</span>
<span class="n">BROWN_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
<span class="n">GREEN_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">34</span><span class="p">)</span>

<span class="c1"># TREE PARAMETERS 
</span><span class="n">GROUND_HEIGHT</span>   <span class="o">=</span> <span class="mi">50</span>
<span class="n">TREE_DEPTH</span>      <span class="o">=</span> <span class="mi">10</span>
<span class="n">BRANCH_WIDTH</span>    <span class="o">=</span> <span class="mi">20</span>
<span class="n">SPREAD_BASE</span>     <span class="o">=</span> <span class="mi">25</span>
<span class="n">SPREAD_FACTOR</span>   <span class="o">=</span> <span class="mi">70</span>         <span class="c1"># slightly larger spread for wider crown
</span><span class="n">LENGTH_DECAY</span>    <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">LENGTH_VARIANCE</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">BRANCH_STEP</span>     <span class="o">=</span> <span class="mi">3</span>
<span class="n">FPS</span>             <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># FONT 
</span><span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># GLOBALS 
</span><span class="n">branches</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">draw_step</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">started</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># FIBONACCI FUNCTION 
</span><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s">"""Return the nth Fibonacci number."""</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="c1"># TREE GENERATION 
</span><span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="s">"""
    Recursive Fibonacci-based branching function.
    Ensures branches stay mostly above the horizon and spread outward naturally.
    """</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">rad</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">end_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">length</span>
    <span class="n">end_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">length</span>

    <span class="c1"># prevent branches from going below the ground
</span>    <span class="k">if</span> <span class="n">end_y</span> <span class="o">&gt;</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span><span class="p">:</span>
        <span class="n">end_y</span> <span class="o">=</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span>

    <span class="c1"># add this branch
</span>    <span class="n">branches</span><span class="p">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">end_x</span><span class="p">,</span> <span class="n">end_y</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">))</span>

    <span class="c1"># Fibonacci ratio scaling
</span>    <span class="n">f_ratio</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fib</span><span class="p">(</span><span class="n">TREE_DEPTH</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">spread</span> <span class="o">=</span> <span class="n">SPREAD_BASE</span> <span class="o">+</span> <span class="n">SPREAD_FACTOR</span> <span class="o">*</span> <span class="n">f_ratio</span>

    <span class="c1"># number of child branches
</span>    <span class="n">sub_branches</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>

    <span class="c1"># nonlinear upward bias â€” keeps branches from pointing downward
</span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sub_branches</span><span class="p">):</span>
        <span class="n">new_length</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">LENGTH_DECAY</span> <span class="o">+</span> <span class="n">LENGTH_VARIANCE</span> <span class="o">*</span> <span class="n">f_ratio</span><span class="p">)</span>
        
        <span class="c1"># bias the angle upwards: restrict below horizontal (no downward growth)
</span>        <span class="n">bias</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">spread</span><span class="p">,</span> <span class="n">spread</span><span class="p">)</span>
        <span class="n">new_angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">bias</span>

        <span class="c1"># Clamp angles: ensure they stay above -90 (horizontal) and below 90
</span>        <span class="n">new_angle</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="n">new_angle</span><span class="p">))</span>

        <span class="n">new_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
        <span class="n">grow</span><span class="p">(</span><span class="n">end_x</span><span class="p">,</span> <span class="n">end_y</span><span class="p">,</span> <span class="n">new_length</span><span class="p">,</span> <span class="n">new_angle</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_width</span><span class="p">)</span>

<span class="c1"># INITIAL TREE CREATION 
</span><span class="n">INITIAL_LENGTH</span> <span class="o">=</span> <span class="p">(</span><span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="mi">120</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">TREE_DEPTH</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">grow</span><span class="p">(</span><span class="n">WIN_WIDTH</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span><span class="p">,</span> <span class="n">INITIAL_LENGTH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TREE_DEPTH</span><span class="p">,</span> <span class="n">BRANCH_WIDTH</span><span class="p">)</span>

<span class="c1"># CLOCK 
</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="c1"># MAIN LOOP 
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">started</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">screen</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">SKY_COLOR</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">GREEN_COLOR</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span><span class="p">,</span> <span class="n">WIN_WIDTH</span><span class="p">,</span> <span class="n">GROUND_HEIGHT</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">started</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"CLICK TO START"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">GREEN_COLOR</span><span class="p">)</span>
        <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="p">(</span><span class="n">WIN_WIDTH</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">msg</span><span class="p">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">draw_step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">draw_step</span> <span class="o">+</span> <span class="n">BRANCH_STEP</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">[:</span><span class="n">draw_step</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">BROWN_COLOR</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">BROWN_COLOR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">GREEN_COLOR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s">"BRANCH COUNT: </span><span class="si">{</span><span class="n">draw_step</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">GREEN_COLOR</span><span class="p">)</span>
        <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">(</span><span class="n">WIN_WIDTH</span> <span class="o">-</span> <span class="n">text</span><span class="p">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="5-deep-explanation--line-by-line-and-concept-by-concept">5. Deep explanation â€” line by line and concept by concept</h2>

<p>Iâ€™ll walk through the important pieces and why they exist.</p>

<h3 id="a-initialization-and-constants">a) Initialization and constants</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pygame.init()</code> starts Pygame.</li>
  <li><code class="language-plaintext highlighter-rouge">WIN_WIDTH</code>, <code class="language-plaintext highlighter-rouge">WIN_HEIGHT</code> â€” screen size.</li>
  <li>Color constants defined as RGB tuples.</li>
  <li>Tree parameters such as <code class="language-plaintext highlighter-rouge">TREE_DEPTH</code>, <code class="language-plaintext highlighter-rouge">BRANCH_WIDTH</code>, <code class="language-plaintext highlighter-rouge">SPREAD_BASE</code>, etc., control how deep the recursion goes, how thick branches start, and how widely they spread.</li>
</ul>

<p><strong>Tip:</strong> Keep <code class="language-plaintext highlighter-rouge">TREE_DEPTH</code> moderate (7â€“12). Too large creates many branches and can slow rendering and thread overhead.</p>

<h3 id="b-fibonacci-function">b) Fibonacci function</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">a</span>
</code></pre></div></div>

<ul>
  <li>Returns the nth Fibonacci number (1-indexed here).</li>
  <li>Used to compute ratios that change with depth â€” making lower/higher branches differ organically.</li>
</ul>

<h3 id="c-recursive-growth-grow">c) Recursive growth: <code class="language-plaintext highlighter-rouge">grow()</code></h3>

<p><code class="language-plaintext highlighter-rouge">grow(x, y, length, angle, depth, width)</code> does the heavy lifting.</p>

<p>Key steps inside:</p>
<ol>
  <li>Base case: stop when depth &lt;= 0 or length is tiny.</li>
  <li>Compute end coordinates using trigonometry:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">end_x = x + sin(angle) * length</code></li>
      <li><code class="language-plaintext highlighter-rouge">end_y = y - cos(angle) * length</code></li>
    </ul>
  </li>
  <li>Prevent branches dipping below the ground by clamping <code class="language-plaintext highlighter-rouge">end_y</code>.</li>
  <li>Append the branch to the <code class="language-plaintext highlighter-rouge">branches</code> list: <code class="language-plaintext highlighter-rouge">branches.append(((x, y), (end_x, end_y), width, depth))</code>.</li>
  <li>Compute Fibonacci-based scale <code class="language-plaintext highlighter-rouge">f_ratio</code> and <code class="language-plaintext highlighter-rouge">spread</code> to determine how much children diverge.</li>
  <li>Decide <code class="language-plaintext highlighter-rouge">sub_branches</code> â€” number of children, varied with Fibonacci.</li>
  <li>Loop through children, derive <code class="language-plaintext highlighter-rouge">new_length</code>, <code class="language-plaintext highlighter-rouge">new_angle</code> (biased upwards), clamp angles, reduce width, then recursively call <code class="language-plaintext highlighter-rouge">grow()</code> with <code class="language-plaintext highlighter-rouge">depth - 1</code>.</li>
</ol>

<p>This recursion builds a flattened list <code class="language-plaintext highlighter-rouge">branches</code> which is later drawn progressively in the main loop.</p>

<h3 id="d-drawing-loop-and-draw_step">d) Drawing loop and <code class="language-plaintext highlighter-rouge">draw_step</code></h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">branches</code> is precomputed once by <code class="language-plaintext highlighter-rouge">grow(...)</code> starting at the trunk base.</li>
  <li>Once user clicks, <code class="language-plaintext highlighter-rouge">draw_step</code> increases and the program draws <code class="language-plaintext highlighter-rouge">branches[:draw_step]</code> to animate growth.</li>
  <li>Color interpolation between brown and green depends on depth to simulate branch â†’ leaf transition.</li>
</ul>

<h2 id="6-why-and-when-to-parallelize">6. Why and when to parallelize</h2>

<p>The algorithm is CPU-heavy when <code class="language-plaintext highlighter-rouge">TREE_DEPTH</code> is high â€” recursively creating many branches. Parallelizing the <strong>generation</strong> (not the drawing) can bring speed benefits on multicore machines.</p>

<p><strong>Important</strong>: Pygame drawing calls must happen in the main thread on many platforms. So you parallelize only the computationally heavy part: generating branch geometry (<code class="language-plaintext highlighter-rouge">branches</code> list). Drawing stays single-threaded.</p>

<p>When to parallelize:</p>
<ul>
  <li>If <code class="language-plaintext highlighter-rouge">TREE_DEPTH &gt;= 11</code> or you notice long pauses at startup while branches are computed.</li>
  <li>If you want quicker precomputation before animating the growth.</li>
</ul>

<h2 id="7-design-choices-for-multithreading">7. Design choices for multithreading</h2>

<p>Options:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">threading.Thread</code> and manual queue/lock management.</li>
  <li><code class="language-plaintext highlighter-rouge">concurrent.futures.ThreadPoolExecutor</code> â€” simpler, higher-level.</li>
</ul>

<p>Constraints &amp; safety:</p>
<ul>
  <li>The shared <code class="language-plaintext highlighter-rouge">branches</code> list must be protected by a <code class="language-plaintext highlighter-rouge">threading.Lock</code> during append operations.</li>
  <li>Avoid creating thousands of concurrent threads. Use a bounded pool (<code class="language-plaintext highlighter-rouge">max_workers = min(32, os.cpu_count() or 4)</code>) to limit resource usage.</li>
  <li>Keep recursion depth per thread modest; better approach: have each submitted task compute an entire subtree (e.g., <code class="language-plaintext highlighter-rouge">grow()</code> from a given node down to a shallow depth) and append the resulting local list to the global list under a lock.</li>
</ul>

<p>Strategy implemented below:</p>
<ul>
  <li>The main <code class="language-plaintext highlighter-rouge">grow_parallel()</code> will push top-level child <code class="language-plaintext highlighter-rouge">grow</code> tasks into an executor.</li>
  <li>Each worker runs a variant <code class="language-plaintext highlighter-rouge">grow_worker()</code> that returns a local list of branches for that subtree.</li>
  <li>The main thread collects futures and merges results into the global <code class="language-plaintext highlighter-rouge">branches</code> once each future completes (safe merging under lock).</li>
</ul>

<p>This design reduces lock contention (threads only lock briefly to append a chunk) and keeps Pygame drawing safe.</p>

<h2 id="8-multithreaded-implementation--full-code">8. Multithreaded implementation â€” full code</h2>

<p>Copy this file as <code class="language-plaintext highlighter-rouge">fibonacci_tree_parallel.py</code> and run it. This includes the parallel <code class="language-plaintext highlighter-rouge">generate_tree()</code> which uses <code class="language-plaintext highlighter-rouge">ThreadPoolExecutor</code> and a safe <code class="language-plaintext highlighter-rouge">branches</code> merge.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># INITIAL SETUP
</span><span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">WIN_WIDTH</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">600</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIN_WIDTH</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Fibonacci Tree Growth (Multithreaded)"</span><span class="p">)</span>

<span class="c1"># COLORS
</span><span class="n">SKY_COLOR</span>   <span class="o">=</span> <span class="p">(</span><span class="mi">135</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">235</span><span class="p">)</span>
<span class="n">BROWN_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">139</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
<span class="n">GREEN_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">34</span><span class="p">)</span>

<span class="c1"># TREE PARAMETERS
</span><span class="n">GROUND_HEIGHT</span>   <span class="o">=</span> <span class="mi">50</span>
<span class="n">TREE_DEPTH</span>      <span class="o">=</span> <span class="mi">10</span>
<span class="n">BRANCH_WIDTH</span>    <span class="o">=</span> <span class="mi">20</span>
<span class="n">SPREAD_BASE</span>     <span class="o">=</span> <span class="mi">25</span>
<span class="n">SPREAD_FACTOR</span>   <span class="o">=</span> <span class="mi">70</span>
<span class="n">LENGTH_DECAY</span>    <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">LENGTH_VARIANCE</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">BRANCH_STEP</span>     <span class="o">=</span> <span class="mi">3</span>
<span class="n">FPS</span>             <span class="o">=</span> <span class="mi">60</span>

<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># GLOBALS
</span><span class="n">branches</span> <span class="o">=</span> <span class="p">[]</span>             <span class="c1"># global branch list used by the renderer
</span><span class="n">branches_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Lock</span><span class="p">()</span>  <span class="c1"># protect writes to `branches`
</span><span class="n">started</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># FIB
</span><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="c1"># Worker-grow produces a local list and returns it (no shared writes).
</span><span class="k">def</span> <span class="nf">grow_worker</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">tree_depth</span><span class="p">):</span>
    <span class="n">local</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">_g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">rad</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">end_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">length</span>
        <span class="n">end_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">length</span>
        <span class="k">if</span> <span class="n">end_y</span> <span class="o">&gt;</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span><span class="p">:</span>
            <span class="n">end_y</span> <span class="o">=</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span>
        <span class="n">local</span><span class="p">.</span><span class="n">append</span><span class="p">(((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">end_x</span><span class="p">,</span> <span class="n">end_y</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">))</span>

        <span class="n">f_ratio</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fib</span><span class="p">(</span><span class="n">tree_depth</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">spread</span> <span class="o">=</span> <span class="n">SPREAD_BASE</span> <span class="o">+</span> <span class="n">SPREAD_FACTOR</span> <span class="o">*</span> <span class="n">f_ratio</span>
        <span class="n">sub_branches</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sub_branches</span><span class="p">):</span>
            <span class="n">new_length</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="p">(</span><span class="n">LENGTH_DECAY</span> <span class="o">+</span> <span class="n">LENGTH_VARIANCE</span> <span class="o">*</span> <span class="n">f_ratio</span><span class="p">)</span>
            <span class="n">bias</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">spread</span><span class="p">,</span> <span class="n">spread</span><span class="p">)</span>
            <span class="n">new_angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">bias</span>
            <span class="n">new_angle</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="n">new_angle</span><span class="p">))</span>
            <span class="n">new_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
            <span class="n">_g</span><span class="p">(</span><span class="n">end_x</span><span class="p">,</span> <span class="n">end_y</span><span class="p">,</span> <span class="n">new_length</span><span class="p">,</span> <span class="n">new_angle</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_width</span><span class="p">)</span>

    <span class="n">_g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">local</span>

<span class="c1"># Multithreaded generation that submits the trunk's immediate children as tasks.
</span><span class="k">def</span> <span class="nf">generate_tree_parallel</span><span class="p">(</span><span class="n">root_x</span><span class="p">,</span> <span class="n">root_y</span><span class="p">,</span> <span class="n">initial_length</span><span class="p">,</span> <span class="n">root_depth</span><span class="p">,</span> <span class="n">root_width</span><span class="p">):</span>
    <span class="c1"># We'll compute the trunk synchronously, then spawn worker tasks for each top-level child subtree.
</span>    <span class="k">global</span> <span class="n">branches</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Add trunk (depth=root_depth)
</span>    <span class="n">rad</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">trunk_end_x</span> <span class="o">=</span> <span class="n">root_x</span> <span class="o">+</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">initial_length</span>
    <span class="n">trunk_end_y</span> <span class="o">=</span> <span class="n">root_y</span> <span class="o">-</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span> <span class="o">*</span> <span class="n">initial_length</span>
    <span class="k">if</span> <span class="n">trunk_end_y</span> <span class="o">&gt;</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span><span class="p">:</span>
        <span class="n">trunk_end_y</span> <span class="o">=</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span>
    <span class="n">branches</span><span class="p">.</span><span class="n">append</span><span class="p">(((</span><span class="n">root_x</span><span class="p">,</span> <span class="n">root_y</span><span class="p">),</span> <span class="p">(</span><span class="n">trunk_end_x</span><span class="p">,</span> <span class="n">trunk_end_y</span><span class="p">),</span> <span class="n">root_width</span><span class="p">,</span> <span class="n">root_depth</span><span class="p">))</span>

    <span class="c1"># Prepare tasks for child subtrees emerging from trunk_end
</span>    <span class="n">f_ratio</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span><span class="n">root_depth</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fib</span><span class="p">(</span><span class="n">TREE_DEPTH</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">spread</span> <span class="o">=</span> <span class="n">SPREAD_BASE</span> <span class="o">+</span> <span class="n">SPREAD_FACTOR</span> <span class="o">*</span> <span class="n">f_ratio</span>
    <span class="n">sub_branches</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">root_depth</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>

    <span class="c1"># Decide worker pool size
</span>    <span class="n">max_workers</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="ow">or</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sub_branches</span><span class="p">):</span>
            <span class="n">new_length</span> <span class="o">=</span> <span class="n">initial_length</span> <span class="o">*</span> <span class="p">(</span><span class="n">LENGTH_DECAY</span> <span class="o">+</span> <span class="n">LENGTH_VARIANCE</span> <span class="o">*</span> <span class="n">f_ratio</span><span class="p">)</span>
            <span class="n">bias</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">spread</span><span class="p">,</span> <span class="n">spread</span><span class="p">)</span>
            <span class="n">new_angle</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="n">bias</span><span class="p">))</span>
            <span class="n">new_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">root_width</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">))</span>
            <span class="c1"># Submit each subtree
</span>            <span class="n">futures</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">executor</span><span class="p">.</span><span class="n">submit</span><span class="p">(</span><span class="n">grow_worker</span><span class="p">,</span> <span class="n">trunk_end_x</span><span class="p">,</span> <span class="n">trunk_end_y</span><span class="p">,</span> <span class="n">new_length</span><span class="p">,</span> <span class="n">new_angle</span><span class="p">,</span> <span class="n">root_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_width</span><span class="p">,</span> <span class="n">TREE_DEPTH</span><span class="p">))</span>

        <span class="c1"># As futures complete, merge their local lists into the global branches list with minimal locking.
</span>        <span class="k">for</span> <span class="n">fut</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
            <span class="n">local_branches</span> <span class="o">=</span> <span class="n">fut</span><span class="p">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">branches_lock</span><span class="p">:</span>
                <span class="n">branches</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">local_branches</span><span class="p">)</span>

<span class="c1"># INITIAL TREE CREATION (parallel)
</span><span class="n">INITIAL_LENGTH</span> <span class="o">=</span> <span class="p">(</span><span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="mi">120</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">TREE_DEPTH</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="c1"># generate using parallel generator
</span><span class="n">generate_tree_parallel</span><span class="p">(</span><span class="n">WIN_WIDTH</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span><span class="p">,</span> <span class="n">INITIAL_LENGTH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">TREE_DEPTH</span><span class="p">,</span> <span class="n">BRANCH_WIDTH</span><span class="p">)</span>

<span class="c1"># CLOCK
</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>

<span class="c1"># MAIN LOOP
</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span><span class="p">:</span>
            <span class="n">started</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">screen</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">SKY_COLOR</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">GREEN_COLOR</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span> <span class="o">-</span> <span class="n">GROUND_HEIGHT</span><span class="p">,</span> <span class="n">WIN_WIDTH</span><span class="p">,</span> <span class="n">GROUND_HEIGHT</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">started</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="s">"CLICK TO START"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">GREEN_COLOR</span><span class="p">)</span>
        <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="p">(</span><span class="n">WIN_WIDTH</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">msg</span><span class="p">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WIN_HEIGHT</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># animate growth
</span>        <span class="n">draw_step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">),</span> <span class="p">(</span><span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">get_ticks</span><span class="p">()</span> <span class="o">//</span> <span class="mi">10</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">[:</span><span class="n">draw_step</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">BROWN_COLOR</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">BROWN_COLOR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">GREEN_COLOR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="sa">f</span><span class="s">"BRANCH COUNT: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">draw_step</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">branches</span><span class="p">))</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">GREEN_COLOR</span><span class="p">)</span>
        <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">(</span><span class="n">WIN_WIDTH</span> <span class="o">-</span> <span class="n">text</span><span class="p">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
    <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="n">FPS</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Notes about the code above</strong>:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">grow_worker()</code> performs the recursion only <em>locally</em> and returns a <code class="language-plaintext highlighter-rouge">local</code> list of branches rather than appending to a global list while computing. This avoids heavy lock contention.</li>
  <li><code class="language-plaintext highlighter-rouge">generate_tree_parallel()</code> handles trunk creation synchronously, then schedules multiple subtree computations via <code class="language-plaintext highlighter-rouge">ThreadPoolExecutor</code>. When a future completes, its result is merged into <code class="language-plaintext highlighter-rouge">branches</code> under <code class="language-plaintext highlighter-rouge">branches_lock</code>.</li>
  <li>The renderer still draws from <code class="language-plaintext highlighter-rouge">branches</code> on the main thread.</li>
</ul>

<h2 id="9-how-to-run-and-test">9. How to run and test</h2>

<ol>
  <li>Save the file as <code class="language-plaintext highlighter-rouge">fibonacci_tree_parallel.py</code>.</li>
  <li>Install pygame if necessary: <code class="language-plaintext highlighter-rouge">pip install pygame</code>.</li>
  <li>Run: <code class="language-plaintext highlighter-rouge">python fibonacci_tree_parallel.py</code>.</li>
  <li>Click the window to start the growth animation.</li>
</ol>

<p><strong>Testing tips</strong>:</p>
<ul>
  <li>Try small/large <code class="language-plaintext highlighter-rouge">TREE_DEPTH</code> values to observe performance changes.</li>
  <li>Toggle <code class="language-plaintext highlighter-rouge">max_workers</code> or the strategy to see CPU/time tradeoffs.</li>
</ul>

<h2 id="10-performance-considerations--debugging-tips">10. Performance considerations &amp; debugging tips</h2>

<ul>
  <li>
    <p>Python threads are limited by the Global Interpreter Lock (GIL) for pure-Python CPU-bound tasks. However, splitting heavy recursion into multiple threads often helps if some operations release the GIL (not the case here) OR if overhead (waiting for random numbers, I/O) exists. Still, for pure CPU-bound tasks, <code class="language-plaintext highlighter-rouge">multiprocessing</code> may give better scaling. The thread approach helps eliminate GUI freeze because branch generation tasks are off the main thread.</p>
  </li>
  <li>
    <p>If you want true parallel CPU utilization for heavy depth, consider <code class="language-plaintext highlighter-rouge">multiprocessing</code> instead. It requires serializing results between processes (e.g., <code class="language-plaintext highlighter-rouge">multiprocessing.Pool</code>), but it avoids the GIL.</p>
  </li>
  <li>
    <p>Keep <code class="language-plaintext highlighter-rouge">branches</code> merging minimal and batched. Appending many single branches under a lock causes contention. Returning a local list and merging it once avoids this.</p>
  </li>
  <li>
    <p>On Windows, <code class="language-plaintext highlighter-rouge">pygame</code> must run in the main thread. Donâ€™t attempt to call Pygame display or drawing from worker threads.</p>
  </li>
</ul>

<h2 id="11-faq-and-closing-notes">11. FAQ and closing notes</h2>

<p><strong>Q: Why not call <code class="language-plaintext highlighter-rouge">grow()</code> directly in multiple threads (no <code class="language-plaintext highlighter-rouge">local</code> lists)?</strong>
A: That creates lock contention (every branch append needs a lock) and increases the chance of subtle bugs. Using local results and merging is safer and faster.</p>

<p><strong>Q: Can I parallelize drawing?</strong>
A: No â€” drawing must stay in the main thread for portability and correctness.</p>

<p><strong>Q: When should I use <code class="language-plaintext highlighter-rouge">multiprocessing</code> instead?</strong>
A: Use it when <code class="language-plaintext highlighter-rouge">TREE_DEPTH</code> is large (e.g., 12+) and CPU usage is the bottleneck. It has higher overhead but avoids the GIL.</p>

<h3 id="final-thoughts">Final thoughts</h3>

<p>This tutorial shows how to understand the original recursive fractal generator and how to safely run expensive geometry generation in parallel without touching the GUI thread. Use the provided code as a starting point â€” tweak parameters, depths, and the pool strategy to match your CPU and artistic goal.</p>

<p>Happy coding and happy tree-growing!</p>]]></content><author><name>PyShine Team</name></author><category term="fibonacci" /><category term="draw tree" /><category term="random tree" /><summary type="html"><![CDATA[Fibonacci Tree in python]]></summary></entry></feed>