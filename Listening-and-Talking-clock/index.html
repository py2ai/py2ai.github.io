

  <!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/Article">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Pinterest & Google verification -->
  <meta name="p:domain_verify" content="fb68a8459fe32b8b072bcd5cc620d125"/>
  <meta name="google-site-verification" content="WAkFPi5cvufClnQetgIl0STmvvwHhVf8jfyENFWhsxU" />
  <meta name="google-site-verification" content="g2pFZlv-92XQD67BPgiVHsvZ4TZH13Ucvmmvvv36kU4" />

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Voice-Enabled Wall Clock with Greetings | PyShine</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Voice-Enabled Wall Clock with Greetings" />
<meta name="author" content="PyShine Team" />
<meta property="og:locale" content="en" />
<meta name="description" content="Step-by-step beginner-friendly guide to create a voice-enabled PyGame wall clock with tick sound, date display, TTS time announcement, and STT voice recognition using Vosk." />
<meta property="og:description" content="Step-by-step beginner-friendly guide to create a voice-enabled PyGame wall clock with tick sound, date display, TTS time announcement, and STT voice recognition using Vosk." />
<link rel="canonical" href="https://www.pyshine.com/Listening-and-Talking-clock/" />
<meta property="og:url" content="https://www.pyshine.com/Listening-and-Talking-clock/" />
<meta property="og:site_name" content="PyShine" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-11-14T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Voice-Enabled Wall Clock with Greetings" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"PyShine Team"},"dateModified":"2025-11-14T00:00:00+00:00","datePublished":"2025-11-14T00:00:00+00:00","description":"Step-by-step beginner-friendly guide to create a voice-enabled PyGame wall clock with tick sound, date display, TTS time announcement, and STT voice recognition using Vosk.","headline":"Voice-Enabled Wall Clock with Greetings","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.pyshine.com/Listening-and-Talking-clock/"},"name":"{{ page.title escape }}","url":"https://www.pyshine.com/Listening-and-Talking-clock/"}</script>
<!-- End Jekyll SEO tag -->
  <!-- This will generate the canonical link automatically -->

  <script src="https://analytics.ahrefs.com/analytics.js" data-key="Im0K82YsmEDy08+6wyUIZA" async></script>

  <!-- Favicon & App Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png?v=qA3OXqyw77">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png?v=qA3OXqyw77">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png?v=qA3OXqyw77">
  <link rel="manifest" href="/assets/img/icons/manifest.json?v=qA3OXqyw77">
  <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg?v=qA3OXqyw77" color="#5bbad5">
  <link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77">
  <!--[if IE]><link rel="shortcut icon" href="/assets/img/icons/favicon.ico?v=qA3OXqyw77"><![endif]-->

  <!-- App & Theme Info -->
  <meta name="apple-mobile-web-app-title" content="Sleek">
  <meta name="application-name" content="Sleek">
  <meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml?v=qA3OXqyw77">
  <meta name="theme-color" content="#ffffff">

  
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-TCVFBKF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GTM-TCVFBKF');
</script>

  

  <!-- Critical CSS Inline -->
  <style class="inlineCSS">
    h1{color:#313237;margin-top:0;margin-bottom:.5rem}.dark-bg{background-color:#19d319}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:last-of-type,.post-card:nth-child(2n+2){margin-right:0}}html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figure,main{display:block}figure{margin:1em 40px}a{background-color:transparent;-webkit-text-decoration-skip:objects}img{border-style:none}svg:not(:root){overflow:hidden}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{-webkit-box-sizing:border-box;box-sizing:border-box}body{-webkit-overflow-scrolling:touch}*,::after,::before{-webkit-box-sizing:inherit;box-sizing:inherit}.site{display:-webkit-box;display:-ms-flexbox;display:flex;min-height:100vh;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.site__content{-webkit-box-flex:1;-ms-flex:1;flex:1}img{max-width:100%;height:auto;width:auto;vertical-align:middle}figure{margin:0}body{background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;font-size:1rem;line-height:1.5;color:#343851;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%}p{margin-top:0;margin-bottom:1.25rem}h1,h2{color:#313237;margin-top:0;margin-bottom:.5rem}a{color:#277cea;text-decoration:none;border-bottom:1px dashed #277cea}.blur{background:#fff;filter:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><filter id="filter"><feGaussianBlur stdDeviation="16" /></filter></svg>#filter');-webkit-filter:blur(1rem);filter:blur(1rem)}.container{padding:0 20px}@media (min-width:0){.container{max-width:auto;margin:0 auto}}@media (min-width:36em){.container{max-width:540px;margin:0 auto}}@media (min-width:48em){.container{max-width:720px;margin:0 auto}}@media (min-width:62em){.container{max-width:960px;margin:0 auto}}@media (min-width:75em){.container{max-width:1170px;margin:0 auto}}.header{background-color:#fff;color:#343851;position:absolute;z-index:4;width:100%;top:0;left:0;will-change:transform;-webkit-transform:translateY(0);transform:translateY(0)}.header a{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:0}.header__logo{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;overflow:hidden;padding:19px 0;margin-right:1.25rem;outline:0;border-bottom:0;color:#313237}.header__logo .header__logo--container{width:58px}.header__logo .header__logo--container .logo{fill:currentColor}.header__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:3.75em;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__links{padding-bottom:.5rem;display:none;position:absolute;top:3.75em;left:0;width:100%;height:auto;background:#fff}.header__link{color:#343851;padding:.938rem 0;border-top:1px solid #ededed}.header__toggle{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:44px;height:100%;background-color:transparent;padding-left:1.25rem}.header__toggle span{display:block;position:relative;margin-top:4px;background-color:#343851;width:100%;height:2px;border-radius:1px}.header__toggle span:first-child{margin-top:0}@media (min-width:62em){.header__toggle{display:none;visibility:hidden}.header__links{position:static;padding:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;visibility:visible;width:auto;height:100%}.header__links-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;padding:0}.header__link{position:relative;padding:.938rem 1rem;border:0;height:100%}.header__link::after{content:"";display:block;position:absolute;left:0;bottom:0;height:3px;width:100%;-webkit-transform:scaleX(0);transform:scaleX(0);background:#277cea}}.post-card{display:block;position:relative;width:100%;min-height:250px;border-radius:4px;overflow:hidden;background-color:#fff;-webkit-box-shadow:0 1px 3px rgba(0,0,0,.08);box-shadow:0 1px 3px rgba(0,0,0,.08);margin-bottom:2.25rem;border-bottom:0}@media (min-width:48em){.post-card{width:48.4375%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:0}}@media (min-width:75em){.post-card{width:31.25%;margin-right:3.125%}.post-card:nth-child(2n+2){margin-right:3.125%}}.post-card__label{position:absolute;top:1.5rem;left:1.5rem;z-index:2}.post-card__thumb{margin:0;background:#fff;position:relative;overflow:hidden}.post-card__thumb::after{content:"";display:block;height:0;width:100%;padding-bottom:56.25%}.post-card__thumb>*{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.post-card__inner{padding:1.875rem 1.25rem .625rem;color:#838c8d}.post-card__header{margin-bottom:.75rem}.post-card__header .post-card__meta{font-size:.875rem}.label{padding:0 10px;margin-bottom:1rem;display:inline-block;line-height:20px;font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.8);border:2px solid rgba(255,255,255,.5);border-radius:100px}.hero{margin:3.75rem auto 0;min-height:16.25rem;width:100%;position:relative;background-color:#dde5ea;background-repeat:no-repeat;background-position:50%;background-size:cover}@media (min-width:62em){.hero{margin:0 auto;height:36em}}.hero::before{position:absolute;display:block;content:"";top:0;left:0;width:100%;height:100%;background:rgba(52,56,81,.8)}.hero__wrap{position:absolute;margin:auto;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:rgba(255,255,255,.8);width:100%;max-width:90%;z-index:1}.hero__wrap .hero__title{font-size:1.8em;color:#fff}.blog{background-color:#f9f9f9}.post-list{padding-top:2.5em;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}@media (min-width:48em){.hero__wrap{max-width:40em}.hero__wrap .hero__title{padding:1rem 0;font-size:2.625em;line-height:3.125rem}.post-list{padding-top:5em}}
  </style>

  <!-- Main CSS -->
  <link rel="preload" href="/assets/css/main.css" as="style" onload="this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/assets/css/main.css"></noscript>

  <script type="text/javascript">
    /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
(function(w){"use strict";if(!w.loadCSS){w.loadCSS=function(){}}
var rp=loadCSS.relpreload={};rp.support=(function(){var ret;try{ret=w.document.createElement("link").relList.supports("preload")}catch(e){ret=!1}
return function(){return ret}})();rp.bindMediaToggle=function(link){var finalMedia=link.media||"all";function enableStylesheet(){link.media=finalMedia}
if(link.addEventListener){link.addEventListener("load",enableStylesheet)}else if(link.attachEvent){link.attachEvent("onload",enableStylesheet)}
setTimeout(function(){link.rel="stylesheet";link.media="only x"});setTimeout(enableStylesheet,3000)};rp.poly=function(){if(rp.support()){return}
var links=w.document.getElementsByTagName("link");for(var i=0;i<links.length;i++){var link=links[i];if(link.rel==="preload"&&link.getAttribute("as")==="style"&&!link.getAttribute("data-loadcss")){link.setAttribute("data-loadcss",!0);rp.bindMediaToggle(link)}}};if(!rp.support()){rp.poly();var run=w.setInterval(rp.poly,500);if(w.addEventListener){w.addEventListener("load",function(){rp.poly();w.clearInterval(run)})}else if(w.attachEvent){w.attachEvent("onload",function(){rp.poly();w.clearInterval(run)})}}
if(typeof exports!=="undefined"){exports.loadCSS=loadCSS}
else{w.loadCSS=loadCSS}}(typeof global!=="undefined"?global:this))

  </script>

  <!-- MathJax -->
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>


  <body class="site" itemscope itemtype="https://schema.org/WebPage">

    
      <!-- Google Tag Manager (noscript) -->
      <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TCVFBKF"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
      </noscript>
      <!-- End Google Tag Manager -->
    

    <header class="header" itemscope itemtype="http://schema.org/SiteNavigationElement" aria-label="Main navigation">
  <div class="container">
    <div class="header__inner">
      <!-- Logo -->
      <a class="header__logo" href="/">
        <div class="header__logo--container">
          <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<g>
	<path d="M18.121,9.88l-7.832-7.836c-0.155-0.158-0.428-0.155-0.584,0L1.842,9.913c-0.262,0.263-0.073,0.705,0.292,0.705h2.069v7.042c0,0.227,0.187,0.414,0.414,0.414h3.725c0.228,0,0.414-0.188,0.414-0.414v-3.313h2.483v3.313c0,0.227,0.187,0.414,0.413,0.414h3.726c0.229,0,0.414-0.188,0.414-0.414v-7.042h2.068h0.004C18.331,10.617,18.389,10.146,18.121,9.88 M14.963,17.245h-2.896v-3.313c0-0.229-0.186-0.415-0.414-0.415H8.342c-0.228,0-0.414,0.187-0.414,0.415v3.313H5.032v-6.628h9.931V17.245z M3.133,9.79l6.864-6.868l6.867,6.868H3.133z"></path>

	
	
</g>
</svg>

        </div>
      </a>

      <!-- Navigation Links -->
      <nav class="header__links">
        <div class="container header__links-wrapper">
          
            <a class="header__link" href="/" itemprop="url">
              <span itemprop="name">Home</span>
            </a>
          
            <a class="header__link" href="/categories" itemprop="url">
              <span itemprop="name">Categories</span>
            </a>
          
            <a class="header__link" href="/converter.html" itemprop="url">
              <span itemprop="name">Free PNG Converter</span>
            </a>
          
            <a class="header__link" href="/about" itemprop="url">
              <span itemprop="name">About</span>
            </a>
          
            <a class="header__link" href="/contact" itemprop="url">
              <span itemprop="name">Contact</span>
            </a>
          
            <a class="header__link" href="/privacy" itemprop="url">
              <span itemprop="name">Privacy Policy</span>
            </a>
          
            <a class="header__link" href="/disclaimer" itemprop="url">
              <span itemprop="name">Disclaimer</span>
            </a>
          
        </div>
      </nav>

      <!-- Mobile Menu Toggle -->
      <div class="header__toggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
</header>


    
      <div class="hero lazyload"
           data-bg="https://www.pyshine.com/assets/img/posts/20251114-wallclock-greeting.jpg"
           role="img"
           aria-label="Voice-Enabled Wall Clock with Greetings">
    
        <div class="hero__wrap">
          
            <div class="hero__categories">
              
            </div>
          

          <h1 class="hero__title" itemprop="headline">Voice-Enabled Wall Clock with Greetings</h1>

          <p class="hero__meta">
            <time datetime="2025-11-14T00:00:00+00:00" itemprop="datePublished">
              14 Nov 2025
            </time>
            &nbsp;·&nbsp;
            
            <span itemprop="timeRequired">
              
                32 mins read
              
            </span>
          </p>
        </div>
      </div>

    <main class="site__content" role="main">
      <div class="container post-layout">

        <!-- Table of Contents Sidebar -->
        <aside class="post-toc" id="post-toc">
          <h3>Contents</h3>
          <nav id="toc-list"></nav>
        </aside>

        <!-- Main Post Content -->
        <article class="post-content"
                 itemprop="articleBody"
                 itemscope itemtype="https://schema.org/Article">
          
          <h1 id="wall-clock-with-voice-time-and-greeting">Wall Clock with Voice Time and Greeting</h1>

<p>This tutorial shows how to create a <strong>Python-based wall clock</strong> using <code class="language-plaintext highlighter-rouge">pygame</code>, with <strong>text-to-speech</strong> and <strong>speech-to-text</strong> using <strong>pyttsx3</strong> and <strong>Vosk</strong>. The app listens for the word “time” and responds with the current time and a greeting based on the current hour.</p>

<hr />

<h1 id="table-of-contents">Table of Contents</h1>

<ol>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#features-overview">Features Overview</a></li>
  <li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#installing-dependencies">Installing Dependencies</a>
    <ul>
      <li><a href="#windows">Windows</a></li>
      <li><a href="#macos">macOS</a></li>
      <li><a href="#linux">Linux</a></li>
    </ul>
  </li>
  <li><a href="#understanding-speech-to-text-vosk">Understanding Speech-to-Text (Vosk)</a>
    <ul>
      <li><a href="#why-speech-to-text-is-important">Why Speech-to-Text Is Important</a></li>
      <li><a href="#how-vosk-works--the-theory-simplified">How Vosk Works — The Theory (Simplified)</a></li>
      <li><a href="#vosk-model-types">Vosk Model Types</a></li>
      <li><a href="#where-to-get-language-models">Where to get language models</a></li>
      <li><a href="#supported-languages">Supported languages</a></li>
      <li><a href="#which-model-should-beginners-use">Which model should beginners use?</a></li>
    </ul>
  </li>
  <li><a href="#understanding-text-to-speech-pyttsx3">Understanding Text-to-Speech (pyttsx3)</a>
    <ul>
      <li><a href="#changing-voice">Changing voice</a></li>
      <li><a href="#changing-speaking-speed">Changing speaking speed</a></li>
    </ul>
  </li>
  <li><a href="#code-breakdown">Code Breakdown</a>
    <ul>
      <li><a href="#clock-rendering">Clock rendering</a></li>
      <li><a href="#tick-sound-generation">Tick sound generation</a></li>
      <li><a href="#typing-animation">Typing animation</a></li>
      <li><a href="#listen-button-behavior">Listen button behavior</a></li>
      <li><a href="#stt-callback-logic">STT callback logic</a></li>
    </ul>
  </li>
  <li><a href="#running-the-app">Running the App</a></li>
  <li><a href="#troubleshooting">Troubleshooting</a></li>
  <li><a href="#full-source-code">Full Source Code</a></li>
</ol>

<hr />

<h2 id="introduction">Introduction</h2>

<p>This project builds a <strong>beautiful wall clock GUI</strong> using <code class="language-plaintext highlighter-rouge">pygame</code> — but with a twist:</p>

<p>It can <strong>speak the time aloud</strong>
…and it can <strong>hear you ask for the time</strong> using speech recognition.</p>

<p>When you say <strong>“time”</strong>, the app will detect your speech using <strong>Vosk</strong>, speak the current time using <strong>pyttsx3</strong>, and display a smooth <strong>typing animation</strong> at the bottom of the screen.</p>

<hr />

<h2 id="features-overview">Features Overview</h2>

<h3 id="analog-wall-clock">Analog Wall Clock</h3>

<ul>
  <li>Smooth second, minute, and hour hands</li>
  <li>Date and weekday display</li>
  <li>Optional dark theme compatible</li>
</ul>

<h3 id="builtin-tick-sound">Built‑in Tick Sound</h3>

<ul>
  <li>Generated artificially using NumPy</li>
  <li>No external audio files required</li>
</ul>

<h3 id="voice-detection-stt">Voice Detection (STT)</h3>

<ul>
  <li>Uses Vosk offline speech recognition</li>
  <li>Works without internet</li>
  <li>Detects simple keywords (“time”)</li>
</ul>

<h3 id="texttospeech-tts">Text‑to‑Speech (TTS)</h3>

<ul>
  <li>Uses pyttsx3 (offline)</li>
  <li>Automatically speaks:
<em>“Good afternoon. It’s 03:25 PM now!”</em></li>
</ul>

<h3 id="typing-animation">Typing Animation</h3>

<ul>
  <li>Displays greeting and time</li>
  <li>Smooth blinking cursor</li>
  <li>Auto-clears after a few seconds</li>
</ul>

<h3 id="listen-button">Listen Button</h3>

<ul>
  <li>Toggles continuous microphone listening</li>
  <li>Runs recognition in background thread</li>
</ul>

<hr />

<h2 id="prerequisites">Prerequisites</h2>

<p>You only need:</p>

<ul>
  <li>Python 3.8+ (Better use Python 3.12)</li>
  <li>A microphone</li>
  <li>Basic terminal usage</li>
  <li>Ability to install packages</li>
</ul>

<hr />

<h2 id="installing-dependencies">Installing Dependencies</h2>

<h3 id="windows">Windows</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> venv py312
py312<span class="se">\S</span>cripts<span class="se">\a</span>ctivate

pip <span class="nb">install </span>pygame pyttsx3 sounddevice vosk numpy
</code></pre></div></div>

<p>Download a Vosk model:
https://alphacephei.com/vosk/models</p>

<p>Get the model for example <a href="https://alphacephei.com/vosk/models/vosk-model-small-en-us-0.15.zip" title="https://alphacephei.com/vosk/models/vosk-model-small-en-us-0.15.zip">this </a></p>

<p>Extract and rename:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vosk-model-small-en-us-0.15
</code></pre></div></div>

<hr />

<h3 id="macos">macOS</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> venv py312
<span class="nb">source </span>py312/bin/activate
brew <span class="nb">install </span>portaudio
pip <span class="nb">install </span>pygame pyttsx3 sounddevice vosk numpy
</code></pre></div></div>

<p>Download the same English model as above.</p>

<hr />

<h3 id="linux">Linux</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> venv py312
<span class="nb">source </span>py312/bin/activate

pip <span class="nb">install </span>pygame pyttsx3 sounddevice vosk numpy
<span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> libportaudio2 libportaudiocpp0 portaudio19-dev
</code></pre></div></div>

<hr />

<h2 id="understanding-speechtotext-vosk">Understanding Speech‑to‑Text (Vosk)</h2>

<p>Speech-to-Text (STT) is the process of converting spoken language into written text. Vosk is one of the most popular offline STT engines, known for being lightweight, accurate, and easy to use in Python projects.</p>

<p>Below is a detailed explanation suitable for tutorials, documentation, or learning purposes.</p>

<h3 id="why-speech-to-text-is-important">Why Speech-to-Text Is Important</h3>

<p>Speech-to-Text technology has become essential in modern software because:</p>

<h4 id="hands-free-interaction">Hands-Free Interaction</h4>

<p>Users can control apps using voice, useful for clocks, assistants, and any hands-busy scenario (cooking, driving, etc.).</p>

<h4 id="accessibility">Accessibility</h4>

<p>STT helps users with motor disabilities or those who cannot type easily.</p>

<h4 id="real-time-automation">Real-Time Automation</h4>

<p>Voice commands can trigger events instantly — e.g.,
“start timer”, “stop music”, “what’s the time”.</p>

<h4 id="works-without-a-screen">Works Without a Screen</h4>

<p>Useful for IoT devices, Raspberry Pi systems, or embedded gadgets.</p>

<h4 id="offline-security">Offline Security</h4>

<p>Vosk works completely offline, so no voice data is sent to the cloud, enhancing privacy.</p>

<h3 id="how-vosk-works--the-theory-simplified">How Vosk Works — The Theory (Simplified)</h3>

<p>Although Vosk feels simple to use, under the hood it uses serious speech-processing theory. Here’s a digestible, beginner-friendly explanation:</p>

<ol>
  <li>
    <p>Audio Capture</p>

    <ul>
      <li>Your microphone records raw audio waves.</li>
      <li>These waves are just numbers representing air pressure changes over time.</li>
    </ul>
  </li>
  <li>
    <p>Feature Extraction (MFCC)</p>

    <ul>
      <li>Raw audio is too detailed and noisy for machine learning models.</li>
      <li>Vosk converts the raw audio into MFCC features (Mel-Frequency Cepstral Coefficients).</li>
    </ul>
  </li>
</ol>

<h4 id="mfccs-represent">MFCCs represent:</h4>

<ul>
  <li>frequency distribution</li>
  <li>loudness</li>
  <li>tone</li>
  <li>patterns that humans perceive as speech</li>
</ul>

<p><em>Think of MFCCs as a fingerprint of sound that neural networks can understand.</em></p>

<ol>
  <li>
    <p>Acoustic Model (Neural Network)</p>

    <p>This model takes the MFCC features and predicts phonemes —
the smallest units of sound like:</p>

    <p><code class="language-plaintext highlighter-rouge">k    a    t    ( = "cat" )</code></p>

    <p>The acoustic model is trained on thousands of hours of speech recordings.</p>
  </li>
  <li>
    <p>Language Model</p>

    <p>Humans don’t speak in random phoneme sequences.
So the language model helps predict what words make sense.</p>

    <p>For example:
If the acoustic model detects something like:</p>

    <p><code class="language-plaintext highlighter-rouge">d   t   a   m   p</code></p>

    <p>The language model guides it to:</p>

    <p><code class="language-plaintext highlighter-rouge">→ "time"</code></p>

    <p>instead of gibberish.</p>
  </li>
  <li>
    <p>Decoder</p>

    <p>The decoder combines:</p>

    <ul>
      <li>predictions from the acoustic model</li>
      <li>probabilities from the language model</li>
    </ul>

    <p>and chooses the most likely final text output.</p>

    <p>Result: clear, readable text.</p>
  </li>
</ol>

<h3 id="why-developers-love-vosk">Why Developers Love Vosk</h3>

<ul>
  <li>100% Offline</li>
  <li>No internet means:</li>
</ul>

<p>✔ privacy
✔ reliability
✔ great for IoT or field environments</p>

<ul>
  <li>Low CPU Usage</li>
</ul>

<p>Runs on:</p>

<ul>
  <li>Raspberry Pi</li>
  <li>Old laptops</li>
  <li>Mid-range PCs</li>
  <li>Small Models Available</li>
  <li>Some models are &lt;50MB.</li>
  <li>Fast &amp; Real-Time</li>
  <li>Even on modest hardware, it transcribes instantly.</li>
  <li>Multi-language Support</li>
</ul>

<h3 id="vosk-model-types">Vosk Model Types</h3>

<p>You can choose based on your device:</p>

<h4 id="small-models">Small models</h4>

<ul>
  <li>&lt;40MB</li>
  <li>Fastest</li>
  <li>Lower accuracy</li>
  <li>Ideal for Raspberry Pi or simple commands</li>
  <li>Perfect for this “voice clock project”</li>
</ul>

<h4 id="medium-models">Medium models</h4>

<ul>
  <li>Balanced accuracy + speed</li>
  <li>Good for desktops or laptops</li>
</ul>

<h4 id="large-models">Large models</h4>

<ul>
  <li>Best accuracy</li>
  <li>Heavier CPU load</li>
  <li>Overkill for simple voice commands</li>
</ul>

<h3 id="where-to-get-language-models">Where to get language models</h3>

<p>All official models here:
https://alphacephei.com/vosk/models</p>

<h3 id="supported-languages">Supported languages</h3>

<p>Vosk supports:</p>

<table>
  <thead>
    <tr>
      <th>Language</th>
      <th>Model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>English</td>
      <td><code class="language-plaintext highlighter-rouge">vosk-model-small-en-us-0.15</code></td>
    </tr>
    <tr>
      <td>Japanese</td>
      <td><code class="language-plaintext highlighter-rouge">vosk-model-small-ja-0.22</code></td>
    </tr>
    <tr>
      <td>Chinese</td>
      <td><code class="language-plaintext highlighter-rouge">vosk-model-small-cn-0.22</code></td>
    </tr>
    <tr>
      <td>Spanish</td>
      <td><code class="language-plaintext highlighter-rouge">vosk-model-small-es-0.42</code></td>
    </tr>
    <tr>
      <td>French</td>
      <td><code class="language-plaintext highlighter-rouge">vosk-model-small-fr-0.22</code></td>
    </tr>
    <tr>
      <td>Hindi</td>
      <td><code class="language-plaintext highlighter-rouge">vosk-model-small-hi-0.22</code></td>
    </tr>
  </tbody>
</table>

<p>…and many more.</p>

<h3 id="which-model-should-beginners-use">Which model should beginners use?</h3>

<p>Use a <strong>small model</strong>:</p>

<ul>
  <li>Fast</li>
  <li>Low CPU usage</li>
  <li>Perfect for Raspberry Pi</li>
  <li>Accurate enough for single-word commands</li>
</ul>

<p>Example small model names:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">vosk-model-small-en-us-0.15</code></li>
  <li><code class="language-plaintext highlighter-rouge">vosk-model-small-es-0.42</code></li>
  <li><code class="language-plaintext highlighter-rouge">vosk-model-small-fr-0.22</code></li>
</ul>

<hr />

<h2 id="understanding-texttospeech-pyttsx3">Understanding Text‑to‑Speech (pyttsx3)</h2>

<h3 id="changing-voice">Changing voice</h3>

<p>In the code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">pyttsx3</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">voices</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">'voices'</span><span class="p">)</span>
<span class="n">engine</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">'voice'</span><span class="p">,</span> <span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nb">id</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="changing-speaking-speed">Changing speaking speed</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">'rate'</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
</code></pre></div></div>

<p>Common values:</p>

<ul>
  <li>120 (slow)</li>
  <li>150 (default)</li>
  <li>180 (fast)</li>
</ul>

<hr />

<h2 id="code-breakdown">Code Breakdown</h2>

<h3 id="clock-rendering">Clock Rendering</h3>

<p>The clock is drawn manually:</p>

<ul>
  <li>Outer circle</li>
  <li>Hour numbers</li>
  <li>Minute ticks</li>
  <li>Rotating hands based on time</li>
</ul>

<h3 id="tick-sound-generation">Tick Sound Generation</h3>

<p>Instead of loading <code class="language-plaintext highlighter-rouge">.wav</code>, we generate audio:</p>

<ul>
  <li>1500 Hz click</li>
  <li>50 ms duration</li>
  <li>Exponential fade</li>
</ul>

<p>Thanks to NumPy, the clock always ticks without importing external files.</p>

<h3 id="typing-animation-1">Typing Animation</h3>

<p>The greeting appears like real typing:</p>

<ul>
  <li>Characters appear gradually</li>
  <li>Cursor blinks</li>
  <li>After 4 seconds, text clears automatically</li>
</ul>

<h3 id="listen-button-behavior">Listen Button Behavior</h3>

<ul>
  <li>Toggle on/off</li>
  <li>Blue → idle</li>
  <li>Green → listening</li>
  <li>Runs Vosk microphone stream in background</li>
</ul>

<h3 id="stt-callback-logic">STT Callback Logic</h3>

<p>When Vosk decodes speech:</p>

<ul>
  <li>Print detected text</li>
  <li>If it contains “time”, call <code class="language-plaintext highlighter-rouge">speak_time()</code></li>
</ul>

<hr />

<h2 id="running-the-app">Running the App</h2>

<p>Once everything is installed:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python main.py
</code></pre></div></div>

<p>Steps:</p>

<ol>
  <li>Clock appears</li>
  <li>Click <strong>LISTEN</strong></li>
  <li>Speak:<strong>“time”</strong></li>
  <li>Clock will speak the current time</li>
  <li>Text animation appears at bottom</li>
</ol>

<hr />

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="-no-microphone-detected">❗ No microphone detected</h3>

<p>Try:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>sounddevice
</code></pre></div></div>

<p>Or select input device:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sd</span><span class="p">.</span><span class="n">default</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="mi">1</span>
</code></pre></div></div>

<hr />

<h3 id="-no-speech-detected">❗ No speech detected</h3>

<p>Use a <strong>small</strong> model; large ones need more CPU.
Speak clearly and wait 1–2 seconds after clicking “LISTEN”.</p>

<hr />

<h3 id="-tts-works-only-once">❗ TTS works only once</h3>

<p>Ensure each TTS call creates a <strong>new engine</strong> (already done in provided code).</p>

<hr />

<h2 id="full-source-code">Full Source Code</h2>

<h3 id="1-windows-dpi-awareness">1. Windows DPI Awareness</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">ctypes</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ctypes</span><span class="p">.</span><span class="n">windll</span><span class="p">.</span><span class="n">user32</span><span class="p">.</span><span class="n">SetProcessDPIAware</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div></div>

<ul>
  <li>Ensures the application displays correctly on <strong>high-DPI screens</strong> in Windows.</li>
  <li>Wrapped in a <code class="language-plaintext highlighter-rouge">try</code> block for compatibility with other OS.</li>
</ul>

<hr />

<h3 id="2-imports">2. Imports</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pygame</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span><span class="p">,</span> <span class="n">pyttsx3</span><span class="p">,</span> <span class="n">threading</span><span class="p">,</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">sounddevice</span> <span class="k">as</span> <span class="n">sd</span>
<span class="kn">from</span> <span class="nn">vosk</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">KaldiRecognizer</span>
<span class="kn">import</span> <span class="nn">json</span><span class="p">,</span> <span class="n">os</span>
</code></pre></div></div>

<ul>
  <li><strong>pygame</strong>: GUI and graphics.</li>
  <li><strong>math</strong>: Trigonometry for clock hands.</li>
  <li><strong>datetime</strong>: Current time for clock and greetings.</li>
  <li><strong>numpy</strong>: Generating artificial tick sounds.</li>
  <li><strong>pyttsx3</strong>: Text-to-speech engine.</li>
  <li><strong>threading</strong>: Run TTS/STT in background.</li>
  <li><strong>sounddevice &amp; vosk</strong>: Speech-to-text recognition.</li>
  <li><strong>json &amp; os</strong>: Parse Vosk output and handle files.</li>
</ul>

<hr />

<h3 id="3-pygame-initialization">3. Pygame Initialization</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">16</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"PyShine Wall Clock"</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Initializes <strong>Pygame</strong> and <strong>audio mixer</strong> for sound playback.</li>
  <li>Sets <strong>screen size</strong> and window <strong>title</strong>.</li>
</ul>

<hr />

<h3 id="4-constants-and-colors">4. Constants and Colors</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BLACK</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">WHITE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">RED</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">GRAY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">DARK_GRAY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">BUTTON_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">BUTTON_HOVER</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">BUTTON_ACTIVE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">LIME</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Defines <strong>colors</strong> used for clock face, hands, button, and text.</li>
</ul>

<hr />

<h3 id="5-clock-parameters--fonts">5. Clock Parameters &amp; Fonts</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">clock_radius</span> <span class="o">=</span> <span class="mi">150</span>

<span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">date_font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">button_font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">time_str_font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">center_x, center_y</code>: Center of clock.</li>
  <li><code class="language-plaintext highlighter-rouge">clock_radius</code>: Size of clock face.</li>
  <li>Fonts for <strong>numbers, date, button text, and TTS text display</strong>.</li>
</ul>

<hr />

<h3 id="6-tick-sound">6. Tick Sound</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_tick_sound</span><span class="p">():</span>
    <span class="p">...</span>
    <span class="n">tick_sound</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">sound_array</span><span class="p">)</span>
    <span class="n">tick_sound</span><span class="p">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tick_sound</span>
</code></pre></div></div>

<ul>
  <li>Generates a <strong>short 1500Hz click</strong> using NumPy.</li>
  <li>No external audio file needed.</li>
  <li>Used to play <strong>tick every second</strong>.</li>
</ul>

<hr />

<h3 id="7-listen-button">7. Listen Button</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">button_rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">WIDTH</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">listening_active</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">def</span> <span class="nf">draw_button</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">):</span>
    <span class="p">...</span>
</code></pre></div></div>

<ul>
  <li>Draws <strong>button on screen</strong>.</li>
  <li>Changes color when <strong>hovered</strong> or <strong>active</strong>.</li>
  <li>Controls <strong>microphone listening state</strong>.</li>
</ul>

<hr />

<h3 id="8-text-typing--tts">8. Text Typing &amp; TTS</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">speak_time</span><span class="p">():</span>
    <span class="p">...</span>
    <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">tts_func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">spoken_time_str</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>Determines <strong>greeting</strong> based on current hour.</li>
  <li>Formats <strong>spoken text</strong>: e.g., <code class="language-plaintext highlighter-rouge">"Good afternoon\nIt's 03:25 PM now!"</code>.</li>
  <li>Starts <strong>text-to-speech in a background thread</strong>.</li>
  <li>Updates <strong>typing animation</strong> variables.</li>
</ul>

<hr />

<h3 id="9-vosk-speech-to-text-setup">9. Vosk Speech-to-Text Setup</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MODEL_PATH</span> <span class="o">=</span> <span class="s">"vosk-model-small-en-us-0.15"</span>
<span class="n">vosk_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">MODEL_PATH</span><span class="p">)</span>
<span class="n">recognizer</span> <span class="o">=</span> <span class="n">KaldiRecognizer</span><span class="p">(</span><span class="n">vosk_model</span><span class="p">,</span> <span class="mi">16000</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Loads <strong>offline Vosk model</strong>.</li>
  <li>Recognizer converts <strong>audio bytes to text</strong>.</li>
  <li>Ensures <strong>offline speech recognition</strong>.</li>
</ul>

<hr />

<h4 id="stt-callbacks">STT Callbacks</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">stt_callback</span><span class="p">(</span><span class="n">indata</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    <span class="p">...</span>
    <span class="k">if</span> <span class="s">"time"</span> <span class="ow">in</span> <span class="n">result_text</span><span class="p">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">speak_time</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>Processes audio from microphone.</li>
  <li>Converts it into text.</li>
  <li>Triggers <code class="language-plaintext highlighter-rouge">speak_time()</code> when <strong>keyword “time”</strong> is detected.</li>
</ul>

<hr />

<h3 id="10-clock-drawing-functions">10. Clock Drawing Functions</h3>

<h4 id="clock-face">Clock Face</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_clock_face</span><span class="p">():</span>
    <span class="p">...</span>
</code></pre></div></div>

<ul>
  <li>Draws <strong>outer circle, hour numbers, minute ticks</strong>.</li>
  <li>Differentiates <strong>hour ticks</strong> (thicker) and <strong>minute ticks</strong> (thin).</li>
</ul>

<h4 id="clock-hands">Clock Hands</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_clock_hands</span><span class="p">():</span>
    <span class="p">...</span>
</code></pre></div></div>

<ul>
  <li>Draws <strong>hour, minute, second hands</strong> based on current time.</li>
  <li>Plays <strong>tick sound every second</strong>.</li>
  <li>Draws <strong>center pivot</strong> circle.</li>
</ul>

<h4 id="date-display">Date Display</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_date_display</span><span class="p">(</span><span class="n">now</span><span class="p">):</span>
    <span class="p">...</span>
</code></pre></div></div>

<ul>
  <li>Displays <strong>current date</strong> and <strong>day of the week</strong>.</li>
</ul>

<h4 id="typing-animation-2">Typing Animation</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">draw_spoken_time</span><span class="p">():</span>
    <span class="p">...</span>
</code></pre></div></div>

<ul>
  <li>Shows <strong>greeting and time gradually</strong> like typing.</li>
  <li>Cursor <strong>blinks</strong>.</li>
  <li>Auto clears after <strong>4 seconds</strong>.</li>
</ul>

<hr />

<h3 id="11-main-loop">11. Main Loop</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="p">...</span>
</code></pre></div></div>

<ul>
  <li>Handles <strong>events</strong>:
    <ul>
      <li>Quit</li>
      <li>ESC key</li>
      <li>Mouse click on <strong>listen button</strong></li>
    </ul>
  </li>
  <li>Updates:
    <ul>
      <li><strong>Clock face</strong></li>
      <li><strong>Hands</strong></li>
      <li><strong>Date</strong></li>
      <li><strong>Typed greeting</strong></li>
      <li><strong>Listen button</strong></li>
    </ul>
  </li>
  <li>Runs at <strong>30 FPS</strong>.</li>
  <li>Ensures <strong>smooth animation and interaction</strong>.</li>
</ul>

<hr />

<h3 id="12-entry-point">12. Entry Point</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>Starts the <strong>main loop</strong> when the script is executed directly.</li>
</ul>

<hr />

<h3 id="mainpy">main.py</h3>

<p>The full working source code here:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Tutorial and Source Code available: www.pyshine.com
</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ctypes</span><span class="p">.</span><span class="n">windll</span><span class="p">.</span><span class="n">user32</span><span class="p">.</span><span class="n">SetProcessDPIAware</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pyttsx3</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1">#  VOSK STT IMPORTS 
</span><span class="kn">import</span> <span class="nn">sounddevice</span> <span class="k">as</span> <span class="n">sd</span>
<span class="kn">from</span> <span class="nn">vosk</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">KaldiRecognizer</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Initialize Pygame
</span><span class="n">pygame</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">mixer</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="mi">44100</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">16</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Screen dimensions
</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">600</span>
<span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_mode</span><span class="p">((</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">))</span>
<span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"PyShine Wall Clock"</span><span class="p">)</span>

<span class="c1"># Colors
</span><span class="n">BLACK</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">WHITE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">RED</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">GRAY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">DARK_GRAY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">BUTTON_COLOR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">BUTTON_HOVER</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">BUTTON_ACTIVE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">LIME</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Clock parameters
</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="n">WIDTH</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">clock_radius</span> <span class="o">=</span> <span class="mi">150</span>

<span class="c1"># Fonts
</span><span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">date_font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">button_font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">time_str_font</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">font</span><span class="p">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">'Arial'</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Tick sound
</span><span class="k">def</span> <span class="nf">create_tick_sound</span><span class="p">():</span>
    <span class="n">sample_rate</span> <span class="o">=</span> <span class="mi">44100</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample_rate</span> <span class="o">*</span> <span class="n">duration</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">envelope</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">waveform</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">envelope</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1500</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span>
    <span class="n">waveform_int16</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">int16</span><span class="p">(</span><span class="n">waveform</span> <span class="o">*</span> <span class="mi">3276</span><span class="p">)</span>
    <span class="n">sound_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">waveform_int16</span><span class="p">,</span> <span class="n">waveform_int16</span><span class="p">])</span>
    <span class="n">tick_sound</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">sndarray</span><span class="p">.</span><span class="n">make_sound</span><span class="p">(</span><span class="n">sound_array</span><span class="p">)</span>
    <span class="n">tick_sound</span><span class="p">.</span><span class="n">set_volume</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tick_sound</span>

<span class="n">tick</span> <span class="o">=</span> <span class="n">create_tick_sound</span><span class="p">()</span>
<span class="n">last_second</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># Button
</span><span class="n">button_rect</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">WIDTH</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">listening_active</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># Button state
</span><span class="n">printed</span><span class="o">=</span><span class="bp">False</span>
<span class="k">def</span> <span class="nf">draw_button</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">printed</span>
    <span class="k">if</span> <span class="n">listening_active</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">BUTTON_ACTIVE</span>
        <span class="n">text_str</span> <span class="o">=</span> <span class="s">"LISTENING..."</span>
        <span class="k">if</span>  <span class="n">printed</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'Start listening...'</span><span class="p">)</span>
            <span class="n">printed</span><span class="o">=</span><span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">BUTTON_HOVER</span> <span class="k">if</span> <span class="n">button_rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">)</span> <span class="k">else</span> <span class="n">BUTTON_COLOR</span>
        <span class="n">text_str</span> <span class="o">=</span> <span class="s">"LISTEN"</span>
        <span class="n">printed</span><span class="o">=</span><span class="bp">False</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">button_rect</span><span class="p">,</span> <span class="n">border_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">button_font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">text_str</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">)</span>
    <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">get_rect</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">button_rect</span><span class="p">.</span><span class="n">center</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

<span class="c1"># Shared variables
</span><span class="n">spoken_time_str</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">typed_text</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">typing_start_time</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">typing_speed</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">cursor_visible</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">last_cursor_toggle</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">text_display_complete_time</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c1"># Speak time and trigger typing
</span><span class="k">def</span> <span class="nf">speak_time</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">spoken_time_str</span><span class="p">,</span> <span class="n">typed_text</span><span class="p">,</span> <span class="n">typing_start_time</span><span class="p">,</span> <span class="n">text_display_complete_time</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">now</span><span class="p">.</span><span class="n">minute</span>

    <span class="c1"># Determine AM/PM
</span>    <span class="n">am_pm</span> <span class="o">=</span> <span class="s">"AM"</span> <span class="k">if</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">12</span> <span class="k">else</span> <span class="s">"PM"</span>
    <span class="n">hour_display</span> <span class="o">=</span> <span class="n">hour</span> <span class="o">%</span> <span class="mi">12</span>
    <span class="n">hour_display</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">hour_display</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">hour_display</span>

    <span class="c1"># Determine greeting based on hour
</span>    <span class="k">if</span> <span class="mi">5</span> <span class="o">&lt;=</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">greeting</span> <span class="o">=</span> <span class="s">"Good morning"</span>
    <span class="k">elif</span> <span class="mi">12</span> <span class="o">&lt;=</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">:</span>
        <span class="n">greeting</span> <span class="o">=</span> <span class="s">"Good afternoon"</span>
    <span class="k">elif</span> <span class="mi">17</span> <span class="o">&lt;=</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">21</span><span class="p">:</span>
        <span class="n">greeting</span> <span class="o">=</span> <span class="s">"Good evening"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">greeting</span> <span class="o">=</span> <span class="s">"Good night"</span>

    <span class="c1"># Combine greeting and time as two lines
</span>    <span class="n">spoken_time_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">greeting</span><span class="si">}</span><span class="se">\n</span><span class="s">It's </span><span class="si">{</span><span class="n">hour_display</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">minute</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">am_pm</span><span class="si">}</span><span class="s"> now!"</span>

    <span class="n">typed_text</span> <span class="o">=</span> <span class="s">""</span>  <span class="c1"># Reset typing
</span>    <span class="n">typing_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">text_display_complete_time</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Speak TTS
</span>    <span class="k">def</span> <span class="nf">tts_func</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="n">tts_engine</span> <span class="o">=</span> <span class="n">pyttsx3</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>
        <span class="n">tts_engine</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">'rate'</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
        <span class="n">tts_engine</span><span class="p">.</span><span class="n">say</span><span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">". "</span><span class="p">))</span>  <span class="c1"># Speak as single sentence
</span>        <span class="n">tts_engine</span><span class="p">.</span><span class="n">runAndWait</span><span class="p">()</span>

    <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">tts_func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">spoken_time_str</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>

<span class="c1">#  VOSK STT SETUP
</span><span class="n">MODEL_PATH</span> <span class="o">=</span> <span class="s">"vosk-model-small-en-us-0.15"</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MODEL_PATH</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Missing model folder '</span><span class="si">{</span><span class="n">MODEL_PATH</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">vosk_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">MODEL_PATH</span><span class="p">)</span>
<span class="n">recognizer</span> <span class="o">=</span> <span class="n">KaldiRecognizer</span><span class="p">(</span><span class="n">vosk_model</span><span class="p">,</span> <span class="mi">16000</span><span class="p">)</span>
<span class="n">sd_stream</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># Global reference to microphone stream
</span>
<span class="k">def</span> <span class="nf">audio_to_bytes</span><span class="p">(</span><span class="n">indata</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">indata</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">indata</span><span class="p">.</span><span class="n">tobytes</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">stt_listen_loop</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">sd_stream</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">sd</span><span class="p">.</span><span class="n">RawInputStream</span><span class="p">(</span>
            <span class="n">samplerate</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>
            <span class="n">blocksize</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s">'int16'</span><span class="p">,</span>
            <span class="n">channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">stt_callback</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">sd_stream</span> <span class="o">=</span> <span class="n">stream</span>
            <span class="k">while</span> <span class="n">listening_active</span><span class="p">:</span>
                <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Microphone error:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">stt_callback</span><span class="p">(</span><span class="n">indata</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span> <span class="n">time_data</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Audio status:"</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">audio_to_bytes</span><span class="p">(</span><span class="n">indata</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">recognizer</span><span class="p">.</span><span class="n">AcceptWaveform</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">result_text</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">recognizer</span><span class="p">.</span><span class="n">Result</span><span class="p">()).</span><span class="n">get</span><span class="p">(</span><span class="s">"text"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result_text</span><span class="p">.</span><span class="n">strip</span><span class="p">():</span>  <span class="c1"># Only print non-empty text
</span>            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Detected: </span><span class="si">{</span><span class="n">result_text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">"time"</span> <span class="ow">in</span> <span class="n">result_text</span><span class="p">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">speak_time</span><span class="p">()</span>

<span class="c1"># CLOCK DRAWING FUNCTIONS
</span>
<span class="k">def</span> <span class="nf">draw_clock_face</span><span class="p">():</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">),</span> <span class="n">clock_radius</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">DARK_GRAY</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">),</span> <span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">hour</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span>
        <span class="n">number_x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">30</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="n">number_y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">30</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span>
        <span class="n">number_text</span> <span class="o">=</span> <span class="n">font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hour</span><span class="p">),</span> <span class="bp">True</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">)</span>
        <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">number_text</span><span class="p">,</span> <span class="p">(</span><span class="n">number_x</span><span class="p">,</span> <span class="n">number_y</span><span class="p">))</span>
        <span class="n">tick_start_x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">tick_start_y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">tick_end_x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">tick_end_y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">,</span> <span class="p">(</span><span class="n">tick_start_x</span><span class="p">,</span> <span class="n">tick_start_y</span><span class="p">),</span> <span class="p">(</span><span class="n">tick_end_x</span><span class="p">,</span> <span class="n">tick_end_y</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">minute</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">60</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">minute</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">minute</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span>
            <span class="n">tick_start_x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">tick_start_y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">tick_end_x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">tick_end_y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">clock_radius</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">GRAY</span><span class="p">,</span> <span class="p">(</span><span class="n">tick_start_x</span><span class="p">,</span> <span class="n">tick_start_y</span><span class="p">),</span> <span class="p">(</span><span class="n">tick_end_x</span><span class="p">,</span> <span class="n">tick_end_y</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">draw_clock_hands</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">last_second</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">hour</span> <span class="o">%</span> <span class="mi">12</span><span class="p">,</span> <span class="n">now</span><span class="p">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">now</span><span class="p">.</span><span class="n">second</span>
    <span class="k">if</span> <span class="n">second</span> <span class="o">!=</span> <span class="n">last_second</span><span class="p">:</span>
        <span class="n">tick</span><span class="p">.</span><span class="n">play</span><span class="p">()</span>
        <span class="n">last_second</span> <span class="o">=</span> <span class="n">second</span>
    <span class="n">hour_angle</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">hour</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">minute</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">minute_angle</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">minute</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">second</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">second_angle</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">second</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">hour_x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="n">clock_radius</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">hour_angle</span><span class="p">)</span>
    <span class="n">hour_y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">clock_radius</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">hour_angle</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">),</span> <span class="p">(</span><span class="n">hour_x</span><span class="p">,</span> <span class="n">hour_y</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">minute_x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="n">clock_radius</span> <span class="o">*</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">minute_angle</span><span class="p">)</span>
    <span class="n">minute_y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">clock_radius</span> <span class="o">*</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">minute_angle</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">),</span> <span class="p">(</span><span class="n">minute_x</span><span class="p">,</span> <span class="n">minute_y</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">second_x</span> <span class="o">=</span> <span class="n">center_x</span> <span class="o">+</span> <span class="n">clock_radius</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">second_angle</span><span class="p">)</span>
    <span class="n">second_y</span> <span class="o">=</span> <span class="n">center_y</span> <span class="o">+</span> <span class="n">clock_radius</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">second_angle</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">RED</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">),</span> <span class="p">(</span><span class="n">second_x</span><span class="p">,</span> <span class="n">second_y</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">RED</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">,</span> <span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">now</span>

<span class="k">def</span> <span class="nf">draw_date_display</span><span class="p">(</span><span class="n">now</span><span class="p">):</span>
    <span class="n">date_text</span> <span class="o">=</span> <span class="n">date_font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y-%m-%d"</span><span class="p">),</span> <span class="bp">True</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">)</span>
    <span class="n">day_text</span> <span class="o">=</span> <span class="n">date_font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%A"</span><span class="p">).</span><span class="n">upper</span><span class="p">(),</span> <span class="bp">True</span><span class="p">,</span> <span class="n">WHITE</span><span class="p">)</span>
    <span class="n">date_rect</span> <span class="o">=</span> <span class="n">date_text</span><span class="p">.</span><span class="n">get_rect</span><span class="p">(</span><span class="n">midtop</span><span class="o">=</span><span class="p">(</span><span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">clock_radius</span> <span class="o">+</span> <span class="mi">70</span><span class="p">))</span>
    <span class="n">day_rect</span> <span class="o">=</span> <span class="n">day_text</span><span class="p">.</span><span class="n">get_rect</span><span class="p">(</span><span class="n">midtop</span><span class="o">=</span><span class="n">date_rect</span><span class="p">.</span><span class="n">midbottom</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">date_text</span><span class="p">,</span> <span class="n">date_rect</span><span class="p">)</span>
    <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">day_text</span><span class="p">,</span> <span class="n">day_rect</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">draw_spoken_time</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">typed_text</span><span class="p">,</span> <span class="n">last_cursor_toggle</span><span class="p">,</span> <span class="n">cursor_visible</span><span class="p">,</span> <span class="n">text_display_complete_time</span><span class="p">,</span> <span class="n">spoken_time_str</span>
    <span class="k">if</span> <span class="n">spoken_time_str</span><span class="p">:</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">typing_start_time</span>
        <span class="c1"># Split into lines
</span>        <span class="n">lines</span> <span class="o">=</span> <span class="n">spoken_time_str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="n">chars_to_show</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">elapsed</span> <span class="o">*</span> <span class="n">typing_speed</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">))</span>
    
        <span class="c1"># Determine how many chars to show per line
</span>        <span class="n">display_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">chars_remaining</span> <span class="o">=</span> <span class="n">chars_to_show</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chars_remaining</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="n">display_lines</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">chars_remaining</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">display_lines</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="n">chars_remaining</span><span class="p">])</span>
                <span class="k">break</span>
    
        <span class="c1"># Clear after 4 seconds of full display
</span>        <span class="k">if</span> <span class="n">chars_to_show</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">)</span> <span class="ow">and</span> <span class="n">text_display_complete_time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">text_display_complete_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">text_display_complete_time</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">text_display_complete_time</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">spoken_time_str</span> <span class="o">=</span> <span class="s">""</span>
            <span class="n">typed_text</span> <span class="o">=</span> <span class="s">""</span>
            <span class="k">return</span>

        <span class="c1"># Cursor blink timer
</span>        <span class="k">if</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_cursor_toggle</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">cursor_visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">cursor_visible</span>
            <span class="n">last_cursor_toggle</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Render each line
</span>        <span class="n">y_offset</span> <span class="o">=</span> <span class="n">HEIGHT</span> <span class="o">-</span> <span class="mi">130</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">display_lines</span><span class="p">):</span>
            <span class="n">text_surface</span> <span class="o">=</span> <span class="n">time_str_font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">LIME</span><span class="p">)</span>
            <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="p">.</span><span class="n">get_rect</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="n">WIDTH</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_offset</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">35</span><span class="p">))</span>
            <span class="n">screen</span><span class="p">.</span><span class="n">blit</span><span class="p">(</span><span class="n">text_surface</span><span class="p">,</span> <span class="n">text_rect</span><span class="p">)</span>

        <span class="c1"># Draw cursor at end of last line
</span>        <span class="k">if</span> <span class="n">cursor_visible</span> <span class="ow">and</span> <span class="n">display_lines</span><span class="p">:</span>
            <span class="n">last_line</span> <span class="o">=</span> <span class="n">display_lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">text_surface</span> <span class="o">=</span> <span class="n">time_str_font</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">last_line</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">LIME</span><span class="p">)</span>
            <span class="n">text_rect</span> <span class="o">=</span> <span class="n">text_surface</span><span class="p">.</span><span class="n">get_rect</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="n">WIDTH</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_offset</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">display_lines</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">35</span><span class="p">))</span>
            <span class="n">cursor_x</span> <span class="o">=</span> <span class="n">text_rect</span><span class="p">.</span><span class="n">right</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">cursor_y</span> <span class="o">=</span> <span class="n">text_rect</span><span class="p">.</span><span class="n">top</span> <span class="o">+</span> <span class="mi">4</span>
            <span class="n">cursor_height</span> <span class="o">=</span> <span class="n">text_rect</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="n">pygame</span><span class="p">.</span><span class="n">draw</span><span class="p">.</span><span class="n">rect</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">LIME</span><span class="p">,</span> <span class="p">(</span><span class="n">cursor_x</span><span class="p">,</span> <span class="n">cursor_y</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">cursor_height</span><span class="p">))</span>


<span class="c1"># MAIN LOOP
</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">listening_active</span>
    <span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">Clock</span><span class="p">()</span>
    <span class="n">running</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">stt_thread</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">while</span> <span class="n">running</span><span class="p">:</span>
        <span class="n">mouse_pos</span> <span class="o">=</span> <span class="n">pygame</span><span class="p">.</span><span class="n">mouse</span><span class="p">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">QUIT</span><span class="p">:</span>
                <span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="p">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">K_ESCAPE</span><span class="p">:</span>
                <span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">event</span><span class="p">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="p">.</span><span class="n">MOUSEBUTTONDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="p">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">button_rect</span><span class="p">.</span><span class="n">collidepoint</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">pos</span><span class="p">):</span>
                    <span class="n">listening_active</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">listening_active</span>
                    <span class="k">if</span> <span class="n">listening_active</span><span class="p">:</span>
                        <span class="c1"># Start background STT listening
</span>                        <span class="n">stt_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">stt_listen_loop</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">stt_thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Stop listening
</span>                        <span class="k">print</span><span class="p">(</span><span class="s">"Stopping listening..."</span><span class="p">)</span>
                        <span class="n">sd_stream</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">screen</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">BLACK</span><span class="p">)</span>
        <span class="n">draw_clock_face</span><span class="p">()</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">draw_clock_hands</span><span class="p">()</span>
        <span class="n">draw_date_display</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
        <span class="n">draw_spoken_time</span><span class="p">()</span>
        <span class="n">draw_button</span><span class="p">(</span><span class="n">mouse_pos</span><span class="p">)</span>
        <span class="n">pygame</span><span class="p">.</span><span class="n">display</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span>
        <span class="n">clock</span><span class="p">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

    <span class="n">pygame</span><span class="p">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

</code></pre></div></div>

<hr />

<p><strong>Website:</strong> https://www.pyshine.com
<strong>Author:</strong> PyShine</p>


          <!-- Inline code styling -->
          <link href="/assets/css/syntax.css" rel="stylesheet">
          <script src="/assets/scripts/copyCode.js" async></script>

          <!-- Google Ad (responsive rectangle after content) -->
          <section aria-label="Advertisements" class="ads mt-4">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-2976211678184829"
                 data-ad-slot="7658460605"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </section>

        </article>

      </div>

      <!-- Post Navigation -->
      <nav class="post-navigation controls__inner mt-5" aria-label="Post navigation">
        <div class="controls__item prev">
          
            <span>Previous</span>
            <a href="/Talking-Wall-Clock/" rel="prev">
              Talking Clock Tutorial with Text-to-S...
            </a>
          
        </div>

        <div class="controls__item next">
          
        </div>
      </nav>

      <!-- Comments Section -->
      
        <section class="comments mt-5" aria-label="Comments Section">
          
<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = 'https://www.pyshine.com/Listening-and-Talking-clock/';
this.page.identifier = 'https://www.pyshine.com/Listening-and-Talking-clock/';
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://https-py2ai-github-io.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the comments.</noscript>


        </section>
      

    </main>

    <footer class="footer">
  <div class="container">
    <nav class="social">
      
      
      
    </nav>
    <span>&copy; 2025 PyShine. All rights reserved.</span>
  </div>
</footer>
<script async src="/assets/js/bundle.js"></script>

<script async>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function( registration ) {
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    })
    .catch(function(error) {
      console.log('ServiceWorker registration failed: ', error);
    });
  }
</script>



    <!-- Scripts at bottom for performance -->
    


    <!-- Async Ads script globally -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <!-- TOC Auto Generator -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      const toc = document.getElementById("toc-list");
      const headings = document.querySelectorAll(".post-content h2, .post-content h3");
      if (!toc || headings.length === 0) return;

      const ul = document.createElement("ul");
      headings.forEach(h => {
        const id = h.id || h.textContent.trim().toLowerCase().replace(/\s+/g, "-");
        h.id = id;
        const li = document.createElement("li");
        if (h.tagName === "H3") li.style.marginLeft = "1rem";
        li.innerHTML = `<a href="#${id}">${h.textContent}</a>`;
        ul.appendChild(li);
      });
      toc.appendChild(ul);
    });
    </script>

  </body>
</html>


